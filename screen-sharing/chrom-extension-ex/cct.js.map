{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap dcce4e8a613d21abf6d6","webpack:///./~/core-js/library/modules/_core.js","webpack:///./~/babel-runtime/helpers/classCallCheck.js","webpack:///./~/babel-runtime/helpers/createClass.js","webpack:///./~/core-js/library/modules/_wks.js","webpack:///./lib/common/log.js","webpack:///./~/core-js/library/modules/_global.js","webpack:///./~/core-js/library/modules/_export.js","webpack:///./~/babel-runtime/core-js/object/get-prototype-of.js","webpack:///./~/core-js/library/modules/_object-dp.js","webpack:///./~/core-js/library/modules/_descriptors.js","webpack:///./~/babel-runtime/helpers/inherits.js","webpack:///./~/babel-runtime/helpers/possibleConstructorReturn.js","webpack:///./lib/common/argCheck.js","webpack:///./lib/common/utils.js","webpack:///./~/core-js/library/modules/_an-object.js","webpack:///./~/core-js/library/modules/_hide.js","webpack:///./~/core-js/library/modules/_to-iobject.js","webpack:///./~/core-js/library/modules/_is-object.js","webpack:///./~/core-js/library/modules/_ctx.js","webpack:///./~/core-js/library/modules/_has.js","webpack:///./~/core-js/library/modules/_fails.js","webpack:///./~/core-js/library/modules/_iterators.js","webpack:///./~/core-js/library/modules/es6.string.iterator.js","webpack:///./~/babel-runtime/core-js/promise.js","webpack:///./~/core-js/library/modules/_object-keys.js","webpack:///./~/core-js/library/modules/_cof.js","webpack:///./~/core-js/library/modules/_property-desc.js","webpack:///./~/core-js/library/modules/_set-to-string-tag.js","webpack:///./~/core-js/library/modules/_to-object.js","webpack:///./~/core-js/library/modules/web.dom.iterable.js","webpack:///./~/babel-runtime/core-js/map.js","webpack:///./~/babel-runtime/helpers/toConsumableArray.js","webpack:///./~/core-js/library/modules/_defined.js","webpack:///./~/core-js/library/modules/_to-length.js","webpack:///./~/core-js/library/modules/_uid.js","webpack:///./lib/common/emitter.js","webpack:///./~/core-js/library/modules/_library.js","webpack:///./~/core-js/library/modules/_object-create.js","webpack:///./~/babel-runtime/helpers/typeof.js","webpack:///./~/core-js/library/modules/_for-of.js","webpack:///./~/babel-runtime/helpers/slicedToArray.js","webpack:///./~/core-js/library/modules/_classof.js","webpack:///./~/core-js/library/modules/_shared-key.js","webpack:///./~/core-js/library/modules/_to-integer.js","webpack:///./~/babel-runtime/core-js/object/define-property.js","webpack:///./~/core-js/library/modules/_dom-create.js","webpack:///./~/core-js/library/modules/_enum-bug-keys.js","webpack:///./~/core-js/library/modules/_iter-define.js","webpack:///./~/core-js/library/modules/_object-pie.js","webpack:///./~/core-js/library/modules/_shared.js","webpack:///./~/babel-runtime/core-js/json/stringify.js","webpack:///./~/babel-runtime/core-js/set.js","webpack:///./~/core-js/library/modules/_a-function.js","webpack:///./~/core-js/library/modules/_to-primitive.js","webpack:///./~/core-js/library/modules/_an-instance.js","webpack:///./~/core-js/library/modules/_object-sap.js","webpack:///./~/core-js/library/modules/_redefine-all.js","webpack:///./~/core-js/library/modules/_meta.js","webpack:///./~/core-js/library/modules/_object-gopd.js","webpack:///./~/core-js/library/modules/_wks-define.js","webpack:///./~/core-js/library/modules/_wks-ext.js","webpack:///./~/core-js/library/modules/core.get-iterator-method.js","webpack:///./~/core-js/library/modules/_iobject.js","webpack:///./~/babel-runtime/core-js/object/create.js","webpack:///./~/babel-runtime/core-js/object/keys.js","webpack:///./~/babel-runtime/helpers/get.js","webpack:///./~/core-js/library/modules/_html.js","webpack:///./~/core-js/library/modules/_ie8-dom-define.js","webpack:///./~/core-js/library/modules/_is-array-iter.js","webpack:///./~/core-js/library/modules/_iter-call.js","webpack:///./~/core-js/library/modules/_iter-step.js","webpack:///./~/core-js/library/modules/_object-gops.js","webpack:///./~/core-js/library/modules/_object-gpo.js","webpack:///./~/core-js/library/modules/_object-keys-internal.js","webpack:///./~/core-js/library/modules/_redefine.js","webpack:///./lib/webrtc/utils.js","webpack:///./~/core-js/library/modules/_iter-detect.js","webpack:///./~/core-js/library/modules/_set-species.js","webpack:///./~/core-js/library/modules/_is-array.js","webpack:///./~/core-js/library/modules/_object-gopn.js","webpack:///./~/core-js/library/modules/_task.js","webpack:///./~/babel-runtime/core-js/array/from.js","webpack:///./~/core-js/library/modules/_collection-strong.js","webpack:///./~/core-js/library/modules/_collection-to-json.js","webpack:///./~/core-js/library/modules/_collection.js","webpack:///./~/babel-runtime/helpers/defineProperty.js","webpack:///./lib/media/mediaNode.js","webpack:///./~/babel-runtime/helpers/toArray.js","webpack:///./~/core-js/library/modules/_object-dps.js","webpack:///./~/babel-runtime/core-js/object/get-own-property-descriptor.js","webpack:///./~/babel-runtime/core-js/symbol.js","webpack:///./~/babel-runtime/core-js/symbol/iterator.js","webpack:///./~/core-js/library/fn/object/define-property.js","webpack:///./~/core-js/library/modules/_add-to-unscopables.js","webpack:///./~/core-js/library/modules/_array-includes.js","webpack:///./~/core-js/library/modules/_iter-create.js","webpack:///./~/core-js/library/modules/_object-gopn-ext.js","webpack:///./~/core-js/library/modules/_string-at.js","webpack:///./~/core-js/library/modules/_to-index.js","webpack:///./~/core-js/library/modules/es6.array.iterator.js","webpack:///./~/core-js/library/modules/es6.object.define-property.js","webpack:///./lib/media/common.js","webpack:///./lib/conference/raftConfiguration.js","webpack:///./lib/conference/raftLogEntry.js","webpack:///./~/babel-runtime/core-js/object/set-prototype-of.js","webpack:///./~/core-js/library/fn/array/from.js","webpack:///./~/core-js/library/fn/object/create.js","webpack:///./~/core-js/library/fn/object/get-own-property-descriptor.js","webpack:///./~/core-js/library/fn/object/get-prototype-of.js","webpack:///./~/core-js/library/fn/object/set-prototype-of.js","webpack:///./~/core-js/library/fn/promise.js","webpack:///./~/core-js/library/fn/set.js","webpack:///./~/core-js/library/fn/symbol/index.js","webpack:///./~/core-js/library/fn/symbol/iterator.js","webpack:///./~/core-js/library/modules/_array-from-iterable.js","webpack:///./~/core-js/library/modules/_array-methods.js","webpack:///./~/core-js/library/modules/_array-species-constructor.js","webpack:///./~/core-js/library/modules/_array-species-create.js","webpack:///./~/core-js/library/modules/_create-property.js","webpack:///./~/core-js/library/modules/_enum-keys.js","webpack:///./~/core-js/library/modules/_invoke.js","webpack:///./~/core-js/library/modules/_keyof.js","webpack:///./~/core-js/library/modules/_microtask.js","webpack:///./~/core-js/library/modules/_set-proto.js","webpack:///./~/core-js/library/modules/_species-constructor.js","webpack:///./~/core-js/library/modules/es6.array.from.js","webpack:///./~/core-js/library/modules/es6.object.create.js","webpack:///./~/core-js/library/modules/es6.object.get-own-property-descriptor.js","webpack:///./~/core-js/library/modules/es6.object.get-prototype-of.js","webpack:///./~/core-js/library/modules/es6.object.set-prototype-of.js","webpack:///./~/core-js/library/modules/es6.promise.js","webpack:///./~/core-js/library/modules/es6.set.js","webpack:///./~/core-js/library/modules/es6.symbol.js","webpack:///./~/core-js/library/modules/es7.set.to-json.js","webpack:///./~/core-js/library/modules/es7.symbol.async-iterator.js","webpack:///./~/core-js/library/modules/es7.symbol.observable.js","webpack:///./lib/conference/raftMessages.js","webpack:///./~/core-js/library/fn/json/stringify.js","webpack:///./~/core-js/library/fn/map.js","webpack:///./~/core-js/library/fn/object/keys.js","webpack:///./~/core-js/library/modules/es6.map.js","webpack:///./~/core-js/library/modules/es6.object.keys.js","webpack:///./~/core-js/library/modules/es7.map.to-json.js","webpack:///./lib/media/mediaSource.js","webpack:///./lib/common/errors.js","webpack:///./lib/conference/meshTopology.js","webpack:///./lib/media/mediaNodeInput.js","webpack:///./lib/media/htmlSink.js","webpack:///./lib/webrtc/rtcComponent.js","webpack:///./lib/webrtc/errors.js","webpack:///./~/babel-runtime/core-js/get-iterator.js","webpack:///./lib/media/concreteMediaSource.js","webpack:///./lib/media/mediaNodeOutput.js","webpack:///./lib/media/mediaSink.js","webpack:///./lib/matrix/resources.js","webpack:///./lib/common/request.js","webpack:///./lib/conference/raftState.js","webpack:///./lib/matrix/ids.js","webpack:///./~/babel-runtime/core-js/is-iterable.js","webpack:///./~/core-js/library/fn/get-iterator.js","webpack:///./~/core-js/library/fn/is-iterable.js","webpack:///./~/core-js/library/modules/core.get-iterator.js","webpack:///./~/core-js/library/modules/core.is-iterable.js","webpack:///./lib/common/queue.js","webpack:///./lib/media/mediaFilter.js","webpack:///./lib/media/muteFilter.js","webpack:///./lib/media/passthrough.js","webpack:///./lib/datamux/constants.js","webpack:///./lib/webrtc/peerConnectionProxy.js","webpack:///./~/babel-runtime/core-js/object/assign.js","webpack:///./lib/conference/raft.js","webpack:///./lib/matrix/accountData.js","webpack:///./lib/matrix/powerLevels.js","webpack:///./lib/matrix/room.js","webpack:///./lib/matrix/user.js","webpack:///./lib/media/streamSink.js","webpack:///./lib/media/streamSource.js","webpack:///./lib/media/streamSplitter.js","webpack:///./lib/webrtc/attachmentManager.js","webpack:///./lib/webrtc/dataHub.js","webpack:///./lib/conference/raftLog.js","webpack:///./lib/conference/raftStateMachine.js","webpack:///./lib/matrix/errors.js","webpack:///./lib/matrix/userRegistry.js","webpack:///./~/babel-runtime/core-js/object/get-own-property-names.js","webpack:///./~/core-js/library/fn/object/assign.js","webpack:///./~/core-js/library/fn/object/get-own-property-names.js","webpack:///./~/core-js/library/modules/_object-assign.js","webpack:///./~/core-js/library/modules/es6.object.assign.js","webpack:///./~/core-js/library/modules/es6.object.get-own-property-names.js","webpack:///./lib/conference/conference.js","webpack:///./lib/matrix/roomQuery.js","webpack:///./lib/matrix/roomState.js","webpack:///./lib/media/chromeScreenSource.js","webpack:///./lib/media/dummySource.js","webpack:///./lib/media/firefoxScreenSource.js","webpack:///./lib/media/mediaTee.js","webpack:///./lib/media/userMediaSource.js","webpack:///./lib/media/webAudioFilter.js","webpack:///./lib/media/webAudioSource.js","webpack:///./lib/webrtc/call.js","webpack:///./lib/webrtc/components.js","webpack:///./lib/webrtc/fileRef.js","webpack:///./lib/datamux/datamux.js","webpack:///./lib/datamux/transfer.js","webpack:///./lib/webrtc/candidater.js","webpack:///./lib/webrtc/channelControllers.js","webpack:///./lib/webrtc/dataChannelMonitor.js","webpack:///./lib/webrtc/signaler.js","webpack:///./~/babel-runtime/core-js/object/define-properties.js","webpack:///./~/babel-runtime/core-js/object/entries.js","webpack:///./~/core-js/library/modules/_object-to-array.js","webpack:///./~/sdp-transform/lib/grammar.js","webpack:///(webpack)/buildin/global.js","webpack:///./lib/matrix/auth.js","webpack:///./lib/matrix/client.js","webpack:///./lib/media/audioBufferSource.js","webpack:///./lib/media/audioMeter.js","webpack:///./lib/media/audioMixer.js","webpack:///./lib/media/deviceSource.js","webpack:///./lib/media/recorder.js","webpack:///./lib/media/screenSource.js","webpack:///./lib/media/streamMerger.js","webpack:///./lib/media/videoFrameCapture.js","webpack:///./lib/webrtc/streamPubSub.js","webpack:///./lib/webrtc/thumbnailBroadcaster.js","webpack:///./lib/cct.js","webpack:///./lib/common/reporter.js","webpack:///./lib/conference/conferenceConnection.js","webpack:///./lib/conference/conferenceConnectionPool.js","webpack:///./lib/conference/conferencePeers.js","webpack:///./lib/conference/switcher.js","webpack:///./lib/conference/voiceActivityDetector.js","webpack:///./lib/datamux/activityTracker.js","webpack:///./lib/datamux/bandwidthEstimation.js","webpack:///./lib/datamux/buffers.js","webpack:///./lib/datamux/channel.js","webpack:///./lib/datamux/channelController.js","webpack:///./lib/datamux/channelDriver.js","webpack:///./lib/datamux/registry.js","webpack:///./lib/matrix/callRegistry.js","webpack:///./lib/matrix/roomRegistry.js","webpack:///./lib/matrix/syncStream.js","webpack:///./lib/media/canvasFilter.js","webpack:///./lib/media/canvasSource.js","webpack:///./lib/media/scaledCanvasFilter.js","webpack:///./lib/media/screenSourceInfo.js","webpack:///./lib/media/temasysCanvasFilter.js","webpack:///./lib/media/temasysScreenSource.js","webpack:///./lib/webrtc/peerConnectionMonitor.js","webpack:///./lib/webrtc/renegotiator.js","webpack:///./lib/webrtc/sdpTransform.js","webpack:///./lib/webrtc/statsFormatter.js","webpack:///./lib/webrtc/statsNormalizer.js","webpack:///./~/babel-runtime/core-js/math/log2.js","webpack:///./~/babel-runtime/core-js/math/sign.js","webpack:///./~/babel-runtime/core-js/object/values.js","webpack:///./~/babel-runtime/helpers/extends.js","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./~/core-js/library/fn/math/log2.js","webpack:///./~/core-js/library/fn/math/sign.js","webpack:///./~/core-js/library/fn/object/define-properties.js","webpack:///./~/core-js/library/fn/object/entries.js","webpack:///./~/core-js/library/fn/object/values.js","webpack:///./~/core-js/library/modules/_math-sign.js","webpack:///./~/core-js/library/modules/es6.math.log2.js","webpack:///./~/core-js/library/modules/es6.math.sign.js","webpack:///./~/core-js/library/modules/es6.object.define-properties.js","webpack:///./~/core-js/library/modules/es7.object.entries.js","webpack:///./~/core-js/library/modules/es7.object.values.js","webpack:///./~/adapterjs/publish/adapter.min.js","webpack:///./~/process/browser.js","webpack:///./~/regenerator-runtime/runtime-module.js","webpack:///./~/regenerator-runtime/runtime.js","webpack:///./~/sdp-interop/lib/array-equals.js","webpack:///./~/sdp-interop/lib/index.js","webpack:///./~/sdp-interop/lib/interop.js","webpack:///./~/sdp-interop/lib/transform.js","webpack:///./~/sdp-transform/lib/index.js","webpack:///./~/sdp-transform/lib/parser.js","webpack:///./~/sdp-transform/lib/writer.js"],"names":["Log","_defaultLogLevel","WARNING","_categoryLevels","_logHandlers","prototype","setLogHandler","levels","handler","arguments","length","ALL","TypeError","forEach","level","index","bind","setLogLevel","category","createLogFunction","mask","message","args","argCheck","string","logLevel","object","objectMessage","objectArgs","call","toUpperCase","NONE","reduce","ignored","log","setLog","_log","logFunctions","ERROR","console","error","warn","INFO","info","DEBUG","debug","VERBOSE","logColors","defaultLogHandler","colorLogHandler","color","colors","defaultHandler","isChrome","optArgCheck","prop","context","name","value","extra","undefined","e","count","requiredCount","actualCount","criteria","constructor","optObject","Array","isArray","RegExp","optInstance","instance","Error","atLeastOneMatch","some","names","map","join","optFunc","func","optArray","array","optString","optStringOrEmpty","stringOrEmpty","optValues","values","indexOf","optNumber","number","isNaN","isFinite","optBoolean","boolean","options","OptionsArgChecker","optOptions","empty","optOptionsArgCheck","type","find","collection","thisArg","key","hasOwnProperty","fill","len","i","filter","arr","push","mapValues","obj","diff","collection1","collection2","set1","set2","added","removed","has","element","toArray","arrayLike","hiddenProp","enumerable","configurable","writable","getter","get","range","from","to","step","defer","deferred","promise","resolve","reject","shallowCopy","keys","result","assign","other","wait","time","setTimeout","apply","randomString","size","now","crypto","noVendor","globalObject","require","randomBytes","window","Uint8Array","getRandomValues","Date","getTime","Math","random","rawString","String","fromCharCode","base64String","utf8ToBase64","replace","slice","arrayBufferSha1IfSupported","arrayBuffer","subtleCrypto","subtle","digest","base64ToUtf8","base64","global","Buffer","toString","atob","utf8","btoa","urlSafeBase64ToUtf8","urlSafeBase64","charFromUrlSafeBase64","utf8ToUrlSafeBase64","charToUrlSafeBase64","char","binaryStringToArrayBuffer","binaryString","buffer","ArrayBuffer","view","charCodeAt","unicodeStringToArrayBuffer","unicodeString","Uint16Array","bufferViewToString","chunkSize","subarray","arrayBufferToBinaryString","byteOffset","byteLength","arrayBufferToUnicodeString","parseDataUri","dataUri","split","mimeType","blobToArrayBuffer","blob","reader","FileReader","onload","onerror","readAsArrayBuffer","bufferToFile","fileName","file","Blob","lastModifiedDate","bufferToHex","x","hexToBuffer","hex","substr","parseInt","concatenateArrayBuffers","buffers","totalLength","offset","set","upper","unprefixed","__C3_SDK_INSTANCES__","listeners","addListener","listener","add","removeListener","delete","registerInstance","collectionName","unregisterInstance","splice","priv","assertPriv","providedPriv","isFirefox","test","navigator","userAgent","isGoogle","vendor","browser","isIE","document","documentMode","isObject","notInNode","thing","maybeConvertStringToNumber","Number","parseFloat","getStringByteLength","bytes","charCode","ReadOnlyMap","ReadOnlySet","createTimedBuffer","callback","timeout","arg","onTimeout","errorForwarder","location","newError","reason","DEFAULT_LISTENER_LIMIT","LEAK_MESSAGE","limit","emitterPrototype","Base","EmitterMixin","emitter","superclass","__listeners","eventType","_listeners","deprecationMessage","_deprecatedEvents","warning","remaining","iterating","pending","LISTENER_LIMIT","newListeners","concat","listenerCount","clear","called","stack","isWebRtcPlugin","webrtcDetectedType","MediaStream","AudioContext","isMediaStream","stream","id","addTrack","getTracks","webRtcReady","ret","AdapterJS","webRTCReady","addPeerConnectionStream","peerConnection","removeSet","_streamsPendingRemoval","addStream","ALLOWED_REMOVE_STATES","waitForStableState","onState","state","signalingState","removeEventListener","addEventListener","removeAllTracks","tracks","sender","getSenders","track","removeTrack","removePeerConnectionStream","removeStream","BinaryTree","nodes","tag","root","parent","child","childIndex","parentIndex","floor","left","right","AudioContextUtil","MAX_REFERENCES","_references","_context","release","close","audioContextUtil","getMediaStreamId","_blobId","fullId","collectStreams","streams","streamDiff","streams1","streams2","streamMap1","streamMap2","streamIds1","streamIds2","addedIds","removedIds","addedStreams","removedStreams","TAG","MediaNode","camelName","toLowerCase","output","input","HTMLElement","MediaNodeOutput","connect","disconnect","target","PortMap","portConstructor","onStream","onCreate","onDetach","_parent","_portConstructor","_onStream","_onCreate","_onDetach","port","oldStream","constructorError","detach","_","InputMap","inputConstructor","OutputMap","outputConstructor","mediaNodeSpecies","inputs","outputs","isMediaNode","doesntSupportPlugin","OverconstrainedError","errorName","gumQueue","NOT_ALLOWED_ERRORS","NOT_FOUND_ERRORS","OVERCONSTRAINED_ERRORS","getUserMedia","constraints","gumError","constraint","Configuration","ownId","_ownId","_members","Members","newMembers","ConfigurationData","data","members","peerId","grantedVotes","hasMajority","matchIndices","getMajorityIndex","voteCount","majorityCount","indices","majorityPosition","majorityIndexPosition","sort","Votes","_votes","granted","voters","RaftLogEntry","json","term","ConfigurationEntry","parse","op","OpEntry","_term","_index","_data","OP","noop","append","opNames","_id","_op","_args","shortId","RaftMessage","body","params","MessageConstructor","messageConstructors","AppendEntriesRequest","topologyIndex","prevIndex","prevTerm","commitIndex","entries","_topologyIndex","_prevIndex","_prevTerm","_commitIndex","_entries","entry","entryIndex","LogEntry","success","needSnapshot","meshTopology","matchIndex","localTopologyInfo","topologyInfo","volume","flag","APPEND_ENTRIES_RESPONSE_FLAG_SUCCESS","APPEND_ENTRIES_RESPONSE_FLAG_FAILURE","APPEND_ENTRIES_RESPONSE_FLAG_NEED_SNAPSHOT","AppendEntriesResponse","_flag","_matchIndex","_topologyInfo","PeerTopologyInfo","parseUpdate","_volume","power","links","RequestVoteRequest","lastLogTerm","lastLogIndex","_lastLogTerm","_lastLogIndex","RequestVoteResponse","_granted","PreVoteRequest","PreVoteResponse","SnapshotRequest","lastTerm","lastIndex","configuration","_lastTerm","_lastIndex","_configuration","_state","SnapshotResponse","StateOpRequest","errorCode","StateOpResponse","_errorCode","NOT_LEADER","MediaSource","_output","setStream","connectMixin","CctError","captureStackTrace","Object","defineProperty","toJSON","NotAllowedError","NotFoundError","UnknownError","LinkInfo","rttMs","bandwidth","up","onUpdate","_rttMs","_bandwidth","_up","_onUpdate","oldUp","changedUpState","LinkInfos","linkInfos","linkInfo","INDEX_UP_STATE_CHANGE_SIZE","onChange","_peerId","_onChange","_links","_power","indexChange","verbose","LocalTopologyInfo","voiceActivityDetector","_handleUpdate","_voiceActivityDetector","active","setActive","infoStrings","MeshTopology","_localTopologyInfo","_onLocalTopologyUpdate","_topologyInfos","_changeListeners","_active","peerTopologyInfo","_invalidate","deactivate","MediaNodeInput","_name","_stream","_target","_setStream","chain","replacement","HtmlSink","bail","_refreshSink","_refreshTick","detachEvent","attachEvent","catch","HTMLMediaElement","srcObject","src","attachMediaStream","originalElement","play","_cleanup","_assign","RtcComponent","config","label","remoteLabel","_label","_remoteLabel","attachPoint","peer","oldValue","ownerId","channel","component","_attachPoint","ConnectionFailedError","times","timesStr","ConnectionLostError","ConnectionSignalingError","ChannelClosedError","ChannelFailedError","ChannelTimeoutError","timeoutMs","FileTransferError","TransferInterruptedError","downloadedBytes","expectedBytes","ConcreteMediaSource","_onInactive","_deferred","_stopped","_error","stop","_stopStream","_targets","default","sink","_add","isHtmlSink","possibleSinkInput","sinkHasTargetAsTarget","_hasTarget","_delete","_clear","MediaSink","_input","createImageResourceFactory","baseUri","cache","uri","resource","ImageResource","resourceUri","match","resourceId","fragment","thumbnailUri","downloadUri","width","height","resizeMethod","query","RequestError","xhrStatus","ResponseError","JsonResponse","Request","copy","_origin","_path","_params","_query","_config","_headers","_client","DEFAULT_CLIENT","_errorHandler","_fragment","origin","path","client","errorHandler","header","headers","_do","del","post","put","method","extraPath","_compileOptions","executeRequest","encodeURIComponent","url","queryString","_executeXhrWithJsonResponse","xhr","setRequestHeader","copyResponseInfoTo","res","status","statusText","responseURL","getAllResponseHeaders","line","substring","onreadystatechange","readyState","responseText","JSON","parseError","send","jsonRequest","XMLHttpRequest","open","overrideMimeType","uploadFile","upload","event","lengthComputable","_emit","loaded","total","FileUploadClient","JsonRetryClient","_execute","request","self","then","response","err","retryAfterMs","SerializedJsonRetryClient","_queue","_working","_poll","shift","unshift","EXPECTED_RTT_MS","FOLLOWER_REMOVE_TIMEOUT_MS","RaftState","_send","leader","votedFor","FollowerState","preVoteDone","CandidateState","LeaderState","handleAppendEntriesRequest","toFollower","compareLog","_votedFor","_leader","FollowerMapEntry","nextIndex","remove","_removeSelf","_nextIndex","_timeoutId","_removeTimeoutId","_idle","_removeIndex","Infinity","_startTimeout","_sendAppendRequest","clearTimeout","min","_update","toIndex","maxEntries","entryTermAtIndex","sliceEntries","maxCommitIndex","lastEntryIndex","create","_onTopologyChange","_followerMap","_joinerMap","_pendingAdditions","_pendingRemovals","start","createOpEntry","_afterAppend","activate","addChangeListener","forEachPeer","_addFollower","follower","clearInterval","intervalId","removeChangeListener","topology","missingConnections","localLinks","localLink","topologyInfos","missingPeerId","_handlePendingMembershipUpdates","mustRejoin","isMember","_removeFollower","sendSnapshot","snapshot","createSnapshot","setInterval","oldMembers","createConfigurationEntry","addedPeers","removedPeers","phaseOutUntilIndex","_onAppend","_tryCommit","addPeer","handleAppendEntriesResponse","forwardStateOpRequest","clientId","majorityMatchIndex","committed","tryCommitIndexForTerm","createMembersChange","appendConfiguration","addClient","removeClient","_sendPreVoteRequests","_targetTerm","_preVotes","_intervalId","_tick","_preVoteDone","requestFactory","voteCollection","toLeader","JoinerState","_convertToFollowerIfMember","loadSnapshot","configData","getCommittedConfigurationData","includes","TYPE_ROOM","TYPE_USER","TYPE_EVENT","TYPE_ALIAS","tagTypeMap","typeTagMap","parseId","matrixId","rest","typeTag","localId","serverName","parseIdForServer","expectedType","parsedServerName","toMatrixIdForServer","AsyncQueue","_currentTask","factory","task","cancelled","AsyncPipe","_deferredRead","item","pop","MediaFilter","MuteFilter","silent","_audioMuted","_videoMuted","_mute","audio","Boolean","_updateMuteState","video","getAudioTracks","enabled","getVideoTracks","audioMuteBefore","videoMuteBefore","Passthrough","_silent","MT_OPEN","MT_OPEN_ACK","MT_DECLARE","MT_CLOSE","MT_CLEAR","MT_DATA","MT_PING","MT_PONG","MT_TRANSFER_HEADER","MT_TRANSFER_BINARY_DATA","M_SEP","ID_BASE","EVENT_HANDLER_ERROR_TEMPLATE","IceConfigErrorDetector","iceServers","_haveTurn","_haveStun","server","urls","_gotStun","_gotTurn","iceConnectionState","msg","PeerConnectionProxy","statsFormatter","rtcpMuxPolicy","bundlePolicy","iceCandidateFilter","pcConfig","_pc","RTCPeerConnection","_iceCandidateFilter","_eventTarget","_interop","_iceErrorDetector","_firstMid","getLocalStreams","getRemoteStreams","addIceCandidate","_createAnswer","_createOffer","getStats","_setLocalDescription","_setRemoteDescription","oniceconnectionstatechange","onnegotiationneeded","onsignalingstatechange","onaddstream","onremovestream","ondatachannel","deferredIce","_initialIceComplete","onicecandidate","candidate","end","parseCandidateInfo","observedCandidate","sdpMid","simpleMid","attachPeerConnectionMonitor","on","off","_dummyStream","waitForIce","dummy","_rewriteLocalInputDescription","desc","_localDescription","offer","_rewriteLocalOutputDescription","_rewriteRemoteInputDescription","answer","sdp","disableSendBandwidthEstimation","filterSdpCandidates","workaroundSdpBundleBug","RTCSessionDescription","unifiedPlanSdp","mid","extractApplicationBlock","extractedSdp","extracted","needsInteropTranslation","mediaModeUnions","readMediaModeUnions","toPlanB","overrideMediaModes","rewriteBundleAttribute","injectApplicationBlock","oldSdp","removeChromeRetransmission","toUnifiedPlan","setLocalDescription","makeError","setRemoteDescription","createOffer","createAnswer","sdpMLineIndex","RTCIceCandidate","createDataChannel","selector","standardReport","standardStats","report","stat","iceGatheringState","remoteDescription","funcName","WaitList","ttlMs","endTime","max","peerIds","waiting","deleted","ELECTION_DEADLOCK_LIMIT","Raft","onMessage","onStateChange","onMembersChange","onLeadershipChange","onReplicationDeadlock","_onElectionTimeout","_onConfigurationCommitted","_onMessage","_onMembersChange","_onLeadershipChange","_onReplicationDeadlock","_raftState","_electionTimeoutId","_electionTimeoutTriggerCount","_waitList","_stateMachine","onConfigurationCommitted","onStateOpRequest","stateMachine","initialMembers","_setState","_stopElectionTimeout","retryTtlMs","requestStateOp","waitlistTtlMs","newState","wasLeader","_resetElectionTimeout","isLeader","isRequest","handleRequestVoteRequest","handleRequestVoteResponse","handlePreVoteRequest","handlePreVoteResponse","handleSnapshotRequest","handleSnapshotResponse","handleStateOpRequest","handleStateOpResponse","toCandidate","deleteAll","AccountData","setData","_values","_setData","__value__","PowerLevelsEdit","powerLevels","ban","kick","_powerLevels","_serverName","toRawForServer","users","convertUsersToMatrix","user","toUserId","userId","events","setName","setTopic","setType","setPowerLevels","invite","redact","userDefault","users_default","eventDefault","events_default","addState","state_default","fromDefault","creator","edit","_DEFAULT_POWER_LEVELS","_DEFAULT_CREATOR_LEVEL","fromZero","_ZERO_POWER_LEVELS","convertUsersToServer","userLevels","matrixUserLevels","PowerLevelsReader","fromRaw","membershipNameMap","leave","userCollectionNameMap","invited","member","Room","privToken","dependencies","ownUser","delegate","baseRequest","userRegistry","callRegistry","imageResourceFactory","roomType","creationContent","topic","avatar","historyVisibility","alias","membership","joinRule","guestAccessRule","invitedBy","typingUsers","memberships","memberCount","NaN","eventsStart","states","setTypingRequest","setTypingEndTime","loadQueue","queries","powerLevel","powerLevelsReader","waitForJoined","awaitingJoin","replyEventSnatchers","_setAccountData","_accountData","roomRequest","typing","initialSync","setAccountData","_request","addPublicInfo","canonical_alias","num_joined_members","fn","eventHandlers","simple","content","history_visibility","displayname","avatarUrl","avatar_url","getUser","state_key","prev","unsigned","prev_content","oldContent","toSimpleEvent","event_id","isPastEvent","timestamp","origin_server_ts","isOwnEvent","stateKey","isStateChange","room","_handleEvent","overrideEventHandlers","processEvent","overrideEventHandler","eventId","senderId","_processEphemeralEvent","user_ids","stateHandlers","isFromTimeline","cctRoomType","c3Content","newPowerLevel","_matrixId","user_default","oldJoinRule","join_rule","oldGuestAccessRule","guest_access","changedBy","_membershipEventUpdate","changeMembership","processState","setState","_set","_logEvent","_handleRoomSync","roomData","isFirstSync","inviteState","invite_state","_setOwnMembership","transitionedToJoin","stateEvents","accountDataEvents","account_data","ephemeralEvents","ephemeral","timelineEvents","timeline","timelineIsLimited","limited","prevToken","prev_batch","accountDataEvent","roomEvent","_onRoomEvent","_close","membershipEvents","membershipEvent","leaveMembership","closeCallsInRoom","conference","getConferenceInRoom","memberCollections","_newMembership","newMembership","prevMembership","_onRoomMembership","next","prevName","nextName","prevCollection","nextCollection","prevCollectionName","nextCollectionName","returnSelf","throwAuthErrorIfNotFound","isTyping","margin","timeToEnd","setJoinRule","setGuestAccessRule","setAvatar","setHistoryVisibility","msgtype","stateType","req","transaction","commit","load","filterFunction","previousStart","filteredCount","recursiveFetch","addedEvents","addEvents","counted","allEventsLoaded","chunk","executing","user_id","all","startCall","startPassiveCall","startConference","getCallsInRoom","getPassiveCallInRoom","_serviceRequest","serviceLocalId","serviceId","waitForService","banned","aliases","accountData","User","_membershipUpdateTime","presence","statusMessage","lastActive","applyUpdate","newName","newAvatarUrl","newAvatar","newPresence","newStatusMessage","status_msg","lastActiveAgo","last_active_ago","abs","_applyUpdate","StreamSink","StreamSource","StreamSplitter","_audioOutput","_videoOutput","newStream","RtcPeer","onCreateChannel","_onCreateChannel","_remoteChannels","_inputs","_outputs","createChannel","_checkValid","channels","newChannels","AttachPoint","_type","_component","_peers","_streams","_addPeer","rtcComponentDidReceivePeer","_setRemoteChannels","rtcComponentReceivedChannel","_setRemoteStreams","rtcComponentDidLosePeer","AttachmentManager","dataHub","_onAttachPointUpdate","_dataHub","setOnUpdateListener","_onDataUpdate","_attachSignaler","onPeerChannelOpen","attachMap","_getAttachMapForPeer","sendMessageToPeer","onPeerChannelClose","cleanupPeer","onMessageFromPeer","_setAttachMapForPeer","_pausedPeers","_attachPoints","_peerDatamuxes","_peerAttachMaps","_peerChannelMaps","_peerRemoteStreams","datamux","negotiationChannel","setChannelForPeer","dataHubChannel","_namespaceId","channelMap","_updateAttachmentsForPeer","namespaceId","rtcComponentWillAttach","_internalAttach","_updateAttachments","peers","closeChannelsInNamespace","_removePeer","detachedComponent","rtcComponentWillDetach","attachments","_getLocalStreams","streamMap","isPaused","changed","removePeer","cleanup","update","rtcComponentUpdatedData","attachData","attachChannelMap","missingPoints","localPoint","ownLabel","ownRemoteLabel","streamId","_getPeer","_setPeerChannels","randomSeq","OP_SET","OP_DELETE","OP_NAME","AttachData","onSendUpdate","_seqs","_ownerIds","_ownOwnerIds","_onSendUpdate","setWithOwnership","seq","_toSetMessage","deleteWithOwnership","_toDeleteMessage","localSeq","ownOwnerId","receivedOwnValue","receivedIsNewer","DataHub","attachDatas","onUpdateListener","controller","updatesMap","sendMessage","updates","_getCurrentState","_onReceiveUpdate","RaftLog","_meshTopology","_offset","_lastApplied","_snapshot","_configurationIndex","entryAtIndex","fromIndex","localPrevTerm","remoteEntries","remoteEntry","localIndex","_pushEntries","localTerm","_revertEntries","newCommitIndex","_incrementCommitIndex","committedEntries","expectedTerm","actualTerm","fromApplied","commitEntries","fromIncludingIndex","reverted","reverse","revertEntries","TICK_INTERVAL","TICK_APPLIED_FACTOR","STATE_OP_APPLY_TTL_MS","RESEND_RTT_FACTOR","StateMachine","_tickMod","_tuples","_appliedIds","_onStateChange","_onStateOpRequest","idSize","expiry","nextResend","tuple","entryId","updated","BadRequestError","TooLargeError","AuthenticationError","InvalidCaptchaError","GuestAccessError","ConflictError","InvalidUsernameError","InvalidPasswordError","InvalidAliasError","RateLimitError","retry_after_ms","defaultRetryTimeoutMs","InternalServerError","errorParsers","M_UNKNOWN","exact","Default","M_FORBIDDEN","M_NOT_FOUND","M_LIMIT_EXCEEDED","M_UNAUTHORIZED","M_MISSING_TOKEN","M_UNKNOWN_TOKEN","M_UNRECOGNIZED","M_BAD_JSON","M_NOT_JSON","M_USER_IN_USE","M_ROOM_IN_USE","M_BAD_PAGINATION","M_BAD_STATE","M_GUEST_ACCESS_FORBIDDEN","M_CAPTCHA_NEEDED","M_CAPTCHA_INVALID","M_MISSING_PARAM","M_TOO_LARGE","M_EXCLUSIVE","M_THREEPID_AUTH_FAILED","M_THREEPID_IN_USE","M_THREEPID_NOT_FOUND","M_INVALID_USERNAME","M_SERVER_NOT_TRUSTED","parseSynapseErrorResponse","errcode","parser","ExactMatch","Match","UserRegistry","_dependencies","_users","init","_handlePresenceSync","presenceEvents","SIGNALING_STATE_SEARCHING","SIGNALING_STATE_JOINING","SIGNALING_STATE_MEMBER","SIGNALING_STATE_CLOSED","CONNECTION_STATE_SIGNALING","CONNECTION_STATE_CONNECTING","CONNECTION_STATE_CONNECTED","CONNECTION_STATE_CLOSED","MEMBER_ADD_TTL_MS","calculateClientPower","hardwareConcurrency","switcherAttachPoint","Conference","switcherMode","onSignalingMessage","deps","_onRaftStateChange","_onRaftMembersChange","_onRaftLeadershipChange","_onAttachmentUpdate","_onPeersUpdate","_onDisconnected","_invitePeer","_connectionState","_signalingState","_joiningCluster","_onClosed","onClosed","_iceServers","_onSignalingMessage","_statsFormatterFactory","statsFormatterFactory","Switcher","modeUsesVoiceDetection","_connectionPool","connectionFactory","_createConnection","onRaftMessage","raftId","_raft","handleMessage","onDisconnected","onInvite","onBestConnection","connection","setPeerConnection","_peerConnection","handleRaftMessage","_switcher","raft","mode","_attachmentManager","attach","_setDefaultMode","_startSearch","_setSignalingState","source","_clearListeners","connections","getLocalStreamsForPeer","_updateLocalStreams","_handleSearchMessage","_handleInviteMessage","handleConnectionMessage","addGhostConnection","clusterA","clusterB","localeCompare","leaderId","cluster","startPassive","connectToClusterLeader","_setPeers","recipient","_joinCluster","ownCluster","_getClusterInfo","compareResult","_compareClusters","_handleStateChange","_setMembers","setExpectedConnections","setPausedState","setPeerPausedState","_handleLeadershipChange","materializeGhostConnections","_hasConnection","_setConnectionState","newSignalingState","newConnectionState","oldConnectionState","clusterId","_initializeLeader","ensureTemporaryConnection","peerLinkInfo","conferencePeer","attachmentManager","_setConferencePeer","RoomQuery","mapFunction","rows","items","stateChangeFunctions","stopped","deferredEmit","handleNewRoom","row","addRow","stateChangeFunction","onStateChangeFunction","_registerQuery","deferEmit","removeRow","newItem","newRow","RoomState","getChromeMediaSourceId","extensionId","sourceTypes","installedStatusTimeout","postMessage","sourceId","getChromeScreenConstraints","screen","chromeMediaSourceId","chromeMediaSource","_sendChromeMessage","chrome","runtime","getChromeMediaSourceIdEx","ChromeScreenSource","chromeExtensionId","p2","_handleExtensionId","setError","DummySource","_audioContext","_destination","createMediaStreamDestination","_silence","createBufferSource","_canvas","createElement","style","getContext","captureStream","ERROR_TIME_BREAKPOINT_MS","FirefoxScreenSource","mediaSource","startTime","actualError","timeToError","protocol","MediaTee","_streamSink","_muteFilter","mute","UserMediaSource","WebAudioFilter","_releaseContext","_source","createMediaStreamSource","onAudioSource","destination","onSetupFilter","AudioNode","onTeardownFilter","WebAudioSource","PEER_SWITCH_TIMEOUT_MS","Call","receivedOffer","_isPassive","_statsFormatter","_disconnectTimeoutId","_datamux","onChannel","handlePeerChannel","onConnect","_signaler","handleDataChannelConnect","onDisconnect","handleDataChannelDisconnect","renegotiationChannel","builtin","_attachmentChannels","messagingChannel","_peerConnectionConfiguration","_onAddRemoteStream","_onRemoteStreamChange","_onRemoveRemoteStream","onSignalingError","_onSignalingError","onErrorStateChange","_onErrorStateChange","onConnectionStateChange","_onConnectionStateChange","onCreatePeerConnection","_createPeerConnection","handleStats","pcId","prevState","signalingError","pipe","getAttachments","_getMediaPipe","currentStreams","setRemoteStreamsForPeer","_oldPeers","switchTimeout","sendHangup","_reset","setPeerId","transitionToClosed","_closeCall","monitorDataChannels","dataChannelFactory","createDataChannels","setDatamuxForPeer","reset","ticket","isConnected","closed","connectionState","errorState","MediaBroadcaster","_peerSources","_remoteSources","DataShare","_checkAttached","FileShare","_refMap","_fileRefs","fileRef","isLocal","oldRef","_fromFileRef","owners","_startTransfer","_toFileRef","PeerMediaPipe","_remoteSource","_localSource","ProxySink","_offer","_answer","_localCandidates","_remoteCandidates","_channel","pairingId","ProxySource","connectionConfig","_connectionConfig","_onAddStream","_onRemoveStream","_onIceCandidate","_cleanupPeerConnection","_setOffer","_addCandidate","performAnswer","FILE_TRANSFER_SLICE_SIZE","FILE_TRANSFER_CHUNK_SIZE","FILE_TRANSFER_TIMEOUT_MS","FileRef","filename","parsed","_file","_size","_download","_downloadPromise","_transfers","_progress","_dataChannelFactory","_localFileRefs","chunks","FileDownload","abort","__cct_type__","transfer","FileTransfer","executePromise","FileChunker","_chunkStart","totalBytes","chunkCount","ceil","_read","_nextChunk","chunkStart","chunkEnd","chunkBuffer","sha1","nextChunk","onEnded","_peer","_chunker","_onEnded","_done","_ended","_end","sendWithGenerator","sentBytes","chunkSha1s","bufferView","chunkSpec","sha1SumBuffer","fileSpec","download","leaveChannelOpen","_leaveChannelOpen","_downloaded","_chunkCount","_chunkProcessQueue","_chunkSha1s","receiveWithGenerator","spec","_emitChunk","_finish","actualSha1","HIGH_PRIORITY_MTU","CONNECT_TIMEOUT_MS","CHANNEL_BASE_ID","TRANSFER_PLACEHOLDER_PREFIX","STATE_CONNECTED","STATE_CONNECTING","STATE_DISCONNECTED","DataChannelMultiplexer","onRttChange","onUpStateChange","targetKbps","transferEncoding","disablePinging","connectTimeoutMs","_onConnectTimeout","_onChannel","_onConnectCallback","_onDisconnectCallback","_onRttChangeCallback","_onUpStateChangeCallback","_transferReceiver","_transferIdCounter","_connectTimeoutId","_disablePinging","_onConnectTimeoutMs","_activityTracker","_sendBuffer","_channelController","channelDriver","activityTracker","bandwidthEstimator","initialTargetKbps","_eventEpoch","_channelRegistry","_pendingRemoteChannels","_builtinsLocked","ordered","reliable","negotiated","binaryType","onopen","_onChannelOpened","onclose","_onChannelClosed","_onChannelError","_paused","nextId","clearAppConnections","pushMessage","remoteId","_openChannel","clearConnections","running","onActiveStateChange","_onChannelTimeout","connectBuiltins","forEachLocalChannel","initMessage","_createChannelInitMessage","alreadyDisconnected","epoch","_onConnected","validateConfig","getNextId","_forwardMuxChannelMessage","onClose","_onLocalMuxChannelClosed","addBuiltin","addLocal","clearNamespace","messageType","_protocol","_pairingId","paramStr","param","_localId","TransferItem","supportsType","transferId","transferPromise","createFromData","transferHeader","createTransferHeader","transferItem","pushTransfer","transferPromises","transferResult","_maybeTransferValue","handleBinaryData","setHeader","sepIndex","channelIdStr","isInteger","isPositive","_handleDataMessage","_handleOpenMessage","_handleOpenAckMessage","_handleCloseMessage","_handleDeclareMessage","_handleClearMessage","getByRemoteId","_builtin","messagePromise","awaitDownload","_parseDataMessageJson","_handleRecievedMessagePromise","transferIndices","results","base64Label","base64Protocol","base64NamespaceId","existingChannel","addRemote","link","base64PairingId","addPairingInfo","minimumRemoteId","setMinimumRemoteId","TI_TYPE_BLOB","TI_TYPE_STRING","TI_TYPE_ARRAY_BUFFER","TI_TYPE_BUFFER_VIEW","TI_TYPE_SEP","TI_VIEW_TYPE_DATA_VIEW","TI_VIEW_TYPE_INT8","TI_VIEW_TYPE_UINT8","TI_VIEW_TYPE_UINT8_CLAMPED","TI_VIEW_TYPE_INT16","TI_VIEW_TYPE_UINT16","TI_VIEW_TYPE_INT32","TI_VIEW_TYPE_UINT32","TI_VIEW_TYPE_FLOAT32","TI_VIEW_TYPE_FLOAT64","TI_VIEW_TYPES","DataView","Int8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint32Array","Float32Array","Float64Array","TI_VIEW_TYPE_MAP","TypeConstructor","viewType","typeDescriptor","base64Type","base64Name","isView","_buffer","_baseOffset","_byteOffset","_byteLength","_typeDescriptor","bytesLeft","decodedSize","binaryData","read","binaryStr","binaryBase64Str","TransferAssembler","typeId","TransferReceiver","_assembler","_currentTransferItem","_currentDownloadId","_deferredTransferResults","_getDeferredResult","headerString","transferIdStr","byteLengthStr","done","write","finalize","CANDIDATE_BUFFER_TIMEOUT_MS","Candidate","Candidater","_earlyLocal","_earlyRemote","_localBuffer","_localBufferTimeout","_onLocalCandidate","_onBufferTimeout","candidates","hasRemoteDescription","earlyLocal","JsonChannelBroadcastController","_onPeerChannelOpen","_onPeerChannelClose","_onMessageFromPeer","peerInfo","messageListener","readyStateListener","dataChannelMessageSize","monitorDataChannel","statsHandler","bytesSent","bytesReceived","messagesSent","messagesReceived","identity","maybeStartStatTimer","sample","MONITOR_INTERVAL","realDataChannelSend","realCreateDataChannel","SIGNALING_STATE_IDLE","SIGNALING_STATE_OFFERED","SIGNALING_STATE_STABLE","CONNECTION_STATE_RECONNECTING","DATACHANNEL_BANDWIDTH","DISCONNECT_TIMEOUT_MS","SIGNALING_PROTOCOL_VERSION","createTicket","remoteTicket","Signaler","_ticket","_isInitiator","_receivedOffer","_disconnectedTicket","_errorState","_hasDataConnection","_connectionFailCount","closeCall","_renegotiator","onError","_candidater","_sendMessage","_onIceStateChange","version","_setErrorState","_connectionHasFailed","description","extractEarlyLocal","hangup","_handleOffer","_handleAnswer","handleRemoteCandidates","_replacePeerConnection","_doOffer","connState","performOffer","_sendDescription","addEarlyRemoteCandidates","remoteBrowser","alwaysOffer","isChromeToOther","isPluginToFirefox","_doAnswer","handleAnswer","Auth","loginWithPassword","_simpleAuthRequest","serverUrl","username","password","registerWithPassword","auth","session","_createHmac","mac","resetPasswordWithPassword","authInfo","accessToken","oldPassword","new_password","newPassword","anonymous","secret","guest","access_token","refresh_token","refreshToken","hmac","createHmac","rawKey","importKey","hash","sign","algorithm","oncomplete","API_VERSION","Client","authedRequest","activeAuthInfo","roomRegistry","_syncStream","roomQueries","userRequests","reporter","statsUrl","authed","logout","setStatus","rawMacaroon","macaroonMatch","matrixUserId","ownMatrixUserId","_authedRequest","profile","getPublicRooms","createRoom","directory","leaveRoom","uploadMedia","foundMemberRoom","rooms","fetchUser","versions","visibility","_visibility","stateMap","stateDesc","differentJoinRule","isEdit","isReader","recording","mediaServiceId","mediaService","c3Recording","meta","lastState","room_alias_name","initial_state","creation_content","waitForRoom","room_id","fetchRoomByAlias","fullAlias","getOrCreateEmptyRoom","fetchRoomById","matrixRoomId","getRoom","roomId","content_uri","getRooms","loadPublicRooms","_addPublicInfo","_handleAccountDataSync","_didChangeSyncStreamState","_onRoomCreated","_willEmitRoomsEvent","_handleNewRoom","_onIncomingCall","_onIncomingConference","_loadPublicRooms","getRoomByAlias","AudioBufferSource","AudioBuffer","halt","_audioSource","onended","audioDestination","delay","duration","loop","loopStart","loopEnd","currentTime","_startTime","shouldReleaseContext","decodeAudioData","decodeArrayBuffer","decodeBinaryString","AudioMeter","_raw","_filtered","_processAudio","_processor","createScriptProcessor","onaudioprocess","raw","filtered","inputBuffer","getChannelData","rms","_rms","_filter","sumOfSquares","val","meanOfSquares","rootMeanSquare","sqrt","current","AudioMixer","_streamSources","_dest","_hasInputStreams","_stereoPanner","createStereoPanner","streamSource","DeviceInfo","deviceId","_deviceId","groupId","_groupId","kind","_kind","convertDeviceConstraints","mediaConstraints","device","ideal","DeviceSource","canEnumerateDevices","mediaDevices","enumerateDevices","list","MILLISECONDS_PER_CHUNK","InternalMediaRecorder","_mediaRecorder","MediaRecorder","mediaRecorderOptions","_onData","onData","_onDataAvailable","_onStopped","_onWarning","_onError","_chunks","_mimeType","Recorder","audioBitsPerSecond","videoBitsPerSecond","_mediaRecorderOptions","WebRTCPlugin","C3_EXTENSTION_ID","availableImplementations","screenSharingImplementation","getScreenSharingImplementation","plugin","HasScreensharingFeature","getScreenSharingConstructor","implementation","ScreenSource","canEnumerateSources","Constructor","enumerateSources","ScreenSharingImplementationConstructor","_screenSource","_promise","StreamMerger","microtask","_audioInput","_videoInput","VideoFrameCapture","_video","_splitter","_htmlSink","videoOutput","scale","imageQuality","canvas","_prepareCanvas","toDataURL","toBlob","videoWidth","videoHeight","clearRect","drawImage","SERVICE_LOCAL_ID","CON_TAG","PUB_TAG","SUB_TAG","CONNECTION_DISCONNECT_TIMEOUT_MS","ERROR_TIMEOUT_MULTIPLIER_MS","StreamConnection","_configPromise","configPromise","_onOffer","onOffer","_emitterTarget","emitterTarget","_errorTimeoutId","_restart","onSignalingStateChange","onAddStream","onRemoveStream","onIceConnectionStateChange","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","offerToReceiveVideo","offerToReceiveAudio","StreamPublisher","publish","_sink","_conneciton","_streamId","_publish","_setStreamId","_connection","attached","StreamSubscriber","subscribe","subscription","_subscribe","_subscribeToStreamId","SinkRenderer","elementClass","_elementClassName","_htmlElements","_elements","dataUrl","_addImageElementForPeer","el","nodeName","_addVideoElementForPeer","elementToRemove","_removeElement","removedElement","imgEl","className","_addElement","videoEl","autoplay","ThumbnailBroadcaster","projectionConfiguration","videoFrameRate","imageFrameRate","_shouldConnectCanvasFilter","_handleStillPicture","createRenderer","_canvasFilter","_outgoingThumbChannels","_sinkRenderer","__processRemoteSource","__processImage","_transferImageToPeers","blobToTransfer","_dataURItoBlob","isChannelOpen","isChannelNotBusy","_isBusy","image","dataURI","ab","a","readAsDataURL","dataChannel","_blobToDataURI","dataURL","__removePeer","cordova","plugins","iosrtc","registerGlobals","REPORTER_SEND_INTERVAL","Reporter","sendIntervalms","statsEndpoint","seenError","payload","reports","processReports","pcStats","stats","j","processPcStats","sources","invertTimeSeries","flattenTimeSeries","samples","firstValue","seenDifferent","RTT_DIFF_THRESHOLD","RTT_FACTOR_THRESHOLD","ConferenceConnection","_peerLinkInfo","_conferencePeer","_connectedAt","_lastReportedRtt","_onRttChange","_onUpStateChange","_raftChannel","shouldUpdate","rttDiff","rttFactor","oldState","CONNECTION_TTL_MS","TICK_INTERVAL_MS","DISCONNECTED_TICK_LIMIT","ConferenceConnectionPool","_connectionFactory","_onRaftMessage","_onInvite","_onBestConnection","_connections","_expiry","_ghostConnections","_expected","_clusterLeader","_disconnectedTicks","_bestConnection","_bestConnectionTime","expected","_removeConnection","_addConnection","_handleSignalingMessage","raftChannel","newExpiryMs","stillTheBest","connectedAt","hadConnection","haveConnection","disconnectFactor","leaderConnection","ConferencePeer","ConferencePeers","_onPeerUpdate","connected","VOICE_DETECTION_INTERVAL_MS","VOICE_DETECTION_BACKOFF_MS","RelayLinks","userIds","parents","speakers","memberIds","_userIds","_parents","_speakers","sourceIndex","targetIndex","targetId","linkStrs","primaryId","secondaryId","primaryIndex","secondaryIndex","childIds","childId","otherLinks","linksA","linksB","parentsA","parentsB","SwitcherComponent","_parentId","_childrenIds","_primarySpeaker","_updateRelayState","parentId","childrenIds","primarySpeaker","targets","relaySource","MODE_OFF","MODE_MANUAL","MODE_MANUAL_FOLLOW","MODE_MANUAL_AUTOMATIC","MODE_AUTOMATIC","MODES","STATE_KEY_MODE","STATE_KEY_PRIMARY_SPEAKER","STATE_KEY_SECONDARY_SPEAKER","STATE_KEY_LINKS","switcherModeBreakdown","primaryMode","secondaryMode","ConferenceSwitcher","_voiceDetectionTick","_mode","_defaultMode","_speaker","_secondarySpeaker","_selectedPrimarySpeaker","_selectedSecondarySpeaker","_loudestPeer","_isLeader","_memberIds","_setMode","useVoice","_setVoiceDetectionEnabled","setVoiceActivityDetectorActive","_voiceDetectionIntervalId","_voiceDetectionTimeoutId","currentLoudest","volumes","b","loudest","_refreshRelayTree","defaultMode","broadcaster","needUpdate","secondarySpeaker","relayLinkData","relayLinks","getParentOf","getChildrenOf","getSpeakers","speaker","setRelayState","memberIdsCopy","targetIds","powers","targetInfo","createEmpty","sourceQueue","insert","sourcePower","sourceInfo","p1","r1","r2","bestTargetId","setSpeakers","currentLinks","equals","relayLinksData","n2","ids","EventEmitter","MODE_STATS","MODE_MAX","MODE_FFT","MODE_RMS","VOLUME_FILTER_ALPHA","VOLUME_FILTER_INTERVAL_MS","RMS_ALPHA","RmsVolumeAlgorithm","MaxVolumeAlgorithm","_max","_updateTime","_updateFrequencyMs","localMax","AudioProcessorMeter","_processAudioData","_algorithm","_processorNode","process","RtcStatsMeter","_processStatsResult","maxVolume","audioInputLevel","normalizedVolume","VolumeFilter","alpha","intervalMs","volumeSource","_alpha","_intervalMs","_volumeSource","measuredVolume","oldComponent","newComponent","VoiceActivityDetector","_meter","_volumeFilter","_maybeStartOrStop","tick","_findTrack","ACTIVITY_TIMEOUT_MS","ActivityTracker","inactivityTimeoutMs","disconnectTimeoutMs","_onActivityTimeout","_onDisconnectTimeout","_inactivityTimeoutMs","_disconnectTimeoutMs","_activityTimeoutId","_running","_disconnected","_activeStateChangeCallback","_disconnectCallback","wasActive","DEFAULT_INITIAL_TARGET_KBPS","DEFAULT_INITIAL_SEND_WINDOW_SIZE_MS","DEFAULT_RETRY_SIZE_BYTES","BandwidthEstimator","timeSource","initialSendWindowSizeMs","_timeSource","_initialTargetKbps","_initialSendWindowSizeMs","_targetKbps","_sendWindowSizeMs","_sendMarkerMs","retrySizeBytes","retryTimeoutMs","currentTimeMs","timeEquivalentMs","availableMs","SendBuffer","_listener","TransferBuffer","_items","_currentItem","notify","encoding","readBase64","lengthStr","MessageBuffer","_messages","first","PrioritizedBuffer","_messageBuffer","_transferBuffer","setNotificationListener","MUX_CHANNEL_READY_STATE_OPENING","MUX_CHANNEL_READY_STATE_OPEN","MUX_CHANNEL_READY_STATE_CLOSED","DataChannel","_isLocal","_onSendMessage","_onClose","_readyState","_startupQueue","_receiveQueue","_remoteId","once","generator","waitForOpen","iterator","return","sendWithIterator","onDone","doSend","ReceiveQueue","handleMessagePromise","_currentPromise","_epoch","_process","MTU","INITIAL_RTT_MS","DEFAULT_PING_INTERVAL_MS","Base64Reader","_base64","str","ChannelController","mtu","pingIntervalMs","_onSendAttempt","_sendPing","_channelDriver","_bandwidthEstimator","_mtu","_transferEncoding","_pingIntervalMs","_base64Reader","_receivedPong","_messageCallback","_rttChangeCallback","_pingTimeoutId","_bandwidthTimeoutId","onSendAttempt","_sendData","registerActivity","reading","_handlePing","_handlePong","begin","pingTime","pingSendTime","_startPingTimeout","bytesToSend","bytesAvailable","messageSize","calculateRetryTimeoutMs","dataSize","consumeSendBytes","DEFAULT_LOW_THRESHOLD","DEFAULT_HIGH_THRESHOLD","DEFAULT_FALLBACK_PROCESS_INTERVAL_MS","ChannelDriver","lowThreshold","highThreshold","fallbackIntervalMs","_lowThreshold","_highThreshold","_fallbackIntervalMs","_sendAttemptCallback","_processIntervalId","onmessage","_hasBufferedAmountLowEvent","bufferedAmountLowThreshold","onbufferedamountlow","eventEpoch","bufferedAmount","PairingNamespace","_byPairingId","_remoteInfos","remoteInfo","_setRemoteId","MuxChannelRegistry","_channelIdCounter","_minimumRemoteId","_minimumLocalId","_builtinChannels","_localChannels","_byRemoteId","_namespaces","namespace","clearRemoteInfos","clearLocalChannels","removeChannel","trimByRemoteId","channelId","_getPairingNamespace","oldRemoteId","StatsFormatter","CONFERENCE_SIGNALING_VERSION","CallStore","_rooms","_passiveCalls","getCallInRoomToPeer","callsInRoom","putPassiveCall","putCall","removeCall","CallRegistry","_userRegistry","_delegate","_callStore","_conferences","currentCall","_createCall","calls","incomingCalls","hijackedOffer","_setPeerId","handleSignalingMessage","_createConference","_ownUser","_reporter","_sendEvent","_handleCallEvent","_handleConferenceEvent","_handleCallOffer","activeCall","passiveCall","incomingCall","messages","_onCallMessage","_onCallClosed","_onConferenceMessages","_onConferenceClosed","ROOM_CREATE_TIMEOUT","ROOM_PREPARE_TIMEOUT","RoomRegistry","_roomMap","_roomArray","_deferredRooms","_roomDependencies","_createRoom","invitedUserIds","lastStateStr","invitesStr","_waitForRoomCreation","roomReady","_waitForRoomState","_waitForRoomInvites","readyTimeout","race","waitForInvite","consumeEvent","roomDependencies","SyncStream","_syncToken","_retryCount","_retryTimeout","INITIAL_RETRY_TIMEOUT","_roomRegistry","_retry","_onPollError","_onPollResponse","_onFirstSyncResponse","SYNC_POLL_TIMEOUT","SYNC_POLL_TIMEOUT_GRACE_PERIOD","MAX_RETRY_TIMEOUT","RETRY_ADD","RETRY_MULT","RETRY_DISCONNECT_LIMIT","since","startToken","_baseRequest","next_batch","_handleReponseEvents","round","membershipRooms","CanvasFilter","HTMLCanvasElement","render","_videoFrameRate","_renderFunction","_renderInterval","_canvasSource","_render","startRender","stopRender","_fpsInterval","_then","elapsed","requestAnimationFrame","CanvasSource","position","_canvasContainer","zIndex","overflow","appendChild","removeChild","ScaledCanvasFilter","_projectionConfiguration","_imageFrameRate","_grabStillPicture","aspectRatio","contentMode","videoAspectRatio","delta","deltaY","deltaX","_projection","_calcProjection","_stillPictureInterval","ctx","ScreenSourceInfo","TemasysCanvasFilter","base64img","getFrame","Image","setAttribute","TemasysScreenSourceInfo","TemasysScreenSource","getScreensharingSources","screensharingKeys","optional","screensharingKey","screenId","WEBRTC_MONITOR_REGEX_MSID_CHROME","WEBRTC_MONITOR_REGEX_MSID_FIREFOX","WEBRTC_MONITOR_REGEX_MSLABEL","WEBRTC_MONITOR_REGEX_LABEL","WEBRTC_MONITOR_REGEX_CNAME","parseIdentities","identities","ssrcs","blocks","block","lines","msidTemp","sdpMsIdC","msid","mstid","sdpMsIdF","ssrc","sdpMsLabel","sdpLabel","sdpCname","cname","reportGenericStat","formatter","PEER_CONNECTION_MONITOR_CANDIDATE_RE","parseCandidateString","candidateString","candidateMatches","relatedAddress","relatedPort","tcpType","transport","reportCandidate","rtcicecandidate","localOrRemote","PEER_CONNECTION_MONITOR_INTERNAL_MS","PEER_CONNECTION_MONITOR_ICE_CHECKING_TIMEOUT_MS","pc","reportIntervalMs","callSucceeded","reportInterval","isRelay","localDescription","normalizePeerConnectionStats","createPeerConnectionStatNormalizer","iceCheckingTimeout","normalizedStats","localCandidateType","realAddIceCandidate","Renegotiator","_needRenegotiation","_doingRenegotiation","_renegotiationTime","_renegotiationOfferQueue","_onSignalingStateChange","_onNegotiationNeeded","isInitiator","_sendRenegotiationOffer","_sendRenegotiationRequest","audioCount","videoCount","_requestedConstraints","offerConstraints","_handleRenegotiationOffer","_handleRenegotiationRequest","_handleRenegotiationAnswer","candidateRegExp","bundleAttributeRegExp","foundation","componentId","priority","address","blockSplitRegExp","sessionBlock","mediaBlocks","applicationMBlockIndex","applicationMId","newSessionBlock","mIdsStr","mIds","applicationMBlock","newSdp","extractedBlock","modeRegExp","mediaTypeRegExp","modeValues","inactive","sendonly","recvonly","sendrecv","modeNames","defaultModeName","audioModeValue","videoModeValue","applicationModeValue","mediaBlock","mediaType","modeName","modeValue","application","mediaModes","mId","bundleAttribute","bweRegExp","ssrcGroupRegExp","rtxPayloadTypeRegExp","modifiedMediaBlocks","removedSsrcs","withoutSsrcGroups","ssrcRegExp","withoutSsrcs","withoutRtxPayloadTypes","contextId","STATS_OBJ_REGEX_FIREFOX","STATS_KEY_BLACKLIST_FIREFOX","STATS_OBJ_REGEX_CHROME","STATS_KEY_BLACKLIST_CHROME","normalizeStatsMatchFirefox","statKey","matchFirefox","role","reportType","k","normalizeStatsMatchChrome","matchChrome","candidatePairKeys","assignCandidatePairValues","destKey","charAt","getSelectedPairSampleFromStats","localCandidateId","remoteCandidateId","localStat","remoteStat","localPriority","remotePriority","selectedPairs","normalizeSsrcStats","sampleTsMs","getStatsTs","normalizeSelectedPairStats","newSelectedPairs","selected","googActiveConnection","newSelectedPair","oldPair","newPair"],"mappings":"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A,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA,CAAC,G;;;;;;AClDD;AACA;AACA;AACA;AACA,yBAAyB,kBAAkB,EAAE;;AAE7C;AACA;AACA;AACA;AACA,GAAG,UAAU;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACtBA;AACA;AACA;AACA;AACA,E;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACLA,kBAAkB,wD;;;;;;ACAlB;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACNA;AACA;AACA;AACA,a;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,aAAa;;AAEzC;AACA;AACA;AACA;AACA;AACA,wCAAwC,oCAAoC;AAC5E,4CAA4C,oCAAoC;AAChF,KAAK,2BAA2B,oCAAoC;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mBAAmB;AACnC;AACA;AACA,iCAAiC,2BAA2B;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,E;;;;;;ACrEA,cAAc,sB;;;;;;ACAd;AACA;AACA,mDAAmD;AACnD;AACA,uCAAuC;AACvC,E;;;;;;ACLA,kBAAkB,yD;;;;;;ACAlB,kBAAkB,yD;;;;;;ACAlB;AACA;AACA;AACA,E;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACXA;AACA;AACA;AACA,GAAG;AACH,E;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA,mDAAmD,OAAO,EAAE;AAC5D,E;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,E;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD,CAAC;AACD;AACA,qBAAqB;AACrB;AACA,SAAS;AACT,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,UAAU;AACb;AACA,E;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,sBAAsB;AAChF,gFAAgF,sBAAsB;AACtG,E;;;;;;ACRA,mC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACPA;AACA;AACA;AACA;AACA,E;;;;;;ACJA,kBAAkB,yD;;;;;;ACAlB,kBAAkB,yD;;;;;;;ACAlB;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,sCAAsC,uCAAuC,gBAAgB;;AAE7F;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA,E;;;;;;ACrCA,6E;;;;;;ACAA;AACA,qEAAsE,gBAAgB,UAAU,GAAG;AACnG,CAAC,E;;;;;;ACFD;AACA;AACA;AACA;;AAEA;AACA;AACA,E;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,E;;;;;;ACXA;AACA,UAAU;AACV,E;;;;;;ACFA,yC;;;;;;ACAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,E;;;;;;ACZA;AACA;AACA;AACA;;AAEA;AACA;AACA;AA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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;AC1EA,kBAAkB,yD;;;;;;;ACAlB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAsB,OAAO;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B,0BAA0B;AAC1B,0BAA0B;AAC1B,qBAAqB;AACrB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,6DAA6D,OAAO;AACpE;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB,0BAA0B;AAC1B,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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A;AACA;AACA;AACA,E;;;;;;ACJA;AACA;AACA;AACA;AACA,E;;;;;;ACJA;AACA,8D;;;;;;ACDA;AACA,8D;;;;;;ACDA;AACA;AACA;AACA;AACA,gD;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA,4C;;;;;;ACLA;AACA;AACA;AACA;AACA,+C;;;;;;ACJA;AACA;AACA,uD;;;;;;ACFA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,eAAe;AACxB;AACA;AACA;AACA,sCAAsC;AACtC;AACA,8BAA8B;AAC9B,6BAA6B;AAC7B,+BAA+B;AAC/B,mCAAmC;AACnC,SAAS,+BAA+B;AACxC;AACA;AACA;AACA;AACA,E;;;;;;AC3CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,E;;;;;;ACfA;AACA;;AAEA;AACA;AACA,E;;;;;;;ACLA;AACA;AACA;;AAEA;AACA;AACA;AACA,E;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,E;;;;;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,E;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,uCAAuC,oBAAoB,EAAE;AAC7D;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,E;;;;;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA,OAAO,UAAU,cAAc;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,GAAG;AACR;AACA,E;;;;;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,wEAA0E,kBAAkB,EAAE;AAC9F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,gCAAgC;AACpF;AACA;AACA,KAAK;AACL;AACA,iCAAiC,gBAAgB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;ACpCD;AACA;AACA,8BAA8B,gCAAoC,E;;;;;;ACFlE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,CAAC,E;;;;;;ACRD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,CAAC,E;;;;;;ACRD;AACA;AACA,8BAA8B,6CAA4C,E;;;;;;;ACF1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;;AAEA;AACA;AACA;AACA;AACA,+CAA+C,sDAAiD,oBAAoB;AACpH;AACA;AACA,GAAG,UAAU;AACb,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,mBAAmB,gCAAgC;AACnD,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,eAAe,qCAAqC;AACpD;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA,uBAAuB,wBAAwB;AAC/C;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH,kBAAkB,uBAAuB,KAAK;AAC9C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,iBAAiB;AACjB,wBAAwB;AACxB,gBAAgB;AAChB,oBAAoB;AACpB,wBAAwB;AACxB,gBAAgB;AAChB,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0DAA0D,kBAAkB;AAC5E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,CAAC,E;;;;;;;AC1SD;AACA;;AAEA;AACA;AACA,wBAAwB,mEAAmE;AAC3F,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC,U;;;;;;;ACXD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB;AACtB,oBAAoB,uBAAuB,SAAS,IAAI;AACxD,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD;AACzD;AACA,KAAK;AACL;AACA,sBAAsB,iCAAiC;AACvD,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8DAA8D,8BAA8B;AAC5F;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;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CA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,E;;;;;;ACfA;AACA;AACA;AACA;AACA,GAAG;AACH,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,OAAO,eAAe;AACtB,OAAO,sBAAsB;AAC7B,OAAO,cAAc;AACrB,OAAO,gBAAgB;AACvB,OAAO,gBAAgB;AACvB,OAAO,oBAAoB;AAC3B,OAAO,kBAAkB;AACzB,UAAU;AACV,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,uCAAuC,UAAU;AACjD,+BAA+B;AAC/B;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC;;;;;;;AChQD;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;;;;;;;;;;;;;ACpBA;;;AAEA;AACA;AAOA;;AAEA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;AAuBA;;;;;;;;;AASe,SAASmC,IAAT,CAAc5vD,IAAd,EAAoB;AACjCC,EAAA,+EAAAA,CAAW,MAAX,EAAmBD,IAAnB;AACD;;AAED;;;;;;;;;;;AAWA4vD,KAAKC,iBAAL,GAAyB,UAAUp5D,OAAV,EAAmB;AAC1CxE,EAAA,gEAAAA,CAASwE,OAAT,CAAiB,wBAAjB,EAA2C,SAA3C,EAAsDA,OAAtD,EACOvE,MADP,CACc,WADd,EAEOA,MAFP,CAEc,UAFd,EAGOA,MAHP,CAGc,UAHd;;AAKA,SAAO09D,KAAKE,kBAAL,CAAwB;AAC7BC,eAAWt5D,QAAQs5D;AADU,GAAxB,EAEJ,OAFI,EAEK;AACVj5D,UAAM,kBADI;AAEV66B,UAAMl7B,QAAQu5D,QAFJ;AAGVC,cAAUx5D,QAAQw5D;AAHR,G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kD,iBAAiB,mDAAmD,kBAAkB,QAAQ,cAAc,KAAK,yDAAyD,6CAA6C,kBAAkB,2EAA2E,6IAA6I,uCAAuC,gFAAgF,iDAAiD,2CAA2C,kDAAkD,QAAQ,8CAA8C,8CAA8C,YAAY,mDAAmD,kBAAkB,yCAAyC,iDAAiD,aAAa,cAAc,KAAK,yDAAyD,6CAA6C,kBAAkB,uHAAuH,wCAAwC,uCAAuC,sCAAsC,6HAA6H,6HAA6H,6CAA6C,8IAA8I,oFAAoF,4CAA4C,yJAAyJ,wDAAwD;;AAE7rlB;AACA,2B;;;;;;ACNA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;;AAErC;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;ACvLtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd,KAAK;AACL,cAAc;AACd;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,WAAW;AACX;;AAEA;AACA;AACA,wCAAwC,WAAW;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iCAAiC,kBAAkB;AACnD;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,iBAAiB;;AAEjB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAwB,iBAAiB;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,YAAY;AACZ;AACA;;AAEA;AACA,YAAY;AACZ;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8CAA8C,QAAQ;AACtD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA,WAAW;AACX;AACA;AACA;;AAEA,WAAW;AACX;AACA;AACA;;AAEA,WAAW;AACX;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,8CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;;AAEL;AACA,8CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,8CAA8C,QAAQ;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1qBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,oCAAoC,OAAO;AAC3C;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,gBAAgB,KAAK,KAAK;AAC1B;AACA;AACA;AACA;AACA;;;;;;;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,+CAA+C,KAAK;AACpD;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB,0BAA0B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,mBAAmB,0BAA0B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;;AAEA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA,yBAAyB;AACzB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA,KAAK;;AAEL;AACA;AACA;AACA,cAAc;;AAEd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,yBAAyB;AAChD;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6BAA6B;;AAE7B;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,0BAA0B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa;AACb;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;;;;;;AChtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,aAAa;AACb,WAAW;AACX;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;;;;;;;AC9GA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;ACPA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,+CAA+C;;AAE/C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,yBAAyB;;AAEzB;AACA;AACA;AACA;AACA;AACA,kBAAkB,kBAAkB;AACpC,uCAAuC;AACvC;;AAEA,mBAAmB,kCAAkC;AACrD;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,wBAAwB;AACxB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sBAAsB,4BAA4B;AAClD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;AC5FA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,OAAO;AACP,KAAK;AACL,GAAG;;AAEH;AACA","file":"cct.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cct\"] = factory();\n\telse\n\t\troot[\"cct\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 240);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap dcce4e8a613d21abf6d6","var core = module.exports = {version: '2.4.0'};\nif(typeof __e == 'number')__e = core; // eslint-disable-line no-undef\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_core.js\n// module id = 0\n// module chunks = 0 1 2 3 4 5 6","\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/classCallCheck.js\n// module id = 1\n// module chunks = 0 1 2 3 4 5 6","\"use strict\";\n\nexports.__esModule = true;\n\nvar _defineProperty = require(\"../core-js/object/define-property\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      (0, _defineProperty2.default)(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/createClass.js\n// module id = 2\n// module chunks = 0 1 2 3 4 5 6","var store      = require('./_shared')('wks')\n  , uid        = require('./_uid')\n  , Symbol     = require('./_global').Symbol\n  , USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function(name){\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_wks.js\n// module id = 3\n// module chunks = 0 1 2 3 4 5 6","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport {isChrome, isFirefox} from 'common/utils'\n\n/**\n * A log interface that is exposed via the singleton `cct.log`.\n *\n * Log messages are sent using one of the five log functions, one for each log level:\n * {@link Log#error}, {@link Log#warning}, {@link Log#info}, {@link Log#debug}, {@link Log#verbose}.\n *\n * Each message is sent to a log category, which is identified by a string. The log level\n * of each category can be set separately, allowing heigher or lower log levels to be\n * set for specific categories.\n *\n * The log messages that don't get filtered out because of their level are forwarded\n * to the log handler for that log level. The default log handlers will use the built-in\n * `console` functions to print the category in square brackets followed by the message.\n *\n * @example <caption>Show all messages and in color, except for own events</caption>\n * cct.log.setLogLevel('own-events', cct.log.NONE);\n * cct.log.setLogLevel(cct.log.VERBOSE);\n * cct.log.color = true;\n *\n * @example <caption>Logging an info message in the gizmo category</caption>\n * cct.log.info('gizmo', 'widget initialized');\n *\n * @abstract\n * @class Log\n */\nexport function Log() {\n  this._defaultLogLevel = this.WARNING\n  this._categoryLevels = {}\n  this._logHandlers = {}\n}\n\n/**\n * @callback LogHandlerFunction\n *\n * @param {number} mask - The log level mask of the message.\n * @param {string} category - The message category.\n * @param {string} message - The log message.\n */\n\n/**\n * Sets the log handler for one or more log levels. The handler will be called whenever\n * anything is logged that doesn't get filtered because of it's log level.\n *\n * Setting a log handler will replace the default log handler for that log level.\n *\n * @example <caption>Setting log handler for multiple levels</caption>\n * log.setLogHandler(log.ERROR|log.WARNING, function (mask, category, ...args) {\n *     ...\n * });\n *\n * @param {number} [levels=ALL] - A mask that describles which log levels the handler\n *  should be applied to. If omitted the handler will be used for all log levels.\n * @param {LogHandlerFunction} handler - The log handler that will be called.\n */\nLog.prototype.setLogHandler = function (levels, handler) {\n  if (arguments.length <= 1) {\n    handler = levels\n    levels = this.ALL\n  }\n  if (typeof(levels) !== 'number') {\n    throw new TypeError('Log.setLogHandler: levels must be a number')\n  }\n  if (typeof(handler) !== 'function' && handler) {\n    throw new TypeError('Log.setLogHandler: handler must be a function')\n  }\n  this.levels.forEach(function (level, index) {\n    if ((1 << index) & levels) {\n      this._logHandlers[level] = handler\n    }\n  }.bind(this))\n}\n\n/**\n * Sets the log level either globally, or for a specific category.\n * The log handler will only be called for messages whose log level is\n * equal or lower than the log level for that category.\n *\n * The log level of any category is equal to the specific log level that has\n * been set for that category, and if none has been set, the gobal log level.\n *\n * @param {string} [category] - Optional log category to set the level of.\n *  If this is excluded, the global log level will be set instead.\n * @param {number} level - The new log level.\n */\nLog.prototype.setLogLevel = function (category, level) {\n  if (arguments.length <= 1) {\n    level = category\n    if (typeof(level) !== 'number') {\n      throw new TypeError('Log.setLogLevel: level must be a number')\n    }\n    this._defaultLogLevel = level\n  } else {\n    if (typeof(category) !== 'string') {\n      throw new TypeError('Log.setLogLevel: category must be a string')\n    }\n    if (typeof(level) !== 'number') {\n      throw new TypeError('Log.setLogLevel: level must be a number')\n    }\n    this._categoryLevels[category] = level\n  }\n}\n\nfunction createLogFunction(level, mask) {\n  return function (category, message, ...args) {\n    argCheck.string(`log.${level}`, 'category', category)\n    var logLevel = 0\n    if (typeof(category) !== 'string') {\n      throw new TypeError('Log.' + level + ': category has to be a string')\n    }\n    if (category in this._categoryLevels) {\n      logLevel = this._categoryLevels[category]\n    } else {\n      logLevel = this._defaultLogLevel\n    }\n    if (logLevel < mask) {\n      return\n    }\n    if (typeof(message) === 'string') {\n      argCheck.string(`log.${level}`, 'message', message)\n    } else {\n      let object = message\n      argCheck.object(`log.${level}`, 'object', object)\n      let [objectMessage, ...objectArgs] = args\n      argCheck.string(`log.${level}`, 'object message', objectMessage)\n\n      message = `${object} ${objectMessage}`\n      args = objectArgs\n    }\n    var handler = this._logHandlers[level]\n    if (handler) {\n      handler.call(this, mask, category, message, ...args)\n    }\n  }\n}\n\n/**\n * An array of the names of all log levels, in lowercase.\n * @type {string[]}\n */\nLog.prototype.levels = ['error', 'warning', 'info', 'debug', 'verbose']\n\nLog.prototype.levels.forEach(function (level, index) {\n  var mask = 1 << index\n  Log.prototype[level.toUpperCase()] = mask\n  Log.prototype[level] = createLogFunction(level, mask)\n})\n\n/**\n * The error log function. Will call the error log handler if the log\n * level of the given category is set to error or higher.\n * @function Log#error\n * @param {string} category - The category of this log message\n * @param {...*} args - The rest of the arguments to pass to the log handler\n */\n/**\n * The warning log function. Will call the warning log handler if the log\n * level of the given category is set to warning or higher.\n * @function Log#warning\n * @param {string} category - The category of this log message\n * @param {...*} args - The rest of the arguments to pass to the log handler\n */\n/**\n * The info log function. Will call the info log handler if the log\n * level of the given category is set to info or higher.\n * @function Log#info\n * @param {string} category - The category of this log message\n * @param {...*} args - The rest of the arguments to pass to the log handler\n */\n/**\n * The debug log function. Will call the debug log handler if the log\n * level of the given category is set to debug or higher.\n * @function Log#debug\n * @param {string} category - The category of this log message\n * @param {...*} args - The rest of the arguments to pass to the log handler\n */\n/**\n * The verbose log function. Will call the verbose log handler if the log\n * level of the given category is set to verbose or higher.\n * @function Log#verbose\n * @param {string} category - The category of this log message\n * @param {...*} args - The rest of the arguments to pass to the log handler\n */\n\n/**\n * Log level representing no logging at all.\n * @member {number} Log#NONE\n * @readonly\n */\n/**\n * Error level.\n * @member {number} Log#ERROR\n * @readonly\n */\n/**\n * Warning level.\n * @member {number} Log#WARNING\n * @readonly\n */\n/**\n * Info level.\n * @member {number} Log#INFO\n * @readonly\n */\n/**\n * Debug level.\n * @member {number} Log#DEBUG\n * @readonly\n */\n/**\n * Verbose level.\n * @member {number} Log#VERBOSE\n * @readonly\n */\n/**\n * Log level representing a mask of all log levels.\n * @member {number} Log#ALL\n * @readonly\n */\n\nLog.prototype.NONE = 0\nLog.prototype.ALL = Log.prototype.levels.reduce(function (mask, ignored, index) {\n  return mask | (1 << index)\n}, 0)\n\nvar log = new Log()\n\nexport default log\n\nexport function setLog(_log) {\n  log = _log\n}\n\n/**\n * Whether or not the default log handler should use color to represent log levels.\n * @member {boolean} Log#color\n */\n\nconst logFunctions = {\n  [log.ERROR]: (console.error || console.log).bind(console),\n  [log.WARNING]: (console.warn || console.log).bind(console),\n  [log.INFO]: (console.info || console.log).bind(console),\n  [log.DEBUG]: (console.debug || console.log).bind(console),\n  [log.VERBOSE]: console.log.bind(console),\n}\nconst logColors = {\n  [log.ERROR]: '#F74333',\n  [log.WARNING]: '#F79743',\n  [log.INFO]: '#3343F7',\n  [log.DEBUG]: '#43C733',\n  [log.VERBOSE]: '#F743F7',\n}\n\nfunction defaultLogHandler(level, category, message, ...args) {\n  logFunctions[level].call(console, `[${category}] ${message}`, ...args)\n}\n\nfunction colorLogHandler(level, category, message, ...args) {\n  if (this.color) {\n    logFunctions[level].call(console, `%c[${category}]%c ${message}`, ...[\n      'color: ' + logColors[level],\n      'color:',\n    ], ...args)\n  } else {\n    logFunctions[level].call(console, `[${category}] ${message}`, ...args)\n  }\n}\n\nlog.color = false\nlog.colors = logColors\n\nvar defaultHandler\n\nif (isChrome || isFirefox) {\n  defaultHandler = colorLogHandler\n} else {\n  defaultHandler = defaultLogHandler\n}\n\nlog.setLogHandler(log.ALL, defaultHandler)\nlog.defaultHandler = defaultHandler\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/log.js","// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self : Function('return this')();\nif(typeof __g == 'number')__g = global; // eslint-disable-line no-undef\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_global.js\n// module id = 5\n// module chunks = 0 1 2 3 4 5 6","var global    = require('./_global')\n  , core      = require('./_core')\n  , ctx       = require('./_ctx')\n  , hide      = require('./_hide')\n  , PROTOTYPE = 'prototype';\n\nvar $export = function(type, name, source){\n  var IS_FORCED = type & $export.F\n    , IS_GLOBAL = type & $export.G\n    , IS_STATIC = type & $export.S\n    , IS_PROTO  = type & $export.P\n    , IS_BIND   = type & $export.B\n    , IS_WRAP   = type & $export.W\n    , exports   = IS_GLOBAL ? core : core[name] || (core[name] = {})\n    , expProto  = exports[PROTOTYPE]\n    , target    = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE]\n    , key, own, out;\n  if(IS_GLOBAL)source = name;\n  for(key in source){\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    if(own && key in exports)continue;\n    // export native or passed\n    out = own ? target[key] : source[key];\n    // prevent global pollution for namespaces\n    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]\n    // bind timers to global for call from export context\n    : IS_BIND && own ? ctx(out, global)\n    // wrap global constructors for prevent change them in library\n    : IS_WRAP && target[key] == out ? (function(C){\n      var F = function(a, b, c){\n        if(this instanceof C){\n          switch(arguments.length){\n            case 0: return new C;\n            case 1: return new C(a);\n            case 2: return new C(a, b);\n          } return new C(a, b, c);\n        } return C.apply(this, arguments);\n      };\n      F[PROTOTYPE] = C[PROTOTYPE];\n      return F;\n    // make static versions for prototype methods\n    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%\n    if(IS_PROTO){\n      (exports.virtual || (exports.virtual = {}))[key] = out;\n      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%\n      if(type & $export.R && expProto && !expProto[key])hide(expProto, key, out);\n    }\n  }\n};\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library` \nmodule.exports = $export;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_export.js\n// module id = 6\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/object/get-prototype-of\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/get-prototype-of.js\n// module id = 7\n// module chunks = 0 1 2 3 4 5","var anObject       = require('./_an-object')\n  , IE8_DOM_DEFINE = require('./_ie8-dom-define')\n  , toPrimitive    = require('./_to-primitive')\n  , dP             = Object.defineProperty;\n\nexports.f = require('./_descriptors') ? Object.defineProperty : function defineProperty(O, P, Attributes){\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if(IE8_DOM_DEFINE)try {\n    return dP(O, P, Attributes);\n  } catch(e){ /* empty */ }\n  if('get' in Attributes || 'set' in Attributes)throw TypeError('Accessors not supported!');\n  if('value' in Attributes)O[P] = Attributes.value;\n  return O;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-dp.js\n// module id = 8\n// module chunks = 0 1 2 3 4 5 6","// Thank's IE8 for his funny defineProperty\nmodule.exports = !require('./_fails')(function(){\n  return Object.defineProperty({}, 'a', {get: function(){ return 7; }}).a != 7;\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_descriptors.js\n// module id = 9\n// module chunks = 0 1 2 3 4 5 6","\"use strict\";\n\nexports.__esModule = true;\n\nvar _setPrototypeOf = require(\"../core-js/object/set-prototype-of\");\n\nvar _setPrototypeOf2 = _interopRequireDefault(_setPrototypeOf);\n\nvar _create = require(\"../core-js/object/create\");\n\nvar _create2 = _interopRequireDefault(_create);\n\nvar _typeof2 = require(\"../helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + (typeof superClass === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(superClass)));\n  }\n\n  subClass.prototype = (0, _create2.default)(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf2.default ? (0, _setPrototypeOf2.default)(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/inherits.js\n// module id = 10\n// module chunks = 0 1 2 3 4 5","\"use strict\";\n\nexports.__esModule = true;\n\nvar _typeof2 = require(\"../helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && ((typeof call === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(call)) === \"object\" || typeof call === \"function\") ? call : self;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/possibleConstructorReturn.js\n// module id = 11\n// module chunks = 0 1 2 3 4 5","'use strict'\n\nfunction optArgCheck(prop) {\n  return function (context, name, value, extra) {\n    if (value !== undefined && value !== null) {\n      try {\n        this[prop](context, name, value, extra)\n      } catch (e) {\n        e.message += ' if present'\n        throw e\n      }\n    }\n    return value\n  }\n}\n\nvar argCheck = {\n  count: function (context, requiredCount, actualCount) {\n    if (requiredCount > actualCount) {\n      throw new TypeError(context + ' requires at least' + requiredCount + ' arguments')\n    }\n  },\n  error: function (context, name, criteria) {\n    if (typeof(context) === 'object') {\n      context = context.constructor && context.constructor.name || 'Unknown'\n      context += ' constructor'\n    }\n    throw new TypeError(context + ': argument \\'' + name + '\\' must ' + criteria)\n  },\n  optObject: optArgCheck('object'),\n  object: function (context, name, value) {\n    if (typeof(value) !== 'object') {\n      this.error(context, name, 'be an object')\n    } else if (value === null) {\n      this.error(context, name, 'be an object, not null')\n    } else if (Array.isArray(value)) {\n      this.error(context, name, 'be an object, not an array')\n    } else if (value instanceof RegExp) {\n      this.error(context, name, 'be an object, not a RegExp instance')\n    }\n    return value\n  },\n  optInstance: optArgCheck('instance'),\n  instance(context, name, value, constructor) {\n    if (!constructor) {\n      throw new Error(`Failed instance argument check for ${name} in ${context}, constructor is ${constructor}.`)\n    }\n    if (Array.isArray(constructor)) {\n      let atLeastOneMatch = constructor.some(constructor => {\n        return value instanceof constructor\n      })\n      if (!atLeastOneMatch) {\n        let names = constructor.map(constructor => constructor.name).join(', ')\n        this.error(context, name, `be an instance of any of ${names}`)\n      }\n    } else if (!(value instanceof constructor)) {\n      this.error(context, name, `be an instance of ${constructor.name}`)\n    }\n    return value\n  },\n  optFunc: optArgCheck('func'),\n  func: function (context, name, value) {\n    if (typeof(value) !== 'function') {\n      this.error(context, name, 'be a function')\n    }\n    return value\n  },\n  optArray: optArgCheck('array'),\n  array: function (context, name, value) {\n    if (!Array.isArray(value)) {\n      this.error(context, name, 'be an array')\n    }\n    return value\n  },\n  optString: optArgCheck('string'),\n  string: function (context, name, value) {\n    if (typeof(value) !== 'string') {\n      this.error(context, name, 'be a string')\n    } else if (value === '') {\n      this.error(context, name, 'not be an empty string')\n    }\n    return value\n  },\n  optStringOrEmpty: optArgCheck('string'),\n  stringOrEmpty: function (context, name, value) {\n    if (typeof(value) !== 'string') {\n      this.error(context, name, 'be a string')\n    }\n    return value\n  },\n  optValues: optArgCheck('values'),\n  values: function (context, name, value, values) {\n    if (values.indexOf(value) === -1) {\n      this.error(context, name, 'be one of ' + values.join(', '))\n    }\n    return value\n  },\n  optNumber: optArgCheck('number'),\n  number: function (context, name, value) {\n    if (isNaN(value)) {\n      this.error(context, name, 'not be NaN')\n    } else if (!isFinite(value)) {\n      this.error(context, name, 'not be Infinite')\n    } else if (typeof(value) !== 'number') {\n      this.error(context, name, 'be a number')\n    }\n    return value\n  },\n  optBoolean: optArgCheck('boolean'),\n  boolean: function (context, name, value) {\n    if (typeof(value) !== 'boolean') {\n      this.error(context, name, 'be a boolean')\n    }\n    return value\n  },\n  options: function (context, name, value) {\n    this.object(context, name, value)\n    return new OptionsArgChecker(context, name, value)\n  },\n  optOptions: function (context, name, value) {\n    if (value !== undefined) {\n      try {\n        return this.options(context, name, value)\n      } catch (e) {\n        e.message += ' if present'\n        throw e\n      }\n    }\n    return new OptionsArgChecker(0, 0, 0, true)\n  },\n}\n\nexport default argCheck\n\nfunction OptionsArgChecker(context, name, value, empty) {\n  this.context = context\n  this.name = name\n  this.value = value\n  this.empty = empty\n}\n\nfunction optOptionsArgCheck(type) {\n  return function (prop, extra) {\n    if (!this.empty && prop in this.value) {\n      if (this.value[prop] !== undefined && this.value[prop] !== null) {\n        try {\n          this[type](prop, extra)\n        } catch (e) {\n          e.message += ' if present'\n          throw e\n        }\n      }\n    }\n    return this\n  }\n}\n\nOptionsArgChecker.prototype = {\n  optObject: optOptionsArgCheck('object'),\n  object: function (prop) {\n    if (!this.empty) {\n      argCheck.object(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n  optInstance: optOptionsArgCheck('instance'),\n  instance: function (prop, constructor) {\n    if (!this.empty) {\n      argCheck.instance(this.context, this.name + '.' + prop, this.value[prop], constructor)\n    }\n    return this\n  },\n  optFunc: optOptionsArgCheck('func'),\n  func: function (prop) {\n    if (!this.empty) {\n      argCheck.func(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n  optArray: optOptionsArgCheck('array'),\n  array: function (prop) {\n    if (!this.empty) {\n      argCheck.array(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n  optString: optOptionsArgCheck('string'),\n  string: function (prop) {\n    if (!this.empty) {\n      argCheck.string(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n  optStringOrEmpty: optOptionsArgCheck('stringOrEmpty'),\n  stringOrEmpty: function (prop) {\n    if (!this.empty) {\n      argCheck.stringOrEmpty(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n  optValues: optOptionsArgCheck('values'),\n  values: function (prop, values) {\n    if (!this.empty) {\n      argCheck.values(this.context, this.name + '.' + prop, this.value[prop], values)\n    }\n    return this\n  },\n  optNumber: optOptionsArgCheck('number'),\n  number: function (prop) {\n    if (!this.empty) {\n      argCheck.number(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n  optBoolean: optOptionsArgCheck('boolean'),\n  boolean: function (prop) {\n    if (!this.empty) {\n      argCheck.boolean(this.context, this.name + '.' + prop, this.value[prop])\n    }\n    return this\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/argCheck.js","'use strict'\n\nexport function find(collection, func, thisArg) {\n  for (var key in collection) {\n    if (collection.hasOwnProperty(key)) {\n      if (func.call(thisArg, collection[key], key, collection)) {\n        return collection[key]\n      }\n    }\n  }\n  return null\n}\n\nexport function fill(array, value = undefined) {\n  let len = array.length | 0\n\n  for (let i = 0; i < len; i += 1) {\n    array[i] = value\n  }\n\n  return array\n}\n\nexport function filter(collection, func, thisArg) {\n  var arr = []\n  for (var key in collection) {\n    if (collection.hasOwnProperty(key)) {\n      if (func.call(thisArg, collection[key], key, collection)) {\n        arr.push(collection[key])\n      }\n    }\n  }\n  return arr\n}\n\nexport function forEach(collection, func, thisArg) {\n  for (var key in collection) {\n    if (collection.hasOwnProperty(key)) {\n      func.call(thisArg, collection[key], key, collection)\n    }\n  }\n}\n\nexport function map(collection, func, thisArg) {\n  var arr = []\n  for (var key in collection) {\n    if (collection.hasOwnProperty(key)) {\n      arr.push(func.call(thisArg, collection[key], key, collection))\n    }\n  }\n  return arr\n}\n\nexport function mapValues(collection, func, thisArg) {\n  var obj = {}\n  for (var key in collection) {\n    if (collection.hasOwnProperty(key)) {\n      obj[key] = func.call(thisArg, collection[key], key, collection)\n    }\n  }\n  return obj\n}\n\nexport function values(collection) {\n  if (!collection) {\n    return []\n  }\n  if (Array.isArray(collection)) {\n    throw new TypeError('tried to call utils.values() on array')\n  }\n  return Object.keys(collection).map(key => collection[key])\n}\n\nexport function diff(collection1, collection2) {\n  let set1 = new Set(collection1)\n  let set2 = new Set(collection2)\n  let added = []\n  let removed = []\n  set1.forEach(element => {\n    if (!set2.has(element)) {\n      removed.push(element)\n    }\n  })\n  set2.forEach(element => {\n    if (!set1.has(element)) {\n      added.push(element)\n    }\n  })\n  return [added, removed]\n}\n\nexport function toArray(arrayLike) {\n  var arr = []\n  for (var i = 0; i < arrayLike.length; i += 1) {\n    arr[i] = arrayLike[i]\n  }\n  return arr\n}\n\nexport function hiddenProp(obj, name, value) {\n  Object.defineProperty(obj, name, {\n    enumerable: false,\n    configurable: true,\n    writable: false,\n    value: value,\n  })\n}\n\nexport function prop(obj, name, func) {\n  Object.defineProperty(obj, name, {\n    enumerable: true,\n    configurable: false,\n    writable: false,\n    value: func,\n  })\n}\n\nexport function getter(obj, name, func) {\n  Object.defineProperty(obj, name, {\n    enumerable: true,\n    configurable: false,\n    get: func,\n  })\n}\n\nexport function range(from, to, step) {\n  if (arguments.length === 1) {\n    to = from\n    from = 0\n    step = 1\n  } else if (arguments.length === 2) {\n    step = 1\n  }\n  var arr = []\n  for (var i = from; i < to; i += step) {\n    arr.push(i)\n  }\n  return arr\n}\n\nexport function defer() {\n  var deferred = {}\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve\n    deferred.reject = reject\n  })\n  return deferred\n}\n\nexport function shallowCopy(obj, keys) {\n  if (!obj) {\n    return null\n  }\n  var result = {}\n  var key\n  if (keys) {\n    for (var index in keys) {\n      key = keys[index]\n      result[key] = obj[key]\n    }\n  } else {\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        result[key] = obj[key]\n      }\n    }\n  }\n  return result\n}\n\nexport function assign(obj, other, keys) {\n  if (!obj) {\n    return null\n  }\n  if (!other) {\n    return obj\n  }\n  var key\n  if (keys) {\n    for (var index in keys) {\n      key = keys[index]\n      obj[key] = other[key]\n    }\n  } else {\n    for (key in other) {\n      if (other.hasOwnProperty(key)) {\n        obj[key] = other[key]\n      }\n    }\n  }\n  return obj\n}\n\nexport function wait(time) {\n  return function () {\n    var args = arguments\n    return new Promise(function (resolve) {\n      setTimeout(function () {\n        resolve.apply(null, args)\n      }, time)\n    })\n  }\n}\n\nexport function randomString(size) {\n  var array = null\n  var now\n  var i\n  var crypto = noVendor(globalObject, 'crypto')\n  if (process.env.NODEJS) {\n    array = require('crypto').randomBytes(size)\n  } else if (crypto && window.Uint8Array) {\n    array = new window.Uint8Array(size)\n    crypto.getRandomValues(array)\n  } else {\n    now = new Date().getTime()\n    array = []\n    for (i = 0; i < size; i += 1) {\n      array[i] = (Math.random() * now) & 255\n    }\n  }\n\n  var rawString = String.fromCharCode.apply(null, array)\n  var base64String = utf8ToBase64(rawString)\n  return base64String.replace(/\\-_/g, '').slice(0, size)\n}\n\nexport function arrayBufferSha1IfSupported(arrayBuffer) {\n  let subtleCrypto = window.crypto && window.crypto.subtle\n  if (subtleCrypto && subtleCrypto.digest) {\n    return subtleCrypto.digest('SHA-1', arrayBuffer)\n  }\n  return Promise.resolve(null)\n}\n\nexport function base64ToUtf8(base64) {\n  if (process.env.NODEJS) {\n    /* global global */\n    return global.Buffer.from(base64, 'base64').toString('utf8')\n  } else {\n    return atob(base64)\n  }\n}\n\nexport function utf8ToBase64(utf8) {\n  if (process.env.NODEJS) {\n    /* global global */\n    return global.Buffer.from(utf8, 'utf8').toString('base64')\n  } else {\n    return btoa(utf8)\n  }\n}\n\nexport function urlSafeBase64ToUtf8(urlSafeBase64) {\n  return base64ToUtf8(urlSafeBase64.replace(/[-_]/g, charFromUrlSafeBase64))\n}\n\nexport function utf8ToUrlSafeBase64(utf8) {\n  return utf8ToBase64(utf8).replace(/[+/=]/g, charToUrlSafeBase64)\n}\n\nfunction charToUrlSafeBase64(char) {\n  switch (char) {\n    case '+': return '-'\n    case '/': return '_'\n  }\n  return ''\n}\n\nfunction charFromUrlSafeBase64(char) {\n  switch (char) {\n    case '-': return '+'\n    case '_': return '/'\n  }\n  return ''\n}\n\nexport function binaryStringToArrayBuffer(binaryString) {\n  var buffer = new ArrayBuffer(binaryString.length)\n  var view = new Uint8Array(buffer)\n  var length = binaryString.length\n  for (var i = 0; i < length; i += 1) {\n    view[i] = binaryString.charCodeAt(i)\n  }\n  return buffer\n}\n\nexport function unicodeStringToArrayBuffer(unicodeString) {\n  var buffer = new ArrayBuffer(unicodeString.length * 2)\n  var view = new Uint16Array(buffer)\n  var length = unicodeString.length\n  for (var i = 0; i < length; i += 1) {\n    view[i] = unicodeString.charCodeAt(i)\n  }\n  return buffer\n}\n\nfunction bufferViewToString(view, chunkSize = 0x1000) {\n  let length = view.length\n  let result = ''\n  for (let i = 0; i < length; i += chunkSize) {\n    result += String.fromCharCode.apply(null, view.subarray(i, i + chunkSize))\n  }\n  return result\n}\n\nexport function arrayBufferToBinaryString(buffer) {\n  let view = new Uint8Array(buffer.buffer || buffer, buffer.byteOffset, buffer.byteLength)\n  return bufferViewToString(view)\n}\n\nexport function arrayBufferToUnicodeString(buffer) {\n  let view = new Uint16Array(buffer.buffer || buffer, buffer.byteOffset, buffer.byteLength >> 1)\n  return bufferViewToString(view)\n}\n\nexport function parseDataUri(dataUri) {\n  var split = dataUri.split(/:|;|,/g)\n  if (split[0] !== 'data') {\n    throw new Error('invalid data uri: ' + dataUri.slice(0, 100))\n  }\n  if (split[2] !== 'base64') {\n    throw new Error('invalid data uri: ' + dataUri.slice(0, 100))\n  }\n  return {\n    mimeType: split[1],\n    binaryString: base64ToUtf8(split[3]),\n  }\n}\n\nexport function blobToArrayBuffer(blob) {\n  var reader = new FileReader()\n  return new Promise(function (resolve, reject) {\n    reader.onload = function () {\n      resolve(reader.result)\n    }\n    reader.onerror = reject\n    reader.readAsArrayBuffer(blob)\n  })\n}\n\nexport function bufferToFile(buffer, fileName, mimeType) {\n  var file = new Blob([buffer], {\n    type: mimeType,\n  })\n  file.name = fileName\n  file.lastModifiedDate = new Date()\n  return file\n}\n\nexport function bufferToHex(buffer) {\n  var view = new Uint8Array(buffer)\n  return Array.prototype.map.call(view, function (x) {\n    return ('00' + x.toString(16)).slice(-2)\n  }).join('')\n}\n\nexport function hexToBuffer(hex) {\n  if (hex.length % 2 !== 0) {\n    throw new TypeError('hexToBuffer: hex length must be even')\n  }\n  var buffer = new Uint8Array(hex.length / 2)\n  for (var i = 0; hex.substr(i, 2); i += 2) {\n    buffer[i / 2] = parseInt(hex.substr(i, 2), 16)\n  }\n  return buffer\n}\n\nexport function concatenateArrayBuffers(buffers) {\n  let totalLength = 0\n  for (let index in buffers) {\n    totalLength += buffers[index].byteLength\n  }\n\n  let result = new Uint8Array(totalLength)\n  let offset = 0\n  for (let index in buffers) {\n    let view = new Uint8Array(buffers[index])\n    result.set(view, offset)\n    offset += view.byteLength\n  }\n\n  return result\n}\n\nexport function noVendor(obj, name) {\n  var upper = name[0].toUpperCase() + name.slice(1)\n  var unprefixed = obj[name] || obj['moz' + upper] || obj['webkit' + upper] || obj['ms' + upper]\n  if (!unprefixed) {\n    return null\n  }\n  if (typeof(unprefixed) === 'function') {\n    return unprefixed.bind(obj)\n  } else {\n    return unprefixed\n  }\n}\n\nvar globalObject\nif (process.env.NODEJS) {\n  /* global global */\n  globalObject = global\n} else {\n  globalObject = window\n}\n\nif (globalObject) {\n  globalObject.__C3_SDK_INSTANCES__ = {\n    listeners: new Set(),\n    addListener(listener) {\n      this.listeners.add(listener)\n    },\n    removeListener(listener) {\n      this.listeners.delete(listener)\n    },\n  }\n}\n\nexport function registerInstance(collectionName, instance) {\n  if (globalObject) {\n    let collection = globalObject.__C3_SDK_INSTANCES__[collectionName]\n    if (!collection) {\n      globalObject.__C3_SDK_INSTANCES__[collectionName] = [instance]\n    } else if (collection.indexOf(instance) === -1) {\n      collection.push(instance)\n    }\n    globalObject.__C3_SDK_INSTANCES__.listeners.forEach(listener => {\n      listener('added', collectionName, instance)\n    })\n  }\n}\n\nexport function unregisterInstance(collectionName, instance) {\n  if (globalObject) {\n    let collection = globalObject.__C3_SDK_INSTANCES__[collectionName]\n    let index = collection.indexOf(instance)\n    if (index !== -1) {\n      collection.splice(index, 1)\n    }\n    globalObject.__C3_SDK_INSTANCES__.listeners.forEach(listener => {\n      listener('removed', collectionName, instance)\n    })\n  }\n}\n\nexport function priv(constructor) {\n  var args = [priv]\n  var len = arguments.length\n  for (var i = 1; i < len; i += 1) {\n    args[i] = arguments[i]\n  }\n  var instance = Object.create(constructor.prototype)\n  constructor.apply(instance, args)\n  return instance\n}\n\nexport function assertPriv(name, providedPriv) {\n  if (priv !== providedPriv) {\n    throw new TypeError(name + ': cannot be used as a constructor')\n  }\n}\n\nexport const isFirefox = /firefox/i.test(typeof(navigator) !== 'undefined' && navigator.userAgent)\nconst isGoogle = /google inc/i.test(typeof(navigator) !== 'undefined' && navigator.vendor)\nexport const isChrome = isGoogle && /chrome/i.test(typeof(navigator) !== 'undefined' && navigator.userAgent)\nexport const browser = isChrome ? 'chrome' : (isFirefox ? 'firefox' : 'other')\n// Internet Explorer 6-11\nexport const isIE = /* @cc_on!@*/false || !!globalObject.document && !!globalObject.document.documentMode\n\nexport function isObject(obj) {\n  return typeof(obj) === 'object' && obj !== null && !Array.isArray(obj) && !(obj instanceof RegExp)\n}\n\nexport function notInNode(thing) {\n  if (process.env.NODEJS) {\n    throw new TypeError(`${thing} is not available in NodeJS`)\n  }\n}\n\nexport function maybeConvertStringToNumber(string) {\n  if (!isNaN(string)) {\n    if (Number(string) % 1 === 0) {\n      return parseInt(string)\n    }\n    return parseFloat(string)\n  }\n  return string\n}\n\nexport function getStringByteLength(string) {\n  var bytes = string.length\n  for (var i = string.length - 1; i >= 0; i -= 1) {\n    var charCode = string.charCodeAt(i)\n    if (charCode > 0x7f && charCode <= 0x7ff) {\n      bytes += 1\n    } else if (charCode > 0x7ff && charCode <= 0xffff) {\n      bytes += 2\n    } if (charCode >= 0xDC00 && charCode <= 0xDFFF) {\n            // trailing surrogate\n      i -= 1\n    }\n  }\n  return bytes\n}\n\n/**\n * A read-only version of the built-in Map class.\n *\n * @class ReadOnlyMap\n */\nexport class ReadOnlyMap extends Map {\n  constructor() {\n    super()\n    if (arguments.length) {\n      throw new TypeError('ReadOnlyMap does not support constructor arguments')\n    }\n  }\n\n  /**\n   * The number of entries in the map.\n   *\n   * @member {number} ReadOnlyMap#size\n   */\n\n  /**\n   * Provides a way to iterate through all the entries in this map. Each entry is represented\n   * by an array with two elements, were the first element is the key and the second is the value.\n   *\n   * @function ReadOnlyMap#entries\n   * @returns {Iterator<Array<*>>} - An iterator of all entries in this map.\n   */\n\n  /**\n   * Provited a way to iterate though all the keys in this map.\n   *\n   * @function ReadOnlyMap#keys\n   * @returns {Iterator<*>} - An iterator of all keys in this map.\n   */\n\n  /**\n   * Provited a way to iterate though all the values in this map.\n   *\n   * @function ReadOnlyMap#values\n   * @returns {Iterator<*>} - An iterator of all values in this map.\n   */\n\n  /**\n   * Returns the value for the given key.\n   *\n   * @function ReadOnlyMap#get\n   * @param {*} key - The key of the value to retreive.\n   * @returns {*} The value, if it exists, `undefined` otherwise\n   */\n\n  /**\n   * Returns true if the map has an entry for the given key.\n   *\n   * @function ReadOnlyMap#has\n   * @param {*} key - The key to look for.\n   */\n\n  /**\n   * Synchronously calls an interator function once for each entry in the map.\n   *\n   * Errors thrown inside the iterator function will cancel the iteration\n   *\n   * @function ReadOnlyMap#forEach\n   * @param {ReadOnlyMapForEachCallback} func - The iterator function.\n   * @param {*} [thisArg] - The value to use as `this` inside the iterator function.\n   */\n\n  /**\n   * The iterator function passed to {@link ReadOnlyMap#forEach}.\n   *\n   * @callback ReadOnlyMapForEachCallback\n   * @param {*} key - The key of the current entry.\n   * @param {*} value - The value of the current entry.\n   * @param {ReadOnlyMap} map - The map itself.\n   */\n\n  set() {\n    throw new TypeError('Map is read-only')\n  }\n\n  delete() {\n    throw new TypeError('Map is read-only')\n  }\n\n  clear() {\n    throw new TypeError('Map is read-only')\n  }\n\n  /* private */\n\n  _set(key, value) {\n    return super.set(key, value)\n  }\n\n  _delete(key) {\n    return super.delete(key)\n  }\n\n  _clear() {\n    return super.clear()\n  }\n}\n\nexport class ReadOnlySet extends Set {\n  constructor() {\n    super()\n    if (arguments.length) {\n      throw new TypeError('ReadOnlySet does not support constructor arguments')\n    }\n  }\n\n  add() {\n    throw new TypeError('Set is read-only')\n  }\n\n  delete() {\n    throw new TypeError('Set is read-only')\n  }\n\n  clear() {\n    throw new TypeError('Set is read-only')\n  }\n\n  _add(value) {\n    return super.add(value)\n  }\n\n  _delete(value) {\n    return super.delete(value)\n  }\n\n  _clear() {\n    return super.clear()\n  }\n}\n\nexport function createTimedBuffer(time, callback) {\n  let args = []\n  let timeout = 0\n  return function (arg) {\n    args.push(arg)\n    if (!timeout) {\n      timeout = setTimeout(onTimeout, time)\n    }\n    function onTimeout() {\n      timeout = 0\n      try {\n        callback(args)\n      } catch (error) {\n        console.error(`error in timed buffer callback: ${error}`)\n      }\n      args = []\n    }\n  }\n}\n\nexport function errorForwarder(handler, location) {\n  return error => {\n    if (!location) {\n      handler(error)\n    } else {\n      let newError = new Error(`Error in ${location}: ${error.message}`)\n      newError.reason = error\n      handler(newError)\n    }\n  }\n}\n\n/**\n * Types that can be serialized as JSON.\n *\n * This is identical to the parameters that can be passed to the built-in `JSON.stringify`.\n * Circular references are not allowed, and `toJSON` methods will be used.\n *\n * @typedef JsonTypes {string|number|boolean|null|Array<JsonTypes>|Object<JsonTypes>}\n */\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/utils.js","var isObject = require('./_is-object');\nmodule.exports = function(it){\n  if(!isObject(it))throw TypeError(it + ' is not an object!');\n  return it;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_an-object.js\n// module id = 14\n// module chunks = 0 1 2 3 4 5 6","var dP         = require('./_object-dp')\n  , createDesc = require('./_property-desc');\nmodule.exports = require('./_descriptors') ? function(object, key, value){\n  return dP.f(object, key, createDesc(1, value));\n} : function(object, key, value){\n  object[key] = value;\n  return object;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_hide.js\n// module id = 15\n// module chunks = 0 1 2 3 4 5 6","// to indexed object, toObject with fallback for non-array-like ES3 strings\nvar IObject = require('./_iobject')\n  , defined = require('./_defined');\nmodule.exports = function(it){\n  return IObject(defined(it));\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_to-iobject.js\n// module id = 16\n// module chunks = 0 1 2 3 4 5 6","module.exports = function(it){\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_is-object.js\n// module id = 17\n// module chunks = 0 1 2 3 4 5 6","// optional / simple context binding\nvar aFunction = require('./_a-function');\nmodule.exports = function(fn, that, length){\n  aFunction(fn);\n  if(that === undefined)return fn;\n  switch(length){\n    case 1: return function(a){\n      return fn.call(that, a);\n    };\n    case 2: return function(a, b){\n      return fn.call(that, a, b);\n    };\n    case 3: return function(a, b, c){\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function(/* ...args */){\n    return fn.apply(that, arguments);\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_ctx.js\n// module id = 18\n// module chunks = 0 1 2 3 4 5 6","var hasOwnProperty = {}.hasOwnProperty;\nmodule.exports = function(it, key){\n  return hasOwnProperty.call(it, key);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_has.js\n// module id = 19\n// module chunks = 0 1 2 3 4 5 6","module.exports = function(exec){\n  try {\n    return !!exec();\n  } catch(e){\n    return true;\n  }\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_fails.js\n// module id = 21\n// module chunks = 0 1 2 3 4 5 6","module.exports = {};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iterators.js\n// module id = 22\n// module chunks = 0 1 2 3 4 5 6","'use strict';\nvar $at  = require('./_string-at')(true);\n\n// 21.1.3.27 String.prototype[@@iterator]()\nrequire('./_iter-define')(String, 'String', function(iterated){\n  this._t = String(iterated); // target\n  this._i = 0;                // next index\n// 21.1.5.2.1 %StringIteratorPrototype%.next()\n}, function(){\n  var O     = this._t\n    , index = this._i\n    , point;\n  if(index >= O.length)return {value: undefined, done: true};\n  point = $at(O, index);\n  this._i += point.length;\n  return {value: point, done: false};\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.string.iterator.js\n// module id = 23\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/promise\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/promise.js\n// module id = 24\n// module chunks = 0 1 2 3 4 6","// 19.1.2.14 / 15.2.3.14 Object.keys(O)\nvar $keys       = require('./_object-keys-internal')\n  , enumBugKeys = require('./_enum-bug-keys');\n\nmodule.exports = Object.keys || function keys(O){\n  return $keys(O, enumBugKeys);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-keys.js\n// module id = 25\n// module chunks = 0 1 2 3 4 5 6","var toString = {}.toString;\n\nmodule.exports = function(it){\n  return toString.call(it).slice(8, -1);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_cof.js\n// module id = 26\n// module chunks = 0 1 2 3 4 5 6","module.exports = function(bitmap, value){\n  return {\n    enumerable  : !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable    : !(bitmap & 4),\n    value       : value\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_property-desc.js\n// module id = 27\n// module chunks = 0 1 2 3 4 5 6","var def = require('./_object-dp').f\n  , has = require('./_has')\n  , TAG = require('./_wks')('toStringTag');\n\nmodule.exports = function(it, tag, stat){\n  if(it && !has(it = stat ? it : it.prototype, TAG))def(it, TAG, {configurable: true, value: tag});\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_set-to-string-tag.js\n// module id = 28\n// module chunks = 0 1 2 3 4 5 6","// 7.1.13 ToObject(argument)\nvar defined = require('./_defined');\nmodule.exports = function(it){\n  return Object(defined(it));\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_to-object.js\n// module id = 29\n// module chunks = 0 1 2 3 4 5 6","require('./es6.array.iterator');\nvar global        = require('./_global')\n  , hide          = require('./_hide')\n  , Iterators     = require('./_iterators')\n  , TO_STRING_TAG = require('./_wks')('toStringTag');\n\nfor(var collections = ['NodeList', 'DOMTokenList', 'MediaList', 'StyleSheetList', 'CSSRuleList'], i = 0; i < 5; i++){\n  var NAME       = collections[i]\n    , Collection = global[NAME]\n    , proto      = Collection && Collection.prototype;\n  if(proto && !proto[TO_STRING_TAG])hide(proto, TO_STRING_TAG, NAME);\n  Iterators[NAME] = Iterators.Array;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/web.dom.iterable.js\n// module id = 30\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/map\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/map.js\n// module id = 31\n// module chunks = 0 1 2 3 4","\"use strict\";\n\nexports.__esModule = true;\n\nvar _from = require(\"../core-js/array/from\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return (0, _from2.default)(arr);\n  }\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/toConsumableArray.js\n// module id = 32\n// module chunks = 0 1 2 3 4 5","// 7.2.1 RequireObjectCoercible(argument)\nmodule.exports = function(it){\n  if(it == undefined)throw TypeError(\"Can't call method on  \" + it);\n  return it;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_defined.js\n// module id = 33\n// module chunks = 0 1 2 3 4 5 6","// 7.1.15 ToLength\nvar toInteger = require('./_to-integer')\n  , min       = Math.min;\nmodule.exports = function(it){\n  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_to-length.js\n// module id = 34\n// module chunks = 0 1 2 3 4 5 6","var id = 0\n  , px = Math.random();\nmodule.exports = function(key){\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_uid.js\n// module id = 35\n// module chunks = 0 1 2 3 4 5 6","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\n\nvar DEFAULT_LISTENER_LIMIT = 10\nfunction LEAK_MESSAGE(limit) {\n  return 'Listener leak: added more than ' + limit +\n        ' listeners for a single event.  This limit can be changed' +\n        ' by setting the LISTENER_LIMIT property on the emitter object.'\n}\n\n/**\n * @mixin EventEmitter\n */\nconst emitterPrototype = (() => {\n  const Base = EmitterMixin(null)\n  let emitter = Object.create(null)\n  Object.getOwnPropertyNames(Base.prototype).forEach(name => {\n    if (name !== 'constructor') {\n      emitter[name] = Base.prototype[name]\n    }\n  })\n  return emitter\n})()\n\nfunction EmitterMixin(superclass = () => {}) {\n  if (arguments.length === 0) {\n    return Object.assign(this, emitterPrototype)\n  }\n\n  return class extends superclass {\n    _listeners() {\n      if (!this.__listeners) {\n        this.__listeners = new Map()\n      }\n      return this.__listeners\n    }\n    /**\n     * Adds a new listener for an event. All listeners will be called in the order in\n     * which they were added. Adding an already added listener is not an error and will\n     * result in the listener being called multiple times.\n     *\n     * @function EventEmitter#on\n     * @param {eventType} eventType - The event to listen for.\n     * @param {Function} listener - A function that will be called whenever the event is emitted.\n     * @returns {EventEmitter} Itself, to allow chained calls.\n     */\n    on(eventType, listener) {\n      argCheck.count('EventEmitter.on', 2, arguments.length)\n      argCheck.string('EventEmitter.on', 'eventType', eventType)\n      argCheck.func('EventEmitter.on', 'listener', listener)\n      let listeners = this._listeners().get(eventType)\n\n      let deprecationMessage = this.constructor._deprecatedEvents && this.constructor._deprecatedEvents[eventType]\n      if (deprecationMessage) {\n        log.warning('deprecated', deprecationMessage('on'))\n      }\n\n      if (!listeners) {\n        listeners = []\n        this._listeners().set(eventType, listeners)\n      }\n      let element = {\n        remaining: -1,\n        func: listener,\n      }\n      if (listeners.iterating) {\n        if (!listeners.pending) {\n          listeners.pending = []\n        }\n        listeners.pending.push(element)\n      } else {\n        listeners.push(element)\n      }\n      var limit = this.LISTENER_LIMIT\n      limit = typeof(limit) === 'number' ? limit : DEFAULT_LISTENER_LIMIT\n      if (listeners.length > limit) {\n        log.warning('emitter', LEAK_MESSAGE(limit), this)\n      }\n      return this\n    }\n\n    /**\n     * Works like {@link EventEmitter#on on}, but the listener is at most called once, and then removed.\n     * If no callback is passed, a promise will be returned instead.\n     *\n     * @function EventEmitter#once\n     * @param {eventType} eventType - The event to listen for.\n     * @param {Function} [listener=null] - A function that will be called whenever the event is emitted.\n     * @returns {EventEmitter|Promise} Itself, or a promise if no callback was passed.\n     */\n    once(eventType, listener) {\n      argCheck.count('EventEmitter.once', 1, arguments.length)\n      argCheck.string('EventEmitter.once', 'eventType', eventType)\n      argCheck.optFunc('EventEmitter.once', 'listener', listener)\n\n      let deprecationMessage = this.constructor._deprecatedEvents && this.constructor._deprecatedEvents[eventType]\n      if (deprecationMessage) {\n        log.warning('deprecated', deprecationMessage('once'))\n      }\n\n      if (listener) {\n        let newListeners = (this._listeners().get(eventType) || []).concat({\n          remaining: 1,\n          func: listener,\n        })\n        this._listeners().set(eventType, newListeners)\n        var listenerCount = this._listeners().get(eventType).length\n        var limit = this.LISTENER_LIMIT\n        limit = typeof(limit) === 'number' ? limit : DEFAULT_LISTENER_LIMIT\n        if (listenerCount > limit) {\n          log.warning('emitter', LEAK_MESSAGE(limit), this)\n        }\n        return this\n      } else {\n        return new Promise(resolve => {\n          let newListeners = (this._listeners().get(eventType) || []).concat({\n            remaining: 1,\n            func: resolve,\n          })\n          this._listeners().set(eventType, newListeners)\n        })\n      }\n    }\n\n    /**\n     * Removes a listener associated with an event. At most one listener is removed, if the\n     * same listener has been added multiple times, only the first listener is removed.\n     *\n     * @function EventEmitter#off\n     * @param {eventType} eventType - The event type from which to remove the listener(s).\n     * @param {Function} [listener] - The listener that should be removed. If omitted,\n     * all listeners for the event type are removed.\n     * @returns {EventEmitter} Itself, to allow chained calls.\n     */\n    off(eventType, listener) {\n      argCheck.count('EventEmitter.off', 1, arguments.length)\n      argCheck.string('EventEmitter.off', 'eventType', eventType)\n      argCheck.func('EventEmitter.off', 'listener', listener)\n\n      let deprecationMessage = this.constructor._deprecatedEvents && this.constructor._deprecatedEvents[eventType]\n      if (deprecationMessage) {\n        log.warning('deprecated', deprecationMessage('off'))\n      }\n\n      var listeners\n      var i\n      listeners = this._listeners().get(eventType)\n      if (listeners) {\n        for (i = 0; i < listeners.length; i += 1) {\n          if (listeners[i].func === listener) {\n            if (listeners.iterating) {\n              if (listeners[i].remaining === 0) {\n                continue\n              }\n              listeners[i].remaining = 0\n            } else {\n              listeners.splice(i, 1)\n            }\n            return this\n          }\n        }\n      }\n      return this\n    }\n\n    _clearListeners(eventType) {\n      if (eventType) {\n        this._listeners().delete(eventType)\n      } else {\n        this._listeners().clear()\n      }\n    }\n\n    /**\n     * @function EventEmitter#_getListeners\n     * @private\n     * @param {eventType} eventType - The event type to fetch the listeners for.\n     * @returns {EventEmitter} All listeners for the given event type.\n     */\n    _getListeners(eventType) {\n      argCheck.count('EventEmitter.listeners', 1, arguments.length)\n      argCheck.string('EventEmitter.listeners', 'eventType', eventType)\n      return (this._listeners().get(eventType) || []).filter(function (obj) {\n        return obj.remaining\n      }).map(function (obj) {\n        return obj.func\n      })\n    }\n\n    // eventType, args...\n    _emit(arg) {\n      var eventType = arg.eventType || arg\n      var defaultHandler = arg.defaultHandler\n      var listeners = this._listeners().get(eventType)\n      if (!listeners && !defaultHandler) {\n        return\n      }\n\n      var args = []\n      var i\n      for (i = 1; i < arguments.length; i += 1) {\n        args[i - 1] = arguments[i]\n      }\n\n      if (!listeners) {\n        defaultHandler.apply(this, args)\n        return\n      }\n      var called = false\n\n      listeners.iterating = true\n      for (i = 0; i < listeners.length; i += 1) {\n        var listener = listeners[i]\n        if (listener.remaining !== 0) {\n          if (listener.remaining > 0) {\n            listener.remaining -= 1\n          }\n          try {\n            listener.func.apply(this, args)\n            called = true\n          } catch (error) {\n            log.error('emitter', `Error in event listener, ${error} ${error.stack ? `${error.stack}\\n` : ''}`)\n          }\n        }\n      }\n      listeners.iterating = false\n\n      for (i = listeners.length - 1; i >= 0; i -= 1) {\n        if (listeners[i].remaining === 0) {\n          listeners.splice(i, 1)\n        }\n      }\n\n      if (listeners.pending) {\n        listeners.push(...listeners.pending)\n        delete listeners.pending\n      }\n\n      if (!called && defaultHandler) {\n        defaultHandler.apply(this, args)\n      }\n    }\n  }\n}\n\nexport default EmitterMixin\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/emitter.js","module.exports = true;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_library.js\n// module id = 37\n// module chunks = 0 1 2 3 4 5 6","// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\nvar anObject    = require('./_an-object')\n  , dPs         = require('./_object-dps')\n  , enumBugKeys = require('./_enum-bug-keys')\n  , IE_PROTO    = require('./_shared-key')('IE_PROTO')\n  , Empty       = function(){ /* empty */ }\n  , PROTOTYPE   = 'prototype';\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar createDict = function(){\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = require('./_dom-create')('iframe')\n    , i      = enumBugKeys.length\n    , lt     = '<'\n    , gt     = '>'\n    , iframeDocument;\n  iframe.style.display = 'none';\n  require('./_html').appendChild(iframe);\n  iframe.src = 'javascript:'; // eslint-disable-line no-script-url\n  // createDict = iframe.contentWindow.Object;\n  // html.removeChild(iframe);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);\n  iframeDocument.close();\n  createDict = iframeDocument.F;\n  while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];\n  return createDict();\n};\n\nmodule.exports = Object.create || function create(O, Properties){\n  var result;\n  if(O !== null){\n    Empty[PROTOTYPE] = anObject(O);\n    result = new Empty;\n    Empty[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = createDict();\n  return Properties === undefined ? result : dPs(result, Properties);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-create.js\n// module id = 38\n// module chunks = 0 1 2 3 4 5 6","\"use strict\";\n\nexports.__esModule = true;\n\nvar _iterator = require(\"../core-js/symbol/iterator\");\n\nvar _iterator2 = _interopRequireDefault(_iterator);\n\nvar _symbol = require(\"../core-js/symbol\");\n\nvar _symbol2 = _interopRequireDefault(_symbol);\n\nvar _typeof = typeof _symbol2.default === \"function\" && typeof _iterator2.default === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof _symbol2.default === \"function\" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? \"symbol\" : typeof obj; };\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = typeof _symbol2.default === \"function\" && _typeof(_iterator2.default) === \"symbol\" ? function (obj) {\n  return typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj);\n} : function (obj) {\n  return obj && typeof _symbol2.default === \"function\" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? \"symbol\" : typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/typeof.js\n// module id = 39\n// module chunks = 0 1 2 3 4 5","var ctx         = require('./_ctx')\n  , call        = require('./_iter-call')\n  , isArrayIter = require('./_is-array-iter')\n  , anObject    = require('./_an-object')\n  , toLength    = require('./_to-length')\n  , getIterFn   = require('./core.get-iterator-method')\n  , BREAK       = {}\n  , RETURN      = {};\nvar exports = module.exports = function(iterable, entries, fn, that, ITERATOR){\n  var iterFn = ITERATOR ? function(){ return iterable; } : getIterFn(iterable)\n    , f      = ctx(fn, that, entries ? 2 : 1)\n    , index  = 0\n    , length, step, iterator, result;\n  if(typeof iterFn != 'function')throw TypeError(iterable + ' is not iterable!');\n  // fast case for arrays with default iterator\n  if(isArrayIter(iterFn))for(length = toLength(iterable.length); length > index; index++){\n    result = entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);\n    if(result === BREAK || result === RETURN)return result;\n  } else for(iterator = iterFn.call(iterable); !(step = iterator.next()).done; ){\n    result = call(iterator, f, step.value, entries);\n    if(result === BREAK || result === RETURN)return result;\n  }\n};\nexports.BREAK  = BREAK;\nexports.RETURN = RETURN;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_for-of.js\n// module id = 40\n// module chunks = 0 1 2 3 4 5 6","\"use strict\";\n\nexports.__esModule = true;\n\nvar _isIterable2 = require(\"../core-js/is-iterable\");\n\nvar _isIterable3 = _interopRequireDefault(_isIterable2);\n\nvar _getIterator2 = require(\"../core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = (0, _getIterator3.default)(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if ((0, _isIterable3.default)(Object(arr))) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/slicedToArray.js\n// module id = 42\n// module chunks = 0 1 5","// getting tag from 19.1.3.6 Object.prototype.toString()\nvar cof = require('./_cof')\n  , TAG = require('./_wks')('toStringTag')\n  // ES3 wrong here\n  , ARG = cof(function(){ return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function(it, key){\n  try {\n    return it[key];\n  } catch(e){ /* empty */ }\n};\n\nmodule.exports = function(it){\n  var O, T, B;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T\n    // builtinTag case\n    : ARG ? cof(O)\n    // ES3 arguments fallback\n    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_classof.js\n// module id = 43\n// module chunks = 0 1 2 3 4 5 6","var shared = require('./_shared')('keys')\n  , uid    = require('./_uid');\nmodule.exports = function(key){\n  return shared[key] || (shared[key] = uid(key));\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_shared-key.js\n// module id = 44\n// module chunks = 0 1 2 3 4 5 6","// 7.1.4 ToInteger\nvar ceil  = Math.ceil\n  , floor = Math.floor;\nmodule.exports = function(it){\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_to-integer.js\n// module id = 45\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/object/define-property\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/define-property.js\n// module id = 46\n// module chunks = 0 1 2 3 4 5 6","var isObject = require('./_is-object')\n  , document = require('./_global').document\n  // in old IE typeof document.createElement is 'object'\n  , is = isObject(document) && isObject(document.createElement);\nmodule.exports = function(it){\n  return is ? document.createElement(it) : {};\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_dom-create.js\n// module id = 47\n// module chunks = 0 1 2 3 4 5 6","// IE 8- don't enum bug keys\nmodule.exports = (\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\n).split(',');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_enum-bug-keys.js\n// module id = 48\n// module chunks = 0 1 2 3 4 5 6","'use strict';\nvar LIBRARY        = require('./_library')\n  , $export        = require('./_export')\n  , redefine       = require('./_redefine')\n  , hide           = require('./_hide')\n  , has            = require('./_has')\n  , Iterators      = require('./_iterators')\n  , $iterCreate    = require('./_iter-create')\n  , setToStringTag = require('./_set-to-string-tag')\n  , getPrototypeOf = require('./_object-gpo')\n  , ITERATOR       = require('./_wks')('iterator')\n  , BUGGY          = !([].keys && 'next' in [].keys()) // Safari has buggy iterators w/o `next`\n  , FF_ITERATOR    = '@@iterator'\n  , KEYS           = 'keys'\n  , VALUES         = 'values';\n\nvar returnThis = function(){ return this; };\n\nmodule.exports = function(Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED){\n  $iterCreate(Constructor, NAME, next);\n  var getMethod = function(kind){\n    if(!BUGGY && kind in proto)return proto[kind];\n    switch(kind){\n      case KEYS: return function keys(){ return new Constructor(this, kind); };\n      case VALUES: return function values(){ return new Constructor(this, kind); };\n    } return function entries(){ return new Constructor(this, kind); };\n  };\n  var TAG        = NAME + ' Iterator'\n    , DEF_VALUES = DEFAULT == VALUES\n    , VALUES_BUG = false\n    , proto      = Base.prototype\n    , $native    = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT]\n    , $default   = $native || getMethod(DEFAULT)\n    , $entries   = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined\n    , $anyNative = NAME == 'Array' ? proto.entries || $native : $native\n    , methods, key, IteratorPrototype;\n  // Fix native\n  if($anyNative){\n    IteratorPrototype = getPrototypeOf($anyNative.call(new Base));\n    if(IteratorPrototype !== Object.prototype){\n      // Set @@toStringTag to native iterators\n      setToStringTag(IteratorPrototype, TAG, true);\n      // fix for some old engines\n      if(!LIBRARY && !has(IteratorPrototype, ITERATOR))hide(IteratorPrototype, ITERATOR, returnThis);\n    }\n  }\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if(DEF_VALUES && $native && $native.name !== VALUES){\n    VALUES_BUG = true;\n    $default = function values(){ return $native.call(this); };\n  }\n  // Define iterator\n  if((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])){\n    hide(proto, ITERATOR, $default);\n  }\n  // Plug for library\n  Iterators[NAME] = $default;\n  Iterators[TAG]  = returnThis;\n  if(DEFAULT){\n    methods = {\n      values:  DEF_VALUES ? $default : getMethod(VALUES),\n      keys:    IS_SET     ? $default : getMethod(KEYS),\n      entries: $entries\n    };\n    if(FORCED)for(key in methods){\n      if(!(key in proto))redefine(proto, key, methods[key]);\n    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);\n  }\n  return methods;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iter-define.js\n// module id = 49\n// module chunks = 0 1 2 3 4 5 6","exports.f = {}.propertyIsEnumerable;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-pie.js\n// module id = 50\n// module chunks = 0 1 2 3 4 5","var global = require('./_global')\n  , SHARED = '__core-js_shared__'\n  , store  = global[SHARED] || (global[SHARED] = {});\nmodule.exports = function(key){\n  return store[key] || (store[key] = {});\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_shared.js\n// module id = 51\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/json/stringify\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/json/stringify.js\n// module id = 52\n// module chunks = 0 1 2 4 6","module.exports = { \"default\": require(\"core-js/library/fn/set\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/set.js\n// module id = 53\n// module chunks = 0 1 2 3 4 5","module.exports = function(it){\n  if(typeof it != 'function')throw TypeError(it + ' is not a function!');\n  return it;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_a-function.js\n// module id = 54\n// module chunks = 0 1 2 3 4 5 6","// 7.1.1 ToPrimitive(input [, PreferredType])\nvar isObject = require('./_is-object');\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function(it, S){\n  if(!isObject(it))return it;\n  var fn, val;\n  if(S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;\n  if(typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it)))return val;\n  if(!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_to-primitive.js\n// module id = 55\n// module chunks = 0 1 2 3 4 5 6","module.exports = function(it, Constructor, name, forbiddenField){\n  if(!(it instanceof Constructor) || (forbiddenField !== undefined && forbiddenField in it)){\n    throw TypeError(name + ': incorrect invocation!');\n  } return it;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_an-instance.js\n// module id = 56\n// module chunks = 0 1 2 3 4 5 6","// most Object methods by ES6 should accept primitives\nvar $export = require('./_export')\n  , core    = require('./_core')\n  , fails   = require('./_fails');\nmodule.exports = function(KEY, exec){\n  var fn  = (core.Object || {})[KEY] || Object[KEY]\n    , exp = {};\n  exp[KEY] = exec(fn);\n  $export($export.S + $export.F * fails(function(){ fn(1); }), 'Object', exp);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-sap.js\n// module id = 57\n// module chunks = 0 1 2 3 4 5","var hide = require('./_hide');\nmodule.exports = function(target, src, safe){\n  for(var key in src){\n    if(safe && target[key])target[key] = src[key];\n    else hide(target, key, src[key]);\n  } return target;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_redefine-all.js\n// module id = 58\n// module chunks = 0 1 2 3 4 5 6","var META     = require('./_uid')('meta')\n  , isObject = require('./_is-object')\n  , has      = require('./_has')\n  , setDesc  = require('./_object-dp').f\n  , id       = 0;\nvar isExtensible = Object.isExtensible || function(){\n  return true;\n};\nvar FREEZE = !require('./_fails')(function(){\n  return isExtensible(Object.preventExtensions({}));\n});\nvar setMeta = function(it){\n  setDesc(it, META, {value: {\n    i: 'O' + ++id, // object ID\n    w: {}          // weak collections IDs\n  }});\n};\nvar fastKey = function(it, create){\n  // return primitive with prefix\n  if(!isObject(it))return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;\n  if(!has(it, META)){\n    // can't set metadata to uncaught frozen object\n    if(!isExtensible(it))return 'F';\n    // not necessary to add metadata\n    if(!create)return 'E';\n    // add missing metadata\n    setMeta(it);\n  // return object ID\n  } return it[META].i;\n};\nvar getWeak = function(it, create){\n  if(!has(it, META)){\n    // can't set metadata to uncaught frozen object\n    if(!isExtensible(it))return true;\n    // not necessary to add metadata\n    if(!create)return false;\n    // add missing metadata\n    setMeta(it);\n  // return hash weak collections IDs\n  } return it[META].w;\n};\n// add metadata on freeze-family methods calling\nvar onFreeze = function(it){\n  if(FREEZE && meta.NEED && isExtensible(it) && !has(it, META))setMeta(it);\n  return it;\n};\nvar meta = module.exports = {\n  KEY:      META,\n  NEED:     false,\n  fastKey:  fastKey,\n  getWeak:  getWeak,\n  onFreeze: onFreeze\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_meta.js\n// module id = 59\n// module chunks = 0 1 2 3 4 5","var pIE            = require('./_object-pie')\n  , createDesc     = require('./_property-desc')\n  , toIObject      = require('./_to-iobject')\n  , toPrimitive    = require('./_to-primitive')\n  , has            = require('./_has')\n  , IE8_DOM_DEFINE = require('./_ie8-dom-define')\n  , gOPD           = Object.getOwnPropertyDescriptor;\n\nexports.f = require('./_descriptors') ? gOPD : function getOwnPropertyDescriptor(O, P){\n  O = toIObject(O);\n  P = toPrimitive(P, true);\n  if(IE8_DOM_DEFINE)try {\n    return gOPD(O, P);\n  } catch(e){ /* empty */ }\n  if(has(O, P))return createDesc(!pIE.f.call(O, P), O[P]);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-gopd.js\n// module id = 60\n// module chunks = 0 1 2 3 4 5","var global         = require('./_global')\n  , core           = require('./_core')\n  , LIBRARY        = require('./_library')\n  , wksExt         = require('./_wks-ext')\n  , defineProperty = require('./_object-dp').f;\nmodule.exports = function(name){\n  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});\n  if(name.charAt(0) != '_' && !(name in $Symbol))defineProperty($Symbol, name, {value: wksExt.f(name)});\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_wks-define.js\n// module id = 61\n// module chunks = 0 1 2 3 4 5","exports.f = require('./_wks');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_wks-ext.js\n// module id = 62\n// module chunks = 0 1 2 3 4 5","var classof   = require('./_classof')\n  , ITERATOR  = require('./_wks')('iterator')\n  , Iterators = require('./_iterators');\nmodule.exports = require('./_core').getIteratorMethod = function(it){\n  if(it != undefined)return it[ITERATOR]\n    || it['@@iterator']\n    || Iterators[classof(it)];\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/core.get-iterator-method.js\n// module id = 63\n// module chunks = 0 1 2 3 4 5 6","// fallback for non-array-like ES3 and non-enumerable old V8 strings\nvar cof = require('./_cof');\nmodule.exports = Object('z').propertyIsEnumerable(0) ? Object : function(it){\n  return cof(it) == 'String' ? it.split('') : Object(it);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iobject.js\n// module id = 64\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/object/create\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/create.js\n// module id = 65\n// module chunks = 0 1 2 3 4 5","module.exports = { \"default\": require(\"core-js/library/fn/object/keys\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/keys.js\n// module id = 66\n// module chunks = 0 1 2 3 4","\"use strict\";\n\nexports.__esModule = true;\n\nvar _getPrototypeOf = require(\"../core-js/object/get-prototype-of\");\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _getOwnPropertyDescriptor = require(\"../core-js/object/get-own-property-descriptor\");\n\nvar _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = (0, _getOwnPropertyDescriptor2.default)(object, property);\n\n  if (desc === undefined) {\n    var parent = (0, _getPrototypeOf2.default)(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/get.js\n// module id = 67\n// module chunks = 0 1 2 3 4 5","module.exports = require('./_global').document && document.documentElement;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_html.js\n// module id = 68\n// module chunks = 0 1 2 3 4 5 6","module.exports = !require('./_descriptors') && !require('./_fails')(function(){\n  return Object.defineProperty(require('./_dom-create')('div'), 'a', {get: function(){ return 7; }}).a != 7;\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_ie8-dom-define.js\n// module id = 69\n// module chunks = 0 1 2 3 4 5 6","// check on default Array iterator\nvar Iterators  = require('./_iterators')\n  , ITERATOR   = require('./_wks')('iterator')\n  , ArrayProto = Array.prototype;\n\nmodule.exports = function(it){\n  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_is-array-iter.js\n// module id = 70\n// module chunks = 0 1 2 3 4 5 6","// call something on iterator step with safe closing on error\nvar anObject = require('./_an-object');\nmodule.exports = function(iterator, fn, value, entries){\n  try {\n    return entries ? fn(anObject(value)[0], value[1]) : fn(value);\n  // 7.4.6 IteratorClose(iterator, completion)\n  } catch(e){\n    var ret = iterator['return'];\n    if(ret !== undefined)anObject(ret.call(iterator));\n    throw e;\n  }\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iter-call.js\n// module id = 71\n// module chunks = 0 1 2 3 4 5 6","module.exports = function(done, value){\n  return {value: value, done: !!done};\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iter-step.js\n// module id = 72\n// module chunks = 0 1 2 3 4 5 6","exports.f = Object.getOwnPropertySymbols;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-gops.js\n// module id = 73\n// module chunks = 0 1 2 3 4 5","// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)\nvar has         = require('./_has')\n  , toObject    = require('./_to-object')\n  , IE_PROTO    = require('./_shared-key')('IE_PROTO')\n  , ObjectProto = Object.prototype;\n\nmodule.exports = Object.getPrototypeOf || function(O){\n  O = toObject(O);\n  if(has(O, IE_PROTO))return O[IE_PROTO];\n  if(typeof O.constructor == 'function' && O instanceof O.constructor){\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectProto : null;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-gpo.js\n// module id = 74\n// module chunks = 0 1 2 3 4 5 6","var has          = require('./_has')\n  , toIObject    = require('./_to-iobject')\n  , arrayIndexOf = require('./_array-includes')(false)\n  , IE_PROTO     = require('./_shared-key')('IE_PROTO');\n\nmodule.exports = function(object, names){\n  var O      = toIObject(object)\n    , i      = 0\n    , result = []\n    , key;\n  for(key in O)if(key != IE_PROTO)has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while(names.length > i)if(has(O, key = names[i++])){\n    ~arrayIndexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-keys-internal.js\n// module id = 75\n// module chunks = 0 1 2 3 4 5 6","module.exports = require('./_hide');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_redefine.js\n// module id = 76\n// module chunks = 0 1 2 3 4 5 6","'use strict'\n\nimport AdapterJS from 'exports-loader?AdapterJS!adapterjs'\nexport {AdapterJS}\n\nimport log from 'common/log'\nimport {diff, find, isFirefox, noVendor} from 'common/utils'\n\n/**\n * @typedef {'signaling'|'connecting'|'connected'|'reconnecting'|'closed'} PeerConnectionState\n *\n * A string representing the connection state of a peer connection.\n *\n * - `'signaling'` - The connection is in the signaling state, e.i. waiting for offer or answer.\n * - `'connecting'` - The signaling has been completed and the connection is being set up.\n * - `'connected'` - Connected to the peer.\n * - `'reconnecting'` - The connection has been temporarily lost but might recover.\n * - `'closed'` - The container of the connection has been closed, i.e. the conference, call, etc.\n */\n\nexport const isWebRtcPlugin = window.webrtcDetectedType === 'plugin'\n\nexport const MediaStream = noVendor(window, 'MediaStream')\nexport const AudioContext = noVendor(window, 'AudioContext')\n\nexport function isMediaStream(stream) {\n  if (!stream) {\n    return false\n  }\n  if (MediaStream) {\n    return stream instanceof MediaStream\n  } else {\n    return stream.id && stream.addTrack && stream.getTracks\n  }\n}\n\n/**\n * A function that returns a promise that is resolved once WebRTC is ready to be used on the page.\n * The promise is always resolved to the first argument passed to the function, so it can\n * be transparently added to a promise `.then()` chain.\n *\n * It is only necessary to wait when using a browser plugin to enable WebRTC,\n * but it is good practice to call this function and make sure the promise is\n * resolved before doing anything WebRTC related, including creating media sources.\n *\n * @example\n * login()\n *   .then(cct.webRtcReady)\n *   .then(setupCall)\n *\n * @function cct.webRtcReady\n * @param {*} [ret] - The value that should be returned.\n * @returns {Promise} A promise that is resolved to the value of the\n *     ret argument once WebRTC is ready.\n */\nexport function webRtcReady(ret) {\n  return new Promise(function (resolve) {\n    if (AdapterJS) {\n      AdapterJS.webRTCReady(function () {\n        resolve(ret)\n      })\n    } else {\n      resolve(ret)\n    }\n  })\n}\n\nexport function addPeerConnectionStream(peerConnection, stream) {\n  if (isFirefox) {\n    let removeSet = peerConnection._streamsPendingRemoval\n    if (removeSet && removeSet.has(stream)) {\n      removeSet.delete(stream)\n    }\n  }\n  peerConnection.addStream(stream)\n}\n\nconst ALLOWED_REMOVE_STATES = ['stable', 'closed']\n\nfunction waitForStableState(peerConnection, callback) {\n  function onState() {\n    let state = peerConnection.signalingState\n    if (ALLOWED_REMOVE_STATES.indexOf(state) !== -1) {\n      peerConnection.removeEventListener('signalingstate', onState)\n      callback()\n    }\n  }\n  peerConnection.addEventListener('signalingstate', onState)\n}\n\nfunction removeAllTracks(peerConnection, tracks) {\n  tracks.forEach(track => {\n    let sender = find(peerConnection.getSenders(), sender => sender.track === track)\n    if (sender) {\n      peerConnection.removeTrack(sender)\n    } else {\n      log.debug('webrtc-utils', `Failed to remove track '${track}' form peer connection, no sender found.`)\n    }\n  })\n}\n\nexport function removePeerConnectionStream(peerConnection, stream) {\n  let state = peerConnection.signalingState\n  if (isFirefox && ALLOWED_REMOVE_STATES.indexOf(state) === -1) {\n    log.info('webrtc-utils', \"delaying removeTrack since we're not in a stable state\")\n    let removeSet = peerConnection._streamsPendingRemoval\n    if (!removeSet) {\n      removeSet = new Set()\n      peerConnection._streamsPendingRemoval = removeSet\n      waitForStableState(peerConnection, () => {\n        let removeSet = peerConnection._streamsPendingRemoval\n        log.info('webrtc-utils', `stable state reached, removing streams: ${removeSet}`)\n        removeSet.forEach(stream => removePeerConnectionStream(peerConnection, stream))\n      })\n    }\n    removeSet.add(stream)\n    return\n  }\n  if (peerConnection.removeStream) {\n    try {\n      peerConnection.removeStream(stream)\n    } catch (error) {\n      if (error.name === 'NotSupportedError') { // Workaround for FireFox\n        removeAllTracks(peerConnection, stream.getTracks())\n      } else {\n        throw error\n      }\n    }\n  } else {\n    removeAllTracks(peerConnection, stream.getTracks())\n  }\n}\n\nexport function BinaryTree(nodes) {\n  this.nodes = nodes || []\n}\n\nBinaryTree.prototype = {\n  constructor: BinaryTree,\n  tag: 'binary-tree',\n  toString: function () {\n    return 'binaryTree{nodes=' + this.nodes + '}'\n  },\n\n  root: function () {\n    return this.nodes[0]\n  },\n  parent: function (child) {\n    var childIndex = this.nodes.indexOf(child)\n    var parentIndex = (Math.floor((childIndex - 1) / 2))\n    return this.nodes[parentIndex]\n  },\n  left: function (parent) {\n    var parentIndex = this.nodes.indexOf(parent)\n    var childIndex = 2 * parentIndex + 1\n    return this.nodes[childIndex]\n  },\n  right: function (parent) {\n    var parentIndex = this.nodes.indexOf(parent)\n    var childIndex = 2 * parentIndex + 2\n    return this.nodes[childIndex]\n  },\n}\n\nAudioContextUtil.MAX_REFERENCES = 32\n\nfunction AudioContextUtil() {\n  this._references = 0\n  this._context = null\n}\n\nAudioContextUtil.prototype = {\n  constructor: AudioContextUtil,\n  tag: 'audio-context-util',\n  toString: function () {\n    return 'audio-context-util{references=' + this._references + ', context=' + this._context + '}'\n  },\n  get: function () {\n    this._references += 1\n    if (this._references > AudioContextUtil.MAX_REFERENCES) {\n      log.warning(this.tag, 'Too many audioContext references, possible leak.')\n    }\n    if (!this._context) {\n      this._context = new AudioContext()\n    }\n    return this._context\n  },\n  release: function () {\n    if (this._references === 0) {\n      log.error(this.tag, 'audioContext was dereferenced too many times.')\n      return\n    } else if (this._references === 1) {\n      this._context.close()\n      this._context = null\n    }\n    this._references -= 1\n  },\n}\n\nexport var audioContextUtil = new AudioContextUtil()\n\nexport function getMediaStreamId(stream) {\n  if (stream._blobId && stream._blobId.indexOf('MediaStream_') === 0) { // Only present in Cordova MediaStreams\n    // MediaStreams in Cordova have a weird id where the first half is the same for\n    // remote streams, while the second half is unique.\n    // An example ID is '0E6CFB41-27A7-4028-9E06-02206E3C5118-6A849356-4C8F-4D93-A438-8329888D0E03'\n    // Where '0E6CFB41-27A7-4028-9E06-02206E3C5118' is the bit we want to use\n    // We've seen other formats as well though, like base64-uuid, as opposed to the above uuid-uuid\n    // To protect agains changes to the Cordova plugin we handle a few different cases below\n    let fullId = stream.id\n    let split = fullId.split('-')\n    if (split.length === 2) {\n      return split[0]\n    } else if (split.length === 6) {\n      return split[0]\n    } else if (split.length === 10) {\n      return split.slice(0, 5).join('-')\n    } else {\n      log.warning('media-stream–id', `unexpected cordova media stream id: ${stream.id}`)\n      return stream.id\n    }\n  } else {\n    return stream.id\n  }\n}\n\nfunction collectStreams(streams, stream) {\n  let id = getMediaStreamId(stream)\n  streams[id] = stream\n  return streams\n}\n\nexport function streamDiff(streams1, streams2) {\n  let streamMap1 = [...streams1].reduce(collectStreams, {})\n  let streamMap2 = [...streams2].reduce(collectStreams, {})\n  let streamIds1 = Object.keys(streamMap1)\n  let streamIds2 = Object.keys(streamMap2)\n  let [addedIds, removedIds] = diff(streamIds1, streamIds2)\n  let addedStreams = addedIds.map(id => streamMap2[id])\n  let removedStreams = removedIds.map(id => streamMap1[id])\n  return [addedStreams, removedStreams]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/utils.js","var ITERATOR     = require('./_wks')('iterator')\n  , SAFE_CLOSING = false;\n\ntry {\n  var riter = [7][ITERATOR]();\n  riter['return'] = function(){ SAFE_CLOSING = true; };\n  Array.from(riter, function(){ throw 2; });\n} catch(e){ /* empty */ }\n\nmodule.exports = function(exec, skipClosing){\n  if(!skipClosing && !SAFE_CLOSING)return false;\n  var safe = false;\n  try {\n    var arr  = [7]\n      , iter = arr[ITERATOR]();\n    iter.next = function(){ return {done: safe = true}; };\n    arr[ITERATOR] = function(){ return iter; };\n    exec(arr);\n  } catch(e){ /* empty */ }\n  return safe;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iter-detect.js\n// module id = 78\n// module chunks = 0 1 2 3 4 5 6","'use strict';\nvar global      = require('./_global')\n  , core        = require('./_core')\n  , dP          = require('./_object-dp')\n  , DESCRIPTORS = require('./_descriptors')\n  , SPECIES     = require('./_wks')('species');\n\nmodule.exports = function(KEY){\n  var C = typeof core[KEY] == 'function' ? core[KEY] : global[KEY];\n  if(DESCRIPTORS && C && !C[SPECIES])dP.f(C, SPECIES, {\n    configurable: true,\n    get: function(){ return this; }\n  });\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_set-species.js\n// module id = 79\n// module chunks = 0 1 2 3 4 5 6","// 7.2.2 IsArray(argument)\nvar cof = require('./_cof');\nmodule.exports = Array.isArray || function isArray(arg){\n  return cof(arg) == 'Array';\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_is-array.js\n// module id = 80\n// module chunks = 0 1 2 3 4 5","// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)\nvar $keys      = require('./_object-keys-internal')\n  , hiddenKeys = require('./_enum-bug-keys').concat('length', 'prototype');\n\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O){\n  return $keys(O, hiddenKeys);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-gopn.js\n// module id = 81\n// module chunks = 0 1 2 3 4 5","var ctx                = require('./_ctx')\n  , invoke             = require('./_invoke')\n  , html               = require('./_html')\n  , cel                = require('./_dom-create')\n  , global             = require('./_global')\n  , process            = global.process\n  , setTask            = global.setImmediate\n  , clearTask          = global.clearImmediate\n  , MessageChannel     = global.MessageChannel\n  , counter            = 0\n  , queue              = {}\n  , ONREADYSTATECHANGE = 'onreadystatechange'\n  , defer, channel, port;\nvar run = function(){\n  var id = +this;\n  if(queue.hasOwnProperty(id)){\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\nvar listener = function(event){\n  run.call(event.data);\n};\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif(!setTask || !clearTask){\n  setTask = function setImmediate(fn){\n    var args = [], i = 1;\n    while(arguments.length > i)args.push(arguments[i++]);\n    queue[++counter] = function(){\n      invoke(typeof fn == 'function' ? fn : Function(fn), args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clearTask = function clearImmediate(id){\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if(require('./_cof')(process) == 'process'){\n    defer = function(id){\n      process.nextTick(ctx(run, id, 1));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  } else if(MessageChannel){\n    channel = new MessageChannel;\n    port    = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = ctx(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if(global.addEventListener && typeof postMessage == 'function' && !global.importScripts){\n    defer = function(id){\n      global.postMessage(id + '', '*');\n    };\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if(ONREADYSTATECHANGE in cel('script')){\n    defer = function(id){\n      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function(){\n        html.removeChild(this);\n        run.call(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function(id){\n      setTimeout(ctx(run, id, 1), 0);\n    };\n  }\n}\nmodule.exports = {\n  set:   setTask,\n  clear: clearTask\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_task.js\n// module id = 82\n// module chunks = 0 1 2 3 4 6","module.exports = { \"default\": require(\"core-js/library/fn/array/from\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/array/from.js\n// module id = 83\n// module chunks = 0 1 2 3 4 5","'use strict';\nvar dP          = require('./_object-dp').f\n  , create      = require('./_object-create')\n  , redefineAll = require('./_redefine-all')\n  , ctx         = require('./_ctx')\n  , anInstance  = require('./_an-instance')\n  , defined     = require('./_defined')\n  , forOf       = require('./_for-of')\n  , $iterDefine = require('./_iter-define')\n  , step        = require('./_iter-step')\n  , setSpecies  = require('./_set-species')\n  , DESCRIPTORS = require('./_descriptors')\n  , fastKey     = require('./_meta').fastKey\n  , SIZE        = DESCRIPTORS ? '_s' : 'size';\n\nvar getEntry = function(that, key){\n  // fast case\n  var index = fastKey(key), entry;\n  if(index !== 'F')return that._i[index];\n  // frozen object case\n  for(entry = that._f; entry; entry = entry.n){\n    if(entry.k == key)return entry;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){\n    var C = wrapper(function(that, iterable){\n      anInstance(that, C, NAME, '_i');\n      that._i = create(null); // index\n      that._f = undefined;    // first entry\n      that._l = undefined;    // last entry\n      that[SIZE] = 0;         // size\n      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.1.3.1 Map.prototype.clear()\n      // 23.2.3.2 Set.prototype.clear()\n      clear: function clear(){\n        for(var that = this, data = that._i, entry = that._f; entry; entry = entry.n){\n          entry.r = true;\n          if(entry.p)entry.p = entry.p.n = undefined;\n          delete data[entry.i];\n        }\n        that._f = that._l = undefined;\n        that[SIZE] = 0;\n      },\n      // 23.1.3.3 Map.prototype.delete(key)\n      // 23.2.3.4 Set.prototype.delete(value)\n      'delete': function(key){\n        var that  = this\n          , entry = getEntry(that, key);\n        if(entry){\n          var next = entry.n\n            , prev = entry.p;\n          delete that._i[entry.i];\n          entry.r = true;\n          if(prev)prev.n = next;\n          if(next)next.p = prev;\n          if(that._f == entry)that._f = next;\n          if(that._l == entry)that._l = prev;\n          that[SIZE]--;\n        } return !!entry;\n      },\n      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)\n      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)\n      forEach: function forEach(callbackfn /*, that = undefined */){\n        anInstance(this, C, 'forEach');\n        var f = ctx(callbackfn, arguments.length > 1 ? arguments[1] : undefined, 3)\n          , entry;\n        while(entry = entry ? entry.n : this._f){\n          f(entry.v, entry.k, this);\n          // revert to the last existing entry\n          while(entry && entry.r)entry = entry.p;\n        }\n      },\n      // 23.1.3.7 Map.prototype.has(key)\n      // 23.2.3.7 Set.prototype.has(value)\n      has: function has(key){\n        return !!getEntry(this, key);\n      }\n    });\n    if(DESCRIPTORS)dP(C.prototype, 'size', {\n      get: function(){\n        return defined(this[SIZE]);\n      }\n    });\n    return C;\n  },\n  def: function(that, key, value){\n    var entry = getEntry(that, key)\n      , prev, index;\n    // change existing entry\n    if(entry){\n      entry.v = value;\n    // create new entry\n    } else {\n      that._l = entry = {\n        i: index = fastKey(key, true), // <- index\n        k: key,                        // <- key\n        v: value,                      // <- value\n        p: prev = that._l,             // <- previous entry\n        n: undefined,                  // <- next entry\n        r: false                       // <- removed\n      };\n      if(!that._f)that._f = entry;\n      if(prev)prev.n = entry;\n      that[SIZE]++;\n      // add to index\n      if(index !== 'F')that._i[index] = entry;\n    } return that;\n  },\n  getEntry: getEntry,\n  setStrong: function(C, NAME, IS_MAP){\n    // add .keys, .values, .entries, [@@iterator]\n    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11\n    $iterDefine(C, NAME, function(iterated, kind){\n      this._t = iterated;  // target\n      this._k = kind;      // kind\n      this._l = undefined; // previous\n    }, function(){\n      var that  = this\n        , kind  = that._k\n        , entry = that._l;\n      // revert to the last existing entry\n      while(entry && entry.r)entry = entry.p;\n      // get next entry\n      if(!that._t || !(that._l = entry = entry ? entry.n : that._t._f)){\n        // or finish the iteration\n        that._t = undefined;\n        return step(1);\n      }\n      // return step by kind\n      if(kind == 'keys'  )return step(0, entry.k);\n      if(kind == 'values')return step(0, entry.v);\n      return step(0, [entry.k, entry.v]);\n    }, IS_MAP ? 'entries' : 'values' , !IS_MAP, true);\n\n    // add [@@species], 23.1.2.2, 23.2.2.2\n    setSpecies(NAME);\n  }\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_collection-strong.js\n// module id = 84\n// module chunks = 0 1 2 3 4 5","// https://github.com/DavidBruant/Map-Set.prototype.toJSON\nvar classof = require('./_classof')\n  , from    = require('./_array-from-iterable');\nmodule.exports = function(NAME){\n  return function toJSON(){\n    if(classof(this) != NAME)throw TypeError(NAME + \"#toJSON isn't generic\");\n    return from(this);\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_collection-to-json.js\n// module id = 85\n// module chunks = 0 1 2 3 4 5","'use strict';\nvar global         = require('./_global')\n  , $export        = require('./_export')\n  , meta           = require('./_meta')\n  , fails          = require('./_fails')\n  , hide           = require('./_hide')\n  , redefineAll    = require('./_redefine-all')\n  , forOf          = require('./_for-of')\n  , anInstance     = require('./_an-instance')\n  , isObject       = require('./_is-object')\n  , setToStringTag = require('./_set-to-string-tag')\n  , dP             = require('./_object-dp').f\n  , each           = require('./_array-methods')(0)\n  , DESCRIPTORS    = require('./_descriptors');\n\nmodule.exports = function(NAME, wrapper, methods, common, IS_MAP, IS_WEAK){\n  var Base  = global[NAME]\n    , C     = Base\n    , ADDER = IS_MAP ? 'set' : 'add'\n    , proto = C && C.prototype\n    , O     = {};\n  if(!DESCRIPTORS || typeof C != 'function' || !(IS_WEAK || proto.forEach && !fails(function(){\n    new C().entries().next();\n  }))){\n    // create collection constructor\n    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);\n    redefineAll(C.prototype, methods);\n    meta.NEED = true;\n  } else {\n    C = wrapper(function(target, iterable){\n      anInstance(target, C, NAME, '_c');\n      target._c = new Base;\n      if(iterable != undefined)forOf(iterable, IS_MAP, target[ADDER], target);\n    });\n    each('add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON'.split(','),function(KEY){\n      var IS_ADDER = KEY == 'add' || KEY == 'set';\n      if(KEY in proto && !(IS_WEAK && KEY == 'clear'))hide(C.prototype, KEY, function(a, b){\n        anInstance(this, C, KEY);\n        if(!IS_ADDER && IS_WEAK && !isObject(a))return KEY == 'get' ? undefined : false;\n        var result = this._c[KEY](a === 0 ? 0 : a, b);\n        return IS_ADDER ? this : result;\n      });\n    });\n    if('size' in proto)dP(C.prototype, 'size', {\n      get: function(){\n        return this._c.size;\n      }\n    });\n  }\n\n  setToStringTag(C, NAME);\n\n  O[NAME] = C;\n  $export($export.G + $export.W + $export.F, O);\n\n  if(!IS_WEAK)common.setStrong(C, NAME, IS_MAP);\n\n  return C;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_collection.js\n// module id = 86\n// module chunks = 0 1 2 3 4 5","\"use strict\";\n\nexports.__esModule = true;\n\nvar _defineProperty = require(\"../core-js/object/define-property\");\n\nvar _defineProperty2 = _interopRequireDefault(_defineProperty);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (obj, key, value) {\n  if (key in obj) {\n    (0, _defineProperty2.default)(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/defineProperty.js\n// module id = 87\n// module chunks = 0 1 2 3 4","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {ReadOnlyMap} from 'common/utils'\n\nimport MediaNodeInput from 'media/mediaNodeInput'\nimport MediaNodeOutput from 'media/mediaNodeOutput'\nimport {mediaNodeSpecies, inputs, outputs} from 'media/common'\n\nconst TAG = 'media-node'\n\n/**\n * @typedef {MediaNodeOutput|Object} MediaNodeConnectSource\n *\n * A set of types that a can connect to {@link MediaNode}s or {@link MediaNodeInput}s.\n *\n * The types are the same as the ones that can be passed to {@link MediaNodeOutput#resolve}.\n */\n\n/**\n * @typedef {MediaNodeInput|external:HTMLMediaElement|Object} MediaNodeConnectTarget\n *\n * A set of types that a {@link MediaNode} or {@link MediaNodeOutput} can be connected to.\n *\n * The types are the same as the ones that can be passed to {@link MediaNodeInput#resolve},\n * with the addition of {@link external:HTMLMediaElement}.\n *\n * If an HTML element is passed when connecting, an {@link HtmlSink} will be created and used\n * as the target. When disconnecting, all targets that are {@link HtmlSink}s which are rendering\n * to the given HTML element will be disconnected. This way the same HTML element can be passed\n * to connect and disconnect without any hassle.\n */\n\n/**\n * A base class that all pure media nodes inherit from.\n *\n * Classes inheriting from {@link MediaNode} are plain nodes with input and output ports directly attached.\n *\n * A media node has zero or more input and output ports, which can be connected to other nodes.\n * Media nodes are always connected from one output port to one input port, using the connect\n * method of either the output port or the media node.\n *\n * When using the connect method of a media node, the output port to be used is resolved by\n * recursively looking up the output property of the media node. The same method is used when\n * a media node is used as the target for a connection, but in that case an input port is looked\n * up via the input property.\n *\n * Because the input and output property lookups are recursive, it is easy to create simple container\n * nodes that have a number of internal media nodes, and then expose input and output ports as\n * properties.\n *\n * As an example, we might have `cameraSource` and `blurFilter`, which both inherit from\n * {@link MediaNode}. The source has one output port, while the filter has one input and one ouput.\n * We can connect these two together using `cameraSource.output.connect(blurFilter.input)`. This is\n * a bit verbose, but because the connect method will look up the input and output properties, we\n * can just use `cameraSource.connect(blurFilter)` instead. The connect method is made available\n * to the camera source class using {@link MediaSource.connectMixin}.\n *\n * Let's say we now want to create a `BlurredCameraSource` class, which reuses the nodes from the\n * above example. The ES6 class declaration would be\n * `class BlurredCameraSource extends MediaSource.connectMixin()`. The mixin adds the connect and\n * disconnect methods for convenience. In the constructor, we can now create our camera source and\n * blur filter, connect them together, and simply expose the ouput property of the `blurFilter`\n * using `this.output = blurFilter.output`. Since the output lookup is recursive, we can call the\n * connect method of our `blurredCameraSource` directly, but the output port of the blurFilter will\n * in the end be what is actually connected.\n *\n * @class MediaNode\n */\nexport default class MediaNode {\n  constructor() {\n    this[inputs] = new Set()\n    this[outputs] = new Set()\n  }\n\n  toString() {\n    let name = this.constructor.name\n    let camelName\n    if (!name) {\n      camelName = '_mediaNode'\n    } else {\n      camelName = name[0].toLowerCase() + name.slice(1)\n    }\n\n    return `${camelName}{io=${this[inputs].size}/${this[outputs].size}}`\n  }\n\n  // Public methods\n\n  /**\n   * Connect two media nodes or ports together. Both the input and the output will be resolved\n   * using the respective resolve methods.\n   *\n   * Usually adding the {@link MediaNode.connectMixin} to the source class is more convenient and clearer than using\n   * these methods.\n   *\n   * @example <caption>Connecting a DeviceSource to a MuteFilter.</caption>\n   * // Passing in MediaNodes\n   * MediaNode.connect(deviceSource, muteFilter)\n   *\n   * // Explicitly passing in inputs and outputs, will result in the same connection as above.\n   * MediaNode.connect(deviceSource.output, muteFilter.input)\n   *\n   * @param  {MediaNodeConnectSource} output - The source ouput or node.\n   * @param  {MediaNodeConnectTarget} input - The target input, node, or element.\n   */\n  static connect(output, input) {\n    argCheck.object(`${output.constructor.name}.connect`, 'output', output)\n    if (!(input instanceof HTMLElement)) {\n      argCheck.object(`${output.constructor.name}.connect`, 'input', input)\n    }\n    output = MediaNodeOutput.resolve(output)\n    output.connect(input)\n  }\n\n  /**\n   * Disconnect two media nodes or ports. Both the input and the output will be resolved\n   * using the respective resolve methods.\n   *\n   * @param  {MediaNodeConnectSource} output - The source ouput or node.\n   * @param  {MediaNodeConnectTarget} input - The target input, node, or element.\n   */\n  static disconnect(output, input) {\n    argCheck.object(`${output.constructor.name}.connect`, 'output', output)\n    if (!(input instanceof HTMLElement)) {\n      argCheck.optObject(`${output.constructor.name}.connect`, 'input', input)\n    }\n    output = MediaNodeOutput.resolve(output)\n    output.disconnect(input)\n  }\n\n  /**\n   * A mixin that adds the connect and disconnect methods from {@link MediaNode} as member methods.\n   *\n   * @mixin ConnectMixin\n   */\n\n  /**\n   * Connect the node to a target. Each output can be connected to multiple targets.\n   *\n   * @function ConnectMixin#connect\n   * @param  {MediaNodeConnectTarget} input - The target input, node, or element.\n   */\n\n  /**\n   * Disconnect the node from a target.\n   *\n   * If no target is specified, all targets will be disconnected.\n   *\n   * @function ConnectMixin#disconnect\n   * @param {MediaNodeConnectTarget} [target] - The target to disconnect from.\n   */\n\n  /**\n   * A mixin that adds the connect and disconnect methods to a class.\n   *\n   * @example <caption>Usage with ES6 classes.</caption>\n   * // Without superclass\n   * class MyClass extends MediaNode.connectMixin() {\n   * }\n   *\n   * // With a superclass\n   * class MyClass extends MediaNode.connectMixin(MySuperClass) {\n   * }\n   *\n   * @param {class} [superclass] - The superclass to extend, if no class is given a class with only the\n   *   mixin applied is returned.\n   * @returns {class} A new class extended with the connect and disconnect methods.\n   */\n  static connectMixin(superclass = () => {}) {\n    return class ConnectableNode extends superclass {\n      connect(target) {\n        MediaNode.connect(this, target)\n      }\n\n      disconnect(target) {\n        MediaNode.disconnect(this, target)\n      }\n    }\n  }\n\n  // Private\n\n  get [mediaNodeSpecies]() {\n    return true\n  }\n}\n\n/**\n * A base class for input and output maps.\n *\n * @class PortMap\n * @abstract\n * @extends ReadOnlyMap\n */\nclass PortMap extends ReadOnlyMap {\n  constructor({parent, portConstructor, onStream, onCreate, onDetach}) {\n    super()\n    argCheck.object(`${this.constructor.name} constructor`, 'parent', parent)\n    argCheck.func(`${this.constructor.name} constructor`, 'portConstructor', portConstructor)\n    this._parent = parent\n    this._portConstructor = portConstructor\n    this._onStream = onStream\n    this._onCreate = onCreate\n    this._onDetach = onDetach\n  }\n\n  /**\n   * Gets the input for the given key. If the input doesn't exist, it is created.\n   *\n   * @param {string} key - The name of the port.\n   * @returns {MediaNodeInput|MediaNodeOutput} An existing or newly created port.\n   */\n  get(key) {\n    argCheck.string(`${this.constructor.name}.get`, 'key', key)\n    let port = super.get(key)\n    if (!port) {\n      try {\n        let options = {\n          name: key,\n          parent: this._parent,\n        }\n        if (this._onStream) {\n          options.onStream = (stream, oldStream) => this._onStream(key, stream, oldStream)\n        }\n        port = new this._portConstructor(options)\n      } catch (constructorError) {\n        let error = new Error(`Error thrown in ${this._portConstructor.name} constructor, ${constructorError}`)\n        error.reason = constructorError\n        throw error\n      }\n      super._set(key, port)\n      if (this._onCreate) {\n        try {\n          this._onCreate(port)\n        } catch (error) {\n          log.error(TAG, `Error thrown in ${this.constructor.name}.onCreate: ${error}`)\n        }\n      }\n    }\n    return port\n  }\n\n  /**\n   * Removes and detaches the input or output with the given name.\n   *\n   * @param {string} key - The name of the port.\n   * @returns {boolean} True if the was a port to delete.\n   */\n  delete(key) {\n    argCheck.string(`${this.constructor.name}.delete`, 'key', key)\n    let port = super.get(key)\n    if (port) {\n      super._delete(key)\n      port.detach()\n      if (this._onDetach) {\n        try {\n          this._onDetach(port)\n        } catch (error) {\n          log.error(TAG, `Error thrown in ${this.constructor.name}.onDetach: ${error}`)\n        }\n      }\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Removes and detaches all the ports in the map.\n   */\n  clear() {\n    super.forEach((_, key) => {\n      this.delete(key)\n    })\n  }\n}\n\n/**\n * A callback that is called when the stream of any of the inputs is updated.\n *\n * @callback InputMap~OnStreamCallback\n * @param {string} key - The key for the input port of the updated stream.\n * @param {?MediaStream} stream - The new media stream.\n * @param {?MediaStream} oldStream - The old media stream.\n */\n\n/**\n * A callback for when a new input is created.\n *\n * @callback InputMap~OnCreateCallback\n * @param {MediaNodeInput} input - The input that was created.\n */\n\n/**\n * A callback for when an input is detached.\n *\n * @callback InputMap~OnDetachCallback\n * @param {MediaNodeInput} input - The input that was detached.\n */\n\n/**\n * A map of inputs for a media node. This allows for a node to have multiple named inputs.\n *\n * @class InputMap\n * @extends PortMap\n * @param {Object} options - Options object.\n * @param {MediaNode} options.parent - The parent media node.\n * @param {class} [options.inputConstructor=MediaNodeInput] - The constructor of the inputs in this map.\n *   Must be `MediaNodeInput`, or a subclass.\n * @param {InputMap~OnStreamCallback} onStream - Callback for when any of the inputs streams are updated.\n * @param {InputMap~OnCreateCallback} onCreate - Callback for when a new port is created.\n * @param {InputMap~OnDetachCallback} onDetach - Callback for when a new port is detached and removed.\n */\nexport class InputMap extends PortMap {\n  constructor({inputConstructor = MediaNodeInput, parent, onStream, onCreate, onDetach}) {\n    argCheck.optFunc('InputMap constructor', 'onStream', onStream)\n    if (!onStream) {\n      onStream = (...args) => parent.onStream(...args)\n    }\n    super({portConstructor: inputConstructor, parent, onStream, onCreate, onDetach})\n  }\n}\n\n/**\n * A callback for when a new output is created.\n *\n * @callback OutputMap~OnCreateCallback\n * @param {MediaNodeInput} output - The output that was created.\n */\n\n/**\n * A callback for when an output is detached.\n *\n * @callback OutputMap~OnDetachCallback\n * @param {MediaNodeInput} output - The output that was detached.\n */\n\n/**\n * A map of ouputs for a media node. This allows for a node to have multiple named ouputs.\n *\n * @class OutputMap\n * @extends PortMap\n * @param {Object} options - Options object.\n * @param {MediaNode} options.parent - The parent media node.\n * @param {class} [options.outputConstructor=MediaNodeOutput] - The constructor of the outputs in this map.\n *   Must be `MediaNodeOutput`, or a subclass.\n * @param {OutputMap~OnCreateCallback} onCreate - Callback for when a new port is created.\n * @param {OutputMap~OnDetachCallback} onDetach - Callback for when a new port is detached and removed.\n */\nexport class OutputMap extends PortMap {\n  constructor({outputConstructor = MediaNodeOutput, parent, onCreate, onDetach}) {\n    super({portConstructor: outputConstructor, parent, onCreate, onDetach})\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaNode.js","\"use strict\";\n\nexports.__esModule = true;\n\nvar _from = require(\"../core-js/array/from\");\n\nvar _from2 = _interopRequireDefault(_from);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = function (arr) {\n  return Array.isArray(arr) ? arr : (0, _from2.default)(arr);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/toArray.js\n// module id = 89\n// module chunks = 0 1 2 3 4","var dP       = require('./_object-dp')\n  , anObject = require('./_an-object')\n  , getKeys  = require('./_object-keys');\n\nmodule.exports = require('./_descriptors') ? Object.defineProperties : function defineProperties(O, Properties){\n  anObject(O);\n  var keys   = getKeys(Properties)\n    , length = keys.length\n    , i = 0\n    , P;\n  while(length > i)dP.f(O, P = keys[i++], Properties[P]);\n  return O;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-dps.js\n// module id = 90\n// module chunks = 0 1 2 3 4 5 6","module.exports = { \"default\": require(\"core-js/library/fn/object/get-own-property-descriptor\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/get-own-property-descriptor.js\n// module id = 91\n// module chunks = 0 1 2 3 4 5","module.exports = { \"default\": require(\"core-js/library/fn/symbol\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/symbol.js\n// module id = 92\n// module chunks = 0 1 2 3 4 5","module.exports = { \"default\": require(\"core-js/library/fn/symbol/iterator\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/symbol/iterator.js\n// module id = 93\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.object.define-property');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function defineProperty(it, key, desc){\n  return $Object.defineProperty(it, key, desc);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/define-property.js\n// module id = 94\n// module chunks = 0 1 2 3 4 5 6","module.exports = function(){ /* empty */ };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_add-to-unscopables.js\n// module id = 95\n// module chunks = 0 1 2 3 4 5 6","// false -> Array#indexOf\n// true  -> Array#includes\nvar toIObject = require('./_to-iobject')\n  , toLength  = require('./_to-length')\n  , toIndex   = require('./_to-index');\nmodule.exports = function(IS_INCLUDES){\n  return function($this, el, fromIndex){\n    var O      = toIObject($this)\n      , length = toLength(O.length)\n      , index  = toIndex(fromIndex, length)\n      , value;\n    // Array#includes uses SameValueZero equality algorithm\n    if(IS_INCLUDES && el != el)while(length > index){\n      value = O[index++];\n      if(value != value)return true;\n    // Array#toIndex ignores holes, Array#includes - not\n    } else for(;length > index; index++)if(IS_INCLUDES || index in O){\n      if(O[index] === el)return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_array-includes.js\n// module id = 96\n// module chunks = 0 1 2 3 4 5 6","'use strict';\nvar create         = require('./_object-create')\n  , descriptor     = require('./_property-desc')\n  , setToStringTag = require('./_set-to-string-tag')\n  , IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\nrequire('./_hide')(IteratorPrototype, require('./_wks')('iterator'), function(){ return this; });\n\nmodule.exports = function(Constructor, NAME, next){\n  Constructor.prototype = create(IteratorPrototype, {next: descriptor(1, next)});\n  setToStringTag(Constructor, NAME + ' Iterator');\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_iter-create.js\n// module id = 97\n// module chunks = 0 1 2 3 4 5 6","// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\nvar toIObject = require('./_to-iobject')\n  , gOPN      = require('./_object-gopn').f\n  , toString  = {}.toString;\n\nvar windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames\n  ? Object.getOwnPropertyNames(window) : [];\n\nvar getWindowNames = function(it){\n  try {\n    return gOPN(it);\n  } catch(e){\n    return windowNames.slice();\n  }\n};\n\nmodule.exports.f = function getOwnPropertyNames(it){\n  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-gopn-ext.js\n// module id = 98\n// module chunks = 0 1 2 3 4 5","var toInteger = require('./_to-integer')\n  , defined   = require('./_defined');\n// true  -> String#at\n// false -> String#codePointAt\nmodule.exports = function(TO_STRING){\n  return function(that, pos){\n    var s = String(defined(that))\n      , i = toInteger(pos)\n      , l = s.length\n      , a, b;\n    if(i < 0 || i >= l)return TO_STRING ? '' : undefined;\n    a = s.charCodeAt(i);\n    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n      ? TO_STRING ? s.charAt(i) : a\n      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_string-at.js\n// module id = 99\n// module chunks = 0 1 2 3 4 5 6","var toInteger = require('./_to-integer')\n  , max       = Math.max\n  , min       = Math.min;\nmodule.exports = function(index, length){\n  index = toInteger(index);\n  return index < 0 ? max(index + length, 0) : min(index, length);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_to-index.js\n// module id = 100\n// module chunks = 0 1 2 3 4 5 6","'use strict';\nvar addToUnscopables = require('./_add-to-unscopables')\n  , step             = require('./_iter-step')\n  , Iterators        = require('./_iterators')\n  , toIObject        = require('./_to-iobject');\n\n// 22.1.3.4 Array.prototype.entries()\n// 22.1.3.13 Array.prototype.keys()\n// 22.1.3.29 Array.prototype.values()\n// 22.1.3.30 Array.prototype[@@iterator]()\nmodule.exports = require('./_iter-define')(Array, 'Array', function(iterated, kind){\n  this._t = toIObject(iterated); // target\n  this._i = 0;                   // next index\n  this._k = kind;                // kind\n// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n}, function(){\n  var O     = this._t\n    , kind  = this._k\n    , index = this._i++;\n  if(!O || index >= O.length){\n    this._t = undefined;\n    return step(1);\n  }\n  if(kind == 'keys'  )return step(0, index);\n  if(kind == 'values')return step(0, O[index]);\n  return step(0, [index, O[index]]);\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\nIterators.Arguments = Iterators.Array;\n\naddToUnscopables('keys');\naddToUnscopables('values');\naddToUnscopables('entries');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.array.iterator.js\n// module id = 101\n// module chunks = 0 1 2 3 4 5 6","var $export = require('./_export');\n// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)\n$export($export.S + $export.F * !require('./_descriptors'), 'Object', {defineProperty: require('./_object-dp').f});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.define-property.js\n// module id = 102\n// module chunks = 0 1 2 3 4 5 6","'use strict'\n\nimport AsyncQueue from 'common/queue'\nimport CctError, {NotAllowedError, NotFoundError, UnknownError} from 'common/errors'\n\nimport {isWebRtcPlugin} from 'webrtc/utils'\n\nexport const mediaNodeSpecies = Symbol('media-node')\nexport const inputs = Symbol('inputs')\nexport const outputs = Symbol('outputs')\n\n/**\n * Checks whether a given object is a media node.\n *\n * @param {Object} obj - An object to test.\n * @returns {boolean} True if the object is a media node, false otherwise.\n */\nexport function isMediaNode(obj) {\n  return !!(obj && obj[mediaNodeSpecies])\n}\n\nexport function doesntSupportPlugin(instance) {\n  if (isWebRtcPlugin) {\n    throw new Error(`${instance.constructor.name} is not supported when using a WebRTC plugin`)\n  }\n}\n\n/**\n * The constraints of the performed action could not be satisfied, e.g. the requested\n * video frame rate could not be delivered.\n *\n * @class OverconstrainedError\n * @extends CctError\n */\nexport class OverconstrainedError extends CctError {}\nOverconstrainedError.errorName = 'OverconstrainedError'\n\nconst gumQueue = new AsyncQueue()\n\n// Browsers are inconsistent in what errors are thrown when mic/camera access is denied.\n// PermissionDeniedError is thrown by Chrome and the plugin\n// SecurityError is from Firefox 48\n// NotAllowedError is from Firefox 50 Developer edition and onward\nconst NOT_ALLOWED_ERRORS = ['SecurityError', 'NotAllowedError', 'PermissionDeniedError', 'PermissionDismissedError']\nconst NOT_FOUND_ERRORS = ['NotFoundError', 'DevicesNotFoundError']\nconst OVERCONSTRAINED_ERRORS = ['OverconstrainedError', 'ConstraintNotSatisfiedError']\n\nexport function getUserMedia(constraints) {\n  if (!navigator.getUserMedia) {\n    return Promise.reject(new Error('no getUserMedia found'))\n  }\n\n  return gumQueue.push(() => new Promise((resolve, reject) => {\n    return navigator.getUserMedia(constraints, stream => {\n      if (stream) {\n        resolve(stream)\n      } else {\n        reject(new NotFoundError('Received a null media stream'))\n      }\n    }, gumError => {\n      var error\n      if (NOT_ALLOWED_ERRORS.indexOf(gumError.name) !== -1) {\n        // According to spec, denying the gum request should lead to a NotAllowedError\n        error = new NotAllowedError(gumError.message)\n      } else if (OVERCONSTRAINED_ERRORS.indexOf(gumError.name) !== -1) {\n        // According to spec, constraint errors should lead to an OverconstrainedError\n        let message = gumError.message\n        if (!message) {\n          if (gumError.constraint) {\n            message = `media constraint '${gumError.constraint}' could not be satisfied`\n          } else {\n            message = 'media constraints could not be satisfied'\n          }\n        }\n        error = new OverconstrainedError(message)\n      } else if (NOT_FOUND_ERRORS.indexOf(gumError.name) !== -1) {\n        // According to spec, not found errors should lead to a NotFoundError\n        error = new NotFoundError(gumError.message)\n      } else {\n        error = new UnknownError(gumError.message)\n      }\n      error.reason = gumError\n      reject(error)\n    })\n  }))\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/common.js","'use strict'\n\nimport argCheck from 'common/argCheck'\n\nexport default class Configuration {\n  constructor({ownId} = {}) {\n    this._ownId = argCheck.string(this, 'ownId', ownId)\n    this._members = new Members()\n  }\n\n  toString() {\n    return `config{members=${[...this._members].join(',')}}`\n  }\n\n  get ownId() {\n    return this._ownId\n  }\n\n  get members() {\n    return new Members(this._members)\n  }\n\n  createMembersChange(newMembers) {\n    argCheck.instance('Configuration.createMembersChange', 'newMembers', newMembers, Members)\n    return new ConfigurationData(newMembers)\n  }\n\n  get() {\n    return new ConfigurationData(this._members)\n  }\n\n  set(data) {\n    argCheck.instance('Configuration.set', 'data', data, ConfigurationData)\n    this._members = data.members\n  }\n\n  // for each server, including self\n  forEach(func, thisArg) {\n    this.members.forEach(func, thisArg)\n  }\n\n  // for each peer in the cluster\n  forEachPeer(func, thisArg) {\n    this.members.forEach(peerId => {\n      if (peerId !== this._ownId) {\n        func.call(this.members, peerId)\n      }\n    }, thisArg)\n  }\n\n  hasMajority(grantedVotes) {\n    return this._members.hasMajority(grantedVotes)\n  }\n\n  getMajorityIndex(matchIndices) {\n    return this._members.getMajorityIndex(matchIndices)\n  }\n}\n\nexport class ConfigurationData {\n  static parse(data) {\n    let {members} = argCheck.object(this, 'data', data)\n    return new ConfigurationData(new Members(members))\n  }\n\n  constructor(members) {\n    argCheck.instance(this, 'members', members, Members)\n    this._members = members\n  }\n\n  toString() {\n    return `configData{members=${[...this._members].join(',')}}`\n  }\n\n  toJSON() {\n    // Only polyfilled sets serialize to arrays, so be explicit\n    return {members: [...this._members]}\n  }\n\n  get members() {\n    return this._members\n  }\n\n  includes(id) {\n    if (this._members.has(id)) {\n      return true\n    }\n    return false\n  }\n}\n\nexport class Members extends Set {\n  get majorityCount() {\n    return ((this.size / 2) | 0) + 1\n  }\n\n  get minorityCount() {\n    return ((this.size - 1) / 2) | 0\n  }\n\n  get majorityIndexPosition() {\n    return ((this.size + 1) / 2) | 0\n  }\n\n  voteCount(grantedVotes /* Set */) {\n    let voteCount = 0\n    this.forEach(id => {\n      if (grantedVotes.has(id)) {\n        voteCount += 1\n      }\n    })\n    return voteCount\n  }\n\n  hasMajority(grantedVotes /* Set */) {\n    let voteCount = this.voteCount(grantedVotes)\n    return voteCount >= this.majorityCount\n  }\n\n  // Finds the greatest log index that a majority is guaranteed to have received\n  getMajorityIndex(matchIndices /* {[clientId]: matchIndex} */) {\n    let indices = []\n    this.forEach(id => {\n      if (matchIndices.hasOwnProperty(id)) {\n        indices.push(matchIndices[id])\n      } else {\n        indices.push(0)\n      }\n    })\n    let majorityPosition = this.majorityIndexPosition\n    if (indices.length === 0 || indices.length < majorityPosition) {\n      return 0\n    } else {\n      return indices.sort()[majorityPosition - 1]\n    }\n  }\n}\n\nexport class Votes {\n  constructor(ownId) {\n    this._votes = new Map()\n    if (ownId) {\n      this.set(ownId, true)\n    }\n  }\n\n  toString() {\n    return `votes{${[...this._votes].map(([peerId, granted]) => granted ? `>${peerId}<` : peerId)}}`\n  }\n\n  set(peerId, granted) {\n    return this._votes.set(peerId, granted)\n  }\n\n  has(peerId) {\n    return this._votes.has(peerId)\n  }\n\n  get grantedVotes() {\n    let voters = new Set()\n    this._votes.forEach((granted, peerId) => {\n      if (granted) {\n        voters.add(peerId)\n      }\n    })\n    return voters\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raftConfiguration.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\n\nimport {ConfigurationData} from 'conference/raftConfiguration'\n\nconst TAG = 'raft'\n\nexport default class RaftLogEntry {\n  static parse(json, index) {\n    // configuration entries have 2 elements, op entries have 3\n    if (json.length === 2) {\n      let [term, data] = json\n      return new ConfigurationEntry({term, index, data: ConfigurationData.parse(data)})\n    } else if (json.length === 4) {\n      let [term, id, op, args] = json\n      return new OpEntry({term, index, id, op, args})\n    } else {\n      throw new TypeError(`Failed to parse log entry data, invalid length: ${json.length}`)\n    }\n  }\n\n  constructor({term, index}) {\n    if (this.constructor === RaftLogEntry) {\n      throw new TypeError('RaftLogEntry should not by constructed directly')\n    }\n    this._term = term\n    this._index = index\n  }\n\n  get term() {\n    return this._term\n  }\n\n  get index() {\n    return this._index\n  }\n}\n\nexport class ConfigurationEntry extends RaftLogEntry {\n  constructor({term, index, data}) {\n    super({term, index})\n    argCheck.instance(this, 'data', data, ConfigurationData)\n    this._data = data\n  }\n\n  get data() {\n    return this._data\n  }\n\n  toString() {\n    return `config{t=${this.term},i=${this.index},${this.data}}`\n  }\n\n  toJSON() {\n    return [this.term, this.data]\n  }\n}\n\nexport const OP = {\n  noop: 0,\n  set: 1,\n  append: 2,\n}\n\nconst opNames = {\n  0: 'noop',\n  1: 'set',\n  2: 'append',\n}\n\nexport class OpEntry extends RaftLogEntry {\n  static get idSize() {\n    return 8\n  }\n\n  constructor({term, index, id = 0, op, args = []}) {\n    super({term, index})\n    this._id = id\n    this._op = op\n    this._args = args\n  }\n\n  get id() {\n    return this._id\n  }\n\n  get op() {\n    return this._op\n  }\n\n  get args() {\n    return this._args\n  }\n\n  toString() {\n    let name = opNames[this.op]\n    let args = this.args.join(',')\n    let shortId = this.id ? this.id.slice(0, 4) : '<no>'\n    return `op{id=${shortId},t=${this.term},i=${this.index},${name},[${args}]}`\n  }\n\n  toJSON() {\n    return [this.term, this.id, this.op, this.args]\n  }\n\n  apply(state) {\n    if (this[this.op]) {\n      log.debug(TAG, `applying ${this}`)\n      return this[this.op](state, ...this.args)\n    } else {\n      throw new TypeError(`Failed to apply OpEntry, unknown op code: '${this.op}'`)\n    }\n  }\n\n  // methods for each op to modify state, args are passed in as parameters 2+\n  // If the state is modified it should always be returned, and the other way around.\n\n  [OP.noop](state) {\n  }\n\n  [OP.set](state, key, value) {\n    if (typeof(key) !== 'string') {\n      throw new TypeError('Invalid OpEntry, set key must be a string')\n    }\n    if (typeof(value) === 'undefined') {\n      delete state[key]\n    }\n    state[key] = value\n    return state\n  }\n\n  [OP.append](state, key, value) {\n    if (typeof(key) !== 'string') {\n      throw new TypeError('Invalid OpEntry, append key must be a string')\n    }\n    if (typeof(value) === 'undefined') {\n      return\n    }\n    if (state[key]) {\n      state[key].push(value)\n    } else {\n      state[key] = [value]\n    }\n    return state\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raftLogEntry.js","module.exports = { \"default\": require(\"core-js/library/fn/object/set-prototype-of\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/set-prototype-of.js\n// module id = 106\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.string.iterator');\nrequire('../../modules/es6.array.from');\nmodule.exports = require('../../modules/_core').Array.from;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/array/from.js\n// module id = 107\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.object.create');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function create(P, D){\n  return $Object.create(P, D);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/create.js\n// module id = 108\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.object.get-own-property-descriptor');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function getOwnPropertyDescriptor(it, key){\n  return $Object.getOwnPropertyDescriptor(it, key);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/get-own-property-descriptor.js\n// module id = 109\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.object.get-prototype-of');\nmodule.exports = require('../../modules/_core').Object.getPrototypeOf;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/get-prototype-of.js\n// module id = 110\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.object.set-prototype-of');\nmodule.exports = require('../../modules/_core').Object.setPrototypeOf;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/set-prototype-of.js\n// module id = 111\n// module chunks = 0 1 2 3 4 5","require('../modules/es6.object.to-string');\nrequire('../modules/es6.string.iterator');\nrequire('../modules/web.dom.iterable');\nrequire('../modules/es6.promise');\nmodule.exports = require('../modules/_core').Promise;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/promise.js\n// module id = 112\n// module chunks = 0 1 2 3 4 6","require('../modules/es6.object.to-string');\nrequire('../modules/es6.string.iterator');\nrequire('../modules/web.dom.iterable');\nrequire('../modules/es6.set');\nrequire('../modules/es7.set.to-json');\nmodule.exports = require('../modules/_core').Set;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/set.js\n// module id = 113\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.symbol');\nrequire('../../modules/es6.object.to-string');\nrequire('../../modules/es7.symbol.async-iterator');\nrequire('../../modules/es7.symbol.observable');\nmodule.exports = require('../../modules/_core').Symbol;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/symbol/index.js\n// module id = 114\n// module chunks = 0 1 2 3 4 5","require('../../modules/es6.string.iterator');\nrequire('../../modules/web.dom.iterable');\nmodule.exports = require('../../modules/_wks-ext').f('iterator');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/symbol/iterator.js\n// module id = 115\n// module chunks = 0 1 2 3 4 5","var forOf = require('./_for-of');\n\nmodule.exports = function(iter, ITERATOR){\n  var result = [];\n  forOf(iter, false, result.push, result, ITERATOR);\n  return result;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_array-from-iterable.js\n// module id = 116\n// module chunks = 0 1 2 3 4 5","// 0 -> Array#forEach\n// 1 -> Array#map\n// 2 -> Array#filter\n// 3 -> Array#some\n// 4 -> Array#every\n// 5 -> Array#find\n// 6 -> Array#findIndex\nvar ctx      = require('./_ctx')\n  , IObject  = require('./_iobject')\n  , toObject = require('./_to-object')\n  , toLength = require('./_to-length')\n  , asc      = require('./_array-species-create');\nmodule.exports = function(TYPE, $create){\n  var IS_MAP        = TYPE == 1\n    , IS_FILTER     = TYPE == 2\n    , IS_SOME       = TYPE == 3\n    , IS_EVERY      = TYPE == 4\n    , IS_FIND_INDEX = TYPE == 6\n    , NO_HOLES      = TYPE == 5 || IS_FIND_INDEX\n    , create        = $create || asc;\n  return function($this, callbackfn, that){\n    var O      = toObject($this)\n      , self   = IObject(O)\n      , f      = ctx(callbackfn, that, 3)\n      , length = toLength(self.length)\n      , index  = 0\n      , result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined\n      , val, res;\n    for(;length > index; index++)if(NO_HOLES || index in self){\n      val = self[index];\n      res = f(val, index, O);\n      if(TYPE){\n        if(IS_MAP)result[index] = res;            // map\n        else if(res)switch(TYPE){\n          case 3: return true;                    // some\n          case 5: return val;                     // find\n          case 6: return index;                   // findIndex\n          case 2: result.push(val);               // filter\n        } else if(IS_EVERY)return false;          // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_array-methods.js\n// module id = 117\n// module chunks = 0 1 2 3 4 5","var isObject = require('./_is-object')\n  , isArray  = require('./_is-array')\n  , SPECIES  = require('./_wks')('species');\n\nmodule.exports = function(original){\n  var C;\n  if(isArray(original)){\n    C = original.constructor;\n    // cross-realm fallback\n    if(typeof C == 'function' && (C === Array || isArray(C.prototype)))C = undefined;\n    if(isObject(C)){\n      C = C[SPECIES];\n      if(C === null)C = undefined;\n    }\n  } return C === undefined ? Array : C;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_array-species-constructor.js\n// module id = 118\n// module chunks = 0 1 2 3 4 5","// 9.4.2.3 ArraySpeciesCreate(originalArray, length)\nvar speciesConstructor = require('./_array-species-constructor');\n\nmodule.exports = function(original, length){\n  return new (speciesConstructor(original))(length);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_array-species-create.js\n// module id = 119\n// module chunks = 0 1 2 3 4 5","'use strict';\nvar $defineProperty = require('./_object-dp')\n  , createDesc      = require('./_property-desc');\n\nmodule.exports = function(object, index, value){\n  if(index in object)$defineProperty.f(object, index, createDesc(0, value));\n  else object[index] = value;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_create-property.js\n// module id = 120\n// module chunks = 0 1 2 3 4 5","// all enumerable object keys, includes symbols\nvar getKeys = require('./_object-keys')\n  , gOPS    = require('./_object-gops')\n  , pIE     = require('./_object-pie');\nmodule.exports = function(it){\n  var result     = getKeys(it)\n    , getSymbols = gOPS.f;\n  if(getSymbols){\n    var symbols = getSymbols(it)\n      , isEnum  = pIE.f\n      , i       = 0\n      , key;\n    while(symbols.length > i)if(isEnum.call(it, key = symbols[i++]))result.push(key);\n  } return result;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_enum-keys.js\n// module id = 121\n// module chunks = 0 1 2 3 4 5","// fast apply, http://jsperf.lnkit.com/fast-apply/5\nmodule.exports = function(fn, args, that){\n  var un = that === undefined;\n  switch(args.length){\n    case 0: return un ? fn()\n                      : fn.call(that);\n    case 1: return un ? fn(args[0])\n                      : fn.call(that, args[0]);\n    case 2: return un ? fn(args[0], args[1])\n                      : fn.call(that, args[0], args[1]);\n    case 3: return un ? fn(args[0], args[1], args[2])\n                      : fn.call(that, args[0], args[1], args[2]);\n    case 4: return un ? fn(args[0], args[1], args[2], args[3])\n                      : fn.call(that, args[0], args[1], args[2], args[3]);\n  } return              fn.apply(that, args);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_invoke.js\n// module id = 122\n// module chunks = 0 1 2 3 4 6","var getKeys   = require('./_object-keys')\n  , toIObject = require('./_to-iobject');\nmodule.exports = function(object, el){\n  var O      = toIObject(object)\n    , keys   = getKeys(O)\n    , length = keys.length\n    , index  = 0\n    , key;\n  while(length > index)if(O[key = keys[index++]] === el)return key;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_keyof.js\n// module id = 123\n// module chunks = 0 1 2 3 4 5","var global    = require('./_global')\n  , macrotask = require('./_task').set\n  , Observer  = global.MutationObserver || global.WebKitMutationObserver\n  , process   = global.process\n  , Promise   = global.Promise\n  , isNode    = require('./_cof')(process) == 'process';\n\nmodule.exports = function(){\n  var head, last, notify;\n\n  var flush = function(){\n    var parent, fn;\n    if(isNode && (parent = process.domain))parent.exit();\n    while(head){\n      fn   = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch(e){\n        if(head)notify();\n        else last = undefined;\n        throw e;\n      }\n    } last = undefined;\n    if(parent)parent.enter();\n  };\n\n  // Node.js\n  if(isNode){\n    notify = function(){\n      process.nextTick(flush);\n    };\n  // browsers with MutationObserver\n  } else if(Observer){\n    var toggle = true\n      , node   = document.createTextNode('');\n    new Observer(flush).observe(node, {characterData: true}); // eslint-disable-line no-new\n    notify = function(){\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if(Promise && Promise.resolve){\n    var promise = Promise.resolve();\n    notify = function(){\n      promise.then(flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function(){\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n\n  return function(fn){\n    var task = {fn: fn, next: undefined};\n    if(last)last.next = task;\n    if(!head){\n      head = task;\n      notify();\n    } last = task;\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_microtask.js\n// module id = 124\n// module chunks = 0 1 2 3 4 6","// Works with __proto__ only. Old v8 can't work with null proto objects.\n/* eslint-disable no-proto */\nvar isObject = require('./_is-object')\n  , anObject = require('./_an-object');\nvar check = function(O, proto){\n  anObject(O);\n  if(!isObject(proto) && proto !== null)throw TypeError(proto + \": can't set as prototype!\");\n};\nmodule.exports = {\n  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line\n    function(test, buggy, set){\n      try {\n        set = require('./_ctx')(Function.call, require('./_object-gopd').f(Object.prototype, '__proto__').set, 2);\n        set(test, []);\n        buggy = !(test instanceof Array);\n      } catch(e){ buggy = true; }\n      return function setPrototypeOf(O, proto){\n        check(O, proto);\n        if(buggy)O.__proto__ = proto;\n        else set(O, proto);\n        return O;\n      };\n    }({}, false) : undefined),\n  check: check\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_set-proto.js\n// module id = 125\n// module chunks = 0 1 2 3 4 5","// 7.3.20 SpeciesConstructor(O, defaultConstructor)\nvar anObject  = require('./_an-object')\n  , aFunction = require('./_a-function')\n  , SPECIES   = require('./_wks')('species');\nmodule.exports = function(O, D){\n  var C = anObject(O).constructor, S;\n  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_species-constructor.js\n// module id = 126\n// module chunks = 0 1 2 3 4 6","'use strict';\nvar ctx            = require('./_ctx')\n  , $export        = require('./_export')\n  , toObject       = require('./_to-object')\n  , call           = require('./_iter-call')\n  , isArrayIter    = require('./_is-array-iter')\n  , toLength       = require('./_to-length')\n  , createProperty = require('./_create-property')\n  , getIterFn      = require('./core.get-iterator-method');\n\n$export($export.S + $export.F * !require('./_iter-detect')(function(iter){ Array.from(iter); }), 'Array', {\n  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)\n  from: function from(arrayLike/*, mapfn = undefined, thisArg = undefined*/){\n    var O       = toObject(arrayLike)\n      , C       = typeof this == 'function' ? this : Array\n      , aLen    = arguments.length\n      , mapfn   = aLen > 1 ? arguments[1] : undefined\n      , mapping = mapfn !== undefined\n      , index   = 0\n      , iterFn  = getIterFn(O)\n      , length, result, step, iterator;\n    if(mapping)mapfn = ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);\n    // if object isn't iterable or it's array with default iterator - use simple case\n    if(iterFn != undefined && !(C == Array && isArrayIter(iterFn))){\n      for(iterator = iterFn.call(O), result = new C; !(step = iterator.next()).done; index++){\n        createProperty(result, index, mapping ? call(iterator, mapfn, [step.value, index], true) : step.value);\n      }\n    } else {\n      length = toLength(O.length);\n      for(result = new C(length); length > index; index++){\n        createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);\n      }\n    }\n    result.length = index;\n    return result;\n  }\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.array.from.js\n// module id = 127\n// module chunks = 0 1 2 3 4 5","var $export = require('./_export')\n// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\n$export($export.S, 'Object', {create: require('./_object-create')});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.create.js\n// module id = 128\n// module chunks = 0 1 2 3 4 5","// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\nvar toIObject                 = require('./_to-iobject')\n  , $getOwnPropertyDescriptor = require('./_object-gopd').f;\n\nrequire('./_object-sap')('getOwnPropertyDescriptor', function(){\n  return function getOwnPropertyDescriptor(it, key){\n    return $getOwnPropertyDescriptor(toIObject(it), key);\n  };\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.get-own-property-descriptor.js\n// module id = 129\n// module chunks = 0 1 2 3 4 5","// 19.1.2.9 Object.getPrototypeOf(O)\nvar toObject        = require('./_to-object')\n  , $getPrototypeOf = require('./_object-gpo');\n\nrequire('./_object-sap')('getPrototypeOf', function(){\n  return function getPrototypeOf(it){\n    return $getPrototypeOf(toObject(it));\n  };\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.get-prototype-of.js\n// module id = 130\n// module chunks = 0 1 2 3 4 5","// 19.1.3.19 Object.setPrototypeOf(O, proto)\nvar $export = require('./_export');\n$export($export.S, 'Object', {setPrototypeOf: require('./_set-proto').set});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.set-prototype-of.js\n// module id = 131\n// module chunks = 0 1 2 3 4 5","'use strict';\nvar LIBRARY            = require('./_library')\n  , global             = require('./_global')\n  , ctx                = require('./_ctx')\n  , classof            = require('./_classof')\n  , $export            = require('./_export')\n  , isObject           = require('./_is-object')\n  , aFunction          = require('./_a-function')\n  , anInstance         = require('./_an-instance')\n  , forOf              = require('./_for-of')\n  , speciesConstructor = require('./_species-constructor')\n  , task               = require('./_task').set\n  , microtask          = require('./_microtask')()\n  , PROMISE            = 'Promise'\n  , TypeError          = global.TypeError\n  , process            = global.process\n  , $Promise           = global[PROMISE]\n  , process            = global.process\n  , isNode             = classof(process) == 'process'\n  , empty              = function(){ /* empty */ }\n  , Internal, GenericPromiseCapability, Wrapper;\n\nvar USE_NATIVE = !!function(){\n  try {\n    // correct subclassing with @@species support\n    var promise     = $Promise.resolve(1)\n      , FakePromise = (promise.constructor = {})[require('./_wks')('species')] = function(exec){ exec(empty, empty); };\n    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    return (isNode || typeof PromiseRejectionEvent == 'function') && promise.then(empty) instanceof FakePromise;\n  } catch(e){ /* empty */ }\n}();\n\n// helpers\nvar sameConstructor = function(a, b){\n  // with library wrapper special case\n  return a === b || a === $Promise && b === Wrapper;\n};\nvar isThenable = function(it){\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar newPromiseCapability = function(C){\n  return sameConstructor($Promise, C)\n    ? new PromiseCapability(C)\n    : new GenericPromiseCapability(C);\n};\nvar PromiseCapability = GenericPromiseCapability = function(C){\n  var resolve, reject;\n  this.promise = new C(function($$resolve, $$reject){\n    if(resolve !== undefined || reject !== undefined)throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject  = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject  = aFunction(reject);\n};\nvar perform = function(exec){\n  try {\n    exec();\n  } catch(e){\n    return {error: e};\n  }\n};\nvar notify = function(promise, isReject){\n  if(promise._n)return;\n  promise._n = true;\n  var chain = promise._c;\n  microtask(function(){\n    var value = promise._v\n      , ok    = promise._s == 1\n      , i     = 0;\n    var run = function(reaction){\n      var handler = ok ? reaction.ok : reaction.fail\n        , resolve = reaction.resolve\n        , reject  = reaction.reject\n        , domain  = reaction.domain\n        , result, then;\n      try {\n        if(handler){\n          if(!ok){\n            if(promise._h == 2)onHandleUnhandled(promise);\n            promise._h = 1;\n          }\n          if(handler === true)result = value;\n          else {\n            if(domain)domain.enter();\n            result = handler(value);\n            if(domain)domain.exit();\n          }\n          if(result === reaction.promise){\n            reject(TypeError('Promise-chain cycle'));\n          } else if(then = isThenable(result)){\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch(e){\n        reject(e);\n      }\n    };\n    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach\n    promise._c = [];\n    promise._n = false;\n    if(isReject && !promise._h)onUnhandled(promise);\n  });\n};\nvar onUnhandled = function(promise){\n  task.call(global, function(){\n    var value = promise._v\n      , abrupt, handler, console;\n    if(isUnhandled(promise)){\n      abrupt = perform(function(){\n        if(isNode){\n          process.emit('unhandledRejection', value, promise);\n        } else if(handler = global.onunhandledrejection){\n          handler({promise: promise, reason: value});\n        } else if((console = global.console) && console.error){\n          console.error('Unhandled promise rejection', value);\n        }\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      promise._h = isNode || isUnhandled(promise) ? 2 : 1;\n    } promise._a = undefined;\n    if(abrupt)throw abrupt.error;\n  });\n};\nvar isUnhandled = function(promise){\n  if(promise._h == 1)return false;\n  var chain = promise._a || promise._c\n    , i     = 0\n    , reaction;\n  while(chain.length > i){\n    reaction = chain[i++];\n    if(reaction.fail || !isUnhandled(reaction.promise))return false;\n  } return true;\n};\nvar onHandleUnhandled = function(promise){\n  task.call(global, function(){\n    var handler;\n    if(isNode){\n      process.emit('rejectionHandled', promise);\n    } else if(handler = global.onrejectionhandled){\n      handler({promise: promise, reason: promise._v});\n    }\n  });\n};\nvar $reject = function(value){\n  var promise = this;\n  if(promise._d)return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  promise._v = value;\n  promise._s = 2;\n  if(!promise._a)promise._a = promise._c.slice();\n  notify(promise, true);\n};\nvar $resolve = function(value){\n  var promise = this\n    , then;\n  if(promise._d)return;\n  promise._d = true;\n  promise = promise._w || promise; // unwrap\n  try {\n    if(promise === value)throw TypeError(\"Promise can't be resolved itself\");\n    if(then = isThenable(value)){\n      microtask(function(){\n        var wrapper = {_w: promise, _d: false}; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch(e){\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      promise._v = value;\n      promise._s = 1;\n      notify(promise, false);\n    }\n  } catch(e){\n    $reject.call({_w: promise, _d: false}, e); // wrap\n  }\n};\n\n// constructor polyfill\nif(!USE_NATIVE){\n  // 25.4.3.1 Promise(executor)\n  $Promise = function Promise(executor){\n    anInstance(this, $Promise, PROMISE, '_h');\n    aFunction(executor);\n    Internal.call(this);\n    try {\n      executor(ctx($resolve, this, 1), ctx($reject, this, 1));\n    } catch(err){\n      $reject.call(this, err);\n    }\n  };\n  Internal = function Promise(executor){\n    this._c = [];             // <- awaiting reactions\n    this._a = undefined;      // <- checked in isUnhandled reactions\n    this._s = 0;              // <- state\n    this._d = false;          // <- done\n    this._v = undefined;      // <- value\n    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled\n    this._n = false;          // <- notify\n  };\n  Internal.prototype = require('./_redefine-all')($Promise.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected){\n      var reaction    = newPromiseCapability(speciesConstructor(this, $Promise));\n      reaction.ok     = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail   = typeof onRejected == 'function' && onRejected;\n      reaction.domain = isNode ? process.domain : undefined;\n      this._c.push(reaction);\n      if(this._a)this._a.push(reaction);\n      if(this._s)notify(this, false);\n      return reaction.promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function(onRejected){\n      return this.then(undefined, onRejected);\n    }\n  });\n  PromiseCapability = function(){\n    var promise  = new Internal;\n    this.promise = promise;\n    this.resolve = ctx($resolve, promise, 1);\n    this.reject  = ctx($reject, promise, 1);\n  };\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, {Promise: $Promise});\nrequire('./_set-to-string-tag')($Promise, PROMISE);\nrequire('./_set-species')(PROMISE);\nWrapper = require('./_core')[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r){\n    var capability = newPromiseCapability(this)\n      , $$reject   = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x){\n    // instanceof instead of internal slot check because we should fix it without replacement native Promise core\n    if(x instanceof $Promise && sameConstructor(x.constructor, this))return x;\n    var capability = newPromiseCapability(this)\n      , $$resolve  = capability.resolve;\n    $$resolve(x);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && require('./_iter-detect')(function(iter){\n  $Promise.all(iter)['catch'](empty);\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable){\n    var C          = this\n      , capability = newPromiseCapability(C)\n      , resolve    = capability.resolve\n      , reject     = capability.reject;\n    var abrupt = perform(function(){\n      var values    = []\n        , index     = 0\n        , remaining = 1;\n      forOf(iterable, false, function(promise){\n        var $index        = index++\n          , alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        C.resolve(promise).then(function(value){\n          if(alreadyCalled)return;\n          alreadyCalled  = true;\n          values[$index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable){\n    var C          = this\n      , capability = newPromiseCapability(C)\n      , reject     = capability.reject;\n    var abrupt = perform(function(){\n      forOf(iterable, false, function(promise){\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.promise.js\n// module id = 132\n// module chunks = 0 1 2 3 4 6","'use strict';\nvar strong = require('./_collection-strong');\n\n// 23.2 Set Objects\nmodule.exports = require('./_collection')('Set', function(get){\n  return function Set(){ return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.2.3.1 Set.prototype.add(value)\n  add: function add(value){\n    return strong.def(this, value = value === 0 ? 0 : value, value);\n  }\n}, strong);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.set.js\n// module id = 133\n// module chunks = 0 1 2 3 4 5","'use strict';\n// ECMAScript 6 symbols shim\nvar global         = require('./_global')\n  , has            = require('./_has')\n  , DESCRIPTORS    = require('./_descriptors')\n  , $export        = require('./_export')\n  , redefine       = require('./_redefine')\n  , META           = require('./_meta').KEY\n  , $fails         = require('./_fails')\n  , shared         = require('./_shared')\n  , setToStringTag = require('./_set-to-string-tag')\n  , uid            = require('./_uid')\n  , wks            = require('./_wks')\n  , wksExt         = require('./_wks-ext')\n  , wksDefine      = require('./_wks-define')\n  , keyOf          = require('./_keyof')\n  , enumKeys       = require('./_enum-keys')\n  , isArray        = require('./_is-array')\n  , anObject       = require('./_an-object')\n  , toIObject      = require('./_to-iobject')\n  , toPrimitive    = require('./_to-primitive')\n  , createDesc     = require('./_property-desc')\n  , _create        = require('./_object-create')\n  , gOPNExt        = require('./_object-gopn-ext')\n  , $GOPD          = require('./_object-gopd')\n  , $DP            = require('./_object-dp')\n  , $keys          = require('./_object-keys')\n  , gOPD           = $GOPD.f\n  , dP             = $DP.f\n  , gOPN           = gOPNExt.f\n  , $Symbol        = global.Symbol\n  , $JSON          = global.JSON\n  , _stringify     = $JSON && $JSON.stringify\n  , PROTOTYPE      = 'prototype'\n  , HIDDEN         = wks('_hidden')\n  , TO_PRIMITIVE   = wks('toPrimitive')\n  , isEnum         = {}.propertyIsEnumerable\n  , SymbolRegistry = shared('symbol-registry')\n  , AllSymbols     = shared('symbols')\n  , OPSymbols      = shared('op-symbols')\n  , ObjectProto    = Object[PROTOTYPE]\n  , USE_NATIVE     = typeof $Symbol == 'function'\n  , QObject        = global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDesc = DESCRIPTORS && $fails(function(){\n  return _create(dP({}, 'a', {\n    get: function(){ return dP(this, 'a', {value: 7}).a; }\n  })).a != 7;\n}) ? function(it, key, D){\n  var protoDesc = gOPD(ObjectProto, key);\n  if(protoDesc)delete ObjectProto[key];\n  dP(it, key, D);\n  if(protoDesc && it !== ObjectProto)dP(ObjectProto, key, protoDesc);\n} : dP;\n\nvar wrap = function(tag){\n  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);\n  sym._k = tag;\n  return sym;\n};\n\nvar isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function(it){\n  return typeof it == 'symbol';\n} : function(it){\n  return it instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(it, key, D){\n  if(it === ObjectProto)$defineProperty(OPSymbols, key, D);\n  anObject(it);\n  key = toPrimitive(key, true);\n  anObject(D);\n  if(has(AllSymbols, key)){\n    if(!D.enumerable){\n      if(!has(it, HIDDEN))dP(it, HIDDEN, createDesc(1, {}));\n      it[HIDDEN][key] = true;\n    } else {\n      if(has(it, HIDDEN) && it[HIDDEN][key])it[HIDDEN][key] = false;\n      D = _create(D, {enumerable: createDesc(0, false)});\n    } return setSymbolDesc(it, key, D);\n  } return dP(it, key, D);\n};\nvar $defineProperties = function defineProperties(it, P){\n  anObject(it);\n  var keys = enumKeys(P = toIObject(P))\n    , i    = 0\n    , l = keys.length\n    , key;\n  while(l > i)$defineProperty(it, key = keys[i++], P[key]);\n  return it;\n};\nvar $create = function create(it, P){\n  return P === undefined ? _create(it) : $defineProperties(_create(it), P);\n};\nvar $propertyIsEnumerable = function propertyIsEnumerable(key){\n  var E = isEnum.call(this, key = toPrimitive(key, true));\n  if(this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key))return false;\n  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;\n};\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key){\n  it  = toIObject(it);\n  key = toPrimitive(key, true);\n  if(it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key))return;\n  var D = gOPD(it, key);\n  if(D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key]))D.enumerable = true;\n  return D;\n};\nvar $getOwnPropertyNames = function getOwnPropertyNames(it){\n  var names  = gOPN(toIObject(it))\n    , result = []\n    , i      = 0\n    , key;\n  while(names.length > i){\n    if(!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META)result.push(key);\n  } return result;\n};\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(it){\n  var IS_OP  = it === ObjectProto\n    , names  = gOPN(IS_OP ? OPSymbols : toIObject(it))\n    , result = []\n    , i      = 0\n    , key;\n  while(names.length > i){\n    if(has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true))result.push(AllSymbols[key]);\n  } return result;\n};\n\n// 19.4.1.1 Symbol([description])\nif(!USE_NATIVE){\n  $Symbol = function Symbol(){\n    if(this instanceof $Symbol)throw TypeError('Symbol is not a constructor!');\n    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);\n    var $set = function(value){\n      if(this === ObjectProto)$set.call(OPSymbols, value);\n      if(has(this, HIDDEN) && has(this[HIDDEN], tag))this[HIDDEN][tag] = false;\n      setSymbolDesc(this, tag, createDesc(1, value));\n    };\n    if(DESCRIPTORS && setter)setSymbolDesc(ObjectProto, tag, {configurable: true, set: $set});\n    return wrap(tag);\n  };\n  redefine($Symbol[PROTOTYPE], 'toString', function toString(){\n    return this._k;\n  });\n\n  $GOPD.f = $getOwnPropertyDescriptor;\n  $DP.f   = $defineProperty;\n  require('./_object-gopn').f = gOPNExt.f = $getOwnPropertyNames;\n  require('./_object-pie').f  = $propertyIsEnumerable;\n  require('./_object-gops').f = $getOwnPropertySymbols;\n\n  if(DESCRIPTORS && !require('./_library')){\n    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n  }\n\n  wksExt.f = function(name){\n    return wrap(wks(name));\n  }\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, {Symbol: $Symbol});\n\nfor(var symbols = (\n  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14\n  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'\n).split(','), i = 0; symbols.length > i; )wks(symbols[i++]);\n\nfor(var symbols = $keys(wks.store), i = 0; symbols.length > i; )wksDefine(symbols[i++]);\n\n$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {\n  // 19.4.2.1 Symbol.for(key)\n  'for': function(key){\n    return has(SymbolRegistry, key += '')\n      ? SymbolRegistry[key]\n      : SymbolRegistry[key] = $Symbol(key);\n  },\n  // 19.4.2.5 Symbol.keyFor(sym)\n  keyFor: function keyFor(key){\n    if(isSymbol(key))return keyOf(SymbolRegistry, key);\n    throw TypeError(key + ' is not a symbol!');\n  },\n  useSetter: function(){ setter = true; },\n  useSimple: function(){ setter = false; }\n});\n\n$export($export.S + $export.F * !USE_NATIVE, 'Object', {\n  // 19.1.2.2 Object.create(O [, Properties])\n  create: $create,\n  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n  defineProperty: $defineProperty,\n  // 19.1.2.3 Object.defineProperties(O, Properties)\n  defineProperties: $defineProperties,\n  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n  // 19.1.2.7 Object.getOwnPropertyNames(O)\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// 24.3.2 JSON.stringify(value [, replacer [, space]])\n$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function(){\n  var S = $Symbol();\n  // MS Edge converts symbol values to JSON as {}\n  // WebKit converts symbol values to JSON as null\n  // V8 throws on boxed symbols\n  return _stringify([S]) != '[null]' || _stringify({a: S}) != '{}' || _stringify(Object(S)) != '{}';\n})), 'JSON', {\n  stringify: function stringify(it){\n    if(it === undefined || isSymbol(it))return; // IE8 returns string on undefined\n    var args = [it]\n      , i    = 1\n      , replacer, $replacer;\n    while(arguments.length > i)args.push(arguments[i++]);\n    replacer = args[1];\n    if(typeof replacer == 'function')$replacer = replacer;\n    if($replacer || !isArray(replacer))replacer = function(key, value){\n      if($replacer)value = $replacer.call(this, key, value);\n      if(!isSymbol(value))return value;\n    };\n    args[1] = replacer;\n    return _stringify.apply($JSON, args);\n  }\n});\n\n// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)\n$Symbol[PROTOTYPE][TO_PRIMITIVE] || require('./_hide')($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);\n// 19.4.3.5 Symbol.prototype[@@toStringTag]\nsetToStringTag($Symbol, 'Symbol');\n// 20.2.1.9 Math[@@toStringTag]\nsetToStringTag(Math, 'Math', true);\n// 24.3.3 JSON[@@toStringTag]\nsetToStringTag(global.JSON, 'JSON', true);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.symbol.js\n// module id = 134\n// module chunks = 0 1 2 3 4 5","// https://github.com/DavidBruant/Map-Set.prototype.toJSON\nvar $export  = require('./_export');\n\n$export($export.P + $export.R, 'Set', {toJSON: require('./_collection-to-json')('Set')});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es7.set.to-json.js\n// module id = 135\n// module chunks = 0 1 2 3 4 5","require('./_wks-define')('asyncIterator');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es7.symbol.async-iterator.js\n// module id = 136\n// module chunks = 0 1 2 3 4 5","require('./_wks-define')('observable');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es7.symbol.observable.js\n// module id = 137\n// module chunks = 0 1 2 3 4 5","'use strict'\n\nimport argCheck from 'common/argCheck'\n\nimport {ConfigurationData} from 'conference/raftConfiguration'\nimport LogEntry from 'conference/raftLogEntry'\nimport {PeerTopologyInfo} from 'conference/meshTopology'\n\nexport default class RaftMessage {\n  static parse(body) {\n    if (!Array.isArray(body)) {\n      throw new TypeError('RaftMessage body must be an array')\n    }\n    let [id, ...params] = body\n    let MessageConstructor = messageConstructors[id]\n    if (!MessageConstructor) {\n      throw new TypeError(`Failed to parse invalid raft message, unknown id: ${id}`)\n    }\n    return new MessageConstructor(...params)\n  }\n\n  constructor(term) {\n    this._term = argCheck.number(this, 'term', term)\n  }\n\n  get term() {\n    return this._term\n  }\n\n  get isRequest() {\n    return !(this.constructor.id & 1)\n  }\n\n  toJSON() {\n    return [this.constructor.id, ...this.params]\n  }\n}\n\nexport class AppendEntriesRequest extends RaftMessage {\n  static create({term, topologyIndex, prevIndex, prevTerm, commitIndex, entries}) {\n    return new AppendEntriesRequest(term, topologyIndex, prevIndex, prevTerm, commitIndex, entries)\n  }\n\n  constructor(term, topologyIndex, prevIndex, prevTerm, commitIndex, entries) {\n    super(term)\n    this._topologyIndex = argCheck.number(this, 'topologyIndex', topologyIndex)\n    this._prevIndex = argCheck.number(this, 'prevIndex', prevIndex)\n    this._prevTerm = argCheck.number(this, 'prevTerm', prevTerm)\n    this._commitIndex = argCheck.number(this, 'commitIndex', commitIndex)\n    this._entries = entries.map((entry, index) => {\n      let entryIndex = this._prevIndex + index + 1\n      entry = (entry instanceof LogEntry) ? entry : LogEntry.parse(entry, entryIndex)\n      argCheck.number(this, 'entry.term', entry.term)\n      return entry\n    })\n  }\n\n  toString() {\n    return 'appendRequest{' +\n      `term=${this.term},ti=${this._topologyIndex},` +\n      `pi=${this._prevIndex},pt=${this._prevTerm},` +\n      `ci=${this._commitIndex},es=[${this._entries}]}`\n  }\n\n  get params() {\n    return [\n      this._term,\n      this._topologyIndex,\n      this._prevIndex,\n      this._prevTerm,\n      this._commitIndex,\n      this._entries,\n    ]\n  }\n\n  // topologyIndex is an addition to the Raft algorithm. The purpose is for the leader\n  // to get a complete view of the topology of the cluster, while keeping network use low.\n  // Each member will send information about their active connections in the AppendEntries\n  // response, but only if the received topology index is lower than their own one.\n  //\n  // Followers will increment their topologyIndex whenever a significant change is made to\n  // their active connections, e.g. added and removed connections, as well as changes in\n  // latency or bandwidth. The initial implementation will only take added and removed\n  // connections into account, and use a timeout to make sure relatively up-to-date network\n  // information is transmitted. The downside is that it will require slightly more bandwidth,\n  // and that bit changes in network characteristics won't be detected as quickly by the leader.\n  //\n  // Just like terms and log indices, the topology index is an integer that is always\n  // incremented during normal operation. The follower increments it as discussed above\n  // and the leader increments their topologyIndex as updates are received from the follower.\n  // Just like the matchIndex the leader keeps track of the remote topologyIndex separately\n  // for each cluster member.\n  //\n  // New leaders will use a topologyIndex of 0 in the first appendEntries request sent to\n  // all members when they get elected, and the followers will then always respond with their\n  // current connection state and topologyIndex.\n  get topologyIndex() {\n    return this._topologyIndex\n  }\n\n  get prevIndex() {\n    return this._prevIndex\n  }\n\n  get prevTerm() {\n    return this._prevTerm\n  }\n\n  get commitIndex() {\n    return this._commitIndex\n  }\n\n  get entries() {\n    return this._entries\n  }\n\n  response(options = {}) {\n    let {\n      term = this._term,\n      success = false,\n      needSnapshot = false,\n      meshTopology,\n      matchIndex = this._prevIndex - 1,\n    } = options\n\n    let localTopologyInfo = meshTopology && meshTopology.localTopologyInfo\n    var topologyInfo = null\n    let topologyIndex = localTopologyInfo && localTopologyInfo.topologyIndex\n    if (topologyIndex > this.topologyIndex) {\n      topologyInfo = localTopologyInfo\n    }\n    let volume = localTopologyInfo ? localTopologyInfo.volume : 0\n\n    var flag = APPEND_ENTRIES_RESPONSE_FLAG_SUCCESS\n    if (!success) {\n      flag = APPEND_ENTRIES_RESPONSE_FLAG_FAILURE\n    }\n    if (needSnapshot) {\n      flag = APPEND_ENTRIES_RESPONSE_FLAG_NEED_SNAPSHOT\n    }\n\n    return new AppendEntriesResponse(term, flag, topologyIndex, topologyInfo, volume, matchIndex)\n  }\n}\n\nconst APPEND_ENTRIES_RESPONSE_FLAG_SUCCESS = 0\nconst APPEND_ENTRIES_RESPONSE_FLAG_FAILURE = 1\nconst APPEND_ENTRIES_RESPONSE_FLAG_NEED_SNAPSHOT = 2\n\nexport class AppendEntriesResponse extends RaftMessage {\n  constructor(term, flag, topologyIndex = -1, topologyInfo = null, volume = 0, matchIndex = -1) {\n    super(term)\n    this._flag = argCheck.number(this, 'flag', flag)\n    this._topologyIndex = argCheck.number(this, 'topologyIndex', topologyIndex)\n    this._matchIndex = argCheck.number(this, 'matchIndex', matchIndex)\n    if (topologyInfo) {\n      this._topologyInfo = PeerTopologyInfo.parseUpdate(topologyInfo)\n    } else {\n      this._topologyInfo = null\n    }\n    this._volume = volume\n  }\n\n  toString() {\n    var topologyInfo = null\n    if (this._topologyInfo) {\n      topologyInfo = `topologyInfo{power=${this._topologyInfo.power},${this._topologyInfo.links}}`\n    }\n    return 'appendResponse{' +\n      `term=${this.term},flag=${this._flag},mi=${this._matchIndex},v=${this._volume},` +\n      `ti=${this._topologyIndex},${topologyInfo}}`\n  }\n\n  get params() {\n    return [this._term, this._flag, this._topologyIndex, this._topologyInfo || 0, this._volume || 0, this._matchIndex]\n  }\n\n  get success() {\n    return this._flag === APPEND_ENTRIES_RESPONSE_FLAG_SUCCESS\n  }\n\n  get needSnapshot() {\n    return this._flag === APPEND_ENTRIES_RESPONSE_FLAG_NEED_SNAPSHOT\n  }\n\n  get topologyIndex() {\n    return this._topologyIndex\n  }\n\n  get topologyInfo() {\n    return this._topologyInfo\n  }\n\n  get matchIndex() {\n    return this._matchIndex\n  }\n\n  get volume() {\n    return this._volume\n  }\n}\n\nexport class RequestVoteRequest extends RaftMessage {\n  static create({term, lastLogTerm, lastLogIndex}) {\n    return new RequestVoteRequest(term, lastLogTerm, lastLogIndex)\n  }\n\n  constructor(term, lastLogTerm, lastLogIndex) {\n    super(term)\n    this._lastLogTerm = argCheck.number(this, 'lastLogTerm', lastLogTerm)\n    this._lastLogIndex = argCheck.number(this, 'lastLogIndex', lastLogIndex)\n  }\n\n  toString() {\n    return `voteRequest{term=${this.term}}`\n  }\n\n  get params() {\n    return [this._term, this._lastLogTerm, this._lastLogIndex]\n  }\n\n  get lastLogTerm() {\n    return this._lastLogTerm\n  }\n\n  get lastLogIndex() {\n    return this._lastLogIndex\n  }\n\n  compareLog(other) {\n    let {lastLogTerm} = other\n    if (this.lastLogTerm !== lastLogTerm) {\n      return this.lastLogTerm - lastLogTerm\n    } else {\n      return this.lastLogIndex - other.lastLogIndex\n    }\n  }\n\n  response({granted = false}) {\n    return new RequestVoteResponse(this._term, granted)\n  }\n}\n\nexport class RequestVoteResponse extends RaftMessage {\n  constructor(term, granted) {\n    super(term)\n    this._granted = argCheck.boolean(this, 'granted', granted)\n  }\n\n  toString() {\n    return `voteResponse{term=${this.term},granted=${this.granted}}`\n  }\n\n  get params() {\n    return [this._term, this._granted]\n  }\n\n  get granted() {\n    return this._granted\n  }\n}\n\n// PreVote RPC is an extension for the Raft algorithm that lets low-population\n// clusters find a leader faster, and prevents many cases of leader flip-flopping.\n//\n// The implementation is based on the suggested modifications in\n// \"Three modifications for the Raft consensus algorithm\" by Henrik Ingo\n// http://openlife.cc/system/files/3-modifications-for-Raft-consensus.pdf\nexport class PreVoteRequest extends RequestVoteRequest {\n  static create({term, lastLogTerm, lastLogIndex}) {\n    return new PreVoteRequest(term, lastLogTerm, lastLogIndex)\n  }\n\n  toString() {\n    return `preVoteRequest{term=${this.term}}`\n  }\n\n  response({granted = false}) {\n    return new PreVoteResponse(this._term, granted)\n  }\n}\n\nexport class PreVoteResponse extends RequestVoteResponse {\n  toString() {\n    return `preVoteResponse{term=${this.term},granted=${this.granted}}`\n  }\n}\n\nexport class SnapshotRequest extends RaftMessage {\n  static create({term, lastTerm, lastIndex, configuration, state}) {\n    return new SnapshotRequest(term, lastTerm, lastIndex, configuration, state)\n  }\n\n  constructor(term, lastTerm, lastIndex, configuration, state) {\n    super(term)\n    this._lastTerm = argCheck.number(this, 'lastTerm', lastTerm)\n    this._lastIndex = argCheck.number(this, 'lastIndex', lastIndex)\n    if (!(configuration instanceof ConfigurationData)) {\n      configuration = ConfigurationData.parse(configuration)\n    }\n    this._configuration = configuration\n    this._state = state\n  }\n\n  toString() {\n    return `snapshotRequest{term=${this.term},li=${this.lastIndex},lt=${this.lastTerm}` +\n      `,${this.configuration},${JSON.stringify(this.state)}}`\n  }\n\n  get params() {\n    return [this._term, this._lastTerm, this._lastIndex, this._configuration, this._state]\n  }\n\n  get lastTerm() {\n    return this._lastTerm\n  }\n\n  get lastIndex() {\n    return this._lastIndex\n  }\n\n  get configuration() {\n    return this._configuration\n  }\n\n  get state() {\n    return this._state\n  }\n\n  response() {\n    return new SnapshotResponse(this._term, this._lastTerm, this._lastIndex)\n  }\n}\n\nexport class SnapshotResponse extends RaftMessage {\n  constructor(term, lastTerm, lastIndex) {\n    super(term)\n    this._lastTerm = argCheck.number(this, 'lastTerm', lastTerm)\n    this._lastIndex = argCheck.number(this, 'lastIndex', lastIndex)\n  }\n\n  toString() {\n    return `snapshotResponse{term=${this.term},li=${this.lastIndex},lt=${this.lastTerm}}`\n  }\n\n  get params() {\n    return [this._term, this._lastTerm, this._lastIndex]\n  }\n\n  get lastTerm() {\n    return this._lastTerm\n  }\n\n  get lastIndex() {\n    return this._lastIndex\n  }\n}\n\nexport class StateOpRequest extends RaftMessage {\n  static create({id, op, args}) {\n    return new StateOpRequest(id, op, args)\n  }\n\n  constructor(id, op, args) {\n    super(0)\n    this._id = id\n    this._op = op\n    this._args = args\n  }\n\n  toString() {\n    return `stateOpRequest{id=${this._id},op=${this._op},args=${this._args}}`\n  }\n\n  get id() {\n    return this._id\n  }\n\n  get op() {\n    return this._op\n  }\n\n  get args() {\n    return this._args\n  }\n\n  get params() {\n    return [this._id, this._op, this._args]\n  }\n\n  response({errorCode = 0} = {}) {\n    return new StateOpResponse(this._id, errorCode)\n  }\n}\n\nexport class StateOpResponse extends RaftMessage {\n  constructor(id, errorCode) {\n    super(0)\n    this._id = id\n    this._errorCode = errorCode\n  }\n\n  toString() {\n    return `stateOpResponse{id=${this._id},errorCode=${this._errorCode}}`\n  }\n\n  get id() {\n    return this._id\n  }\n\n  get errorCode() {\n    return this._errorCode\n  }\n\n  get params() {\n    return [this._id, this._errorCode]\n  }\n}\nStateOpResponse.NOT_LEADER = 1\n\nAppendEntriesRequest.id = 2\nAppendEntriesResponse.id = 3\nRequestVoteRequest.id = 4\nRequestVoteResponse.id = 5\nPreVoteRequest.id = 6\nPreVoteResponse.id = 7\nSnapshotRequest.id = 8\nSnapshotResponse.id = 9\nStateOpRequest.id = 10\nStateOpResponse.id = 11\n\nconst messageConstructors = {\n  2: AppendEntriesRequest,\n  3: AppendEntriesResponse,\n  4: RequestVoteRequest,\n  5: RequestVoteResponse,\n  6: PreVoteRequest,\n  7: PreVoteResponse,\n  8: SnapshotRequest,\n  9: SnapshotResponse,\n  10: StateOpRequest,\n  11: StateOpResponse,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raftMessages.js","var core  = require('../../modules/_core')\n  , $JSON = core.JSON || (core.JSON = {stringify: JSON.stringify});\nmodule.exports = function stringify(it){ // eslint-disable-line no-unused-vars\n  return $JSON.stringify.apply($JSON, arguments);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/json/stringify.js\n// module id = 139\n// module chunks = 0 1 2 4 6","require('../modules/es6.object.to-string');\nrequire('../modules/es6.string.iterator');\nrequire('../modules/web.dom.iterable');\nrequire('../modules/es6.map');\nrequire('../modules/es7.map.to-json');\nmodule.exports = require('../modules/_core').Map;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/map.js\n// module id = 140\n// module chunks = 0 1 2 3 4","require('../../modules/es6.object.keys');\nmodule.exports = require('../../modules/_core').Object.keys;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/keys.js\n// module id = 141\n// module chunks = 0 1 2 3 4","'use strict';\nvar strong = require('./_collection-strong');\n\n// 23.1 Map Objects\nmodule.exports = require('./_collection')('Map', function(get){\n  return function Map(){ return get(this, arguments.length > 0 ? arguments[0] : undefined); };\n}, {\n  // 23.1.3.6 Map.prototype.get(key)\n  get: function get(key){\n    var entry = strong.getEntry(this, key);\n    return entry && entry.v;\n  },\n  // 23.1.3.9 Map.prototype.set(key, value)\n  set: function set(key, value){\n    return strong.def(this, key === 0 ? 0 : key, value);\n  }\n}, strong, true);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.map.js\n// module id = 142\n// module chunks = 0 1 2 3 4","// 19.1.2.14 Object.keys(O)\nvar toObject = require('./_to-object')\n  , $keys    = require('./_object-keys');\n\nrequire('./_object-sap')('keys', function(){\n  return function keys(it){\n    return $keys(toObject(it));\n  };\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.keys.js\n// module id = 143\n// module chunks = 0 1 2 3 4","// https://github.com/DavidBruant/Map-Set.prototype.toJSON\nvar $export  = require('./_export');\n\n$export($export.P + $export.R, 'Map', {toJSON: require('./_collection-to-json')('Map')});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es7.map.to-json.js\n// module id = 144\n// module chunks = 0 1 2 3 4","'use strict'\n\nimport MediaNode from 'media/mediaNode'\nimport MediaNodeOutput from 'media/mediaNodeOutput'\n\n/**\n * A base class for media nodes with a single output and no input. Typically used to represent nodes\n * that generate streams, or as a base for nodes with multiple inputs.\n *\n * The subclass should call the `setStream` method to update the output stream.\n *\n * @class MediaSource\n * @extends MediaNode\n * @extends ConnectMixin\n */\nexport default class MediaSource extends MediaNode.connectMixin(MediaNode) {\n  constructor() {\n    super()\n    this._output = new MediaNodeOutput({\n      name: 'default',\n      parent: this,\n    })\n  }\n\n  /**\n   * The current output stream.\n   *\n   * @readonly\n   * @member {MediaStream} MediaSource#stream\n   */\n  get stream() {\n    return this._output.stream\n  }\n\n  /**\n   * The output.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} MediaSource#output\n   */\n  get output() {\n    return this._output\n  }\n\n  /**\n   * Sets the current output stream.\n   *\n   * This should only be called by the subclass implementation, not from outside the media node.\n   *\n   * @param {?MediaStream} stream - The new output stream, or null.\n   */\n  setStream(stream) {\n    this._output.setStream(stream)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaSource.js","'use strict'\n\nimport argCheck from 'common/argCheck'\n\n/**\n * Base class for all custom errors in the library.\n *\n * The main purpose of this class is to provide a cross-browser way to\n * subclass errors and have proper stack traces.\n *\n * It is safe to subclass this error in a babel environment, as opposed\n * to subclassing the `Error` builtin.\n *\n * The static `errorName` property is used to determine the default name\n * for instances of each subclass. The property is used to avoid problems\n * minification and should be set by all subclasses.\n *\n * @class CctError\n * @extends Error\n *\n * @example\n * class MyError extends CctError {\n *   constructor() {\n *     super('This is my error')\n *   }\n * }\n * MyError.errorName = 'MyError'\n */\n\n// Need to do some trickery here to allow subclassing later on\n// http://stackoverflow.com/questions/33870684\nexport default function CctError(message) {\n  argCheck.stringOrEmpty('CctError constructor', 'message', message)\n  Object.defineProperties(this, {\n    message: {\n      configurable: true,\n      enumerable: true,\n      value: message,\n    },\n  })\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, this.constructor)\n  } else {\n    let stack = new Error(message).stack\n    // IE11 does not initialize 'Error.stack' until the object is thrown.\n    if (!stack) {\n      try {\n        throw new Error()\n      } catch (e) {\n        stack = e.stack\n      }\n    }\n    Object.defineProperty(this, 'stack', {\n      configurable: true,\n      enumerable: false,\n      value: stack,\n    })\n  }\n}\nCctError.errorName = 'CctError'\n\nCctError.prototype = Object.create(Error.prototype, {\n  constructor: {value: CctError},\n\n  /**\n   * The name of the error. Will always be set to the name of the class\n   * unless something else is indicated.\n   *\n   * @readonly\n   * @member {string} CctError#name\n   */\n  name: {\n    get() {\n      return this.constructor.errorName\n    },\n  },\n\n  /**\n   * Error objects are by default JSON serialized as `{\"name\":<name>,\"message\":<message>}`\n   *\n   * @method CctError#toJson\n   * @returns {Object} - JSON representation of the error.\n   */\n  toJSON: {\n    value() {\n      return {\n        name: this.name,\n        message: this.message,\n      }\n    },\n  },\n  toString: {\n    value() {\n      return `${this.name}: ${this.message}`\n    },\n  },\n})\n\n/**\n * The requested action could not be performed because it is not allowed, e.g. the\n * authenticated user doesn't have enough power level, or a user media request was denied.\n *\n * Actions that are not allowed because the user has a guest account result in a\n * {@link GuestAccessError} instead of this.\n *\n * @class NotAllowedError\n * @extends CctError\n */\nexport class NotAllowedError extends CctError {}\nNotAllowedError.errorName = 'NotAllowedError'\n\n/**\n * The requested resource could not be found, e.g. when looking up a room by alias\n * or requesting a media source.\n *\n * @class NotFoundError\n * @extends CctError\n */\nexport class NotFoundError extends CctError {}\nNotFoundError.errorName = 'NotFoundError'\n\n/**\n * The cause of the error could not be determined. Seeing this error is in itself an error\n * because the real error reason should always be possible to determine.\n *\n * @class UnknownError\n * @extends CctError\n */\nexport class UnknownError extends CctError {}\nUnknownError.errorName = 'UnknownError'\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/errors.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\nimport {forEach, map} from 'common/utils'\n\nconst TAG = 'mesh-topology'\n\nexport class LinkInfo {\n  constructor({rttMs = -1, bandwidth = -1, up = false, onUpdate}) {\n    this._rttMs = argCheck.number(this, 'rttMs', rttMs)\n    this._bandwidth = argCheck.number(this, 'bandwidth', bandwidth)\n    this._up = argCheck.boolean(this, 'up', up)\n    this._onUpdate = onUpdate\n  }\n\n  get up() {\n    return this._up\n  }\n\n  get rttMs() {\n    return this._rttMs\n  }\n\n  get bandwidth() {\n    return this._bandwidth\n  }\n\n  update(info) {\n    let {rttMs = null, bandwidth = null, up = null} = info\n    if (rttMs !== null) {\n      this._rttMs = argCheck.number('LinkInfo.update', 'rttMs', rttMs)\n    }\n    if (bandwidth !== null) {\n      this._bandwidth = argCheck.number('LinkInfo.update', 'bandwidth', bandwidth)\n    }\n    let oldUp = this._up\n    if (up !== null) {\n      this._up = argCheck.boolean('LinkInfo.update', 'up', up)\n    }\n    if (this._onUpdate) {\n      let changedUpState = oldUp !== this._up\n      this._onUpdate(changedUpState)\n    }\n  }\n\n  toString() {\n    return `link{${this._up ? 'up' : 'down'},rttMs=${this._rttMs},bw=${this._bandwidth}}`\n  }\n\n  toJSON() {\n    if (this._up) {\n      return [this._rttMs, this._bandwidth]\n    } else {\n      return []\n    }\n  }\n\n  static parse(data) {\n    if (data.constructor === LinkInfo) {\n      return data\n    } else if (Array.isArray(data)) {\n      if (!data.length) {\n        return new LinkInfo({up: false})\n      }\n      let [rttMs, bandwidth] = data\n      return new LinkInfo({rttMs, bandwidth, up: true})\n    } else {\n      throw new TypeError(`Could not parse link info data, ${data}`)\n    }\n  }\n}\n\nexport class LinkInfos {\n  static parse(data) {\n    let linkInfos = new LinkInfos()\n    forEach(data, (linkInfo, peerId) => {\n      linkInfos[peerId] = LinkInfo.parse(linkInfo)\n    })\n    return linkInfos\n  }\n\n  toString() {\n    return `linkInfos{${Object.keys(this).map(peerId => `${peerId}:${this[peerId]}`).join(',')}}`\n  }\n}\n\nconst INDEX_UP_STATE_CHANGE_SIZE = 10\n\nexport class PeerTopologyInfo {\n  static parseUpdate(data) {\n    if (!Array.isArray(data)) {\n      return data\n    }\n    let [power, links] = data\n    return {\n      power,\n      links: LinkInfos.parse(links),\n    }\n  }\n\n  constructor(peerId, onChange) {\n    this._peerId = peerId\n    this._onChange = onChange\n    this._topologyIndex = 1\n\n    this._links = new LinkInfos()\n    this._power = 1\n  }\n\n  toString() {\n    return `peerTopologyInfo{peerId=${this._peerId},power=${this._power},${this._links}}`\n  }\n\n  toJSON() {\n    return [this._power, this._links]\n  }\n\n  get links() {\n    return this._links\n  }\n\n  get power() {\n    return this._power\n  }\n\n  get volume() {\n    return this._volume\n  }\n\n  get topologyIndex() {\n    return this._topologyIndex\n  }\n\n  _update({topologyInfo, topologyIndex, volume}) {\n    this._volume = volume\n    if (!topologyInfo) {\n      return\n    }\n    argCheck.number('PeerTopologyInfo._update', 'topologyIndex', topologyIndex)\n    if (topologyIndex < this._topologyIndex) {\n      return\n    }\n    argCheck.options('PeerTopologyInfo._update', 'topologyInfo', topologyInfo)\n      .number('power')\n      .instance('links', LinkInfos)\n    this._links = topologyInfo.links\n    this._power = topologyInfo.power\n    let indexChange = topologyIndex - this._topologyIndex\n    this._topologyIndex = topologyIndex\n    log.verbose(TAG, this, `updated peer topology info by ${indexChange} indices`)\n    this._onChange(indexChange >= INDEX_UP_STATE_CHANGE_SIZE)\n  }\n\n  _invalidate() {\n    this._links = null\n    this._onChange = null\n  }\n}\n\nexport class LocalTopologyInfo {\n  constructor({power, voiceActivityDetector, onUpdate}) {\n    this._handleUpdate = this._handleUpdate.bind(this)\n\n    this._links = new LinkInfos()\n    this._power = power\n    this._voiceActivityDetector = voiceActivityDetector\n    this._topologyIndex = 1\n    this._onUpdate = onUpdate\n  }\n\n  get links() {\n    return this._links\n  }\n\n  get power() {\n    return this._power\n  }\n\n  get topologyIndex() {\n    return this._topologyIndex\n  }\n\n  get volume() {\n    if (this._voiceActivityDetector) {\n      return this._voiceActivityDetector.volume\n    } else {\n      return 0\n    }\n  }\n\n  setVoiceActivityDetectorActive(active) {\n    if (this._voiceActivityDetector) {\n      this._voiceActivityDetector.setActive(active)\n    }\n  }\n\n  addPeer(peerId) {\n    if (this._links.hasOwnProperty(peerId)) {\n      throw new Error(`LocalTopologyInfo already has a peer with id ${peerId}`)\n    }\n    let linkInfo = new LinkInfo({onUpdate: this._handleUpdate})\n    this._links[peerId] = linkInfo\n    return linkInfo\n  }\n\n  removePeer(peerId) {\n    let linkInfo = this._links[peerId]\n    if (!linkInfo) {\n      throw new Error(`LocalTopologyInfo failed to delete nonexistent peer, ${peerId}`)\n    }\n    delete this._links[peerId]\n  }\n\n  toString() {\n    let infoStrings = map(this._links, (linkInfo, peerId) => {\n      return `${peerId}:${linkInfo}`\n    })\n    return `localTopology{power=${this._power},${infoStrings.join(',')}}`\n  }\n\n  toJSON() {\n    return [this._power, this._links]\n  }\n\n  _handleUpdate(changedUpState) {\n    this._topologyIndex += changedUpState ? INDEX_UP_STATE_CHANGE_SIZE : 1\n    this._onUpdate(changedUpState)\n  }\n\n  _invalidate() {\n  }\n}\n\nexport default class MeshTopology {\n  constructor({ownId, power = 1, voiceActivityDetector = null}) {\n    this._onChange = this._onChange.bind(this)\n\n    this._localTopologyInfo = new LocalTopologyInfo({\n      power,\n      voiceActivityDetector,\n      onUpdate: this._onLocalTopologyUpdate.bind(this),\n    })\n    this._topologyInfos = new Map()\n    this._changeListeners = new Set()\n    this._ownId = ownId\n    this._active = false\n  }\n\n  toString() {\n    if (this._topologyInfos.size === 0) {\n      return `meshTopology{ownId=${this._ownId},${this._localTopologyInfo}}`\n    }\n    return `meshTopology{ownId=${this._ownId},${[...this._topologyInfos.values()].join(',')}}`\n  }\n\n  get topologyInfos() {\n    return this._topologyInfos\n  }\n\n  get localTopologyInfo() {\n    return this._localTopologyInfo\n  }\n\n  get active() {\n    return this._active\n  }\n\n  // The mesh topology instance is only active when in the leader state\n  // Being active means that it is possible to add, remove, and update peer link info,\n  // and that changes will be signaled through the change listener\n  activate() {\n    log.debug(TAG, `activating ${this}`)\n    this._active = true\n    this._topologyInfos.clear()\n    this._topologyInfos.set(this._ownId, this._localTopologyInfo)\n    this._onChange(true)\n  }\n\n  deactivate() {\n    log.debug(TAG, `deactivating ${this}`)\n    this._active = false\n    this._topologyInfos.forEach(peerTopologyInfo => peerTopologyInfo._invalidate())\n    this._topologyInfos.clear()\n    this._onChange(true)\n  }\n\n  invalidate() {\n    this._changeListeners.clear()\n    this.deactivate() // change listeners will not be called, since we cleared them\n    this._changeListeners = null\n    this._ownId = null\n    this._localTopologyInfo._invalidate()\n    this._localTopologyInfo = null\n    this._topologyInfos = null\n  }\n\n  addClient(peerId) {\n    if (!this._active) {\n      throw new Error('Tried to add client while MeshTopology was deactivated')\n    }\n    if (this._topologyInfos.has(peerId)) {\n      throw new Error('Tried to add existing client to MeshTopology')\n    }\n    let peerTopologyInfo = new PeerTopologyInfo(peerId, this._onChange)\n    this._topologyInfos.set(peerId, peerTopologyInfo)\n    log.debug(TAG, this, `adding client: ${peerId},  ${peerTopologyInfo}`)\n    this._onChange(false) // links will be added later\n    return peerTopologyInfo\n  }\n\n  removeClient(peerId) {\n    if (!this._active) {\n      throw new Error('Tried to remove client while MeshTopology was deactivated')\n    }\n    if (!this._topologyInfos.has(peerId)) {\n      throw new Error('Tried to remove missing client from MeshTopology')\n    }\n    this._topologyInfos.delete(peerId)\n    log.debug(TAG, this, `removed client: ${peerId}`)\n    this._onChange(true)\n  }\n\n  addChangeListener(listener) {\n    this._changeListeners.add(listener)\n  }\n\n  removeChangeListener(listener) {\n    this._changeListeners.delete(listener)\n  }\n\n  _onChange(changedUpState) {\n    this._changeListeners.forEach(listener => listener(this, changedUpState))\n  }\n\n  _onLocalTopologyUpdate(changedUpState) {\n    this._onChange(changedUpState)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/meshTopology.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {isObject} from 'common/utils'\n\nimport {isMediaNode, inputs} from 'media/common'\n\nconst TAG = 'media-node-input'\n\n/**\n * @callback MediaNodeInput~OnStreamCallback\n * @param {?MediaStream} stream - The current media stream, or null.\n * @param {?MediaStream} oldStream - The previous media stream, or null.\n */\n\n/**\n * A class which represents an input of a {@link MediaNode}. Outputs are connected to\n * inputs in order to forward media streams.\n *\n * This class should only be used within the implementation of {@link MediaNode}s. While it\n * is possible to attach inputs to an existing media node, it should be avoided. Use an additional\n * media node to implement the desired behaviour instead, such as a {@link Passthrough}.\n *\n * @class MediaNodeInput\n * @param {Object} options - Options object.\n * @param {string} options.name - The name of the output, should be 'default' for single inputs.\n * @param {MediaNode} options.parent - The parent media node.\n * @param {MediaNodeInput~OnStreamCallback} options.parent - A callback that will be called whenever\n * the stream of this media node changes.\n */\nexport default class MediaNodeInput {\n  constructor({name, parent, onStream}) {\n    argCheck.string('MediaNodeInput constructor', 'name', name)\n    if (!isMediaNode(parent)) {\n      argCheck.error('MediaNodeInput constructor', 'parent', 'be a MediaNode')\n    }\n    argCheck.func('MediaNodeInput constructor', 'onStream', onStream)\n    this._name = name\n    this._parent = parent\n    this._onStream = onStream\n    this._output = null\n    this._stream = null\n\n    this._parent[inputs].add(this)\n  }\n\n  toString() {\n    return `mediaNodeInput{name=${this.name},parent=${this._parent}}`\n  }\n\n  /**\n   * Resolves the input of a target. If the lookup fails, an error will be thrown.\n   *\n   * Inputs are resolved as follows, starting with a target:\n   *   1. If the current target is a {@link MediaNodeInput} instance, stop and return the target.\n   *   2. If the target is an object, set the new target to the `input` property of the target, and start over.\n   *   3. Throw error.\n   *\n   * If a circular input object structure is encountered, an error will be thrown.\n   *\n   * @param {MediaNodeInput|Object} target - The target to resolve the input of.\n   * @returns {MediaNodeInput} The resolved input.\n   */\n  static resolve(target) {\n    let chain = [target]\n    for (;;) {\n      if (target instanceof MediaNodeInput) {\n        return target\n      } else if (!isObject(target)) {\n        throw new TypeError(`failed to resolve input of ${chain[0] && chain[0].constructor.name}, ` +\n          'input must be a MediaNodeInput or have an input property')\n      } else if ('input' in target) {\n        try {\n          target = target.input\n        } catch (error) {\n          throw new TypeError(`failed to resolve input of ${chain[0].constructor.name}, ` +\n            `getting input property of ${target} threw error: ${error.message}`)\n        }\n        if (chain.indexOf(target) !== -1) {\n          throw new TypeError(`failed to resolve input of ${chain[0].constructor.name}, ` +\n            'encountered loop in input property chain')\n        }\n        chain.push(target)\n      } else {\n        throw new TypeError(`failed to resolve input of ${chain[0].constructor.name}, ` +\n          `${target.constructor.name} does not have an input property`)\n      }\n    }\n  }\n\n  /**\n   * The name of this input. This is only meaningful for inputs that belong to media nodes with\n   * multiple inputs.\n   *\n   * Any input that belong to one of the base media node implementations, such as {@link MediaSink},\n   * will have the name `'default'`.\n   *\n   * @readonly\n   * @member {string} MediaNodeInput#name\n   */\n  get name() {\n    return this._name\n  }\n\n  /**\n   * The current target of this input.\n   *\n   * The input will always be set to the {@link MediaNodeOutput} that the input is connected to,\n   * and not the media node that the connect might have been called on.\n   *\n   * @readonly\n   * @member {ReadOnlySet<MediaNodeInput>} MediaNodeInput#target\n   */\n  get target() {\n    return this._target\n  }\n\n  /**\n   * The inputs's current media stream, or null.\n   *\n   * @readonly\n   * @member {MediaStream} MediaNodeInput#stream\n   */\n  get stream() {\n    return this._stream\n  }\n\n  /**\n   * Detaches the input from it's parent and removes any connection. Use this to clean up inputs\n   * in media nodes with dynamic inputs, such as a media mixer. After this method has been called\n   * the input can no longer be used.\n   *\n   * This method is internal and should only be called by the implementation of the parent media node.\n   */\n  detach() {\n    if (this._target) {\n      this._target.disconnect(this)\n    }\n    this._parent[inputs].delete(this)\n    this._parent = null\n  }\n\n  _disconnect(target) {\n    if (this.target !== target) {\n      log.error(TAG, `invalid input disconnect state, expected target ${target} but was ${this.target}`)\n    }\n    this._target = null\n    this._setStream(null)\n  }\n\n  _setStream(stream) {\n    if (this._stream === stream) {\n      return\n    }\n    let oldStream = this._stream\n    this._stream = stream\n    try {\n      this._onStream(stream, oldStream)\n    } catch (error) {\n      log.error(TAG, `Error thrown in onStream: ${error}`)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaNodeInput.js","'use strict'\n\nimport log from 'common/log'\n\nimport MediaSink from 'media/mediaSink'\n\nconst TAG = 'html-sink'\n\nconst replacement = Symbol('sink-replacement')\n\n/**\n * A media sink that renders to a target HTML media element, either `<audio>` or `<video>`.\n *\n * @class HtmlSink\n * @extends MediaSink\n * @param {Object} [options] - Optional options object.\n * @param {external:HTMLMediaElement} target - The target HTML element.\n */\nexport default class HtmlSink extends MediaSink {\n  constructor({target = null} = {}) {\n    super()\n    let bail = 0\n    while (target && target[replacement] && bail < 5) {\n      target = target[replacement]\n      bail += 1\n    }\n    if (bail >= 5) {\n      log.error(TAG, 'HtmlSink got stuck in element replacement loop')\n    }\n    this._target = target\n    this._refreshSink = this._refreshSink.bind(this)\n    this._refreshTick = null\n  }\n\n  /**\n   * The target HTML element to render to.\n   *\n   * This can be updated at any time.\n   *\n   * @member {external:HTMLMediaElement} HtmlSink#target\n   */\n  get target() {\n    return this._target\n  }\n\n  set target(target) {\n    if (this._target) {\n      this._cleanup()\n    }\n    this._target = target || null\n    if (target) {\n      this._assign()\n    }\n  }\n\n  _hasTarget(target) {\n    if (this._target === target) {\n      return true\n    } else if (this._target === target[replacement]) {\n      return true\n    }\n    return false\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  onStream(stream, oldStream) {\n    if (oldStream) {\n      if (oldStream.removeEventListener) {\n        oldStream.removeEventListener('addtrack', this._refreshSink)\n        oldStream.removeEventListener('removetrack', this._refreshSink)\n      } else {\n        oldStream.detachEvent('addtrack', this._refreshSink)\n        oldStream.detachEvent('removetrack', this._refreshSink)\n      }\n    }\n    if (stream) {\n      if (stream.addEventListener) {\n        stream.addEventListener('addtrack', this._refreshSink)\n        stream.addEventListener('removetrack', this._refreshSink)\n      } else {\n        stream.attachEvent('addtrack', this._refreshSink)\n        stream.attachEvent('removetrack', this._refreshSink)\n      }\n    }\n    if (!this._refreshTick) {\n      this._refreshTick = Promise.reject().catch(() => {\n        this._refreshTick = null\n        if (this.stream !== oldStream) {\n          this._refreshSink()\n        }\n      })\n    }\n  }\n\n  _cleanup() {\n    if (this._target && (this._target instanceof HTMLMediaElement)) {\n      if (this._target.srcObject) {\n        this._target.srcObject = null\n      } else if (this._target.src) {\n        this._target.src = ''\n      }\n    } else {\n      this._target = window.attachMediaStream(this._target, null)\n    }\n  }\n\n  _assign() {\n    if (this.stream) {\n      try {\n        let originalElement = this._target\n        this._target = window.attachMediaStream(this._target, this.stream)\n        if (originalElement instanceof HTMLMediaElement) {\n          originalElement[replacement] = this._target\n        }\n      } catch (error) {\n        log.info(TAG, `Error when assigning html sink stream: ${error}`)\n      }\n      try {\n        let result = this._target.play()\n        if (result && result.catch) {\n          result.catch(error => {\n            log.debug(TAG, `Failed to play stream, ${error}`)\n          })\n        }\n      } catch (error) {\n        log.info(TAG, `Error when playing html sink stream: ${error}`)\n      }\n    }\n  }\n\n  _refreshSink() {\n    if (this._target) {\n      this._cleanup()\n      this._assign()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/htmlSink.js","'use strict'\n\nimport argCheck from 'common/argCheck'\n\n/**\n * A base class for components that can be attached to both {@link Call}s and {@link Conference}s.\n *\n * Subclasses have a number of lifecycle methods that can be overriden to implement actions during\n * various parts of a call or conference.\n *\n * RtcComponents that are attached will be able to interact with other remote components, as long as the\n * components are compatible. An example is two users in a call that both attach a {@link DataShare}\n * component to the same point. The two data shares will then synchronize data, as long as the calls\n * are connected.\n *\n * The purpose of the `label` and `remoteLabel` configuration is to make sure that components are compatible\n * before connecting. A component is compatible with another component if the label is equal to the\n * remote label, or match in the case where the remote label is a RegExp. If components are not compatible\n * they will not be connected, so the peer will not show up in the {@link AttachPoint#peers} collection.\n *\n * @class RtcComponent\n * @abstract\n * @param {Object} config - Configuration object.\n * @param {string} config.label - The label that remote components will be matched against. Only components\n *   with matching labels can interact with each other.\n * @param {string|Regex} [config.remoteLabel] - The expected remote component label, defaults to the own label.\n */\nexport default class RtcComponent {\n  constructor(config) {\n    if (this.constructor === RtcComponent) {\n      throw new TypeError('RtcComponent must be subclassed')\n    }\n    argCheck.options('RtcComponent', 'config', config)\n      .string('label')\n      .optString('remoteLabel')\n    let {label, remoteLabel = null} = config\n    this._label = label\n    this._remoteLabel = remoteLabel\n  }\n\n  /**\n   * True if the component is currently attached to anything.\n   *\n   * @readonly\n   * @member {boolean} RtcComponent#attached\n   */\n  get attached() {\n    return !!this._attachPoint\n  }\n\n  /**\n   * Returns the current attachment point. This should only be accessed from within the component\n   * implementation. An error will be thrown if you try to access this member when the component\n   * is not attached.\n   *\n   * @readonly\n   * @member {AttachPoint} RtcComponent#attachPoint\n   */\n  get attachPoint() {\n    if (!this._attachPoint) {\n      throw new Error('RtcComponent tried to access attachPoint while not attached.')\n    }\n    return this._attachPoint\n  }\n\n  set attachPoint(value) {\n    throw new TypeError('RtcComponent.attachPoint is read-only.')\n  }\n\n  /**\n   * A overridable method that is called when the component is about to be attached to something.\n   * When this method is called, {@link RtcComponent#attachPoint} will not yet have been set, but\n   * the attachment point can be accessed through the parameter.\n   *\n   * If this method throws an error, the component will fail to attach. The error will be caught and\n   * handled by logging an error, but the program flow will continue.\n   *\n   * This method will always the followed by a call to {@link RtcComponent#rtcComponentWillDetach}.\n   *\n   * @abstract\n   * @param {AttachPoint} attachPoint - The point that the component will be attached to.\n   */\n  rtcComponentWillAttach(attachPoint) {}\n\n  /**\n   * This method is called whenever a peer is added to the {@link AttachPoint#peers} collection of the\n   * attach point.\n   *\n   * Only peers to who we have an active connection and who have mounted a matching component will be\n   * visible.\n   *\n   * This method will always be followed by a call to {@link RtcComponent#rtcComponentDidLosePeer} for\n   * the given peer. It will also only ever be called while the component is attached.\n   *\n   * @abstract\n   * @param {RtcPeer} peer - The added peer.\n   */\n  rtcComponentDidReceivePeer(peer) {}\n\n  /**\n   * This method is called whenever an update to this component's {@link AttachData} occurs.\n   *\n   * This method will only be called for active peers, which means that it is always happens after\n   * the {@link RtcComponent#rtcComponentDidReceivePeer} call for a peer, and before\n   * {@link RtcComponent#rtcComponentDidLosePeer}. It will also only ever be called while the component\n   * is attached.\n   *\n   * @abstract\n   * @param {Object} update - An object that describes the update that happened.\n   * @param {string} update.key - The key that was updated.\n   * @param {JsonTypes} update.value - The new value.\n   * @param {JsonTypes} update.oldValue - The old value.\n   * @param {string} update.ownerId - The id of the owner, if it was set.\n   */\n  rtcComponentUpdatedData({key, value, oldValue, ownerId}) {}\n\n  /**\n   * This method is called whenever a peer opens a data channel. The channel will be ready to use as\n   * soon as this method is called.\n   *\n   * When this method is called the channel will already have been added to the collection returned by\n   * {@link RtcPeer#getRemoteChannels}.\n   *\n   * This method will only be called for active peers, which means that it is always happens after\n   * the {@link RtcComponent#rtcComponentDidReceivePeer} call for a peer, and before\n   * {@link RtcComponent#rtcComponentDidLosePeer}. It will also only ever be called while the component is attached.\n   *\n   * @abstract\n   * @param {RtcPeer} peer - The peer that created the channel.\n   * @param {external:RTCDataChannel} channel - The opened data channel.\n   */\n  rtcComponentReceivedChannel(peer, channel) {}\n\n  /**\n   * This method is called whenever a peer is removed from the {@link AttachPoint#peers} collection of the\n   * attach point.\n   *\n   * This will happen when the connection to a peer is lost, the peer detaches their component, or when\n   * the local component is detached.\n   *\n   * This method will always preceeded by a call to {@link RtcComponent#rtcComponentDidReceivePeer}\n   * for the given peer. It will also only ever be called while the component is attached.\n   *\n   * @abstract\n   * @param {RtcPeer} peer - The peer that was lost.\n   */\n  rtcComponentDidLosePeer(peer) {}\n\n  /**\n   * Called before the component is detached. Once this method has returned the attachPoint will no longer\n   * be valid, and any attempt to call a method on the attach point will throw an error.\n   *\n   * This method will always the preceeded by a call to {@link RtcComponent#rtcComponentWillAttach}.\n   *\n   * @abstract\n   */\n  rtcComponentWillDetach() {}\n\n  _internalAttach(component) {\n    this._attachPoint = component\n  }\n\n  _internalDetach() {\n    this._attachPoint = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/rtcComponent.js","'use strict'\n\nimport CctError from 'common/errors'\n\n/**\n * An error that represents a failure to set up a connection. As opposed to the\n * {@link ConnectionLostError}, this error almost always happens when trying to\n * create a new connection.\n *\n * Attempts will be made to set up a new connection, so the\n * {@link ConnectionLostError#times} property is exposed in order to make it\n * easier for applications to decide when to give up.\n *\n * @class ConnectionFailedError\n * @extends CctError\n */\nexport class ConnectionFailedError extends CctError {\n  constructor(times) {\n    var timesStr\n    if (times % 10 === 1) {\n      timesStr = times + 'st'\n    } else if (times % 10 === 2) {\n      timesStr = times + 'nd'\n    } else if (times % 10 === 3) {\n      timesStr = times + 'rd'\n    } else {\n      timesStr = times + 'th'\n    }\n    super(`connection failed for the ${timesStr} time`)\n    this.times = times\n  }\n\n  /**\n   * The number of times that the connection has failed in a row.\n   *\n   * @readonly\n   * @member {number} ConnectionFailedError#times\n   */\n}\nConnectionFailedError.errorName = 'ConnectionFailedError'\n\n/**\n * An error that indicates that a connection that was set up successfully\n * has now been disconnected.\n *\n * An attempt will be made to restore the connection, but if that attempt fails\n * this error will be replaced with a {@link ConnectionFailedError}.\n *\n * @class ConnectionLostError\n * @extends CctError\n */\nexport class ConnectionLostError extends CctError {}\nConnectionLostError.errorName = 'ConnectionLostError'\n\n/**\n * An error that is represents a signaling failure. This error almost\n * always indicates that there is an incompatability between the endpoints\n * that are being connected, or that the particular way that the connection\n * is being set up is not supported.\n *\n * @class ConnectionSignalingError\n * @extends CctError\n */\nexport class ConnectionSignalingError extends CctError {\n  constructor(reason) {\n    super(`Connection signaling failed, ${reason}`)\n    this.reason = reason\n  }\n\n  /**\n   * The error that caused the signaling failure.\n   *\n   * @readonly\n   * @member {Error} ConnectionSignalingError#reason\n   */\n}\nConnectionSignalingError.errorName = 'ConnectionSignalingError'\n\n/**\n * The operation failed because the channel was closed.\n *\n * @class ChannelClosedError\n * @extends CctError\n */\nexport class ChannelClosedError extends CctError {}\nChannelClosedError.errorName = 'ChannelClosedError'\n\n/**\n * The channel failed due to a low-level error.\n *\n * @class ChannelFailedError\n * @extends CctError\n */\nexport class ChannelFailedError extends CctError {\n  constructor(message, reason) {\n    super(message)\n    this.reason = reason\n  }\n\n  /**\n   * The error that caused the failure.\n   *\n   * @member {Error} ChannelFailedError#reason\n   */\n}\nChannelFailedError.errorName = 'ChannelFailedError'\n\n/**\n * The channel operation timed out.\n *\n * @class ChannelTimeoutError\n * @extends CctError\n */\nexport class ChannelTimeoutError extends CctError {\n  constructor(message, timeoutMs) {\n    super(message)\n    this.timeoutMs = timeoutMs\n  }\n\n  /**\n   * The time limit that was set for the operation, in milliseconds.\n   *\n   * @member {number} ChannelTimeoutError#timeoutMs\n   */\n}\nChannelTimeoutError.errorName = 'ChannelTimeoutError'\n\n/**\n * An error that indicates that a file transfer failed because of a protocol\n * error or data corruption.\n *\n * @class FileTransferError\n * @extends CctError\n */\nexport class FileTransferError extends CctError {\n}\nFileTransferError.errorName = 'FileTransferError'\n\n/**\n * An error that indicates that the transfer was interrupted either on purpose\n * or because of connection issues.\n *\n * @class TransferInterruptedError\n * @extends CctError\n */\nexport class TransferInterruptedError extends CctError {\n  constructor(reason = null, downloadedBytes = null, expectedBytes = null) {\n    super(`Transfer ${reason} after ${downloadedBytes} out of ${expectedBytes} bytes`)\n    this.reason = reason\n    this.downloadedBytes = downloadedBytes\n    this.expectedBytes = expectedBytes\n  }\n\n  /**\n   * The reason the interruption happened.\n   *\n   * @member {string?} TransferInterruptedError#reason\n   */\n\n  /**\n   * The number of bytes that were downloaded before the interruption.\n   *\n   * @member {number?} TransferInterruptedError#downloadedBytes\n   */\n\n  /**\n   * The total number of bytes that was expected to be downloaded.\n   *\n   * @member {number?} TransferInterruptedError#expectedBytes\n   */\n}\nTransferInterruptedError.errorName = 'TransferInterruptedError'\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/errors.js","module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/get-iterator.js\n// module id = 153\n// module chunks = 0 1 5","'use strict'\n\nimport log from 'common/log'\nimport {defer} from 'common/utils'\n\nimport MediaSource from 'media/mediaSource'\n\nconst TAG = 'concrete-media-source'\n\n/**\n * A {@link MediaSource} that is backed by a single media stream from a tangible source, such\n * as a camera or microphone.\n *\n * @class ConcreteMediaSource\n */\nexport default class ConcreteMediaSource extends MediaSource {\n  constructor() {\n    super()\n    this._onInactive = this._onInactive.bind(this)\n\n    this._deferred = defer()\n    this._stopped = false\n    this._error = null\n  }\n\n  /**\n   * A promise that is resolved to the stream as soon as it is available, or rejected\n   * with an error.\n   *\n   * @readonly\n   * @member {Promise<MediaStream, Error>}\n   */\n  get promise() {\n    return this._deferred.promise\n  }\n\n  /**\n   * True if the media stream has been stopped.\n   *\n   * @readonly\n   * @member {boolean} ConcreteMediaSource#stopped\n   */\n  get stopped() {\n    return this._stopped\n  }\n\n  /**\n   * An error explaining why the stream could not be acquired, if that was the case.\n   *\n   * @readonly\n   * @member {?Error} ConcreteMediaSource#error\n   */\n  get error() {\n    return this._error\n  }\n\n  /**\n   * Signals that a backing stream could not be acquired and the source is stopped with an error.\n   *\n   * This method should only be called by the subclass implementation.\n   *\n   * @param {Error} error - The error that caused the setup to fail.\n   */\n  setError(error) {\n    if (!this._stopped) {\n      this._error = error\n      this.stop()\n      this._deferred.reject(error)\n    }\n  }\n\n  /**\n   * Sets the backing stream and signals that an error did not occur.\n   *\n   * The stream should be valid until the stop method is called.\n   *\n   * This method should only be called by the subclass implementation.\n   *\n   * @param {MediaStream} stream - The media stream.\n   */\n  setStream(stream) {\n    if (this._stopped) {\n      if (stream) {\n        this._stopStream(stream)\n      }\n    } else {\n      this._deferred.resolve(stream)\n      super.setStream(stream)\n      if (stream.addEventListener) {\n        stream.addEventListener('inactive', this._onInactive)\n      } else {\n        stream.attachEvent('inactive', this._onInactive)\n      }\n    }\n  }\n\n  /**\n   * Stops the source and cleans up all resources. This has to be called once the source\n   * is no longer used in order to clean up resources.\n   *\n   * If an error happened there is no need to call this function, although calling it will have no effect.\n   */\n  stop() {\n    if (this._stopped) {\n      return\n    }\n    this._stopped = true\n    let stream = this.stream\n    super.setStream(null)\n    if (stream) {\n      this._stopStream(stream)\n    }\n  }\n\n  _onInactive() {\n    this.stop()\n  }\n\n  _stopStream(stream) {\n    stream.getTracks().forEach(track => {\n      try {\n        track.stop()\n      } catch (error) {\n        log.error(TAG, 'failed to stop media stream track:', error)\n      }\n    })\n    if (stream.removeEventListener) {\n      stream.removeEventListener('inactive', this._onInactive)\n    } else {\n      stream.detachEvent('inactive', this._onInactive)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/concreteMediaSource.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {isObject, ReadOnlySet} from 'common/utils'\n\nimport {isMediaStream} from 'webrtc/utils'\n\nimport {isMediaNode, outputs} from 'media/common'\nimport MediaNodeInput from 'media/mediaNodeInput'\n\nconst TAG = 'media-node-output'\n\n/**\n * A class which represents an output of a {@link MediaNode}. Outputs are connected to\n * inputs in order to forward media streams.\n *\n * This class should only be used within the implementation of {@link MediaNode}s. While it\n * is possible to attach outputs to an existing media node, it should be avoided. Use an additional\n * media node to implement the desired behaviour instead, such as a {@link Passthrough}.\n *\n * @class MediaNodeOutput\n * @param {Object} options - Options object.\n * @param {string} options.name - The name of the output, should be 'default' for single outputs.\n * @param {MediaNode} options.parent - The parent media node.\n */\nexport default class MediaNodeOutput {\n  constructor({name, parent}) {\n    argCheck.string('MediaNodeInput constructor', 'name', name)\n    if (!isMediaNode(parent)) {\n      argCheck.error('MediaNodeInput constructor', 'parent', 'be a MediaNode')\n    }\n    this._name = name\n    this._parent = parent\n    this._targets = new ReadOnlySet()\n    this._stream = null\n\n    this._parent[outputs].add(this)\n  }\n\n  toString() {\n    return `mediaNodeOutput{name=${this.name},parent=${this._parent},targets=${this._targets.size}}}`\n  }\n\n  /**\n   * Resolves the output of a target. If the lookup fails, an error will be thrown.\n   *\n   * Outputs are resolved as follows, starting with a target:\n   *   1. If the current target is a {@link MediaNodeOutput} instance, stop and return the target.\n   *   2. If the target is an object, set the new target to the `output` property of the target, and start over.\n   *   3. Throw error.\n   *\n   * If a circular output object structure is encountered, an error will be thrown.\n   *\n   * @param {MediaNodeOutput|Object} target - The target to resolve the output of.\n   * @returns {MediaNodeOutput} The resolved output.\n   */\n  static resolve(target) {\n    let chain = [target]\n    for (;;) {\n      if (target instanceof MediaNodeOutput) {\n        return target\n      } else if (!isObject(target)) {\n        throw new TypeError(`failed to resolve output of ${chain[0] && chain[0].constructor.name}, ` +\n          'output must be a MediaNodeOutput or have an output property')\n      } else if ('output' in target) {\n        try {\n          target = target.output\n        } catch (error) {\n          throw new TypeError(`failed to resolve output of ${chain[0].constructor.name}, ` +\n            `getting output property of ${target} threw error: ${error.message}`)\n        }\n        if (chain.indexOf(target) !== -1) {\n          throw new TypeError(`failed to resolve output of ${chain[0].constructor.name}, ` +\n            'encountered loop in output property chain')\n        }\n        chain.push(target)\n      } else {\n        throw new TypeError(`failed to resolve output of ${chain[0].constructor.name}, ` +\n          `${target.constructor.name} does not have an output property`)\n      }\n    }\n  }\n\n  /**\n   * The name of this output. This is only meaningful for outputs that belong to media nodes with\n   * multiple outputs.\n   *\n   * Any output that belong to one of the base media node implementations, such as {@link MediaSource},\n   * will have the name `'default'`.\n   *\n   * @readonly\n   * @member {string} MediaNodeOutput#name\n   */\n  get name() {\n    return this._name\n  }\n\n  /**\n   * A read-only set of all the current targets of the output.\n   *\n   * The set will only contain resolved inputs, and not the original targets given to the connect method.\n   *\n   * @readonly\n   * @member {ReadOnlySet<MediaNodeInput>} MediaNodeOutput#targets\n   */\n  get targets() {\n    return this._targets\n  }\n\n  /**\n   * The output's current media stream, or null.\n   *\n   * @readonly\n   * @member {MediaStream} MediaNodeOutput#stream\n   */\n  get stream() {\n    return this._stream\n  }\n\n  /**\n   * Connect this output to a target. Each output can be connected to multiple targets.\n   *\n   * @param {MediaNodeConnectTarget} target - The target to connect the output to.\n   */\n  connect(target) {\n    if (!this._parent) {\n      return log.error(TAG, 'tried to connect a detached ouput')\n    }\n\n    if (target instanceof HTMLElement) {\n      // require here to avoid circular dependency\n      const HtmlSink = require('media/htmlSink').default\n      let sink = new HtmlSink({target})\n      this.connect(sink)\n      return\n    }\n\n    target = MediaNodeInput.resolve(target)\n    log.info(TAG, `connecting ${this} to ${target}`)\n    if (this._targets.has(target)) {\n      log.verbose(TAG, 'ignored connect with same target')\n      return\n    }\n    if (!target._parent) {\n      return log.error(TAG, 'tried to connect to a detached input')\n    }\n    if (target._target) {\n      log.debug(TAG, `disconnecting target's existing target: ${target._target}`)\n      target._target.disconnect(target)\n    }\n    log.debug(TAG, `connecting to new target: ${target}`)\n    this._targets._add(target)\n    target._target = this\n    target._setStream(this._stream)\n  }\n\n  /**\n   * Disconnect this output from a target.\n   *\n   * If no target is specified, all targets will be disconnected.\n   *\n   * @param {MediaNodeConnectTarget} [target] - The target to disconnect from.\n   */\n  disconnect(target) {\n    if (!this._parent) {\n      log.error(TAG, 'tried to disconnect a detached ouput')\n      return\n    }\n    if (this._targets.size === 0) {\n      log.warning(TAG, `tried to disconnect ${this}, but it is not connected to anything`)\n      return\n    }\n\n    if (target instanceof HTMLElement) {\n      // Iterate through the targets and find html sinks with the input as target\n      this._targets.forEach(possibleSinkInput => {\n        // require here to avoid circular dependency\n        const HtmlSink = require('media/htmlSink').default\n        let isHtmlSink = possibleSinkInput._parent instanceof HtmlSink\n        let sinkHasTargetAsTarget = possibleSinkInput._parent._hasTarget(target)\n        if (isHtmlSink && sinkHasTargetAsTarget) {\n          this.disconnect(possibleSinkInput)\n        }\n      })\n    } else if (target) {\n      target = MediaNodeInput.resolve(target)\n      log.info(TAG, `disconnecting ${this} from ${target}`)\n      if (this._targets._delete(target)) {\n        target._target = null\n        target._setStream(null)\n      } else {\n        throw new Error(`failed to disconnect ${this} from ${target}, not connected`)\n      }\n    } else {\n      log.info(TAG, `disconnecting ${this} from all ${this._targets.size} targets`)\n      this._targets.forEach(target => {\n        log.info(TAG, `disconnecting ${this} from ${target}`)\n        target._target = null\n        target._setStream(null)\n      })\n      this._targets._clear()\n    }\n  }\n\n  /**\n   * Sets the current stream of this output.\n   *\n   * This method is internal and should only be called by the implementation of the parent media node.\n   *\n   * @param {MediaStream} stream - A media stream, or null.\n   */\n  setStream(stream) {\n    if (!this._parent) {\n      return log.error(TAG, 'tried to setStream of a detached ouput')\n    }\n    if (stream === null || isMediaStream(stream)) {\n      this._stream = stream\n      this._targets.forEach(target => target._setStream(stream))\n    } else {\n      argCheck.error('MediaNodeOutput.setStream', 'stream', 'be a MediaStream or null')\n    }\n  }\n\n  /**\n   * Detaches the output from it's parent and removes any connections. Use this to clean up outputs\n   * in media nodes with dynamic outputs, such as a media demultiplexer. After this method has been called\n   * the input can no longer be used.\n   *\n   * This method is internal and should only be called by the implementation of the parent media node.\n   */\n  detach() {\n    this.disconnect()\n    this._parent[outputs].delete(this)\n    this._parent = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaNodeOutput.js","'use strict'\n\nimport log from 'common/log'\n\nimport MediaNode from 'media/mediaNode'\nimport MediaNodeInput from 'media/mediaNodeInput'\n\nconst TAG = 'media-input'\n\n/**\n * A base class for media nodes with a single input and no output. Typically used to render\n * the stream, or as a base for nodes with multiple outputs.\n *\n * The subclass should override the `onStream` method.\n *\n * @class MediaSink\n * @extends MediaNode\n */\nexport default class MediaSink extends MediaNode {\n  constructor() {\n    super()\n    this._input = new MediaNodeInput({\n      name: 'default',\n      parent: this,\n      onStream: (stream, oldStream) => this.onStream(stream, oldStream),\n    })\n  }\n\n  /**\n   * The current input stream.\n   *\n   * @readonly\n   * @member {MediaStream} MediaSink#stream\n   */\n  get stream() {\n    return this._input.stream\n  }\n\n  /**\n   * The input.\n   *\n   * @readonly\n   * @member {MediaNodeInput} MediaSink#input\n   */\n  get input() {\n    return this._input\n  }\n\n  /**\n   * Abstract method that is called whenever the input stream is updated, this should\n   * be overridden by the subclass.\n   *\n   * This will only ever be called if the stream has changed, been added, or removed,\n   * i.e. stream and oldStream will never be equal.\n   *\n   * The `onStream` method will not be called when the backing tracks of a stream is changed.\n   * If the subclass needs to be notified of track updates this has to be done manually using\n   * the MediaStream listeners.\n   *\n   * @abstract\n   * @param {?MediaStream} stream - The new media stream, or null.\n   * @param {?MediaStream} oldStream - The old media stream, or null.\n   */\n  onStream(stream, oldStream) {\n    log.warning(TAG, `${this.constructor.name}.onStream should be overridden`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaSink.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport {assertPriv, priv, prop} from 'common/utils'\n\nexport function createImageResourceFactory(baseUri) {\n  var cache = {}\n  return function (uri) {\n    var resource = cache[uri] = cache[uri] || priv(ImageResource, uri, baseUri)\n    return resource\n  }\n}\n\n// eslint-disable-next-line\n/**\n * Represents a server-side image resource.\n *\n * This class provides a link to an image, as well as the possibility to thumbnail the image.\n *\n * @abstract\n * @class ImageResource\n */\nexport default function ImageResource(priv, resourceUri, baseUri) {\n  assertPriv('ImageResource', priv)\n  var match = resourceUri.match(/mxc:\\/\\/([^\\/]+\\/[^\\/#]+)(#.+)?$/)\n  if (!match) {\n    throw new TypeError('ImageResource: invalid resource url ', resourceUri)\n  }\n  var resourceId = match[1]\n  var fragment = match[2] || ''\n\n  var thumbnailUri = baseUri + '/_matrix/media/v1/thumbnail/' + resourceId\n  var downloadUri = baseUri + '/_matrix/media/v1/download/' + resourceId + fragment\n\n  /**\n   * The uri to the image\n   * @readonly\n   * @member {string} ImageResource#uri\n   */\n  prop(this, 'uri', downloadUri)\n\n  /**\n   * The original resource uri of the resource, of the form `mxc://...`\n   * @readonly\n   * @member {MatrixContentUri} ImageResource#resourceUri\n   */\n  prop(this, 'resourceUri', resourceUri)\n\n  /**\n   * Generates a thumbnail uri for the image resource\n   *\n   * @name ImageResource#thumbnail\n   * @function\n   * @param {number} width - The request width of the thumbnail\n   * @param {number} height=width - The request height of the thumbnail\n   * @param {'scale'|'crop'} resizeMethod='scale' - The method used for resizing the image.\n   *  'scale' will try to\n   * @returns {string} - A thumbnail uri for the image\n   */\n  prop(this, 'thumbnail', function (width, height, resizeMethod) {\n    argCheck.count('ImageResource.thumbnail', 1, arguments.length)\n    argCheck.number('ImageResource.thumbnail', 'width', width)\n    if (arguments.length === 1) {\n      height = width\n      resizeMethod = 'scale'\n    } else if (arguments.length === 2) {\n      argCheck.number('ImageResource.thumbnail', 'height', height)\n      resizeMethod = 'scale'\n    } else {\n      argCheck.values('ImageResource.thumbnail', 'resizeMethod', resizeMethod, ['scale', 'crop'])\n    }\n    var query = '?width=' + width + '&height=' + height + '&method=' + resizeMethod\n    return thumbnailUri + query + fragment\n  })\n}\n\nImageResource.prototype.toString = function () {\n  return this.uri\n}\n\n/**\n * Represents a media upload.\n *\n * @abstract\n * @class ImageUpload\n * @extends EventEmitter\n */\n\n/**\n * A promise which resolves to an ImageResource for the uploaded media file.\n *\n * ##### Errors:\n * - {@link GuestAccessError} - Guest access is not allowed.\n * - {@link AuthenticationError} - The client must be authenticated to use this method.\n *\n * @member ImageUpload#promise {Promise<ImageResource, CctError>}\n */\n\n/**\n * Emitted when the progress of the upload is updated\n * @event ImageUpload#progress\n * @param {number} progress - The progress of the upload as a value between 0 and 1\n */\n\n/**\n * @typedef {string} MatrixContentUri\n * A string in uri form with the protocol \"mxc\", the hostname of the originating\n * server, and a resource id as the path.\n */\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/resources.js","'use strict'\n\nimport log from 'common/log'\nimport CctError from 'common/errors'\nimport {\n  assign,\n  defer,\n  map,\n  shallowCopy,\n} from 'common/utils'\n\nimport EmitterMixin from 'common/emitter'\n\nexport class RequestError extends CctError {\n  constructor(message, xhrStatus) {\n    super(message)\n    this.xhrStatus = xhrStatus\n  }\n}\nRequestError.errorName = 'RequestError'\n\nexport class ResponseError extends CctError {}\nResponseError.errorName = 'ResponseError'\n\nexport class JsonResponse {}\n\nexport default function Request(copy) {\n  if (!this) {\n    return new Request()\n  }\n  copy = copy || {}\n  this._origin = copy._origin || ''\n  this._path = copy._path || []\n  this._params = copy._params || {}\n  this._query = copy._query || {}\n  this._config = copy._config || {}\n  this._headers = copy._headers || {}\n  this._client = copy._client || Request.DEFAULT_CLIENT\n  this._errorHandler = copy._errorHandler\n  this._fragment = copy._fragment || ''\n}\n\nRequest.prototype = {\n  constructor: Request,\n  tag: 'request',\n\n  toString: function () {\n    var origin = this._origin\n    var path = 'path=' + this._path.join('/')\n    var params = 'params=[' + map(this._params, function (value, key) {\n      return key + '=' + value\n    }).join(',') + ']'\n    var query = Object.keys(this._query)\n\n    return 'request{' + [origin, path, params, query].join(',') + '}'\n  },\n\n  path: function () {\n    var copy = new Request(this)\n    copy._path = copy._path.concat.apply(copy._path, arguments)\n    return copy\n  },\n  origin: function (origin) {\n    var copy = new Request(this)\n    copy._origin = origin\n    return copy\n  },\n  client: function (client) {\n    var copy = new Request(this)\n    copy._client = client\n    return copy\n  },\n  errorHandler: function (errorHandler) {\n    var copy = new Request(this)\n    copy._errorHandler = errorHandler\n    return copy\n  },\n  fragment: function (fragment) {\n    var copy = new Request(this)\n    copy._fragment = fragment\n    return copy\n  },\n\n  // The below methods append values to each respective object prepresentation\n  // If an object is passed as the first argument, all key-value pairs are copied,\n  // If a string is passed as first argument, it will be used as key while the second\n  // argument will be used as value.\n  // e.g. req.headers({'x-ample': 'text'}) or req.headers('x-ample', 'test')\n\n  // will be serialized to a query string when sendings a request\n  query: function (obj, value) {\n    var copy = new Request(this)\n    var query = shallowCopy(this._query)\n    if (typeof(obj) === 'string') {\n      query[obj] = value\n    } else {\n      assign(query, obj)\n    }\n    copy._query = query\n    return copy\n  },\n  // substitutes any key that is found within braces in the url with the value of the param\n  // e.g. {userId: 'test'} will change /users/{userId}/ to /users/test/\n  params: function (obj, value) {\n    var copy = new Request(this)\n    var params = shallowCopy(this._params)\n    if (typeof(obj) === 'string') {\n      params[obj] = value\n    } else {\n      assign(params, obj)\n    }\n    copy._params = params\n    return copy\n  },\n  // HTTP headers...\n  header: function (obj, value) {\n    var copy = new Request(this)\n    var headers = shallowCopy(this._headers)\n    if (typeof(obj) === 'string') {\n      headers[obj] = value\n    } else {\n      assign(headers, obj)\n    }\n    copy._headers = headers\n    return copy\n  },\n  config: function (obj, value) {\n    var copy = new Request(this)\n    var config = shallowCopy(this._config)\n    if (typeof(obj) === 'string') {\n      config[obj] = value\n    } else {\n      assign(config, obj)\n    }\n    copy._config = config\n    return copy\n  },\n\n  get: function () {\n    return this._do('GET', arguments)\n  },\n\n  del: function () {\n    return this._do('DEL', arguments)\n  },\n\n  post: function () {\n    return this._do('POST', arguments)\n  },\n\n  put: function () {\n    return this._do('PUT', arguments)\n  },\n\n  _do: function (method, args) {\n    var extraPath\n    var body = null\n\n    if (method === 'POST' || method === 'PUT') {\n      if (args.length === 0) {\n        body = {}\n      } else if (args.length === 1) {\n        body = args[0]\n      } else {\n        extraPath = args[0]\n        body = args[1]\n      }\n    } else {\n      extraPath = args[0]\n    }\n\n    var options = this._compileOptions(method, extraPath, body)\n    if (this._errorHandler) {\n      options.errorHandler = this._errorHandler\n    } else {\n      options.errorHandler = error => error\n    }\n    return this._client.executeRequest(options)\n  },\n\n  _compileOptions: function (method, extraPath, body) {\n    let path = this._path.concat(extraPath || [])\n    let params = this._params\n    path = path.map(function (component) {\n      let match = component.match(/^\\{(.+)\\}$/)\n      if (match && !match[1].match(/^\\{.*\\}$/)) {\n        component = params[match[1]]\n      }\n      return encodeURIComponent(component)\n    }).join('/')\n    let url = this._origin + (path ? '/' + path : '')\n\n    let query = this._query\n    let queryString = Object.keys(query).filter(function (key) {\n      return query[key]\n    }).map(function (key) {\n      return encodeURIComponent(key) + '=' + encodeURIComponent(query[key])\n    }).join('&')\n\n    url += queryString && '?' + queryString\n    url += this._fragment && '#' + this._fragment\n\n    return {\n      headers: this._headers,\n      timeout: this._config.timeout,\n      method: method,\n      body: body,\n      url: url,\n    }\n  },\n}\n\nRequest._executeXhrWithJsonResponse = function (xhr, options, body) {\n  if (typeof(options.timeout) === 'number') {\n    xhr.timeout = options.timeout\n  }\n  let headers = options.headers\n  for (let header in headers) {\n    if (headers.hasOwnProperty(header)) {\n      xhr.setRequestHeader(header, headers[header])\n    }\n  }\n\n  function copyResponseInfoTo(res) {\n    res.status = xhr.status\n    res.statusText = xhr.statusText\n    res.url = xhr.responseURL\n    res.headers = xhr.getAllResponseHeaders().split('\\r\\n').reduce(function (obj, line) {\n      let index = line.indexOf(': ')\n      if (index > 0) {\n        obj[line.substring(0, index)] = line.substring(index + 2)\n      }\n      return obj\n    }, {})\n  }\n\n  return new Promise((resolve, reject) => {\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState !== 4) {\n        return\n      }\n      if (!xhr.status) {\n        let message = 'failed ' + options.method + ' request to ' + options.url\n        reject(new RequestError(message, xhr.status))\n        return\n      }\n\n      let res = new JsonResponse()\n      try {\n        if (xhr.responseText) {\n          res.body = JSON.parse(xhr.responseText)\n        }\n      } catch (parseError) {\n        let error = new ResponseError(`Failed to parse response JSON: ${parseError.message}`)\n        error.reason = parseError\n        error.responseText = xhr.responseText\n        copyResponseInfoTo(error)\n        reject(error)\n        return\n      }\n\n      copyResponseInfoTo(res)\n\n      if (res.status >= 400) {\n        reject(options.errorHandler(res))\n      } else {\n        resolve(res)\n      }\n    }\n    xhr.send(body || options.body)\n  })\n}\n\nRequest.jsonRequest = function (options) {\n  var xhr = new XMLHttpRequest()\n  xhr.open(options.method, options.url, true)\n  if (xhr.overrideMimeType) {\n    xhr.overrideMimeType('application/json')\n  }\n\n  var body = JSON.stringify(options.body || {})\n  xhr.setRequestHeader('Content-Type', 'application/json')\n\n  return Request._executeXhrWithJsonResponse(xhr, options, body)\n}\n\nRequest.uploadFile = function (options) {\n  var xhr = new XMLHttpRequest()\n  xhr.open(options.method, options.url, true)\n\n  var upload = new EmitterMixin()\n\n  xhr.upload.addEventListener('progress', function (event) {\n    if (event.lengthComputable) {\n      upload._emit('progress', event.loaded / event.total)\n    }\n  }, false)\n\n  xhr.upload.addEventListener('load', function () {\n    upload._emit('done')\n  }, false)\n\n  upload.promise = Request._executeXhrWithJsonResponse(xhr, options)\n\n  return upload\n}\n\nexport function FileUploadClient() {\n}\n\nFileUploadClient.prototype = {\n  constructor: FileUploadClient,\n  tag: 'file-upload-client',\n\n  toString: function () {\n    return 'fileUploadClient{}'\n  },\n\n  executeRequest: function (options) {\n    return Request.uploadFile(options)\n  },\n}\n\nexport function JsonRetryClient() {\n  this._execute = this._execute.bind(this)\n}\n\nJsonRetryClient.prototype = {\n  constructor: JsonRetryClient,\n  tag: 'json-retry-client',\n\n  toString: function () {\n    return 'jsonRetryClient{}'\n  },\n\n  executeRequest: function (options) {\n    var request = defer()\n    request.options = options\n    this._execute(request)\n    return request.promise\n  },\n\n  _execute: function (request) {\n    var self = this\n    Request.jsonRequest(request.options).then(function (response) {\n      request.resolve(response)\n    }, function (err) {\n      if (err.name === 'RateLimitError') {\n        setTimeout(self._execute, err.retryAfterMs, request)\n      } else {\n        request.reject(err)\n      }\n    }).catch(function (error) {\n      log.error(self.tag, 'error while executing request: ', error)\n    })\n  },\n}\n\nexport function SerializedJsonRetryClient() {\n  this._queue = []\n  this._working = false\n}\n\nSerializedJsonRetryClient.prototype = {\n  constructor: SerializedJsonRetryClient,\n  tag: 'serialized-json-retry-client',\n\n  toString: function () {\n    return 'serializedJsonRetryClient{working=' + this._working +\n            ',queued=' + this._queue.length + '}'\n  },\n\n  executeRequest: function (options) {\n    var request = defer()\n    request.options = options\n    this._queue.push(request)\n    this._poll()\n    return request.promise\n  },\n\n  _poll: function () {\n    if (this._working) {\n      return\n    }\n\n    var request = this._queue.shift()\n    if (!request) {\n      return\n    }\n\n    var self = this\n    this._working = true\n\n    Request.jsonRequest(request.options).then(function (response) {\n      request.resolve(response)\n      self._working = false\n      self._poll()\n    }, function (err) {\n      if (err.name === 'RateLimitError') {\n        setTimeout(function () {\n          self._queue.unshift(request)\n          self._working = false\n          self._poll()\n        }, err.retryAfterMs)\n      } else {\n        request.reject(err)\n        self._working = false\n        self._poll()\n      }\n    }).catch(function (error) {\n      log.error(self.tag, 'error while executing request: ', error)\n    })\n  },\n}\n\nRequest.DEFAULT_CLIENT = new JsonRetryClient()\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/request.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\nimport {diff} from 'common/utils'\n\nimport {Votes} from 'conference/raftConfiguration'\nimport {ConfigurationEntry, OP} from 'conference/raftLogEntry'\nimport {\n  AppendEntriesRequest,\n  PreVoteRequest,\n  RequestVoteRequest,\n  StateOpResponse,\n} from 'conference/raftMessages'\n\nconst TAG = 'raft'\n\nexport const EXPECTED_RTT_MS = 200\n\n// This doesn't need to be particularly low, but it's good to get rid\n// of old followers so that we don't leak into unused send buffers,\n// It should however be high enough that the follower has a chance to\n// reconnect, so we set it higher than datachannel and ICE timeouts.\nconst FOLLOWER_REMOVE_TIMEOUT_MS = 15000\n\nexport default class RaftState {\n  constructor(log, send, term) {\n    this._log = log\n    this._send = send\n    this._term = argCheck.number(this, 'term', term)\n  }\n\n  toFollower(term, leader, votedFor) {\n    if (this.stop) {\n      this.stop()\n    }\n    return new FollowerState(this._log, this._send, term, leader, votedFor)\n  }\n\n  toCandidate(term, preVoteDone) {\n    if (this.stop) {\n      this.stop()\n    }\n    return new CandidateState(this._log, this._send, term, preVoteDone)\n  }\n\n  toLeader(term, configuration) {\n    if (this.stop) {\n      this.stop()\n    }\n    return new LeaderState(this._log, this._send, term, configuration)\n  }\n\n  handleAppendEntriesRequest(peerId, message) {\n    let response = this._log.handleAppendEntriesRequest(message)\n    if (response) {\n      this._send(peerId, response)\n      return this.toFollower(message.term, peerId)\n    }\n  }\n\n  handleAppendEntriesResponse(peerId, message) {\n  }\n\n  handleRequestVoteRequest(peerId, message) {\n    let granted = message.compareLog(this._log) >= 0\n    if (message.term === this._term) {\n      if (this._votedFor === peerId) {\n        // If we already voted for the peer this term, meaning we are a follower, resend the vote\n        log.debug(TAG, this, `resending granted vote to peer, '${peerId}'`)\n        this._send(peerId, message.response({granted: true}))\n      } else if (this._votedFor) {\n        // Or if we already voted for someone else, reject the vote\n        log.debug(TAG, this, `rejecting vote for '${peerId}', already voted for ${this._votedFor}`)\n        this._send(peerId, message.response({granted: false}))\n      } else if (this instanceof FollowerState) {\n        // If we are follower at this point, it means we rejected a vote for this term,\n        // but may still select someone else to vote for.\n        log.debug(TAG, this, `${granted ? 'granting' : 'rejecting'} same-term vote request from '${peerId}'`)\n        this._send(peerId, message.response({granted}))\n        if (granted) {\n          this._votedFor = peerId\n          return this\n        }\n      } else {\n        // Otherwise we are either leader or candidate and should reject the vote\n        log.debug(TAG, this, `ignoring vote request from '${peerId}', already leader`)\n        this._send(peerId, message.response({granted: false}))\n      }\n    } else if (message.term <= this._term) {\n      // If the vote is for an old term, reject it\n      this._send(peerId, message.response({granted: false}))\n    } else {\n      // We received a vote request for a new term, but need to figure out if logs are up to date\n      // TODO: we may want to ignore votes when we're still hearing from the leader\n      this._send(peerId, message.response({granted}))\n      if (this instanceof FollowerState) {\n        this._term = argCheck.number('RaftState.handleRequestVoteRequest', 'message.term', message.term)\n        this._leader = null\n        if (granted) {\n          this._votedFor = peerId\n          return this\n        }\n      } else {\n        return this.toFollower(message.term, null, granted ? peerId : null)\n      }\n    }\n  }\n\n  handleRequestVoteResponse(peerId, message) {\n  }\n\n  handlePreVoteRequest(peerId, message) {\n    let granted = false\n    let reason = 'none'\n\n    if (message.term < this._term) {\n      // If the vote is for an old term, reject it\n      granted = false\n      reason = 'old or current term'\n    } else {\n      // We received a vote request for a new term, but need to figure out if logs are up to date\n      granted = message.compareLog(this._log) >= 0\n      reason = 'newer term'\n    }\n    log.debug(TAG, this, `${granted ? 'granting' : 'rejecting'} pre-vote request from '${peerId}' when ${reason}`)\n    this._send(peerId, message.response({granted}))\n  }\n\n  handlePreVoteResponse(peerId, message) {\n  }\n\n  handleSnapshotRequest(peerId, message) {\n  }\n\n  handleSnapshotResponse(peerId, message) {\n  }\n\n  handleStateOpRequest(peerId, message) {\n    this._send(peerId, message.response({errorCode: StateOpResponse.NOT_LEADER}))\n  }\n\n  // StateOpResponse is handled by StateMachine\n\n  forwardStateOpRequest(request) {\n  }\n\n  hasVote(peerId) {\n    return false\n  }\n}\n\nexport class FollowerMapEntry {\n  constructor({term, nextIndex, topologyInfo, log, send, remove}) {\n    this._term = term\n    this._log = log\n    this._send = send\n    this._removeSelf = remove\n    this._nextIndex = argCheck.number(this, 'nextIndex', nextIndex)\n    this._matchIndex = 0\n    this._topologyInfo = topologyInfo\n    this._timeoutId = null\n    this._removeTimeoutId = null\n    this._idle = true\n    this._removeIndex = Infinity\n  }\n\n  get matchIndex() {\n    return this._matchIndex\n  }\n\n  start() {\n    this._startTimeout()\n    this._sendAppendRequest(0)\n  }\n\n  stop() {\n    if (this._timeoutId) {\n      clearTimeout(this._timeoutId)\n      this._timeoutId = null\n    }\n    if (this._removeTimeoutId) {\n      clearTimeout(this._removeTimeoutId)\n      this._removeTimeoutId = null\n    }\n    this._topologyInfo._invalidate()\n  }\n\n  // Followers that are removed should receive the information that they\n  // have been removed, so we keep sending messages until we have received\n  // a matchIndex that confirms that they have been informed of their own\n  // removal.\n  // By always using the minimum index it's safe to call this multiple\n  // times as as configurations change.\n  phaseOutUntilIndex(index) {\n    if (this._removeIndex !== Infinity) {\n      this._removeIndex = Math.min(this._removeIndex, index)\n      this._removeTimeoutId = setTimeout(() => {\n        this._removeTimeoutId = null\n        this._removeSelf()\n      }, FOLLOWER_REMOVE_TIMEOUT_MS)\n    }\n  }\n\n  handleAppendEntriesResponse(message) {\n    this._topologyInfo._update(message)\n\n    if (message.success) {\n      this._matchIndex = message.matchIndex\n      this._nextIndex = message.matchIndex + 1\n      if (this._log.lastLogIndex > this._nextIndex) {\n        this._sendAppendRequest(5)\n      } else {\n        this._idle = true\n      }\n    } else {\n      this._nextIndex = message.matchIndex\n      if (this._nextIndex < 1) {\n        this._nextIndex = 1\n      }\n      this._sendAppendRequest(0)\n    }\n\n    if (this._matchIndex >= this._removeIndex) {\n      clearTimeout(this._removeTimeoutId)\n      this._removeTimeoutId = null\n      this._removeSelf()\n    }\n  }\n\n  _onAppend(toIndex) {\n    // Will only trigger a send if we have received acks for all messages\n    if (this._nextIndex === toIndex) {\n      if (this._idle) {\n        log.verbose(TAG, this, 'was idle when matching entries were added, sending')\n        this._sendAppendRequest(5)\n      } else {\n        log.verbose(TAG, this, 'was busy when matching entries were added')\n      }\n    }\n  }\n\n  _sendAppendRequest(maxEntries = 0) {\n    let prevIndex = this._nextIndex - 1\n    let prevTerm = this._log.entryTermAtIndex(prevIndex)\n    let entries = this._log.sliceEntries(this._nextIndex, this._nextIndex + maxEntries)\n\n    let maxCommitIndex = this._log.commitIndex\n    let lastEntryIndex = prevIndex + entries.length\n    let commitIndex = Math.min(maxCommitIndex, lastEntryIndex)\n\n    this._send(AppendEntriesRequest.create({\n      term: this._term,\n      topologyIndex: this._topologyInfo.topologyIndex,\n      prevIndex,\n      prevTerm,\n      commitIndex,\n      entries,\n    }))\n\n    this._idle = false\n  }\n\n  _startTimeout() {\n    if (this._timeoutId) {\n      clearTimeout(this._timeoutId)\n    }\n    this._timeoutId = setTimeout(() => {\n      this._startTimeout()\n      this._sendAppendRequest(1)\n    }, EXPECTED_RTT_MS * 4)\n  }\n}\n\n/*\n  ##       ########    ###    ########  ######## ########\n  ##       ##         ## ##   ##     ## ##       ##     ##\n  ##       ##        ##   ##  ##     ## ##       ##     ##\n  ##       ######   ##     ## ##     ## ######   ########\n  ##       ##       ######### ##     ## ##       ##   ##\n  ##       ##       ##     ## ##     ## ##       ##    ##\n  ######## ######## ##     ## ########  ######## ##     ##\n*/\n\nexport class LeaderState extends RaftState {\n  constructor(log, send, term = 0) {\n    super(log, send, term)\n    this._onTopologyChange = this._onTopologyChange.bind(this)\n\n    // TODO: Leader should also have an election timeout that is triggered if not\n    // a majority of the followers respond.\n    this._followerMap = new Map()\n    this._joinerMap = new Map()\n    this._pendingAdditions = new Set()\n    this._pendingRemovals = new Set()\n\n    this.start()\n  }\n\n  toString() {\n    return `leader{term=${this._term}}`\n  }\n\n  start() {\n    this._log.createOpEntry({term: this._term, op: OP.noop})\n    this._afterAppend()\n    let nextIndex = this._log.lastLogIndex + 1\n    this._log.meshTopology.activate()\n    this._log.meshTopology.addChangeListener(this._onTopologyChange)\n    this._log.configuration.forEachPeer(peerId => this._addFollower(peerId, nextIndex))\n  }\n\n  stop() {\n    this._followerMap.forEach(follower => follower.stop())\n    this._followerMap.clear()\n    this._joinerMap.forEach(intervalId => clearInterval(intervalId))\n    this._joinerMap.clear()\n    this._log.meshTopology.removeChangeListener(this._onTopologyChange)\n    this._log.meshTopology.deactivate()\n  }\n\n  _onTopologyChange(topology, changedUpState) {\n    if (!changedUpState) {\n      // Leader only cares about connections going up and down, rtt/bw is for relaying\n      return\n    }\n\n    log.verbose(TAG, this, 'got significant topology change, checking if any members should be removed')\n\n    // First we figure out what member connections we are missing between ourselves and each follower\n    let missingConnections = new Set()\n    let localLinks = topology.localTopologyInfo.links\n    // this._followerMap.forEach((follower, peerId) => {\n    this._log.configuration.members.forEach(peerId => {\n      if (peerId === this._log.configuration.ownId) {\n        return\n      }\n      let localLink = localLinks[peerId]\n      if (localLink && localLink.up) {\n        return\n      }\n      if (this._pendingRemovals.has(peerId)) {\n        return\n      }\n      missingConnections.add(peerId)\n    })\n\n    if (missingConnections.size === 0) {\n      return\n    }\n\n    // Look at the link infos for the rest of the cluster and keep all connections\n    // where some other conference member has a conneciton.\n    topology.topologyInfos.forEach(({links}, peerId) => {\n      // If our link to the peer is down we don't trust the current peer link info\n      let localLink = localLinks[peerId]\n      if (!localLink || !localLink.up) {\n        return\n      }\n      if (this._followerMap.has(peerId)) {\n        missingConnections.forEach(missingPeerId => {\n          if (missingPeerId === peerId) {\n            return\n          }\n          if (links[missingPeerId] && links[missingPeerId].up) {\n            log.debug(TAG, this, `not removing connection to ${missingPeerId} because ${peerId} has a connection`)\n            missingConnections.delete(missingPeerId)\n          }\n        })\n      }\n    })\n\n    log.info(TAG, this, `removing connections to [${[...missingConnections].join(',')}] with topology: ${topology}`)\n    // Now we're left with all peers that should be removed\n    missingConnections.forEach(peerId => {\n      this._pendingRemovals.add(peerId)\n    })\n    this._handlePendingMembershipUpdates()\n  }\n\n  // When adding a peer it will always be in the joiner state. This is because a joiner\n  // does not transition to follower until a configuration with their id has been committed.\n  // Meaning that if we manager to get elected as leader, we will either see the peer in the\n  // configuration and ignore the add request, or we won't and the peer must still be in\n  // the joiner state.\n  addPeer({peerId, mustRejoin = true}) {\n    if (this._followerMap.has(peerId)) {\n      let isMember = this._log.configuration.members.has(peerId)\n      let localLink = this._log.meshTopology.localTopologyInfo.links[peerId]\n      if (isMember && localLink && localLink.up && !mustRejoin) {\n        log.debug(TAG, this, 'got add request for follower, but the link is up, ignoring')\n        return\n      } else {\n        log.debug(TAG, this, `got add request for follower, ${peerId}, resetting state`)\n        this._removeFollower(peerId)\n      }\n    }\n    if (this._joinerMap.has(peerId)) {\n      log.debug(TAG, this, `got a second request to add peer ${peerId}`)\n      return\n    }\n    log.debug(TAG, this, `added peer to joiners: ${peerId}`)\n\n    let sendSnapshot = () => {\n      let snapshot = this._log.createSnapshot(this._term)\n      this._send(peerId, snapshot)\n    }\n    let intervalId = setInterval(sendSnapshot, EXPECTED_RTT_MS * 4)\n    this._joinerMap.set(peerId, intervalId)\n    sendSnapshot()\n  }\n\n  appendConfiguration(data) {\n    let oldMembers = this._log.configuration.members\n    let entry = this._log.createConfigurationEntry({term: this._term, data})\n    let newMembers = this._log.configuration.members\n\n    let [addedPeers, removedPeers] = diff(oldMembers, newMembers)\n    let nextIndex = this._log.lastLogIndex + 1\n\n    addedPeers.forEach(peerId => this._addFollower(peerId, nextIndex))\n    removedPeers.forEach(peerId => {\n      let follower = this._followerMap.get(peerId)\n      if (follower) {\n        follower.phaseOutUntilIndex(nextIndex)\n      }\n    })\n    this._afterAppend()\n    return entry\n  }\n\n  _afterAppend() {\n    let index = this._log.lastLogIndex\n    this._followerMap.forEach(follower => {\n      follower._onAppend(index)\n    })\n    this._tryCommit()\n  }\n\n  handleAppendEntriesRequest(peerId, message) {\n    if (message.term === this._term) {\n      log.debug(TAG, `ERROR: ${this} received append request for own term: ${message}`)\n    } else if (message.term > this._term) {\n      // A new leader was elected, allow it to take over\n      return super.handleAppendEntriesRequest(peerId, message)\n    }\n  }\n\n  handleAppendEntriesResponse(peerId, message) {\n    if (message.term === this._term) {\n      // TODO: Add tests for this\n      if (message.needSnapshot) {\n        log.debug(TAG, this, `received append entries response from ${peerId} with needSnapshot flag`)\n        this.addPeer({peerId, mustRejoin: true})\n        return\n      }\n      // Got a response to one of our append requests\n      let follower = this._followerMap.get(peerId)\n      if (follower) {\n        follower.handleAppendEntriesResponse(message)\n        if (message.success) {\n          // We have appended new log entires, might be able to increment commit index\n          this._tryCommit()\n        }\n      } else {\n        log.debug(TAG, `ERROR: ${this} got append entries response from unknown peer: ${peerId}`)\n      }\n    } else if (message.term > this._term) {\n      log.debug(TAG, `ERROR: ${this} received append response for newer term: ${message}`)\n    }\n  }\n\n  handleSnapshotResponse(peerId, message) {\n    if (message.term !== this._term) {\n      log.warning(TAG, this, `received snapshot response for future term: ${message}`)\n      return\n    }\n    let intervalId = this._joinerMap.get(peerId)\n    if (!intervalId) {\n      log.debug(TAG, this, `received snapshot response for missing joiner: ${message}`)\n      return\n    }\n    clearInterval(intervalId)\n    this._joinerMap.delete(peerId)\n\n    log.debug(TAG, this, `accepted snapshot response from ${peerId}: ${message}`)\n    let {lastIndex} = message\n    this._addFollower(peerId, lastIndex + 1)\n\n    this._pendingAdditions.add(peerId)\n    this._handlePendingMembershipUpdates()\n  }\n\n  handleStateOpRequest(peerId, message) {\n    this.forwardStateOpRequest(message)\n    this._send(peerId, message.response())\n  }\n\n  forwardStateOpRequest(request) {\n    let {id, op, args} = request\n    this._log.createOpEntry({term: this._term, id, op, args})\n    this._afterAppend()\n  }\n\n  _tryCommit() {\n    let matchIndices = {\n      [this._log.configuration.ownId]: this._log.lastLogIndex,\n    }\n    this._followerMap.forEach((follower, clientId) => {\n      matchIndices[clientId] = follower.matchIndex\n    })\n    let majorityMatchIndex = this._log.configuration.getMajorityIndex(matchIndices)\n    let committed = this._log.tryCommitIndexForTerm(majorityMatchIndex, this._term)\n\n    if (committed && committed.length) {\n      this._followerMap.forEach(follower => follower._sendAppendRequest(0))\n    }\n\n    if (committed && committed.some(entry => entry instanceof ConfigurationEntry)) {\n      // This assumes that there can only be a single un-committed configuration log entry\n      // at any given time for any leader. Afaik that is true but needs some proof.\n      this._handlePendingMembershipUpdates()\n    }\n  }\n\n  _handlePendingMembershipUpdates() {\n    if (this._pendingAdditions.size + this._pendingRemovals.size === 0) {\n      return\n    }\n\n    let members = this._log.configuration.members\n\n    // The configuration implementation in the first Raft paper is more\n    // complex and less robus than the one in the thesis.\n    // The basic concept of the one from the thesis is that as long as\n    // we do few enough additions or removals each time, it is safe.\n    //\n    // TODO: It's possible to add or remove more than one members at\n    // at time in large clusters, figure out limits.\n    if (this._pendingRemovals.size) {\n      let [removed] = [...this._pendingRemovals]\n      this._pendingRemovals.delete(removed)\n      members.delete(removed)\n    } else if (this._pendingAdditions.size) {\n      let [added] = [...this._pendingAdditions]\n      this._pendingAdditions.delete(added)\n      members.add(added)\n    }\n\n    let data = this._log.configuration.createMembersChange(members)\n    this.appendConfiguration(data)\n  }\n\n  _addFollower(peerId, nextIndex) {\n    if (this._followerMap.has(peerId)) {\n      log.debug(TAG, this, `not adding new follower, already exists since joining: ${peerId}`)\n      return\n    }\n    log.debug(TAG, this, `added peer to followers: ${peerId}`)\n    const send = message => this._send(peerId, message)\n    let topologyInfo = this._log.meshTopology.addClient(peerId)\n    let follower = new FollowerMapEntry({\n      term: this._term,\n      nextIndex,\n      topologyInfo,\n      log: this._log,\n      send,\n      remove: this._removeFollower.bind(this, peerId),\n    })\n    this._followerMap.set(peerId, follower)\n    follower.start()\n  }\n\n  _removeFollower(peerId) {\n    let follower = this._followerMap.get(peerId)\n    if (follower) {\n      follower.stop()\n      this._followerMap.delete(peerId)\n      this._log.meshTopology.removeClient(peerId)\n    } else {\n      log.warning(TAG, this, `failed to remove missing follower: ${peerId}`)\n    }\n  }\n}\n\n/*\n  ########  #######  ##       ##        #######  ##      ## ######## ########\n  ##       ##     ## ##       ##       ##     ## ##  ##  ## ##       ##     ##\n  ##       ##     ## ##       ##       ##     ## ##  ##  ## ##       ##     ##\n  ######   ##     ## ##       ##       ##     ## ##  ##  ## ######   ########\n  ##       ##     ## ##       ##       ##     ## ##  ##  ## ##       ##   ##\n  ##       ##     ## ##       ##       ##     ## ##  ##  ## ##       ##    ##\n  ##        #######  ######## ########  #######   ###  ###  ######## ##     ##\n*/\n\nexport class FollowerState extends RaftState {\n  constructor(log, send, term = 0, leader = null, votedFor = null) {\n    super(log, send, term)\n    argCheck.optString(this, 'leader', leader)\n\n    this._sendPreVoteRequests = this._sendPreVoteRequests.bind(this)\n\n    this._leader = leader\n    this._votedFor = votedFor\n\n    // When doing a pre-vote, this is the term we would candidate for\n    this._targetTerm = null\n  }\n\n  toString() {\n    return `follower{term=${this._term},leader=${this._leader},votedFor=${this._votedFor}}`\n  }\n\n  hasVote(peerId) {\n    return this._votedFor === peerId\n  }\n\n  toFollower(term, leader, votedFor = null) {\n    if (term > this._term) {\n      this._term = term\n      this._leader = leader\n      this._votedFor = votedFor\n    }\n    if (term === this._term && !this._leader) {\n      this._leader = leader\n    }\n    this.stop()\n    return this\n  }\n\n  // The below code is a part of the pre-vote modification of Raft, see raftMessages.js\n  toCandidate(term, preVoteDone) {\n    if (preVoteDone) {\n      return super.toCandidate(term, preVoteDone)\n    }\n    this.stop()\n    this._targetTerm = term\n    this._preVotes = new Votes(this._log.configuration.ownId)\n    this.start()\n    return this\n  }\n\n  start() {\n    this._sendPreVoteRequests()\n    this._intervalId = setInterval(this._sendPreVoteRequests, EXPECTED_RTT_MS * 4)\n  }\n\n  stop() {\n    if (this._intervalId) {\n      clearInterval(this._intervalId)\n      this._intervalId = null\n    }\n    if (this._targetTerm) {\n      this._targetTerm = null\n      this._preVotes = null\n    }\n  }\n\n  handlePreVoteResponse(peerId, message) {\n    if (this._targetTerm && message.term === this._targetTerm) {\n      // We got a vote for the current term, so we store the reply and check if we\n      // have received enough votes to have a majority and become leader\n      this._preVotes.set(peerId, message.granted)\n      log.debug(TAG, this, `received pre-vote reply from ${peerId}: ${message.granted ? 'granted' : 'rejected'}`)\n      if (this._log.configuration.hasMajority(this._preVotes.grantedVotes)) {\n        return super.toCandidate(this._targetTerm, true)\n      }\n    }\n  }\n\n  forwardStateOpRequest(request) {\n    if (this._leader) {\n      this._send(this._leader, request)\n    } else {\n      // We just let the client time out for now\n      // TODO: Use an async queue to serialize messages and send feedback\n    }\n  }\n\n  _sendPreVoteRequests() {\n    let request = PreVoteRequest.create({\n      term: this._targetTerm, // we're going to be voting in the next term\n      lastLogTerm: this._log.lastLogTerm,\n      lastLogIndex: this._log.lastLogIndex,\n    })\n\n    this._log.configuration.forEachPeer(peerId => {\n      if (!this._preVotes.has(peerId)) {\n        this._send(peerId, request)\n      }\n    })\n  }\n}\n\n/*\n   ######     ###    ##    ## ########  #### ########     ###    ######## ########\n  ##    ##   ## ##   ###   ## ##     ##  ##  ##     ##   ## ##      ##    ##\n  ##        ##   ##  ####  ## ##     ##  ##  ##     ##  ##   ##     ##    ##\n  ##       ##     ## ## ## ## ##     ##  ##  ##     ## ##     ##    ##    ######\n  ##       ######### ##  #### ##     ##  ##  ##     ## #########    ##    ##\n  ##    ## ##     ## ##   ### ##     ##  ##  ##     ## ##     ##    ##    ##\n   ######  ##     ## ##    ## ########  #### ########  ##     ##    ##    ########\n*/\n\nexport class CandidateState extends RaftState {\n  constructor(log, send, term, preVoteDone) {\n    super(log, send, term)\n\n    this._tick = this._tick.bind(this)\n\n    // Start by gathering a majority of pre-votes, otherwise we wait until next election.\n    // Pre-votes are a modification to Raft, see raftMessages.js\n    this._preVoteDone = preVoteDone\n    this._preVotes = preVoteDone ? null : new Votes(log.configuration.ownId)\n    this._votes = preVoteDone ? new Votes(log.configuration.ownId) : null\n    this._intervalId = null\n\n    this.start()\n  }\n\n  toString() {\n    return `candidate{term=${this._term},votes=${this._votes}}`\n  }\n\n  start() {\n    this._tick()\n    this._intervalId = setInterval(this._tick, EXPECTED_RTT_MS * 4)\n  }\n\n  stop() {\n    if (this._intervalId) {\n      clearInterval(this._intervalId)\n      this._intervalId = null\n    }\n  }\n\n  _tick() {\n    let requestFactory = this._preVoteDone ? RequestVoteRequest : PreVoteRequest\n    let voteCollection = this._preVoteDone ? this._votes : this._preVotes\n\n    let request = requestFactory.create({\n      term: this._term,\n      lastLogTerm: this._log.lastLogTerm,\n      lastLogIndex: this._log.lastLogIndex,\n    })\n\n    this._log.configuration.forEachPeer(peerId => {\n      if (!voteCollection.has(peerId)) {\n        this._send(peerId, request)\n      }\n    })\n  }\n\n  handlePreVoteResponse(peerId, message) {\n    if (!this._preVoteDone && message.term === this._term) {\n      // We got a vote for the current term, so we store the reply and check if we\n      // have received enough votes to have a majority and become leader\n      this._preVotes.set(peerId, message.granted)\n      log.debug(TAG, this, `received pre-vote reply from ${peerId}: ${message.granted ? 'granted' : 'rejected'}`)\n      if (this._log.configuration.hasMajority(this._preVotes.grantedVotes)) {\n        this._preVoteDone = true\n        this._votes = new Votes(this._log.configuration.ownId)\n        // trigger tick and reset timer\n        this.stop()\n        this.start()\n      }\n    }\n  }\n\n  handleRequestVoteResponse(peerId, message) {\n    if (this._preVoteDone && message.term === this._term) {\n      // We got a vote for the current term, so we store the reply and check if we\n      // have received enough votes to have a majority and become leader\n      this._votes.set(peerId, message.granted)\n      log.debug(TAG, this, `received vote reply from ${peerId}: ${message.granted ? 'granted' : 'rejected'}`)\n      if (this._log.configuration.hasMajority(this._votes.grantedVotes)) {\n        return this.toLeader(this._term)\n      }\n    }\n  }\n}\n\n/*\n        ##  #######  #### ##    ## ######## ########\n        ## ##     ##  ##  ###   ## ##       ##     ##\n        ## ##     ##  ##  ####  ## ##       ##     ##\n        ## ##     ##  ##  ## ## ## ######   ########\n  ##    ## ##     ##  ##  ##  #### ##       ##   ##\n  ##    ## ##     ##  ##  ##   ### ##       ##    ##\n   ######   #######  #### ##    ## ######## ##     ##\n*/\n\n// The joiner state is a new state not documented in the main raft paper.\n//\n// In this state the client waits for a snapshot request to be able to join in, it\n// then waits for a configuration to be committed where the client is a member of the cluster.\n//\n// When adding a peer, the leader will first send snaptshots until a snapshot response for\n// the current term is received. It will then request a new configuration which includes the\n// new client as soon as possible.\n//\n// Clients in the joiner state will not vote or be requested to vote, they will also not\n// time out and start candidating.\nexport class JoinerState extends RaftState {\n  constructor(log, send) {\n    super(log, send, 0)\n  }\n\n  toString() {\n    return 'joiner{}'\n  }\n\n  handleAppendEntriesRequest(peerId, message) {\n    if (this._term === 0) {\n      // We haven't received a snapshot yet. The old leader was probably replaced and the new one thinks\n      // we're a regular cluster member.\n      this._send(peerId, message.response({needSnapshot: true}))\n      return\n    }\n    let response = this._log.handleAppendEntriesRequest(message)\n    if (response) {\n      this._send(peerId, response)\n      this._term = message.term\n      return this._convertToFollowerIfMember(peerId)\n    }\n  }\n\n  handleAppendEntriesResponse(peerId, message) {\n  }\n\n  handleRequestVoteRequest(peerId, message) {\n    // joiners do not participate in voting in any way\n  }\n\n  handleRequestVoteResponse(peerId, message) {\n  }\n\n  handleSnapshotRequest(peerId, message) {\n    if (this._term > message.term || this._log.commitIndex > message.lastIndex) {\n      return // ignore old snapshots\n    }\n    this._log.loadSnapshot(message)\n    this._send(peerId, message.response())\n    this._term = message.term\n    return this._convertToFollowerIfMember(peerId)\n  }\n\n  handleSnapshotResponse(peerId, message) {\n  }\n\n  _convertToFollowerIfMember(peerId) {\n    let configData = this._log.getCommittedConfigurationData()\n    let ownId = this._log.configuration.ownId\n    if (configData.includes(ownId)) {\n      log.info(TAG, this, 'found itself in committed configuration, converting to follower')\n      return this.toFollower(this._term, peerId)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raftState.js","'use strict'\n\nimport argCheck from 'common/argCheck'\n\nconst TYPE_ROOM = 'room'\nconst TYPE_USER = 'user'\nconst TYPE_EVENT = 'event'\nconst TYPE_ALIAS = 'alias'\n\nconst tagTypeMap = {\n  '!': TYPE_ROOM,\n  '@': TYPE_USER,\n  '$': TYPE_EVENT,\n  '#': TYPE_ALIAS,\n}\nconst typeTagMap = {\n  [TYPE_ROOM]: '!',\n  [TYPE_USER]: '@',\n  [TYPE_EVENT]: '$',\n  [TYPE_ALIAS]: '#',\n}\n\nexport function parseId(matrixId) {\n  argCheck.string('parseId', 'matrixId', matrixId)\n  let [id, ...rest] = matrixId.split(':')\n  let typeTag = id[0]\n  let localId = id.slice(1)\n  if (localId.length === 0) {\n    argCheck.error('parseId', 'matrixId', 'not have an empty local id')\n  }\n  let type = tagTypeMap[typeTag]\n  if (!type) {\n    argCheck.error('parseId', 'matrixId', 'have a valid type tag')\n  }\n  let serverName = rest.join(':')\n  if (serverName.length === 0) {\n    argCheck.error('parseId', 'matrixId', 'not have an empty server name')\n  }\n  return [type, localId, serverName]\n}\n\nexport function parseIdForServer(context, matrixId, serverName, expectedType) {\n  argCheck.string(context, 'serverName', serverName)\n  let [type, localId, parsedServerName] = parseId(matrixId)\n  if (type !== expectedType) {\n    argCheck.error(context, 'type', `be ${expectedType} and not ${type}`)\n  }\n  if (serverName === parsedServerName) {\n    return localId\n  } else {\n    return `${localId}:${parsedServerName}`\n  }\n}\n\nexport function toMatrixIdForServer(context, id, serverName, type) {\n  argCheck.string(context, 'id', id)\n  let tag = typeTagMap[type]\n  if (!type) {\n    argCheck.error(context, 'type', 'use a valid type')\n  }\n\n  if (id.indexOf(':') === -1) {\n    argCheck.string(context, 'serverName', serverName)\n    id = `${id}:${serverName}`\n  }\n  if (id[0] !== tag) {\n    id = tag + id\n  }\n\n  return id\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/ids.js","module.exports = { \"default\": require(\"core-js/library/fn/is-iterable\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/is-iterable.js\n// module id = 161\n// module chunks = 0 1 5","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/get-iterator.js\n// module id = 162\n// module chunks = 0 1 5","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.is-iterable');\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/is-iterable.js\n// module id = 163\n// module chunks = 0 1 5","var anObject = require('./_an-object')\n  , get      = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function(it){\n  var iterFn = get(it);\n  if(typeof iterFn != 'function')throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/core.get-iterator.js\n// module id = 164\n// module chunks = 0 1 5","var classof   = require('./_classof')\n  , ITERATOR  = require('./_wks')('iterator')\n  , Iterators = require('./_iterators');\nmodule.exports = require('./_core').isIterable = function(it){\n  var O = Object(it);\n  return O[ITERATOR] !== undefined\n    || '@@iterator' in O\n    || Iterators.hasOwnProperty(classof(O));\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/core.is-iterable.js\n// module id = 165\n// module chunks = 0 1 5","'use strict'\n\nimport log from 'common/log'\n\nimport {defer} from 'common/utils'\n\nexport default class AsyncQueue {\n  constructor() {\n    this._queue = []\n    this._currentTask = null\n  }\n\n  toString() {\n    return 'AsyncQueue{executing=' + !!this._currentTask + 'queued=' + this._queue.length + '}'\n  }\n\n  push(factory) {\n    var task = defer()\n    task.factory = factory\n    this._queue.push(task)\n    if (!this._currentTask) {\n      this._poll()\n    }\n    return task.promise\n  }\n\n  clear() {\n    if (this._currentTask) {\n      this._currentTask.cancelled = true\n      this._currentTask = null\n    }\n    this._queue.length = 0\n  }\n\n  _poll() {\n    if (this._currentTask || !this._queue.length) {\n      return\n    }\n    var self = this\n    var task = this._currentTask = this._queue.shift()\n    if (!task) {\n      return\n    }\n\n    var promise = null\n    try {\n      promise = task.factory()\n    } catch (e) {\n      log.error(this.tag, 'AsyncQueue.process: factory threw error', e, e.stack)\n    }\n    if (promise) {\n      promise.then(function (result) {\n        if (task.cancelled) {\n          throw new Error('task was cancelled')\n        }\n        task.resolve(result)\n      }).catch(task.reject).then(function () {\n        self._currentTask = null\n        self._poll()\n      }).catch(function (error) {\n        log.error(self.tag, 'error calling poll after task completion: ', error)\n      })\n    } else {\n      this._currentTask = null\n      this._poll()\n    }\n  }\n}\n\nAsyncQueue.tag = 'async-queue'\n\nexport class AsyncPipe {\n  constructor() {\n    this._queue = []\n    this._deferredRead = null\n  }\n\n  read() {\n    if (!this._queue) {\n      return Promise.reject()\n    } else if (this._deferredRead) {\n      return this._deferredRead.promise\n    } else if (this._queue.length) {\n      let item = this._queue.pop()\n      return Promise.resolve(item)\n    } else {\n      this._deferredRead = defer()\n      return this._deferredRead.promise\n    }\n  }\n\n  write(message) {\n    if (!this._queue) {\n      throw new Error('AsyncPipe is closed')\n    } else if (!this._deferredRead) {\n      this._queue.unshift(message)\n    } else {\n      this._deferredRead.resolve(message)\n      this._deferredRead = null\n    }\n  }\n\n  close() {\n    if (!this._queue) {\n      throw new Error('AsyncPipe has already been closed')\n    }\n    if (this._deferredRead) {\n      this._deferredRead.reject()\n      this._deferredRead = null\n    }\n    this._queue.length = 0\n    this._queue = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/queue.js","'use strict'\n\nimport log from 'common/log'\n\nimport MediaNode from 'media/mediaNode'\nimport MediaNodeInput from 'media/mediaNodeInput'\nimport MediaNodeOutput from 'media/mediaNodeOutput'\n\nconst TAG = 'media-filter'\n\n/**\n * A base class for media nodes with a single input and a single output.\n *\n * The subclass should override the `onStream` method, and call `setStream` to update\n * the output stream.\n *\n * @class MediaFilter\n * @extends MediaNode\n * @extends ConnectMixin\n */\nexport default class MediaFilter extends MediaNode.connectMixin(MediaNode) {\n  constructor() {\n    super()\n\n    this._input = new MediaNodeInput({\n      name: 'default',\n      parent: this,\n      onStream: this.onStream.bind(this),\n    })\n    this._output = new MediaNodeOutput({\n      name: 'default',\n      parent: this,\n    })\n  }\n\n  /**\n   * The input of the filter.\n   *\n   * @readonly\n   * @member {MediaNodeInput} MediaFilter#input\n   */\n  get input() {\n    return this._input\n  }\n\n  /**\n   * The output of the filter.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} MediaFilter#output\n   */\n  get output() {\n    return this._output\n  }\n\n  /**\n   * Abstract method that is called whenever the input stream is updated, this should\n   * be overridden by the subclass.\n   *\n   * This will only ever be called if the stream has changed, been added, or removed,\n   * i.e. stream and oldStream will never be equal.\n   *\n   * The `onStream` method will not be called when the backing tracks of a stream is changed.\n   * If the subclass needs to be notified of track updates this has to be done manually using\n   * the MediaStream listeners.\n   *\n   * @abstract\n   * @param  {?MediaStream} stream - The new media stream, or null.\n   * @param  {?MediaStream} oldStream - The old media stream, or null.\n   */\n  onStream(stream, oldStream) {\n    log.warning(TAG, `${this.constructor.name}.onStream should be overridden`)\n  }\n\n  /**\n   * Sets the current output stream.\n   *\n   * This should only be called by the subclass implementation, and not from outside the media node.\n   *\n   * @param {?MediaStream} stream - The new output stream, or null.\n   */\n  setStream(stream) {\n    this._output.setStream(stream)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaFilter.js","'use strict'\n\nimport log from 'common/log'\n\nimport MediaFilter from 'media/mediaFilter'\n\nconst TAG = 'mute-filter'\n\n/**\n * A media node that can mute the audio and/or video of a stream.\n *\n * @class MuteFilter\n * @extends MediaFilter\n */\nexport default class MuteFilter extends MediaFilter {\n  constructor({silent = false} = {}) {\n    super()\n\n    this._audioMuted = false\n    this._videoMuted = false\n\n    let filter = this\n    this._mute = {\n      get audio() {\n        return filter._audioMuted\n      },\n      set audio(value) {\n        value = Boolean(value)\n        if (value !== filter._audioMuted) {\n          filter._audioMuted = value\n          filter._updateMuteState()\n        }\n      },\n      get video() {\n        return filter._videoMuted\n      },\n      set video(value) {\n        value = Boolean(value)\n        if (value !== filter._videoMuted) {\n          filter._videoMuted = value\n          filter._updateMuteState()\n        }\n      },\n    }\n  }\n\n  /**\n   * Toggles muting of the media passing through this filter.\n   *\n   * When assigning an object to the property, only the media types\n   *   present in the object will be updated.\n   *\n   * @example <caption>Different ways to set mute state</caption>\n   * // directly\n   * filter.mute.video = true\n   *\n   * // separately or simulateously\n   * filter.mute = {\n   *   video: true\n   * }\n   *\n   * // both at once\n   * filter.mute = true\n   *\n   * @member {Object} MuteFilter#mute\n   * @property {boolean} audio - Audio mute state.\n   * @property {boolean} video - Video mute state.\n   */\n  get mute() {\n    return this._mute\n  }\n\n  set mute(value) {\n    let audioMuteBefore = this._audioMuted\n    let videoMuteBefore = this._videoMuted\n    if (typeof(value) === 'boolean') {\n      this._audioMuted = value\n      this._videoMuted = value\n    } else if (typeof(value) === 'object' && value !== null) {\n      if (value.hasOwnProperty('audio')) {\n        this._audioMuted = !!value.audio\n      }\n      if (value.hasOwnProperty('video')) {\n        this._videoMuted = !!value.video\n      }\n    }\n    if (audioMuteBefore !== this._audioMuted || videoMuteBefore !== this._videoMuted) {\n      this._updateMuteState()\n    }\n  }\n\n  _updateMuteState() {\n    let {stream} = this.output\n    log.debug(TAG, `updating mute audio=${this._audioMuted} video=${this._videoMuted} state with stream ${stream}`)\n    if (stream) {\n      stream.getAudioTracks().forEach(track => {\n        track.enabled = !this._audioMuted\n      })\n      stream.getVideoTracks().forEach(track => {\n        track.enabled = !this._videoMuted\n      })\n    }\n  }\n\n  /**\n   * @private\n   * @function MuteFilter#setStream\n   */\n\n  /**\n   * @private\n   * @param {MediaStream} stream - The new stream.\n   */\n  onStream(stream) {\n    this.setStream(stream)\n    this._updateMuteState()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/muteFilter.js","'use strict'\n\nimport log from 'common/log'\nimport EmitterMixin from 'common/emitter'\n\nimport MediaFilter from 'media/mediaFilter'\n\nconst TAG = 'passthrough'\n\n/**\n * A simple identity filter that simply passes on the input stream.\n *\n * This node can e.g. be used to provide a separate output node in order to avoid losing\n * internal connections in a node. The example below shows how a container node uses a passthrough\n * element in order to avoid losing the connection between the filter and analyser if `disconnect()`\n * is called on the output.\n *\n * ```\n *                       |‾‾‾‾‾‾‾‾‾‾|\n *                     o-| Analyser |\n *          |‾‾‾‾‾‾‾‾| | |__________|\n *  input o-| Filter |-o\n *          |________| | |‾‾‾‾‾‾‾‾‾‾‾‾‾|\n *                     o-| Passthrough |-o output\n *                       |_____________|\n * ```\n *\n * It can also be used to log updates and inspect a media pipeline.\n *\n * @class Passthrough\n * @extends MediaFilter\n * @extends EventEmitter\n * @param {Object} [options] - Optional options object.\n * @param {boolean} [options.silent=true] - If silent is set to false the node will emit a log\n *   message with log level `info` whenever the stream is updated.\n */\nexport default class Passthrough extends EmitterMixin(MediaFilter) {\n  constructor({silent = true} = {}) {\n    super()\n    this._silent = silent\n  }\n\n  /**\n   * Emitted when the stream changes.\n   *\n   * @event Passthrough#stream\n   * @param {?MediaStream} stream - The media stream.\n   */\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  onStream(stream) {\n    if (!this.silent) {\n      log.info(TAG, `got new stream: ${stream}`)\n    }\n    this.setStream(stream)\n    this._emit('stream', stream)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/passthrough.js","'use strict'\n\n// This module contains common constants for other\n// datamux modules.\n\n// Message types from senders point of view.\nexport const MT_OPEN = 'o' // <localId>:<base64Label>:<base64Protocol>\nexport const MT_OPEN_ACK = 'a' // <localId>:<remoteId>\nexport const MT_DECLARE = 'd' // <localId>:<base64Label>:<base64Protocol>:<base64PairingId>\nexport const MT_CLOSE = 'c' // <localId>\nexport const MT_CLEAR = 'l' // <localId>\nexport const MT_DATA = 'j' // <localId>:<jsonMessage>\nexport const MT_PING = 'p' // <pingTime>\nexport const MT_PONG = 'g' // <pingTime>\n\n// Transfer message types\nexport const MT_TRANSFER_HEADER = 'h' // <transferId>:<typeDescriptor>:<byteLength>\nexport const MT_TRANSFER_BINARY_DATA = 'b' // <transferId>:<base64Data>\n\nexport const M_SEP = ':'\n\nexport const ID_BASE = 36 // The radix of the serialized channel IDs\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/constants.js","\nimport {Interop} from 'sdp-interop'\n\nimport log from 'common/log'\nimport EmitterMixin from 'common/emitter'\nimport {defer, isChrome, isFirefox, randomString} from 'common/utils'\n\nimport attachPeerConnectionMonitor from 'webrtc/peerConnectionMonitor'\nimport DummySource from 'media/dummySource'\nimport {addPeerConnectionStream, removePeerConnectionStream} from 'webrtc/utils'\nimport {\n  parseCandidateInfo,\n  filterSdpCandidates,\n  workaroundSdpBundleBug,\n  extractApplicationBlock,\n  injectApplicationBlock,\n  readMediaModeUnions,\n  overrideMediaModes,\n  disableSendBandwidthEstimation,\n  rewriteBundleAttribute,\n  removeChromeRetransmission,\n} from 'webrtc/sdpTransform'\n\nconst TAG = 'peer-connection'\n\nconst EVENT_HANDLER_ERROR_TEMPLATE = 'onFUNC is not available, use addEventListener instead'\n\nclass IceConfigErrorDetector {\n  constructor(iceServers) {\n    this._haveTurn = false\n    this._haveStun = false\n    if (iceServers) {\n      iceServers.forEach(server => {\n        let url = server.urls || server.url\n        if (!url) {\n          log.error('peer-connection', `ice server has no url: ${JSON.stringify(server)}`)\n        }\n        if (url.indexOf('stun:') === 0) {\n          this._haveStun = true\n        }\n        if (url.indexOf('turn:') === 0) {\n          this._haveStun = true\n          this._haveTurn = true\n        }\n      })\n    }\n  }\n  observedCandidate(info) {\n    if (info.type !== 'host') {\n      this._gotStun = true\n    }\n    if (info.type === 'relay') {\n      this._gotTurn = true\n    }\n  }\n  end(iceConnectionState) {\n    // We might not bother gathering candidates with lower priority if we find a good connection\n    // early. But if that happens we will have moved on from iceConnectionState 'new'.\n    // So we only want to continue the check if we're still in 'new' state.\n    if (iceConnectionState !== 'new') {\n      return null\n    }\n    if (this._haveTurn && !this._gotTurn) {\n      let msg = \"'iceServers' contained a turn server, but no relay candidates were received.\" +\n        ' Check the turn server configuration and availability.'\n      log.warning('peer-connection', msg)\n      return 'turn'\n    } else if (this._haveStun && !this._gotStun) {\n      let msg = \"'iceServers' contained a stun server, but no stun candidates were received.\" +\n        ' Check the stun server configuration and availability.'\n      log.warning('peer-connection', msg)\n      return 'stun'\n    }\n    return null\n  }\n}\n\nexport default class PeerConnectionProxy {\n  static create(config) {\n    config = config || {}\n    var statsFormatter = config.statsFormatter\n    var rtcpMuxPolicy = config.rtcpMuxPolicy || 'require'\n    var bundlePolicy = config.bundlePolicy || 'max-bundle'\n    var iceServers = config.iceServers\n    var iceCandidateFilter = config.iceCandidateFilter\n    if (typeof(iceServers) === 'string') {\n      iceServers = [iceServers]\n    } else if (!Array.isArray(iceServers)) {\n      iceServers = []\n    }\n    iceServers = iceServers.map(function (server) {\n      if (typeof(server) === 'string') {\n        return {\n          urls: server,\n        }\n      } else {\n        return server\n      }\n    })\n    var pcConfig = {iceServers, rtcpMuxPolicy, bundlePolicy}\n    return new PeerConnectionProxy(pcConfig, statsFormatter, iceCandidateFilter)\n  }\n\n  constructor(pcConfig, statsFormatter, iceCandidateFilter) {\n    log.debug(TAG, 'creating peer connection with config:', pcConfig)\n    this._pc = new RTCPeerConnection(pcConfig)\n    this._iceCandidateFilter = iceCandidateFilter\n    this._eventTarget = new EmitterMixin()\n    this._id = randomString(30)\n    this._interop = new Interop()\n    this._iceErrorDetector = new IceConfigErrorDetector(pcConfig.iceServers)\n    this._firstMid = null\n\n    this.addEventListener = this.addEventListener.bind(this)\n    this.addStream = this.addStream.bind(this)\n    this.close = this.close.bind(this)\n    this.getLocalStreams = this.getLocalStreams.bind(this)\n    this.getRemoteStreams = this.getRemoteStreams.bind(this)\n    this.addIceCandidate = this.addIceCandidate.bind(this)\n    this._createAnswer = this._createAnswer.bind(this)\n    this._createOffer = this._createOffer.bind(this)\n    this.getStats = this.getStats.bind(this)\n    this._setLocalDescription = this._setLocalDescription.bind(this)\n    this._setRemoteDescription = this._setRemoteDescription.bind(this)\n    this.removeEventListener = this.removeEventListener.bind(this)\n    this.removeStream = this.removeStream.bind(this)\n\n    this._pc.oniceconnectionstatechange = event => {\n      this._eventTarget._emit('iceconnectionstatechange', {target: this})\n    }\n\n    this._pc.onnegotiationneeded = event => {\n      this._eventTarget._emit('negotiationneeded', {target: this})\n    }\n\n    this._pc.onsignalingstatechange = event => {\n      this._eventTarget._emit('signalingstatechange', {target: this})\n    }\n\n    this._pc.onaddstream = event => {\n      this._eventTarget._emit('addstream', {target: this, stream: event.stream})\n    }\n\n    this._pc.onremovestream = event => {\n      this._eventTarget._emit('removestream', {target: this, stream: event.stream})\n    }\n\n    this._pc.ondatachannel = event => {\n      let {channel} = event\n      log.warning('data-channel', \"received data channel, which shouldn't happen\")\n      this._eventTarget._emit('datachannel', {target: this, channel: channel})\n    }\n\n    let deferredIce = defer()\n    this._initialIceComplete = deferredIce.promise\n\n    this._pc.onicecandidate = event => {\n      let {candidate} = event\n      if (!candidate) {\n        this._eventTarget._emit('icecandidate', {target: this, candidate})\n        if (this._iceErrorDetector) {\n          if (this._iceErrorDetector.end(this._pc.iceConnectionState) === 'turn') {\n            deferredIce.reject(new Error('No relay candidates received while turn server was configured'))\n          }\n          this._iceErrorDetector = null\n        }\n        deferredIce.resolve()\n        return\n      }\n\n      let info = parseCandidateInfo(candidate.candidate, 'local')\n      if (this._iceErrorDetector) {\n        this._iceErrorDetector.observedCandidate(info)\n      }\n\n      if (this._iceCandidateFilter) {\n        try {\n          if (!this._iceCandidateFilter(info)) {\n            log.debug(TAG, `ignored candidate due to being filtered out: ${candidate}`)\n            return\n          }\n        } catch (error) {\n          log.error(TAG, `ignoring candidate, error was thrown in candidate filter: ${error}`)\n          return\n        }\n      }\n\n      if (isFirefox) {\n        let [, simpleMid] = candidate.sdpMid.match(/^(audio|video)-[0-9]+$/) || []\n        if (simpleMid) {\n          candidate.sdpMid = simpleMid\n        }\n      }\n\n      this._eventTarget._emit('icecandidate', {target: this, candidate})\n    }\n\n    if (statsFormatter) {\n      attachPeerConnectionMonitor(this, statsFormatter)\n    }\n  }\n\n  get id() {\n    return this._id\n  }\n\n  get signalingState() {\n    return this._pc.signalingState\n  }\n\n  get iceConnectionState() {\n    return this._pc.iceConnectionState\n  }\n\n  get iceGatheringState() {\n    return this._pc.iceGatheringState\n  }\n\n  get hasRemoteDescription() {\n    let {remoteDescription} = this._pc\n    return !!remoteDescription && !!remoteDescription.type\n  }\n\n  set onaddstream(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'addstream'))\n  }\n\n  set ondatachannel(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'datachannel'))\n  }\n\n  set onicecandidate(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'icecandidate'))\n  }\n\n  set oniceconnectionstatechange(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'iceconnectionstatechange'))\n  }\n\n  set onnegotiationneeded(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'negotiationneeded'))\n  }\n\n  set onremovestream(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'removestream'))\n  }\n\n  set onsignalingstatechange(value) {\n    throw new Error(EVENT_HANDLER_ERROR_TEMPLATE.replace('FUNC', 'signalingstatechange'))\n  }\n\n  toString() {\n    return `peerConnection{id=${this._id}}`\n  }\n\n  addEventListener(event, listener) {\n    return this._eventTarget.on(event, listener)\n  }\n\n  removeEventListener(event, listener) {\n    return this._eventTarget.off(event, listener)\n  }\n\n  addStream(stream) {\n    return addPeerConnectionStream(this._pc, stream)\n  }\n\n  removeStream(stream) {\n    return removePeerConnectionStream(this._pc, stream)\n  }\n\n  getLocalStreams() {\n    return this._pc.getLocalStreams().filter(stream => stream !== this._dummyStream)\n  }\n\n  getRemoteStreams() {\n    return this._pc.getRemoteStreams()\n  }\n\n  close() {\n    return this._pc.close()\n  }\n\n  // performOffer, performAnswer, and handleAnswer are high-level versions\n  // of the setLocal/RemoteDescription and createOffer/Answer dance.\n  // We use higher-level constructs because that allows us to make some assuptions\n  // that makes sdp transformations easier and cheaper to do. e.g. we don't need\n  // to support using both the description received from setLocalDescription and\n  // createOffer/Answer, as well as the localDescription property, and instead just\n  // munge the SDP once.\n  performOffer({constraints = null, bandwidth = null, waitForIce = false}) {\n    // Chrome 57 introduced a bug that breaks renegotiation of additional media\n    // blocks if the initial connection only included data channels. We work around\n    // this by adding a dummy stream that forces a video block to be added.\n    // Simply setting OfferToCreateVideo/Audio constraints does not work.\n    //\n    // We used to remove the dummy stream once a real stream is added, but this\n    // seems to now break sendonly connections towards Firefox. If the dummy\n    // stream is replaced without any incoming connection, all communication seems\n    // to break, including data channels.\n    // So for now we just keep the dummy stream around until we find a better solution.\n    //\n    // TODO: A possible workaround is to use constructed MediaStream instances as the\n    // streams that are added to the RTCPeerConnections. When adding streams we instead\n    // just take the tracks and add those to the existing streams. More importantly\n    // we never remove streams from the RTCPeerConnection, just remove the tracks\n    // from the stream.\n    if (isChrome && this._pc.getLocalStreams().length === 0) {\n      let dummy = new DummySource({video: true, audio: true})\n      this.addStream(dummy.stream)\n      this._dummyStream = dummy.stream\n    }\n\n    return this._createOffer(constraints)\n      .then(desc => this._rewriteLocalInputDescription(desc, {bandwidth}))\n      .then(desc => this._setLocalDescription(desc))\n      .then(offer => {\n        if (waitForIce) {\n          return this._initialIceComplete.then(() => this._pc._localDescription)\n        } else {\n          return offer\n        }\n      })\n      .then(desc => this._rewriteLocalOutputDescription(desc))\n  }\n\n  performAnswer({offer, constraints = null, bandwidth = null}) {\n    return Promise.resolve(offer)\n      .then(desc => this._rewriteRemoteInputDescription(desc))\n      .then(desc => this._setRemoteDescription(desc))\n      .then(() => this._createAnswer(constraints))\n      .then(desc => this._rewriteLocalInputDescription(desc, {bandwidth}))\n      .then(desc => this._setLocalDescription(desc))\n      .then(desc => this._rewriteLocalOutputDescription(desc))\n  }\n\n  handleAnswer({answer}) {\n    return Promise.resolve(answer)\n      .then(desc => this._rewriteRemoteInputDescription(desc))\n      .then(desc => this._setRemoteDescription(desc))\n  }\n\n  _rewriteLocalInputDescription(desc, {bandwidth}) {\n    let {sdp, type} = desc\n\n    if (bandwidth) {\n      sdp = sdp.replace(/^b=AS:[0-9]+$/gm, `b=AS:${bandwidth}`)\n    }\n\n    // TODO: only do this in Chrome 58 & 59\n    if (isChrome) {\n      sdp = disableSendBandwidthEstimation(sdp)\n    }\n\n    if (this._iceCandidateFilter) {\n      sdp = filterSdpCandidates(sdp, this._iceCandidateFilter, 'local')\n    }\n\n    sdp = workaroundSdpBundleBug(sdp)\n\n    return new RTCSessionDescription({sdp, type})\n  }\n\n  _rewriteLocalOutputDescription(desc) {\n    let {sdp, type} = desc\n    var unifiedPlanSdp\n\n    if (isFirefox && !this._firstMid) {\n      // Start off by grabbing the mid for the first media block. This has to be\n      // done straight away and stored, since future renegotiatons may inactivate the\n      // block and remove the mid from the SDP.\n      // We need this in order to add ICE candidates, since we will be receiving candidates\n      // that have translated mIds.\n      let [, mid] = desc.sdp.match(/^a=mid:(.+)$/m) || []\n      if (mid) {\n        this._firstMid = mid\n      }\n    }\n\n    if (this._iceCandidateFilter) {\n      sdp = filterSdpCandidates(sdp, this._iceCandidateFilter, 'local')\n    }\n\n    if (isFirefox) {\n      unifiedPlanSdp = desc.sdp\n      let [extractedSdp, extracted] = extractApplicationBlock(desc.sdp)\n      sdp = extractedSdp\n      if (extracted && extracted.needsInteropTranslation) {\n        // Firefox uses the unified SDP format, which adds multiple media blocks,\n        // one block for each track. Each block has an individual mode describing if it's\n        // inactive, sending, receiving, or both (inactive, sendonly, recvonly, sendrecv).\n        // When that SDP is converted to plan B format, which has a single media block\n        // for each media type, only the last mode mentioned in the SDP will\n        // be used, which will often break the connection.\n        // readMediaModeUnions() reads the modes of the different media types\n        // in the initial SDP and creates a union for each media type, e.g.\n        // sendonly | recvonly = sendrecv, inactive | sendonly = sendonly, etc.\n        // overrideMediaModes() then injects those union modes to the plan B SDP.\n        let mediaModeUnions = readMediaModeUnions(desc.sdp)\n        sdp = this._interop.toPlanB({type: desc.type, sdp}).sdp\n        sdp = overrideMediaModes(sdp, mediaModeUnions)\n\n        // The interop SDP transform doesn't always rewrite the bundle\n        // attribute properly, so we recreate it just in case\n        sdp = rewriteBundleAttribute(sdp)\n      }\n      sdp = injectApplicationBlock(sdp, extracted)\n      log.verbose(TAG, `converted local ${desc.type} SDP from unified plan ${unifiedPlanSdp}\\n\\nto\\n\\n${sdp}`)\n    }\n\n    return {\n      sdp,\n      type,\n      unifiedPlanSdp,\n    }\n  }\n\n  _rewriteRemoteInputDescription(desc) {\n    let {sdp, type, unifiedPlanSdp} = desc\n\n    if (this._iceCandidateFilter) {\n      sdp = filterSdpCandidates(sdp, this._iceCandidateFilter, 'remote')\n    }\n\n    if (isFirefox) {\n      // When we receive a description it might already contain a unified plan SDP\n      // if it was sent by Firefox, use it directly in that case\n      if (unifiedPlanSdp) {\n        sdp = unifiedPlanSdp\n      } else {\n        // Otherwise we need to convert the SDP from plan B to unified plan\n        let oldSdp = desc.sdp\n        let [extractedSdp, extracted] = extractApplicationBlock(desc.sdp)\n        sdp = extractedSdp\n        sdp = removeChromeRetransmission(sdp)\n        if (extracted && extracted.needsInteropTranslation) {\n          sdp = this._interop.toUnifiedPlan({type: desc.type, sdp}).sdp\n        }\n        sdp = injectApplicationBlock(sdp, extracted)\n        log.verbose(TAG, `converted remote ${desc.type} SDP from plan b ${oldSdp}\\n\\nto\\n\\n${sdp}`)\n      }\n    }\n\n    return new RTCSessionDescription({\n      sdp,\n      type,\n    })\n  }\n\n  _setLocalDescription(desc) {\n    log.verbose(TAG, this + '.setLocalDescription', desc.sdp)\n    return new Promise((resolve, reject) => {\n      this._pc.setLocalDescription(desc, () => {\n        resolve(desc)\n      }, error => {\n        reject(makeError('setLocalDescription', 'failed to set local description', error))\n      })\n    })\n  }\n\n  _setRemoteDescription(desc) {\n    log.verbose(TAG, this + '.setRemoteDescription', desc.sdp)\n    return new Promise((resolve, reject) => {\n      this._pc.setRemoteDescription(desc, () => {\n        resolve()\n      }, error => {\n        reject(makeError('setRemoteDescription', 'failed to set remote description', error))\n      })\n    })\n  }\n\n  _createOffer(constraints) {\n    log.verbose(TAG, this + '.createOffer')\n    return new Promise((resolve, reject) => {\n      this._pc.createOffer(desc => {\n        if (!desc) {\n          reject(new Error('failed to create offer, no offer generated'))\n        } else {\n          resolve(desc)\n        }\n      }, error => {\n        reject(makeError('createOffer', 'failed to create offer', error))\n      }, constraints)\n    })\n  }\n\n  _createAnswer(constraints) {\n    log.verbose(TAG, this + '.createAnswer')\n    return new Promise((resolve, reject) => {\n      this._pc.createAnswer(desc => {\n        if (!desc) {\n          return reject(new Error('failed to create answer, no answer generated'))\n        }\n        resolve(desc)\n      }, error => {\n        reject(makeError('createAnswer', 'failed to create answer', error))\n      }, constraints)\n    })\n  }\n\n  addIceCandidate(candidate) {\n    if (candidate.sdpMLineIndex !== 0) {\n      log.debug(TAG, `ignored candidate with sdpMLineIndex != 0, ${candidate.sdpMLineIndex}`)\n      return Promise.resolve()\n    }\n    if (!(candidate instanceof RTCIceCandidate)) {\n      candidate = new RTCIceCandidate(candidate)\n    }\n    if (this._iceCandidateFilter) {\n      try {\n        let info = parseCandidateInfo(candidate.candidate, 'remote')\n        if (!this._iceCandidateFilter(info)) {\n          log.debug(TAG, `ignored candidate due to being filtered out: ${candidate}`)\n          return Promise.resolve()\n        }\n      } catch (error) {\n        log.error(TAG, `ignoring candidate, error was thrown in candidate filter: ${error}`)\n        return Promise.resolve()\n      }\n    }\n    if (isFirefox) {\n      if (!this._firstMid) {\n        return Promise.reject(new Error('Tried to add ice candidate before local description was set'))\n      }\n      candidate.sdpMid = this._firstMid\n    }\n    return new Promise((resolve, reject) => {\n      this._pc.addIceCandidate(candidate, resolve, error => {\n        reject(makeError('addIceCandidate', 'failed add ice candidate', error))\n      })\n    })\n  }\n\n  createDataChannel(label, config) {\n    return this._pc.createDataChannel(label, config)\n  }\n\n  getStats(selector) {\n    if (isFirefox) {\n      return this._pc.getStats(selector)\n    }\n    return new Promise((resolve, reject) => {\n      this._pc.getStats(response => {\n        var standardReport = {}\n        response.result().forEach(report => {\n          var standardStats = {\n            id: report.id,\n            type: report.type,\n          }\n          report.names().forEach(name => {\n            standardStats[name] = report.stat(name)\n          })\n          standardReport[standardStats.id] = standardStats\n        })\n        resolve(standardReport)\n      }, selector, reject)\n    })\n  }\n}\n\nfunction makeError(funcName, message, reason) {\n  let msg = `Error in ${funcName}, ${message}`\n  try {\n    let error = new Error(`${msg}: ${reason}`)\n    error.reason = reason\n    error.stack = reason.stack\n    return error\n  } catch (error) {\n    return new Error(`${msg} and failed to serialize root cause: ${error}`)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/peerConnectionProxy.js","module.exports = { \"default\": require(\"core-js/library/fn/object/assign\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/assign.js\n// module id = 174\n// module chunks = 0 3","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\n\nimport Log from 'conference/raftLog'\nimport {OP} from 'conference/raftLogEntry'\nimport Configuration, {\n  ConfigurationData,\n  Members,\n  Votes,\n} from 'conference/raftConfiguration'\nimport MeshTopology from 'conference/meshTopology'\nimport StateMachine from 'conference/raftStateMachine'\nimport {\n  LeaderState,\n  FollowerState,\n  JoinerState,\n  EXPECTED_RTT_MS,\n} from 'conference/raftState'\nimport RaftMessage, {\n  AppendEntriesRequest,\n  AppendEntriesResponse,\n  RequestVoteRequest,\n  RequestVoteResponse,\n  PreVoteRequest,\n  PreVoteResponse,\n  SnapshotRequest,\n  SnapshotResponse,\n  StateOpRequest,\n  StateOpResponse,\n} from 'conference/raftMessages'\n\n/*\n  Conferencing consensus plan:\n\n  Raft (https://raft.github.io/) provides a simple consensus algorithm which\n  is quite easy to implement and prove to be correct. It does not provide\n  Byzantine fault tolerance, i.e. it assumes that all clients behave correctly.\n\n  Each conference client participates in the Raft consensus protocol, there are no\n  client-only nodes, like e.g. in etcd.\n  The primary purpose of the Raft implementation is to provide a unified view of who the\n  members of the conference are. Although it might prove to be useful for other types of\n  log replication at a later stage.\n\n  Raft supports controlled reconfiguration of the cluster members, which means that clients\n  can be added and removed as long as a majority of the current cluster can agree on the change.\n  For conferences we will sometimes see big changes in the number of participants. Adding\n  members is quite straight-forward to do with the baseline Raft implementation, even if\n  the new members make up the majority in the new configuration. Removing members is also\n  straight-forward as long as the removed clients stay connected until the new configuration\n  is in place.\n  The tricky bit is getting rid of disconnected clients. The cluster needs to be able to\n  reach a consensus that a client has been disconnected and can be removed. This will be\n  even more troublesome if a majority of the cluster disconnects, as it may cause the\n  new configuration and the entire cluster to get stuck in a bad state. Some mechanism\n  for handling netsplits by letting minorities break away from the cluster needs to be\n  implemented, as well as a mechanism for those clients to potentially rejoin the cluster\n  at a later point.\n\n  Alternative approaches:\n\n  The main alternative to using Raft that is being considered is that all peers would\n  simply broadcast the peers that they are connected to to all their connected peers.\n  This way every peer would be able to get a somewhat complete view of the members,\n  although it would fail to report peers that are more than two hops away. Consider\n  the below scenario where clients A, B, C and D only have 3 connections set up so far.\n\n    A <-> B <-> C <-> D\n\n  With the proposed solution, A would be unaware of D's existence, and vice versa.\n  This could be worked around by sending more information between the peers, with the\n  downside of added complexity and bandwidth usage.\n  Btw, Raft does not behave perfectly in the above scenario either, as A and D would take\n  turns in triggering new elections, but there will still be some log replication happening\n  and new connections should be set up soon enough.\n\n  Another issue is feedback for the clients, should A respond to requests from B? Raft solves\n  this with heartbeats and election timeouts.\n\n  In the end the main reason for choosing Raft is that it is an established algorithm that\n  is simple and easy to proove to be correct. Since raft needs to be extended a bit in order\n  to work for conferences, it is possible that this alternative is reveisited if the\n  modifications end up being too complex.\n  A downside of using Raft is that the log replication functionality is not used at the\n  moment, and it arguably what adds the most complexity to the algorithm. However, it is\n  quite likely that it will be used in the future for Smart Mesh or SFU.\n\n  Conference setup flow:\n\n  An important piece of functionality for the below flow is that it is possible to generate\n  a single offer that is valid for multiple peer connections, as long as all peer connections\n  are configured to use the same certificate. We will try to use this functionality initially\n  but may have to fall back to a more tranditional singaling approach if we run into trouble\n  with plugins and native mobile clients.\n\n  When joining a conference, send a JOIN message with the Raft ID and an offer SDP.\n  Now one of two things may happen, either there is already an existing conference and the\n  client will be added, or no one replies, and we wait. We likely want to repeat the JOIN\n  message every so often while waiting, in order to provide some fault tolerance.\n\n  When an existing conference sees a JOIN message a number of different things may happen\n  depending on the state of the conference. But this is the general algorithm:\n\n  (1) Upon receiving a JOIN message, every client adds the peer to a list of joining peers.\n  (2) Every client that is a leader (there may be multiple with different terms) will\n      send an answer to the joining peer. The joiner will set up a connection for each answer.\n  (3) Once connected the leader(s) will add the peer as a joining client, and will start\n      off by sending a snapshot of the current state. Once a reply from the snapshot request\n      has been received the leader will request a configuration change which includes the new\n      client.\n      The joining client will prioritize snapshots with the latest term, and ignored old ones.\n      Once the client has received a configuration where they are present and the configuration\n      has been committed, they will convert to a follower and be a full member of the cluster.\n      During this time, the joining client will communicate via the current p2p connections\n      to set up new connections towards the other members of the cluster.\n  (4) If there is a leadership change during the above process, the new leader will start over\n      at (2), that is if the client has not already joined the cluster. This is why every\n      client must keep track of JOIN messages.\n\n  Removing disconnected members:\n\n  The current plan is that each client will include the clients that it is not connected\n  to in the heartbeat responses. That will make it possible for the leader to detect when\n  no client is able to reach another client, and may then initiate a reconfiguration.\n\n  The trickier problem of handling netsplits where the conference is split into segments\n  is not yet solved. The current idea is to modify the voting algorithm and have vote\n  requests include connected peers. Hopefully it'll be possible to find a simple way to\n  simultaneously do an instant reconfiguration and leader election. This is probably\n  doable because the majority log consistency constraint can be ignored. When the segment\n  that has been spliced out rejoins the conference, the logs don't have to be consistent,\n  it'll be possible to just do a regular join via snapshots.\n\n  Updates:\n\n  25-03-2017, Client IDs:\n\n  The current implementation uses separate IDs for users and raft client, i.e. there is a 1-N mapping\n  of user to raft IDs. This is because if the raft client state is lost is it no longer safe to rejoin\n  the cluster using the same ID. Entries are committed based on the knowledge that clients are up to date,\n  and if a client loses it's state and then reconnects using the same ID, incorrect assumptions may be\n  made about what entries are actually committed.\n\n  A planned change will consolidate the IDs to only use user IDs for all clients. This makes the conference\n  implementation a lot simpler and easier to reason about. The reason this change can be made is the\n  introduction of the Joiner state and messages. Built into the raft algorithm is the guarantee that if\n  there exists a commit index N within the cluster, only clients that have at least N matching entries\n  can ever be elected leader. Since clients that are joining the cluster always do so through a leader,\n  it means that if a client reconnects, it will always receive a snapshot that restores at least N entries.\n  This means that any commit index determined by a leader will stay correct, even if a client loses it's\n  state and reconnects.\n\n  One caveat is that clients that lose their state MUST rejoin the cluster through the joiner mechanism.\n  If they simply rejoin as members then the above assumption does not hold and the implementation is not safe.\n\n  The crucial bit is that reconnecting members do not vote until they have received a snapshot. It is also\n  important that all snapshots that are sent contain all of the current log entries of the leader, otherwise\n  reconnecting members might receive a partial snapshot were they are member, and begin voting too early.\n\n  It is also possible that the disconnected client will be removed from the cluster before it rejoins. In\n  that case the original rule of the raft algorithm applies, since if it is possible to update the\n  configuration without the participation of the disconnected client, then the entries prior to the\n  reconfiguration can be considered committed, even without the disconnected client.\n\n  If the reconfiguration can not be committed due to lack of majority, the state machine will lock up until\n  either the member reconnects, or some other mechanism is used to recover. The change proposed above does\n  not solve this issue, but it likely does not make it more difficult to solve either.\n */\n\nclass WaitList {\n  constructor() {\n    this._entries = new Map()\n  }\n\n  add({peerId, mustRejoin, ttlMs}) {\n    let endTime = Date.now() + ttlMs\n\n    if (this._entries.has(peerId)) {\n      let entry = this._entries.get(peerId)\n      endTime = Math.max(endTime, entry.endTime)\n      mustRejoin = mustRejoin || entry.mustRejoin\n    }\n\n    this._entries.set(peerId, {endTime, mustRejoin})\n  }\n\n  delete(peerId) {\n    this._entries.delete(peerId)\n  }\n\n  deleteAll(peerIds) {\n    peerIds.forEach(peerId => this.delete(peerId))\n  }\n\n  get() {\n    let waiting = new Set()\n    let deleted = new Set()\n    let now = Date.now()\n    this._entries.forEach(({mustRejoin, endTime}, peerId) => {\n      if (now < endTime) {\n        waiting.add({peerId, mustRejoin})\n      } else {\n        deleted.add(peerId)\n      }\n    })\n    deleted.forEach(peerId => this._entries.delete(peerId))\n    return waiting\n  }\n\n  clear() {\n    this._entries.clear()\n  }\n}\n\nconst TAG = 'raft'\n\nconst ELECTION_DEADLOCK_LIMIT = 3\n\nexport default class Raft {\n  constructor(options = {}) {\n    let {\n      id,\n      meshTopology,\n      onMessage,\n      onStateChange,\n      onMembersChange,\n      onLeadershipChange,\n      onReplicationDeadlock,\n    } = options\n\n    this._send = this._send.bind(this)\n    this._onElectionTimeout = this._onElectionTimeout.bind(this)\n    this._onConfigurationCommitted = this._onConfigurationCommitted.bind(this)\n\n    this._id = argCheck.string(this, 'id', id)\n    argCheck.instance(this, 'meshTopology', meshTopology, MeshTopology)\n    this._onMessage = argCheck.optFunc(this, 'onMessage', onMessage)\n    argCheck.optFunc(this, 'onStateChange', onStateChange)\n    this._onMembersChange = argCheck.optFunc(this, 'onMembersChange', onMembersChange)\n    this._onLeadershipChange = argCheck.optFunc(this, 'onLeadershipChange', onLeadershipChange)\n    this._onReplicationDeadlock = argCheck.optFunc(this, 'onReplicationDeadlock', onReplicationDeadlock)\n\n    this._raftState = null\n    this._electionTimeoutId = null\n    this._electionTimeoutTriggerCount = 0\n    this._waitList = new WaitList()\n    this._stateMachine = new StateMachine({\n      onStateChange,\n      onConfigurationCommitted: this._onConfigurationCommitted,\n      onStateOpRequest: request => this._raftState && this._raftState.forwardStateOpRequest(request),\n    })\n    this._log = new Log({\n      meshTopology,\n      configuration: new Configuration({ownId: id}),\n      stateMachine: this._stateMachine,\n    })\n  }\n\n  toString() {\n    return `raft{id=${this.id},${this._raftState},${this._log},${this._stateMachine}}`\n  }\n\n  get id() {\n    return this._id\n  }\n\n  get log() {\n    return this._log\n  }\n\n  get isLeader() {\n    return this._raftState instanceof LeaderState\n  }\n\n  get members() {\n    return this._log.configuration.members\n  }\n\n  get term() {\n    if (!this._raftState) {\n      return 0\n    }\n    return this._raftState._term\n  }\n\n  start(initialMembers = [this.id]) {\n    this.stop()\n    this._stateMachine.start()\n\n    let data = new ConfigurationData(new Members(initialMembers))\n    this._log.configuration.set(data)\n\n    if (this.log.configuration.hasMajority(new Votes(this._id))) {\n      this._setState(new LeaderState(this._log, this._send, 1))\n      log.debug(TAG, this, 'starting as leader, signaling configuration commit')\n      this._onConfigurationCommitted()\n    } else {\n      this._setState(new FollowerState(this._log, this._send))\n    }\n  }\n\n  startPassive() {\n    this.stop()\n    this._stateMachine.start()\n    this._setState(new JoinerState(this._log, this._send))\n  }\n\n  stop() {\n    if (this._raftState && this._raftState.stop) {\n      this._raftState.stop()\n    }\n    this._stateMachine.stop()\n\n    this._waitList.clear()\n\n    this._log.clear()\n    let data = new ConfigurationData(new Members())\n    this._log.configuration.set(data)\n\n    this._setState(null) // Use _setState to properly trigger leadership change\n    this._stopElectionTimeout()\n  }\n\n  get(key) {\n    argCheck.string('Raft.get', 'key', key)\n    return this._stateMachine.state[key]\n  }\n\n  append(key, value, {retryTtlMs = 3000} = {}) {\n    argCheck.string('Raft.append', 'key', key)\n    if (!this._raftState) {\n      return Promise.reject(new Error('Raft is stopped'))\n    }\n    return this._stateMachine.requestStateOp({\n      op: OP.append,\n      args: [key, value],\n      retryTtlMs,\n    })\n  }\n\n  set(key, value, {retryTtlMs = 3000} = {}) {\n    argCheck.string('Raft.set', 'key', key)\n    if (!this._raftState) {\n      return Promise.reject(new Error('Raft is stopped'))\n    }\n    return this._stateMachine.requestStateOp({\n      op: OP.set,\n      args: [key, value],\n      retryTtlMs,\n    })\n  }\n\n  // mustRejoin should be true if the peer is currently in another cluster. Otherwise\n  // we will end up with inconsistencies in the raft log.\n  addPeer(peerId, {mustRejoin = true, waitlistTtlMs = 0} = {}) {\n    this._waitList.add({peerId, mustRejoin, ttlMs: waitlistTtlMs})\n    if (this._raftState && this._raftState.addPeer) {\n      this._raftState.addPeer({peerId, mustRejoin})\n    }\n  }\n\n  _send(peerId, body) {\n    log.verbose(TAG, this, `send message to '${peerId}': ${body}`)\n    this._onMessage(peerId, body)\n  }\n\n  _setState(newState) {\n    let wasLeader = this._raftState instanceof LeaderState\n    this._raftState = newState\n    if (this._raftState instanceof LeaderState) {\n      this._stopElectionTimeout()\n      this._waitList.get().forEach(({peerId, mustRejoin}) => {\n        // Even after becoming leader we must add the peers from the waitlist, in case they never got\n        // a snapshot from the previous leader.\n        // This means that reconnecting clients will keep getting snapshots from new leaders until the add\n        // ttl runs out, so it should not be too long.\n        this._raftState.addPeer({peerId, mustRejoin})\n      })\n    } else if (this._raftState instanceof JoinerState) {\n      this._stopElectionTimeout()\n    } else {\n      this._resetElectionTimeout()\n    }\n    if (this._onLeadershipChange) {\n      let isLeader = this._raftState instanceof LeaderState\n      if (wasLeader !== isLeader) {\n        log.info(TAG, this, 'changed leadership status')\n        this._onLeadershipChange(isLeader)\n      }\n    }\n  }\n\n  handleMessage(peerId, body) {\n    if (!this._raftState) {\n      return\n    }\n    let message = RaftMessage.parse(body)\n    log.verbose(TAG, this, `receive message from '${peerId}': ${message}`)\n    if (message.term && message.term < this._raftState._term) {\n      // Old responses are always silently ignored\n      // Old requests are always rejected, but send reply so the peer can be updated\n      if (message.isRequest) {\n        this._send(peerId, message.response({term: this._raftState._term}))\n      }\n    } else {\n      var newState\n      switch (message.constructor) {\n        case AppendEntriesRequest:\n          newState = this._raftState.handleAppendEntriesRequest(peerId, message)\n          break\n        case AppendEntriesResponse:\n          newState = this._raftState.handleAppendEntriesResponse(peerId, message)\n          break\n        case RequestVoteRequest:\n          newState = this._raftState.handleRequestVoteRequest(peerId, message)\n          break\n        case RequestVoteResponse:\n          newState = this._raftState.handleRequestVoteResponse(peerId, message)\n          break\n        case PreVoteRequest:\n          newState = this._raftState.handlePreVoteRequest(peerId, message)\n          break\n        case PreVoteResponse:\n          newState = this._raftState.handlePreVoteResponse(peerId, message)\n          break\n        case SnapshotRequest:\n          newState = this._raftState.handleSnapshotRequest(peerId, message)\n          break\n        case SnapshotResponse:\n          newState = this._raftState.handleSnapshotResponse(peerId, message)\n          break\n        case StateOpRequest:\n          newState = this._raftState.handleStateOpRequest(peerId, message)\n          break\n        case StateOpResponse:\n          // StateOp responses are handled by the state machine, since the state\n          // doesn't have any use for it anyway, and the state machine uses\n          // it for quicker feedback.\n          this._stateMachine.handleStateOpResponse(peerId, message)\n          break\n      }\n      // _raftState is not set we were stopped in the handler\n      if (newState && this._raftState) {\n        this._setState(newState)\n      }\n    }\n  }\n\n  _resetElectionTimeout() {\n    log.verbose(TAG, this, 'election timer restarted')\n    if (this._electionTimeoutId) {\n      this._electionTimeoutTriggerCount = 0\n      clearTimeout(this._electionTimeoutId)\n    }\n    let timeoutMs = EXPECTED_RTT_MS * 8 + EXPECTED_RTT_MS * 12 * Math.random()\n    this._electionTimeoutId = setTimeout(this._onElectionTimeout, timeoutMs)\n  }\n\n  _stopElectionTimeout() {\n    if (this._electionTimeoutId) {\n      log.verbose(TAG, this, 'election timer stopped')\n      clearTimeout(this._electionTimeoutId)\n      this._electionTimeoutId = null\n    }\n  }\n\n  _onElectionTimeout() {\n    this._electionTimeoutId = null\n    log.info(TAG, this, 'election timeout')\n    // We timed out waiting for heartbeat, start campaigning for leadership of next term\n    if (this.log.configuration.hasMajority(new Votes(this._id))) {\n      this._setState(this._raftState.toLeader(this._raftState._term + 1))\n    } else {\n      this._electionTimeoutTriggerCount += 1\n      if (this._electionTimeoutTriggerCount > ELECTION_DEADLOCK_LIMIT) {\n        this._onReplicationDeadlock()\n      } else {\n        this._setState(this._raftState.toCandidate(this._raftState._term + 1, false))\n      }\n    }\n  }\n\n  _onConfigurationCommitted() {\n    log.debug(TAG, this, 'committed new configuration')\n\n    this._waitList.deleteAll(this.log.configuration.members)\n    if (this._onMembersChange) {\n      Promise.reject().catch(() => {\n        this._onMembersChange(this.log.configuration.members)\n      })\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raft.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {assertPriv, isObject} from 'common/utils'\n\n/**\n * Emitted when any account data entry changes.\n *\n * @event AccountData#update\n * @param {Object} change\n * @param {string} change.key - The key whose value was changed.\n * @param {JsonTypes} change.value - The new value that the key is now associated with.\n * @param {JsonTypes} change.oldValue - The value that the key was previously associated with, if any.\n */\n\n/**\n * Emitted when the value associated with the given key is changed.\n *\n * @event AccountData#update:&lt;key&gt;\n * @param {JsonTypes} value - The new value that the key is now associated with.\n * @param {JsonTypes} oldValue - The value that the key was previously associated with, if any.\n */\n\n/**\n * Represents account data that is persistent and unique to each client.\n * It is synchronized between all clients of the same user, and can be\n * used for e.g. settings or unread notifications.\n *\n * Account data can be scoped either to the user or to a room. It is accessed\n * through {@link Client.accountData} and {@link Room.accountData}.\n *\n * Each account data is a key-value pair store that emits events when values are changed.\n *\n * @abstract\n * @class AccountData\n * @extends EventEmitter\n */\nexport default class AccountData extends EmitterMixin(null) {\n  constructor(priv, setData) {\n    super()\n    assertPriv('AccountData', priv)\n    this._values = {}\n    this._setData = setData\n  }\n\n  toString() {\n    return 'accountData{keys=' + this.keys + '}'\n  }\n\n  /**\n   * A list of all keys that have been set.\n   *\n   * @readonly\n   * @member {string[]} AccountData#keys\n   */\n  get keys() {\n    return Object.keys(this._values)\n  }\n\n  /**\n   * Returns true if the key has been set.\n   *\n   * @param {string} key - The key to test if it has been set.\n   * @returns {boolean} - True if the key has been set, false otherwise.\n   */\n  has(key) {\n    argCheck.stringOrEmpty('AccountData.has', 'key', key)\n    return key in this._values\n  }\n\n  /**\n   * Gets the value for the corresponding key.\n   *\n   * @param {string} key - The key whose associated value should be returned.\n   * @returns {JsonTypes} - The value associated with the key.\n   */\n  get(key) {\n    argCheck.stringOrEmpty('AccountData.get', 'key', key)\n    return this._values[key]\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Sets the value that a key should be associated with. This will override any\n   * existing association with the key.\n   *\n   * NOTE: It is best to avoid relying on the returned promise to modify application state,\n   * e.g. UI updates, as that will lead to race conditions and undefined behaviour.\n   * It is better to use the returned promise for feedback that the state was changed\n   * was successfully, and tie application state changes an 'update' event handler.\n   * This is due to the fact that state changes are received via the event stream, but\n   * the returned promise is resolved when the request is returned, and those two events\n   * can happen in any order.\n   * ##### Errors:\n   * - {@link GuestAccessError} - Guests are not allowed to set account data.\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @param {string} key - The key that should be associated with the value.\n   * @param {JsonTypes} value - The value that should be associated with the key.\n   * @returns {Promise<AccountData, CctError>} - The account data.\n   */\n  set(key, value) {\n    argCheck.stringOrEmpty('AccountData.set', 'key', key)\n    argCheck.count('AccountData.set', 2, arguments.length)\n    if (!isObject(value)) {\n      value = {__value__: value}\n    }\n    return this._setData(key, value).then(() => this)\n  }\n\n  _set(key, value) {\n    if (value.__value__) {\n      value = value.__value__\n    }\n    var oldValue = this._values[key]\n    this._values[key] = value\n    this._emit('update:' + key, value, oldValue)\n    this._emit('update', {\n      key: key,\n      value: value,\n      oldValue: oldValue,\n    })\n  }\n\n  _clear() {\n    this._values = {}\n  }\n}\n\nAccountData.tag = 'account-data'\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/accountData.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport {assertPriv, priv, shallowCopy} from 'common/utils'\n\nimport {parseIdForServer, toMatrixIdForServer} from 'matrix/ids'\nimport {toUserId} from 'matrix/userRegistry'\n\n/**\n * A class which provides a fluent API for modifying a power levels object.\n * It cannot be instantiated directly and can only be created through the\n * static factory methods as well as {@link Room#editPowerLevels}.\n *\n * Many methods are verbs, but they simply set the power level required to\n * execute the matching action, with the exception of {@link PowerLevelsEdit#commit}.\n *\n * No actual action is taken until the commit method is called. The commit\n * method is only available if the instance was obtained from a\n * {@link Room#editPowerLevels} call. It is also possible to create an\n * instance with one of the static factory methods and then pass the instance\n * to setPowerLevels.\n *\n * @example\n * room.editPowerLevels()\n *     .kick(60)\n *     .addState(0)\n *     .user(promotedUser, 60)\n *     .event('my.custom.event', 20)\n *     .commit()\n *     .then(function () {\n *         console.log(\"Power levels updated!\");\n *     });\n *\n * @example\n * room.setPowerLevels(PowerLevelsEdit.fromDefault(client.user))\n *     .then(function () {\n *         console.log(\"Power levels reset\");\n *     });\n *\n * @class PowerLevelsEdit\n * @abstract\n */\n\nexport function PowerLevelsEdit(priv, powerLevels, options) {\n  assertPriv('PowerLevelsEdit', priv)\n  argCheck.optOptions('PowerLevelsReader', 'options', options)\n    .optString('serverName')\n\n  powerLevels.ban = powerLevels.kick\n  this._powerLevels = JSON.parse(JSON.stringify(powerLevels))\n  this._serverName = options && options.serverName\n}\n\nPowerLevelsEdit.prototype = {\n  constructor: PowerLevelsEdit,\n  toString: function () {\n    return 'powerLevelsEdit' + JSON.stringify(this._powerLevels)\n  },\n  toJSON: function () {\n    if (this._serverName) {\n      return this.toRawForServer(this._serverName)\n    } else {\n      throw new TypeError(\"Can't serialize power levels without a server name set\")\n    }\n  },\n\n  toRawForServer(serverName) {\n    argCheck.string('PowerLevelsEdit.toRawForServer', 'serverName', serverName)\n    let powerLevels = JSON.parse(JSON.stringify(this._powerLevels))\n    powerLevels.users = convertUsersToMatrix(powerLevels.users, serverName)\n    return powerLevels\n  },\n\n  /**\n   * Commits the current state of the power levels edit by updating the\n   * power levels of the room to the current values. This method is only\n   * present if the instance was obtained via {@link Room#editPowerLevels}.\n   *\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function PowerLevelsEdit#commit\n   * @returns {Promise<Room, CctError>}\n   */\n\n  /**\n   * Sets the power level of a user.\n   *\n   * @param {UserId|User} user - The userId or {@link User} instance.\n   * @param {number} level - The new power level of the user.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  user: function (user, level) {\n    argCheck.count('PowerLevelsEdit.user', 2, arguments.length)\n    argCheck.number('PowerLevelsEdit.user', 'level', level)\n    let matrixId = toUserId('PowerLevelsEdit.user', user, this._serverName)\n    let userId = parseIdForServer('PowerLevelsEdit.user', matrixId, this._serverName || '-', 'user')\n    this._powerLevels.users[userId] = level\n    return this\n  },\n\n  /**\n   * Sets the power level required to send an event of a specific\n   * type or set a state of the same type.\n   *\n   * @param {EventType} eventType - The type of the event.\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  event: function (eventType, level) {\n    argCheck.count('PowerLevelsEdit.event', 2, arguments.length)\n    argCheck.string('PowerLevelsEdit.event', 'eventType', eventType)\n    argCheck.number('PowerLevelsEdit.event', 'level', level)\n    this._powerLevels.events[eventType] = level\n    return this\n  },\n\n  /**\n   * Sets the power level required to change the name of a room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  setName: function (level) {\n    argCheck.count('PowerLevelsEdit.setName', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.setName', 'level', level)\n    return this.event('m.room.name', level)\n  },\n\n  /**\n   * Sets the power level required to change the topic of a room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  setTopic: function (level) {\n    argCheck.count('PowerLevelsEdit.setTopic', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.setTopic', 'level', level)\n    return this.event('m.room.topic', level)\n  },\n\n  /**\n   * Sets the power level required to change the type of a room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  setType: function (level) {\n    argCheck.count('PowerLevelsEdit.setType', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.setType', 'level', level)\n    return this.event('com.ericsson.room.type', level)\n  },\n\n  /**\n   * Sets the power level required to change the power levels of a room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  setPowerLevels: function (level) {\n    argCheck.count('PowerLevelsEdit.setPowerLevels', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.setPowerLevels', 'level', level)\n    return this.event('m.room.power_levels', level)\n  },\n\n  /**\n   * Sets the power level required to kick a user from the room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  kick: function (level) {\n    argCheck.count('PowerLevelsEdit.kick', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.kick', 'level', level)\n    this._powerLevels.kick = level\n    this._powerLevels.ban = level\n    return this\n  },\n\n  /**\n   * Sets the power level required to invite a user to the room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  invite: function (level) {\n    argCheck.count('PowerLevelsEdit.invite', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.invite', 'level', level)\n    this._powerLevels.invite = level\n    return this\n  },\n\n  /**\n   * Sets the power level required to redact and event in the room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  redact: function (level) {\n    argCheck.count('PowerLevelsEdit.redact', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.redact', 'level', level)\n    this._powerLevels.redact = level\n    return this\n  },\n\n  /**\n   * Sets the default power level for users in the room. If a specific\n   * power level hasn't been set for a user this value will be used.\n   *\n   * @param {number} level - The new default power level.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  userDefault: function (level) {\n    argCheck.count('PowerLevelsEdit.userDefault', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.userDefault', 'level', level)\n    this._powerLevels.users_default = level\n    return this\n  },\n\n  /**\n   * Sets the default power level for all event types in the room.\n   * If a specific power level hasn't been set for an event type\n   * this value will be used.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  eventDefault: function (level) {\n    argCheck.count('PowerLevelsEdit.eventDefault', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.eventDefault', 'level', level)\n    this._powerLevels.events_default = level\n    return this\n  },\n\n  /**\n   * Sets the power level required to add a new state to the room.\n   *\n   * @param {number} level - The new power level requirement.\n   * @returns {PowerLevelsEdit} Returns itself to allow chaining.\n   */\n  addState: function (level) {\n    argCheck.count('PowerLevelsEdit.addState', 1, arguments.length)\n    argCheck.number('PowerLevelsEdit.addState', 'level', level)\n    this._powerLevels.state_default = level\n    return this\n  },\n}\n\n/**\n * Creates a new {@link PowerLevelsEdit} object with the default\n * power levels.\n *\n * The creator of the room can optionally be specified, in which case\n * the creators power level will be set to the default power level\n * of the creator.\n *\n * @param {(UserId|User)?} [creator] - An optional creator of the room.\n * @param {Object} [options] - An options object.\n * @param {string} [options.serverName] - The server name that the IDs in the edit will be relative to.\n * @returns {PowerLevelsEdit} A new power levels edit instance.\n */\nPowerLevelsEdit.fromDefault = function (creator, options) {\n  var edit = priv(PowerLevelsEdit, PowerLevelsEdit._DEFAULT_POWER_LEVELS, options)\n  if (creator) {\n    edit.user(creator, PowerLevelsEdit._DEFAULT_CREATOR_LEVEL)\n  }\n  return edit\n}\n\n/**\n * Creates a new {@link PowerLevelsEdit} object with all power levels set to 0.\n *\n * @param {Object} [options] - An options object.\n * @param {string} [options.serverName] - The server name that the IDs in the edit will be relative to.\n * @returns {PowerLevelsEdit} A new power levels edit instance.\n */\nPowerLevelsEdit.fromZero = function (options) {\n  return priv(PowerLevelsEdit, PowerLevelsEdit._ZERO_POWER_LEVELS, options)\n}\n\nPowerLevelsEdit._DEFAULT_CREATOR_LEVEL = 100\n\nPowerLevelsEdit._DEFAULT_POWER_LEVELS = {\n  users: {},\n  users_default: 0,\n  events: {\n    'm.room.name': 50,\n    'm.room.power_levels': 100,\n    'm.room.history_visibility': 100,\n    'm.room.canonical_alias': 50,\n    'm.room.avatar': 50,\n  },\n  events_default: 0,\n  state_default: 50,\n  kick: 50,\n  redact: 50,\n  invite: 0,\n}\n\nPowerLevelsEdit._ZERO_POWER_LEVELS = {\n  users: {},\n  users_default: 0,\n  events: {},\n  events_default: 0,\n  state_default: 0,\n  kick: 0,\n  redact: 0,\n  invite: 0,\n}\n\nfunction convertUsersToServer(users, serverName) {\n  if (!users) {\n    return users\n  }\n  let userLevels = {}\n  Object.entries(users).forEach(([matrixId, level]) => {\n    let userId = parseIdForServer('PowerLevels rawToUsers', matrixId, serverName || '-', 'user')\n    userLevels[userId] = level\n  })\n  return userLevels\n}\n\nfunction convertUsersToMatrix(users, serverName) {\n  if (!users) {\n    return users\n  }\n  let matrixUserLevels = {}\n  Object.entries(users).forEach(([userId, level]) => {\n    let matrixId = toMatrixIdForServer('PowerLevels usersToRaw', userId, serverName, 'user')\n    matrixUserLevels[matrixId] = level\n  })\n  return matrixUserLevels\n}\n\n/**\n * A class which provides convenience accessors for the internal representation\n * of a power levels structure.\n *\n * This will usually be accessed through {@link Room#powerLevels}, but\n * can also be instantiated with {@link PowerLevelsReader.fromRaw}.\n *\n * @class PowerLevelsReader\n * @abstract\n */\n\nexport function PowerLevelsReader(priv, powerLevels, options) {\n  assertPriv('PowerLevelsReader', priv)\n  argCheck.options('PowerLevelsReader', 'powerLevels', powerLevels)\n        .object('users')\n        .object('events')\n        .number('kick')\n        .number('invite')\n        .number('users_default')\n        .number('events_default')\n        .number('state_default')\n        .number('redact')\n  argCheck.optOptions('PowerLevelsReader', 'options', options)\n    .optString('serverName')\n\n  powerLevels.ban = powerLevels.kick\n  this._powerLevels = powerLevels\n  this._serverName = options && options.serverName\n}\n\nPowerLevelsReader.prototype = {\n  constructor: PowerLevelsReader,\n  toString: function () {\n    return 'powerLevelsReader' + JSON.stringify(this._powerLevels)\n  },\n  toJSON: function () {\n    if (this._serverName) {\n      return this.toRawForServer(this._serverName)\n    } else {\n      throw new TypeError(\"Can't serialize power levels without a server name set\")\n    }\n  },\n\n  toRawForServer(serverName) {\n    argCheck.string('PowerLevelsEdit.toRawForServer', 'serverName', serverName)\n    let powerLevels = JSON.parse(JSON.stringify(this._powerLevels))\n    powerLevels.users = convertUsersToMatrix(powerLevels.users, serverName)\n    return powerLevels\n  },\n\n  /**\n   * An object where the key is a userId and the value is that user's power level.\n   *\n   * @readonly\n   * @member {object<UserId,number>} PowerLevelsReader#users\n   */\n  get users() {\n    return shallowCopy(this._powerLevels.users) || {}\n  },\n  /**\n   * An object where the key is an event type and the value is that event type's required power level.\n   *\n   * @readonly\n   * @member {object<EventType,number>} PowerLevelsReader#events\n   */\n  get events() {\n    return shallowCopy(this._powerLevels.events) || {}\n  },\n  /**\n   * Looks up the power level required for a specific event.\n   *\n   * @param {EventType} eventType - The event type to look up the required power level for.\n   * @returns {number} The power level required for the given event type.\n   */\n  event(eventType) {\n    argCheck.string('PowerLevelsReader.event', 'eventType', eventType)\n    if (this._powerLevels.events.hasOwnProperty(eventType)) {\n      return this._powerLevels.events[eventType]\n    } else {\n      return this._powerLevels.events_default\n    }\n  },\n  /**\n   * Looks up the effective power level of a user.\n   *\n   * @param {UserId|User} user - The user to look up the power level for.\n   * @returns {number} The effective power level of the user.\n   */\n  user(user) {\n    let matrixId = toUserId('PowerLevelsReader.user', user, this._serverName)\n    let userId = parseIdForServer('PowerLevelsReader.user', matrixId, this._serverName || '-', 'user')\n    if (this._powerLevels.users.hasOwnProperty(userId)) {\n      return this._powerLevels.users[userId]\n    } else {\n      return this._powerLevels.users_default\n    }\n  },\n  /**\n   * The power level required to set the name of the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#setName\n   */\n  get setName() {\n    return this._powerLevels.events['m.room.name']\n  },\n  /**\n   * The power level required to set the topic of the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#setTopic\n   */\n  get setTopic() {\n    return this._powerLevels.events['m.room.topic']\n  },\n  /**\n   * The power level required to set the type of the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#setType\n   */\n  get setType() {\n    return this._powerLevels.events['com.ericsson.room.type']\n  },\n  /**\n   * The power level required to set the power levels in a room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#setPowerLevels\n   */\n  get setPowerLevels() {\n    return this._powerLevels.events['m.room.power_levels']\n  },\n  /**\n   * The power level required to kick a user form the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#kick\n   */\n  get kick() {\n    return this._powerLevels.kick\n  },\n  /**\n   * The power level required to invite a user to the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#invite\n   */\n  get invite() {\n    return this._powerLevels.invite\n  },\n  /**\n   * The power level required to redact an event from the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#redact\n   */\n  get redact() {\n    return this._powerLevels.redact\n  },\n  /**\n   * The default power level for users in the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#userDefault\n   */\n  get userDefault() {\n    return this._powerLevels.users_default\n  },\n  /**\n   * The default power level for events in the room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#eventDefault\n   */\n  get eventDefault() {\n    return this._powerLevels.events_default\n  },\n  /**\n   * The power level required to add a new state to a room.\n   *\n   * @readonly\n   * @member {number} PowerLevelsReader#addState\n   */\n  get addState() {\n    return this._powerLevels.state_default\n  },\n}\n\n/**\n * Creates a new {@link PowerLevelsReader} from a raw power levels object.\n *\n * @param {Object} object - A plain object with power levels.\n * @param {Object} [options] - An options object.\n * @param {string} [options.serverName] - The server name that the IDs in the reader will be relative to.\n * @returns {PowerLevelsReader} A new power levels reader instance.\n */\nPowerLevelsReader.fromRaw = function (object, options) {\n  let powerLevels = JSON.parse(JSON.stringify(object))\n  powerLevels.users = convertUsersToServer(powerLevels.users, options && options.serverName)\n  return priv(PowerLevelsReader, powerLevels, options)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/powerLevels.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {JsonRetryClient, SerializedJsonRetryClient} from 'common/request'\nimport AsyncQueue from 'common/queue'\nimport {NotAllowedError} from 'common/errors'\nimport {\n  assertPriv,\n  assign,\n  defer,\n  find,\n  getter,\n  hiddenProp,\n  priv,\n  prop,\n  shallowCopy,\n} from 'common/utils'\n\nimport AccountData from 'matrix/accountData'\nimport ImageResource from 'matrix/resources'\nimport RoomState from 'matrix/roomState'\nimport User from 'matrix/user'\nimport {parseIdForServer} from 'matrix/ids'\nimport {parseSynapseErrorResponse} from 'matrix/errors'\nimport {PowerLevelsEdit, PowerLevelsReader} from 'matrix/powerLevels'\nimport {toUserId} from 'matrix/userRegistry'\n\nvar membershipNameMap = {\n  join: 'member',\n  kick: 'kicked',\n  ban: 'kicked',\n  invite: 'invited',\n  leave: 'left',\n}\n\nvar userCollectionNameMap = {\n  invited: 'invited',\n  member: 'members',\n}\n\n/**\n * Represents a room.\n *\n * @abstract\n * @class Room\n * @extends EventEmitter\n */\n\nexport default function Room(privToken, config, dependencies) {\n  assertPriv('Room', privToken)\n  var self = this\n\n  var ownUser = dependencies.ownUser\n  var delegate = dependencies.delegate\n  var baseRequest = dependencies.baseRequest\n  var userRegistry = dependencies.userRegistry\n  var callRegistry = dependencies.callRegistry\n  var imageResourceFactory = dependencies.imageResourceFactory\n\n  if (!(ownUser instanceof User)) {\n    throw new TypeError('room has to be passed a user')\n  }\n  if (!baseRequest) {\n    throw new TypeError('room has to be passed a base request object')\n  }\n\n  let matrixId = config.matrixId\n  let id = parseIdForServer('Room constructor', config.matrixId, dependencies.serverName, 'room')\n  var roomType = null\n  var creator = null\n  var creationContent = null\n  var name = null\n  var topic = null\n  var avatar = null\n  var historyVisibility = null\n  var alias = null\n  var membership = null\n  var joinRule = null\n  var guestAccessRule = null\n  var invitedBy = null\n  var typingUsers = []\n  var memberships = {}\n  var members = []\n  var memberCount = NaN\n  var invited = []\n  var events = []\n  var eventsStart = null\n  var states = {}\n  var setTypingRequest = null\n  var setTypingEndTime = 0\n  var loadQueue = new AsyncQueue()\n  var queries = []\n  var powerLevel = 0\n  var powerLevelsReader = null\n  var waitForJoined = null\n  let awaitingJoin = null\n  let replyEventSnatchers = null\n\n  this._setAccountData = this._setAccountData.bind(this)\n  this._accountData = priv(AccountData, this._setAccountData)\n  var roomRequest = baseRequest\n    .client(new SerializedJsonRetryClient())\n    .params('roomId', matrixId)\n  var request = roomRequest.path('rooms', '{roomId}')\n  request.send = request.path('send')\n  request.state = request.path('state')\n  request.invite = request.path('invite')\n  request.join = request.path('join')\n  request.kick = request.path('kick')\n  request.leave = request.path('leave')\n  request.typing = request.path('typing', '{userId}')\n  request.initialSync = request.path('initialSync')\n  request.setAccountData = roomRequest.path('user', '{userId}', 'rooms', '{roomId}', 'account_data')\n  request.events = request\n    .client(new JsonRetryClient())\n    .errorHandler(parseSynapseErrorResponse)\n    .path('messages')\n    .query('dir', 'b')\n\n  this._request = request\n\n  function addPublicInfo(info) {\n    if (membership === 'member') {\n      return\n    }\n    name = info.name\n    self._emit('name', name)\n    topic = info.topic\n    self._emit('topic', topic)\n    alias = parseIdForServer('Room.addPublicInfo', info.canonical_alias, dependencies.serverName, 'alias')\n    self._emit('alias', alias)\n    memberCount = info.num_joined_members\n    queries = queries.filter(function (fn) {\n      return !fn()\n    })\n  }\n\n  hiddenProp(this, '_addPublicInfo', addPublicInfo)\n\n  var eventHandlers = {\n    'com.ericsson.room.type': function (simple) {\n      simple.content = simple.content.type\n      return simple\n    },\n    'm.room.topic': function (simple) {\n      simple.content = simple.content.topic\n      return simple\n    },\n    'm.room.avatar': function (simple) {\n      var url = simple.content.url\n      if (url) {\n        simple.content = imageResourceFactory(url)\n      } else {\n        simple.content = null\n      }\n      return simple\n    },\n    'm.room.history_visibility': function (simple) {\n      simple.content = simple.content.history_visibility\n      return simple\n    },\n    'm.room.name': function (simple) {\n      simple.content = simple.content.name\n      return simple\n    },\n    'm.room.canonical_alias': function (simple) {\n      simple.content = parseIdForServer('Room.eventHandler', simple.content.alias, dependencies.serverName, 'alias')\n      return simple\n    },\n    'm.room.member': function (simple, event) {\n      var name = event.content.displayname || null\n      var avatarUrl = event.content.avatar_url || null\n      var membership = event.content.membership\n\n      simple.content = {\n        user: userRegistry.getUser(event.state_key),\n        name: name,\n        avatarUrl: avatarUrl,\n        membership: membershipNameMap[membership],\n      }\n\n      var prev = event.unsigned && event.unsigned.prev_content\n      if (prev) {\n        var oldContent = simple.oldContent = {}\n        oldContent.name = prev.displayname || null\n        oldContent.avatarUrl = prev.avatar_url || null\n        oldContent.membership = membershipNameMap[prev.membership] || null\n      }\n      return simple\n    },\n  }\n\n  function toSimpleEvent(event) {\n    let id = parseIdForServer('event conversion', event.event_id, dependencies.serverName, 'event')\n    let simple = {\n      id,\n      content: event.content,\n      type: event.type,\n      isPastEvent: event.isPastEvent,\n      sender: userRegistry.getUser(event.sender),\n      timestamp: event.origin_server_ts,\n    }\n    simple.isOwnEvent = simple.sender === ownUser\n    if ('state_key' in event) {\n      if (event.state_key !== '') {\n        simple.stateKey = event.state_key\n      } else {\n        simple.stateKey = null\n      }\n      simple.isStateChange = true\n    } else {\n      simple.isStateChange = false\n    }\n    if (simple.content && simple.content.__value__) {\n      simple.content = simple.content.__value__\n    }\n    if (event.unsigned && event.unsigned.prev_content) {\n      simple.oldContent = event.unsigned.prev_content\n      if (simple.oldContent.__value__) {\n        simple.oldContent = simple.oldContent.__value__\n      }\n    }\n    simple.room = self\n    var handler = eventHandlers[event.type]\n    if (handler) {\n      simple = handler(simple, event)\n    }\n    if (process.env.HAS_WEBRTC) {\n      callRegistry._handleEvent(simple)\n    }\n    return simple\n  }\n\n  var overrideEventHandlers = {}\n\n  function processEvent(event) {\n    var overrideEventHandler = overrideEventHandlers[event.type]\n    if (overrideEventHandler) {\n      overrideEventHandler(event)\n      return\n    }\n\n    if (replyEventSnatchers && event.type.slice(-6) === '.reply') {\n      let eventId = event.content.eventId\n      let deferred = replyEventSnatchers.get(eventId)\n      if (deferred) {\n        if (deferred.senderId !== event.sender) {\n          log.error('room', `reply with invalid sender: '${event.sender}', expected '${deferred.senderId}'`)\n        } else if (deferred.eventType !== event.type) {\n          log.error('room', `reply with invalid type: '${event.type}', expected '${deferred.eventType}'`)\n        } else {\n          deferred.resolve(event.content)\n          replyEventSnatchers.delete(eventId)\n        }\n      }\n      return\n    }\n    var simple = toSimpleEvent(event)\n    if (simple) {\n      if (events[simple.id]) {\n        var index = find(events, function (event) {\n          return event.id === simple.id\n        })\n        if (index !== null) {\n          events[index] = simple\n        } else {\n          log.error('room', 'failed to find existing event with id match:', simple)\n        }\n      } else {\n        events.unshift(simple)\n        events[simple.id] = simple\n      }\n      self._emit('event:' + simple.type, simple)\n      self._emit('event', simple)\n      self._emit('events', self)\n    }\n    return simple\n  }\n\n  this._processEphemeralEvent = function (event) {\n    if (event.type === 'm.typing') {\n      typingUsers = event.content.user_ids.map(function (userId) {\n        return userRegistry.getUser(userId)\n      })\n      self._emit('typing')\n    }\n  }\n\n  var stateHandlers = {\n    'com.ericsson.room.type': function (event) {\n      if (roomType !== event.content.type) {\n        roomType = event.content.type\n        self._emit('type', roomType)\n      }\n    },\n    'm.room.create': function (event, isFromTimeline) {\n      if (isFromTimeline) {\n        eventsStart = null\n      }\n      if (event.content.cctRoomType) {\n        roomType = event.content.cctRoomType\n        self._emit('type', roomType)\n      }\n      creator = userRegistry.getUser(event.content.creator)\n      if ('c3Content' in event.content) { // backwards compatability\n        creationContent = event.content.c3Content\n      } else {\n        creationContent = event.content\n      }\n      self._emit('creator', creator)\n      self._emit('creationContent', creationContent)\n    },\n    'm.room.topic': function (event) {\n      topic = event.content.topic\n      self._emit('topic', topic)\n    },\n    'm.room.avatar': function (event) {\n      var url = event.content.url\n      if (url) {\n        avatar = imageResourceFactory(url)\n      } else {\n        avatar = null\n      }\n      self._emit('avatar', avatar)\n    },\n    'm.room.history_visibility': function (event) {\n      historyVisibility = event.content.history_visibility\n      self._emit('historyVisibility', historyVisibility)\n    },\n    'm.room.name': function (event) {\n      name = event.content.name\n      self._emit('name', name)\n    },\n    'm.room.canonical_alias': function (event) {\n      alias = parseIdForServer('Room.stateHandler', event.content.alias, dependencies.serverName, 'alias')\n      self._emit('alias', alias)\n    },\n    'm.room.power_levels': function (event) {\n      var powerLevels = shallowCopy(event.content);\n      [\n        'users_default',\n        'events',\n        'events_default',\n        'state_default',\n        'kick',\n        'redact',\n        'invite',\n      ].forEach(function (key) {\n        if (!(key in powerLevels)) {\n          powerLevels[key] = PowerLevelsEdit._DEFAULT_POWER_LEVELS[key]\n        }\n      })\n      if (!('users' in powerLevels)) {\n        powerLevels.users = {}\n      }\n      if (!('events' in powerLevels)) {\n        powerLevels.events = {}\n      }\n      powerLevelsReader = PowerLevelsReader.fromRaw(powerLevels, {serverName: dependencies.serverName})\n      var newPowerLevel = null\n      var users = powerLevels.users\n      if (users && (ownUser._matrixId in users)) {\n        newPowerLevel = users[ownUser._matrixId]\n      } else {\n        newPowerLevel = powerLevels.user_default || 0\n      }\n      if (powerLevel !== newPowerLevel) {\n        powerLevel = newPowerLevel\n        self._emit('powerLevel', powerLevel)\n      }\n      self._emit('powerLevels', powerLevelsReader)\n    },\n    'm.room.join_rules': function (simple) {\n      var oldJoinRule = joinRule\n      joinRule = simple.content.join_rule\n      if (joinRule === 'public') {\n        joinRule = 'open'\n      }\n      if (oldJoinRule !== joinRule) {\n        self._emit('joinRule', joinRule, oldJoinRule)\n      }\n    },\n    'm.room.guest_access': function (simple) {\n      var oldGuestAccessRule = guestAccessRule\n      guestAccessRule = simple.content.guest_access\n      if (guestAccessRule === 'can_join') {\n        guestAccessRule = 'open'\n      } else if (guestAccessRule === 'forbidden') {\n        guestAccessRule = 'closed'\n      }\n      if (oldGuestAccessRule !== guestAccessRule) {\n        self._emit('guestAccessRule', guestAccessRule, oldGuestAccessRule)\n      }\n    },\n    'm.room.member': function (event) {\n      var user = userRegistry.getUser(event.state_key)\n      var changedBy = userRegistry.getUser(event.sender)\n      var content = event.content\n\n      if (content.membership === 'join') {\n        user._membershipEventUpdate(event)\n      }\n      changeMembership(content.membership, user, changedBy)\n    },\n  }\n\n  function processState(event, isFromTimeline) {\n    var state = states[event.type] = states[event.type] ||\n            priv(RoomState, event.type, self, setState.bind(self, event.type))\n    state._set(event.state_key, event.content)\n    self._emit('state:' + event.type, state)\n    self._emit('state', state)\n\n    var handler = stateHandlers[event.type]\n    if (handler) {\n      handler(event, isFromTimeline)\n    }\n  }\n\n  this._logEvent = function (type, event) {\n    var category = event.sender === ownUser._matrixId ? 'own-events' : 'events'\n    log.verbose(category, `got ${type} event: ${event.type}`, event)\n  }\n\n  this._handleRoomSync = function (roomData, membership, isFirstSync) {\n    var i\n\n    if (membership === 'invite') {\n      var inviteState = roomData.invite_state.events\n      for (i in inviteState) {\n        this._logEvent('invite state', inviteState[i])\n        processState(inviteState[i])\n      }\n      this._setOwnMembership(membership)\n      eventsStart = null\n    } else if (membership === 'join') {\n      let transitionedToJoin = this._setOwnMembership(membership)\n      if (transitionedToJoin) {\n        isFirstSync = true\n      }\n      var stateEvents = roomData.state.events\n      var accountDataEvents = roomData.account_data.events\n      var ephemeralEvents = roomData.ephemeral && roomData.ephemeral.events\n      var timelineEvents = roomData.timeline.events\n      var timelineIsLimited = roomData.timeline.limited\n      var prevToken = roomData.timeline.prev_batch\n\n      if (!eventsStart && timelineIsLimited) {\n        eventsStart = prevToken\n      }\n      for (i in ephemeralEvents) {\n        this._logEvent('ephemeral', ephemeralEvents[i])\n        this._processEphemeralEvent(ephemeralEvents[i])\n      }\n      for (i in accountDataEvents) {\n        var accountDataEvent = accountDataEvents[i]\n        this._logEvent('account data', accountDataEvent)\n        this._accountData._set(accountDataEvent.type, accountDataEvent.content)\n      }\n      for (i in stateEvents) {\n        this._logEvent('state', stateEvents[i])\n        processState(stateEvents[i])\n      }\n      for (i in timelineEvents) {\n        var event = timelineEvents[i]\n        event.isPastEvent = !!isFirstSync\n        this._logEvent('timeline', event)\n        var roomEvent = processEvent(event)\n        if ('state_key' in event) {\n          processState(event, true /* isFromTimeline */)\n        }\n        if (roomEvent) {\n          delegate._onRoomEvent(roomEvent)\n        }\n      }\n      if (waitForJoined) {\n        waitForJoined.resolve(this)\n        waitForJoined = null\n      }\n    } else if (membership === 'leave') {\n      this._close()\n      var membershipEvents = roomData.timeline.events.filter(function (event) {\n        return event.state_key === ownUser._matrixId\n      }).slice(-1)\n      if (membershipEvents.length) {\n        var membershipEvent = membershipEvents[0]\n        this._logEvent('leave event', membershipEvent)\n        var leaveMembership = membershipEvent.content.membership\n        if (leaveMembership === 'leave' && membershipEvent.sender !== ownUser._matrixId) {\n          leaveMembership = 'kick'\n        }\n        this._setOwnMembership(leaveMembership)\n      }\n    }\n    queries = queries.filter(function (fn) {\n      return !fn()\n    })\n  }\n\n  hiddenProp(this, '_close', function () {\n    callRegistry.closeCallsInRoom(this)\n    let conference = callRegistry.getConferenceInRoom(this)\n    if (conference) {\n      conference.close()\n    }\n    roomType = null\n    creator = null\n    creationContent = null\n    name = null\n    topic = null\n    avatar = null\n    historyVisibility = null\n    alias = null\n    membership = null\n    joinRule = null\n    guestAccessRule = null\n    invitedBy = null\n    memberCount = NaN\n    memberships = {}\n    members = []\n    invited = []\n    events = []\n    eventsStart = null\n    states = {}\n    typingUsers = []\n    setTypingRequest = null\n    setTypingEndTime = 0\n    loadQueue.clear()\n    powerLevel = 0\n    powerLevelsReader = null\n    if (waitForJoined) {\n      waitForJoined.reject(new Error('room closed before it was joined'))\n    }\n    waitForJoined = null\n    awaitingJoin = null\n    replyEventSnatchers = null\n    queries = queries.filter(function (fn) {\n      return !fn()\n    })\n  })\n\n  var memberCollections = {\n    get invited() {\n      return invited\n    },\n    get member() {\n      return members\n    },\n  }\n\n  this._setOwnMembership = function (_newMembership) {\n    var newMembership = membershipNameMap[_newMembership]\n    if (newMembership === this.membership) {\n      return false\n    }\n    var prevMembership = membership\n    membership = newMembership\n    this._emit('membership:' + membership, this)\n    this._emit('membership', membership, prevMembership)\n    delegate._onRoomMembership(this, _newMembership)\n    return newMembership === 'member'\n  }\n\n  function changeMembership(next, user, changedBy) {\n    var index\n\n    var prevName = memberships[user.id]\n    var nextName = membershipNameMap[next]\n    if (prevName === nextName) {\n      return\n    }\n\n    if (nextName === 'left') {\n      delete memberships[user.id]\n    } else {\n      memberships[user.id] = nextName\n    }\n\n    var prevCollection = memberCollections[prevName]\n    var nextCollection = memberCollections[nextName]\n\n    var prevCollectionName = userCollectionNameMap[prevName]\n    var nextCollectionName = userCollectionNameMap[nextName]\n\n    if (prevCollection) {\n      index = prevCollection.indexOf(user)\n      if (index !== -1) {\n        prevCollection.splice(index, 1)\n      } else {\n        log.error('room', 'failed to remove user from old membership collection:', prevCollection, user)\n        return\n      }\n    }\n\n    if (nextCollection) {\n      nextCollection.push(user)\n    }\n    if (user === ownUser) {\n      if (nextName === 'invited') {\n        invitedBy = changedBy\n      } else {\n        invitedBy = null\n      }\n    }\n\n    if (next === 'join' && awaitingJoin && awaitingJoin.has(user._matrixId)) {\n      awaitingJoin.get(user._matrixId).resolve()\n      awaitingJoin.delete(user._matrixId)\n    }\n\n    self._emit(next, user, changedBy)\n    self._emit('memberships', memberships)\n    if (prevCollectionName && prevCollectionName !== nextCollectionName) {\n      self._emit(prevCollectionName)\n    }\n    if (nextCollectionName) {\n      self._emit(nextCollectionName)\n    }\n    if (nextCollectionName === 'members' && user !== ownUser) {\n      self._emit('otherMembers')\n    }\n  }\n\n  function returnSelf() {\n    return self\n  }\n\n  function throwAuthErrorIfNotFound(error) {\n    if (error.name === 'NotFoundError') {\n      throw new NotAllowedError(`Not allowed to kick users from this room, ${error.message}`)\n    } else {\n      throw error\n    }\n  }\n\n  /**\n   * The id of the room\n   * @readonly\n   * @member {RoomId} Room#id\n   */\n  Object.defineProperty(this, 'id', {\n    enumerable: true,\n    value: id,\n  })\n\n  /**\n   * The type of membership that the authenticated user has\n   * @readonly\n   * @member {Room~Membership} Room#membership\n   */\n  Object.defineProperty(this, 'membership', {\n    enumerable: true,\n    get: function () {\n      return membership\n    },\n  })\n\n  /**\n   * The type of memberships that all the users in the room have.\n   *\n   * **NOTE:** The returned object is read only and must not be modified.\n   *\n   * @readonly\n   * @member {Object.<UserId,Room~Membership>} Room#memberships\n   */\n  Object.defineProperty(this, 'memberships', {\n    enumerable: true,\n    get: function () {\n      return memberships\n    },\n  })\n\n  /**\n   * The alias of the room\n   * @readonly\n   * @member {RoomAlias} Room#alias\n   */\n  Object.defineProperty(this, 'alias', {\n    enumerable: true,\n    get: function () {\n      return alias\n    },\n  })\n\n  /**\n   * The users in the room that are currently typing\n   * @readonly\n   * @member {User[]} Room#typing\n   */\n  Object.defineProperty(this, 'typing', {\n    enumerable: true,\n    get: function () {\n      return typingUsers.slice()\n    },\n  })\n\n  /**\n   * Sets whether the user is currently typing or not, with an optional timeout and margin.\n   * The timeout can be used to temporarily set typing to true, while the margin allows throttling of requests.\n   *\n   * The margin permits setTyping to be called at a high rate without actually sending\n   * any requests to the server. A request is sent only if the end of the previous\n   * request's timeout has been reached or if the time until then is smaller than the margin.\n   *\n   * ```e.i. if (current time + margin) > (previous (request time + timeout))```\n   *\n   * Specifying a timeout is only valid when setting typing to true,\n   *  as setting it to false will always do so indefinetly.\n   *\n   * Setting the typing state will cause any previous state, including timeouts, to be overwritten.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#setTyping\n   * @param {boolean} [isTyping=true] - The new typing state\n   * @param {number} [timeout=10000] - Timeout in milliseconds\n   * @param {number} [margin=1000] - Margin in milliseconds, or -1 to always send a request\n   * @returns {Promise<Room, CctError>} - The room.\n   */\n  prop(this, 'setTyping', function (isTyping, timeout, margin) {\n    if (arguments.length === 0) {\n      isTyping = true\n    }\n    if (arguments.length < 2) {\n      argCheck.boolean('room.setTyping', 'isTyping', isTyping)\n      timeout = 10000\n    }\n    if (arguments.length < 3) {\n      argCheck.number('room.setTyping', 'timeout', timeout)\n      margin = 1000\n    } else {\n      argCheck.number('room.setTyping', 'margin', margin)\n    }\n    if (!isTyping) {\n      setTypingRequest = null\n      setTypingEndTime = 0\n      return request.typing.put({\n        typing: !!isTyping,\n        timeout: timeout,\n      })\n    }\n    if (setTypingEndTime) {\n      var timeToEnd = setTypingEndTime - new Date().getTime()\n      if (timeToEnd < margin || margin === -1) {\n        setTypingRequest = null\n      }\n    }\n    if (!setTypingRequest) {\n      setTypingEndTime = new Date().getTime() + timeout\n      setTypingRequest = request.typing.put({\n        typing: !!isTyping,\n        timeout: timeout,\n      }).then(returnSelf)\n    }\n    return setTypingRequest\n  })\n\n  /**\n   * The members of the room\n   * @readonly\n   * @member {User[]} Room#members\n   */\n  Object.defineProperty(this, 'members', {\n    enumerable: true,\n    get: function () {\n      return members.slice()\n    },\n  })\n\n  /**\n   * All members of the room except for the authenticated user\n   * @readonly\n   * @member {User[]} Room#otherMembers\n   */\n  Object.defineProperty(this, 'otherMembers', {\n    enumerable: true,\n    get: function () {\n      return members.filter(function (member) {\n        return member !== ownUser\n      })\n    },\n  })\n\n  Object.defineProperty(this, '_memberCount', {\n    enumerable: true,\n    get: function () {\n      if (isNaN(memberCount)) {\n        return members.length\n      } else {\n        return memberCount\n      }\n    },\n  })\n\n  /**\n   * Users that have been invited to the room\n   * @readonly\n   * @member {User[]} Room#invited\n   */\n  Object.defineProperty(this, 'invited', {\n    enumerable: true,\n    get: function () {\n      return invited.slice()\n    },\n  })\n\n  /**\n   * The joinRule of the room\n   * @readonly\n   * @member {Room~JoinRule} Room#joinRule\n   */\n  Object.defineProperty(this, 'joinRule', {\n    enumerable: true,\n    get: function () {\n      return joinRule\n    },\n  })\n\n  /**\n   * Sets how other users are able to join this room. An `'open'`` room can\n   * be joined with anyone that has the room id or an alias of the room,\n   * while a room with the `'invite'` rule only allows users to join after\n   * first being invited to the room by an existing member.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#setJoinRule\n   * @param {Room~JoinRule} joinRule - The new join rule for this room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setJoinRule = function (joinRule) {\n    argCheck.values('room.setJoinRule', 'joinRule', joinRule, ['open', 'invite'])\n    if (joinRule === 'open') {\n      joinRule = 'public'\n    }\n    return setState('m.room.join_rules', {\n      join_rule: joinRule,\n    })\n  }\n\n  /**\n   * The guestAccessRule of the room\n   * @readonly\n   * @member {Room~GuestAccessRule} Room#guestAccessRule\n   */\n  Object.defineProperty(this, 'guestAccessRule', {\n    enumerable: true,\n    get: function () {\n      return guestAccessRule\n    },\n  })\n\n  /**\n   * Sets how guests are allowed to join the room. If set to `'open'`, guests\n   * are allowed to join the rule, although they are still subject to\n   * the join rule of the room. If set to `'closed'`, guests are not allowed\n   * to join the room at all.\n   *\n   * The default guest access rule is `'closed'`.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#setGuestAccessRule\n   * @param {Room~GuestAccessRule} guestAccessRule - The new guest access rule for this room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setGuestAccessRule = function (guestAccessRule) {\n    argCheck.values('room.setGuestAccessRule', 'guestAccessRule', guestAccessRule, ['open', 'closed'])\n    if (guestAccessRule === 'open') {\n      guestAccessRule = 'can_join'\n    } else if (guestAccessRule === 'closed') {\n      guestAccessRule = 'forbidden'\n    }\n    return setState('m.room.guest_access', {\n      guest_access: guestAccessRule,\n    })\n  }\n\n  /**\n   * The type of the room.\n   * @readonly\n   * @member {string} Room#type\n   */\n  Object.defineProperty(this, 'type', {\n    enumerable: true,\n    get: function () {\n      return roomType\n    },\n  })\n\n  /**\n   * The creator of the room.\n   * @readonly\n   * @member {User} Room#creator\n   */\n  Object.defineProperty(this, 'creator', {\n    enumerable: true,\n    get: function () {\n      return creator\n    },\n  })\n\n  /**\n   * The creation content of the room.\n   * @readonly\n   * @member {JsonTypes} Room#creationContent\n   */\n  Object.defineProperty(this, 'creationContent', {\n    enumerable: true,\n    get: function () {\n      return creationContent\n    },\n  })\n\n  /**\n   * The current topic of the room.\n   * @readonly\n   * @member {string} Room#topic\n   */\n  Object.defineProperty(this, 'topic', {\n    enumerable: true,\n    get: function () {\n      return topic\n    },\n  })\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Sets the topic of the room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Room#setTopic\n   * @param {string} topic - The new topic for this room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setTopic = function (topic) {\n    argCheck.optString('room.setTopic', 'topic', topic)\n    return setState('m.room.topic', {\n      topic: topic || null,\n    })\n  }\n\n  /**\n   * The current avatar of the room.\n   * @readonly\n   * @member {ImageResource} Room#avatar\n   */\n  Object.defineProperty(this, 'avatar', {\n    enumerable: true,\n    get: function () {\n      return avatar\n    },\n  })\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Sets the avatar of the room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Room#setAvatar\n   * @param {MatrixContentUri|ImageResource} avatar - The new avatar for this room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setAvatar = function (avatar) {\n    argCheck.count('room.setAvatar', 1, arguments.length)\n    var url = null\n    if (avatar) {\n      if (!(avatar instanceof ImageResource)) {\n        argCheck.string('room.setAvatar', 'avatar', avatar)\n        avatar = imageResourceFactory(avatar)\n      }\n      url = avatar.resourceUri\n    }\n    return setState('m.room.avatar', {\n      url: url,\n    })\n  }\n\n  /**\n   * The current history visibility of the room.\n   * @readonly\n   * @member {Room~HistoryVisibility} Room#historyVisibility\n   */\n  Object.defineProperty(this, 'historyVisibility', {\n    enumerable: true,\n    get: function () {\n      return historyVisibility\n    },\n  })\n\n  /**\n   * Sets the history visibility of the room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#setHistoryVisibility\n   * @param {Room~HistoryVisibility} historyVisibility - The new history visibility of this room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setHistoryVisibility = function (historyVisibility) {\n    argCheck.values('room.setHistoryVisibility', 'historyVisibility', historyVisibility,\n            ['shared', 'invited', 'joined', 'public'])\n    return setState('m.room.history_visibility', {\n      history_visibility: historyVisibility,\n    })\n  }\n\n  /**\n   * The current name of the room.\n   * @readonly\n   * @member {string} Room#name\n   */\n  Object.defineProperty(this, 'name', {\n    enumerable: true,\n    get: function () {\n      return name\n    },\n  })\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Sets the name of the room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Room#setName\n   * @param {string} name - The new name for this room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setName = function (name) {\n    argCheck.optString('room.setName', 'name', name)\n    return setState('m.room.name', {\n      name: name || null,\n    })\n  }\n\n  /**\n   * The events of the room.\n   * @readonly\n   * @member {Room~Event[]} Room#events\n   */\n  Object.defineProperty(this, 'events', {\n    enumerable: true,\n    get: function () {\n      return events.slice()\n    },\n  })\n\n  /**\n   * The user that invited the client to the room.\n   * @readonly\n   * @member {Room~Event[]} Room#invitedBy\n   */\n  Object.defineProperty(this, 'invitedBy', {\n    enumerable: true,\n    get: function () {\n      return invitedBy\n    },\n  })\n\n  /**\n   * A list of state types that are present in this room.\n   * @readonly\n   * @member {EventType[]} Room#states\n   */\n  Object.defineProperty(this, 'states', {\n    enumerable: true,\n    get: function () {\n      return Object.keys(states).map(function (key) {\n        return states[key]\n      })\n    },\n  })\n\n  /**\n   * Retrieves the state access object for a state of a specific type in the room.\n   *\n   * @function Room#state\n   * @param {EventType} type - The state type.\n   * @returns {RoomState} - A room state object for interacting with the state.\n   */\n  this.state = function (type) {\n    argCheck.string('room.state', 'type', type)\n    var state = states[type] = states[type] ||\n            priv(RoomState, type, self, setState.bind(self, type))\n    return state\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Send an event.\n   *\n   * If two arguments are passed, they are treated as eventType + content.\n   *\n   * If only one argument is passed, it is treated as the body for a message event,\n   *  the type of the message is inferred from the argument that was passed.\n   * ##### Errors:\n   * - {@link TooLargeError} - The serialized content is too large, as in it occupies too many bytes.\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Room#send\n   * @param {EventType|*} eventType - The type of the event,\n   *  or if only one arguments is passed, the message body.\n   * @param {Object} [content] - The content of the event.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  function send(eventType, content) {\n    if (membership !== 'member') {\n      return Promise.reject(new Error('Room.send: not a member of the room: ', self.id, membership))\n    }\n    argCheck.count('room.send', 1, arguments.length)\n    if (arguments.length === 1) {\n      content = eventType\n      if (typeof(content) !== 'string') {\n        throw new TypeError('room.send: could not infer message type from', content)\n      }\n      return request.send.path('m.room.message').post({\n        body: content,\n        msgtype: 'm.text',\n      }).then(returnSelf)\n    } else {\n      argCheck.string('room.send', 'eventType', eventType)\n      argCheck.object('room.send', 'content', content)\n      return request.send.path(eventType).post(content).then(returnSelf)\n    }\n  }\n\n  function setState(stateType, stateKey, content) {\n    argCheck.count('room.setState', 2, arguments.length)\n    argCheck.string('room.setState', 'stateType', stateType)\n    if (arguments.length === 2) {\n      content = stateKey\n      stateKey = null\n    }\n    var req = request.state.path(stateType)\n    if (stateKey) {\n      req = req.path(stateKey)\n    }\n    return req.put(content).then(returnSelf)\n  }\n\n  /**\n   * The power levels in the room.\n   * @readonly\n   * @member {PowerLevelsReader} Room#powerLevels\n   */\n  getter(this, 'powerLevels', function () {\n    return powerLevelsReader\n  })\n\n  /**\n   * Sets the entire power level state of the room to that of a power\n   * level container object.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#setPowerLevels\n   * @param {PowerLevelsEdit|PowerLevelsReader} powerLevels - A power level container.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  this.setPowerLevels = function (powerLevels) {\n    argCheck.object('room.setPowerLevels', 'powerLevels', powerLevels)\n    if (powerLevels.toRawForServer) {\n      powerLevels = powerLevels.toRawForServer(dependencies.serverName)\n    }\n    return setState('m.room.power_levels', powerLevels)\n  }\n\n  /**\n   * The power level of the own user in this room. Or null\n   * if not a member of the room.\n   * @readonly\n   * @member {?number} Room#powerLevel\n   */\n  getter(this, 'powerLevel', function () {\n    return powerLevel\n  })\n\n  /**\n   * Start editing the power levels of this room using a {@link PowerLevelsEdit}.\n   *\n   * @function Room#editPowerLevels\n   * @returns {PowerLevelsEdit}\n   */\n  prop(this, 'editPowerLevels', function () {\n    if (powerLevelsReader === null) {\n      return null\n    }\n    let serverName = dependencies.serverName\n    let transaction = priv(PowerLevelsEdit, powerLevelsReader._powerLevels, {serverName})\n    transaction.commit = function () {\n      return setState('m.room.power_levels', transaction.toRawForServer(serverName))\n    }\n    return transaction\n  })\n\n  /**\n   * This callback is used to help decide how many events are loaded in.\n   *  It is called once for every event that is loaded.\n   *\n   * @callback Room~LoadFilterFunction\n   * @param {Room~Event} event - Event which has been loaded.\n   * @param {number} index - The number of events that were loaded before this one.\n   * @returns {boolean} - True if the event should count towards the total load count, false otherwise.\n   */\n\n  /**\n   * Load in old events. If multiple requests are sent at once they will be queued after eachother.\n   *\n   * By passing a filterFunction, it is possible to filter whether each event should\n   *  count towards the total count, and keep loading in events until the total count has been reached.\n   * Events that are filtered out by the filter function are not discarded,\n   *  they simply don't count towards the load count.\n   *\n   * If a filter function is used the number of matching events might exceed the requested count,\n   * since events are loaded in chunks and no events will be ignored.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room.\n   *\n   * @function Room#load\n   * @param {number} count - The number of events to load.\n   * @param {number} [chunkSize=10] - Only valid if a filter function is given. It specifies how many events\n   *  are loaded and filtered with each request.\n   * @param {Room~LoadFilterFunction} [filterFunction] - Function used to\n   *  filter out events that should count towards the event count.\n   * @returns {Promise<Room~Event[], CctError>} List of events that were loaded, sorted newest to oldest.\n   */\n  this.load = function (count, chunkSize, filterFunction) {\n    argCheck.count('room.load', 1, arguments.length)\n    argCheck.number('room.load', 'count', count)\n    if (eventsStart === null) {\n      return Promise.resolve([])\n    }\n    var previousStart = eventsStart\n    if (arguments.length === 2) {\n      filterFunction = chunkSize\n      chunkSize = 10\n    } else if (arguments.length > 2) {\n      argCheck.number('room.load', 'chunkSize', chunkSize)\n    }\n    if (arguments.length > 1) {\n      argCheck.func('room.load', 'filterFunction', filterFunction)\n      var loaded = []\n      var index = 0\n      var filteredCount = 0\n\n      return loadQueue.push(function () {\n        return new Promise(function (resolve, reject) {\n          recursiveFetch(resolve, reject)\n        })\n      })\n    }\n    return loadQueue.push(function () {\n      if (eventsStart === null) {\n        return Promise.reject('EOS')\n      }\n      return request.events.query({\n        limit: count,\n        from: '' + eventsStart,\n      }).get()\n    }).then(function (response) {\n      var addedEvents = addEvents(response)\n      self._emit('events', self)\n      return addedEvents\n    }).catch(function (err) {\n      if (err === 'EOS') {\n        return []\n      }\n      throw err\n    })\n\n    function recursiveFetch(resolve, reject) {\n      return request.events.query({\n        limit: chunkSize,\n        from: '' + eventsStart,\n      }).get().then(function (response) {\n        var addedEvents = addEvents(response)\n        addedEvents.forEach(function (event) {\n          var counted = true\n          try {\n            counted = filterFunction(event, index)\n          } catch (e) {\n            log.error('room', 'Room.load: error thrown by filter function: ', e)\n          }\n          if (counted) {\n            filteredCount += 1\n          }\n          index += 1\n        })\n        loaded = loaded.concat(addedEvents)\n        self._emit('events', self)\n        if (filteredCount >= count || self.allEventsLoaded) {\n          resolve(loaded)\n        } else {\n          return recursiveFetch(resolve, reject)\n        }\n      }).catch(reject)\n    }\n\n    function addEvents(response) {\n      var body = response.body\n      eventsStart = body.end\n      if (eventsStart === previousStart) {\n        eventsStart = null\n      }\n      previousStart = eventsStart\n      return body.chunk.map(function (event) {\n        event.isPastEvent = true\n        var simple = toSimpleEvent(event)\n        if (simple) {\n          if (events[simple.id]) {\n            var index = find(events, function (event) {\n              return event.id === simple.id\n            })\n            if (index !== null) {\n              events[index] = simple\n            } else {\n              log.error('room', 'failed to find existing event with id match:', simple)\n            }\n          } else {\n            events.push(simple)\n            events[simple.id] = simple\n          }\n        }\n        return simple\n      }).filter(x => x)\n    }\n  }\n\n  /**\n   * True if all past events have been loaded\n   *\n   * @readonly\n   * @member {boolean} Room#allEventsLoaded\n   */\n  getter(this, 'allEventsLoaded', function () {\n    return eventsStart === null\n  })\n\n  /**\n   * True if more events are currently being loaded in\n   *\n   * @readonly\n   * @member {boolean} Room#isLoading\n   */\n  getter(this, 'isLoading', function () {\n    return !!loadQueue.executing\n  })\n\n  /**\n   * Invites a user to this room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#invite\n   * @param {UserId|User} user - A user or a user id.\n   * @returns {Promise<Room, CctError>} - The room.\n   */\n  this.invite = function (user) {\n    argCheck.count('room.invite', 1, arguments.length)\n    return request.invite.post({\n      user_id: toUserId('room.invite', user, dependencies.serverName),\n    }).then(returnSelf).catch(throwAuthErrorIfNotFound)\n  }\n\n  /**\n   * Join this room.\n   * ##### Errors:\n   * - {@link NotFoundError} - If the room does not exist, e.g. after using {@link Client#getRoom}.\n   * - {@link NotAllowedError} - The user must be invited or the room join rule needs to be open.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#join\n   * @returns {Promise<Room, CctError>} - The room.\n   */\n  this.join = function () {\n    if (membership === 'member') {\n      return Promise.resolve(self)\n    } else if (waitForJoined) {\n      return waitForJoined.promise\n    } else {\n      waitForJoined = defer()\n      return Promise.all([\n        waitForJoined.promise,\n        request.join.post().catch(function (err) {\n          waitForJoined = null\n          throw err\n        }),\n      ]).then(returnSelf)\n    }\n  }\n\n  /**\n   * Leave this room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room.\n   *\n   * @function Room#leave\n   * @returns {Promise<Room, CctError>} - The room.\n   */\n  this.leave = function () {\n    if (membership === 'invited') {\n      self._close()\n      return request.leave.post().then(returnSelf).catch(throwAuthErrorIfNotFound)\n    } else if (membership !== 'member') {\n      return Promise.resolve(self)\n    } else {\n      return request.leave.post().then(returnSelf).catch(throwAuthErrorIfNotFound)\n    }\n  }\n\n  /**\n   * Kick a user from this room.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   *\n   * @function Room#kick\n   * @param {UserId|User} user - The user to kick.\n   * @returns {Promise<Room, CctError>} - The room.\n   */\n  this.kick = function (user) {\n    argCheck.count('room.kick', 1, arguments.length)\n    var userId = toUserId('room.kick', user, dependencies.serverName)\n    return request.kick.post({\n      user_id: userId,\n    }).then(returnSelf).catch(throwAuthErrorIfNotFound)\n  }\n\n  /**\n   * Initiate a call in the room.\n   *\n   * @function Room#startCall\n   * @param {UserId|User} peer - The user to call as either a user instance or user id.\n   * @returns {Call} - The call.\n   */\n  this.startCall = function (peer) {\n    argCheck.count('room.startCall', 1, arguments.length)\n\n    peer = userRegistry.getUser(toUserId('room.startCall', peer, dependencies.serverName))\n    log.debug('room', 'starting call to peer', peer)\n\n    return callRegistry.startCall(self, peer)\n  }\n\n  /**\n   * Starts a new passive call in the room. A passive call works much like a normal call,\n   * except that it does not initiate any new call, it only accepts incoming calls.\n   *\n   * This is typically used in the scenario where the creator of a room wants to start\n   * setting up a call before knowing who the peer will be.\n   *\n   * Passive calls will always accept incoming calls from new peers, and hang up the\n   * call to old ones. Whenever the call connects to a new peer, a 'peer' event will be\n   * emitted from the call.\n   *\n   * @function Room#startPassiveCall\n   * @returns {Call} - The call.\n   */\n  this.startPassiveCall = function () {\n    log.debug('room', 'starting passive call')\n    return callRegistry.startCall(self)\n  }\n\n  /**\n   * Start or join a conference call in the room. All clients that call this method within\n   * a room will end up in the same conference.\n   *\n   * @function Room#startConference\n   * @param {Object} options - Options object.\n   * @param {ConferenceSwitcherMode} [options.switcherMode] - The default switcher mode for the conference.\n   * @returns {ConferenceCall} - The conference call.\n  */\n  this.startConference = function (options) {\n    log.debug('room', 'starting conference call')\n    return callRegistry.startConference(self, options)\n  }\n\n  /**\n   * The active conference in the room, if there is one\n   *\n   * @readonly\n   * @member {Conference} Room#conference\n   */\n  getter(this, 'conference', function () {\n    return callRegistry.getConferenceInRoom(this)\n  })\n\n  /**\n   * All active calls in the room. Each key-value pair is the other user and\n   * the call object.\n   * @readonly\n   * @member {object<UserId,Call>} Room#calls\n   */\n  getter(this, 'calls', function () {\n    return assign({}, callRegistry.getCallsInRoom(this))\n  })\n\n  /**\n   * Get the passive call in a room, if there is one.\n   * @readonly\n   * @member {Call?} Room#passiveCall\n   */\n  getter(this, 'passiveCall', function () {\n    return callRegistry.getPassiveCallInRoom(this)\n  })\n\n  hiddenProp(this, '_registerQuery', function (query) {\n    queries.push(query)\n  })\n\n  this.send = send\n\n  this._serviceRequest = function (serviceLocalId, eventType, content = {}, timeoutMs = 10000) {\n    argCheck.string('room._serviceRequest', 'serviceLocalId', serviceLocalId)\n    argCheck.string('room._serviceRequest', 'eventType', eventType)\n    argCheck.optObject('room._serviceRequest', 'content', content)\n    argCheck.optNumber('room._serviceRequest', 'timeoutMs', timeoutMs)\n\n    let serviceId = `@${serviceLocalId}:${dependencies.serverName}`\n\n    let deferred = defer()\n    deferred.senderId = serviceId\n    deferred.eventType = `${eventType}.reply`\n\n    var waitForService\n\n    if (memberships[serviceLocalId] !== 'member') {\n      log.debug('room', `need to wait for '${serviceId}' before sending service request`)\n      if (!awaitingJoin) {\n        awaitingJoin = new Map()\n      }\n      if (awaitingJoin.has(serviceId)) {\n        waitForService = awaitingJoin.get(serviceId).promise\n      } else {\n        let deferred = defer()\n        awaitingJoin.set(serviceId, deferred)\n        setTimeout(() => {\n          if (awaitingJoin.get(serviceId)) {\n            deferred.reject(new Error('timed out waiting for service to join'))\n            awaitingJoin.delete(serviceId)\n          }\n        }, timeoutMs)\n        waitForService = deferred.promise\n      }\n    } else {\n      waitForService = Promise.resolve()\n    }\n\n    return waitForService\n      .then(() => request.send.path(eventType).post(content))\n      .then(response => {\n        let eventId = response.body && response.body.event_id\n        if (!eventId) {\n          throw new Error('No event_id in response')\n        }\n        if (!replyEventSnatchers) {\n          replyEventSnatchers = new Map()\n        }\n        replyEventSnatchers.set(eventId, deferred)\n        setTimeout(() => {\n          deferred.reject(new Error('request timed out'))\n          replyEventSnatchers.delete(eventId)\n        }, timeoutMs)\n        return deferred.promise.then(content => {\n          let {error} = content\n          if (error) {\n            let {name, message, extra} = error\n            let newError = new Error(message)\n            newError.name = name\n            if (extra) {\n              newError.extra = extra\n            }\n            throw newError\n          } else {\n            return content\n          }\n        })\n      })\n  }\n}\n\nRoom.prototype = {\n  constructor: Room,\n  tag: 'room',\n\n  toString: function () {\n    return this.id\n  },\n\n  get banned() {\n    throw new Error('room.banned has been removed')\n  },\n\n  get ban() {\n    throw new Error('room.ban has been removed')\n  },\n\n  get aliases() {\n    throw new Error('room.aliases has been replaced by room.alias')\n  },\n\n  get setType() {\n    throw new Error('room.setType has been removed, type is immutable')\n  },\n\n  /**\n   * Account data object that is used to access room scoped account data.\n   *\n   * @readonly\n   * @member {AccountData} Room#accountData\n   */\n  get accountData() {\n    return this._accountData\n  },\n\n  _setAccountData: function (key, value) {\n    return this._request.setAccountData.path(key).put(value)\n  },\n}\n\nEmitterMixin.call(Room.prototype)\n\n/**\n * @typedef {object} Room~Event\n * @property {EventType} type - The event type\n * @property {object} content - The content of the event\n * @property {object} [oldContent] - The previous content of a state, if any.\n * @property {boolean} isStateChange - Whether or not this event is a state change event\n *  that changes the state of the room, as opposed to a message event which doesn't change any state.\n * @property {string} [stateKey] - The state key for a state change event or null if the default value was changed.\n *  Only defined for state events.\n * @property {User} sender - The user that sent the event\n * @property {Room} room - The room that event was received from\n * @property {boolean} isOwnEvent - True if the event was triggered by the authenticated user\n * @property {boolean} isPastEvent - True if the event was received before the client connected.\n * @property {number} timestamp - Unix timestamp in milliseconds\n */\n\n/**\n * A string describing the users membership in a room.\n * @typedef {\"member\"|\"kicked\"|\"invited\"|null} Room~Membership\n */\n\n/**\n * A string describing the visibility rules for events in a room.\n *\n * - `'shared'` - Any member of the room can read the entire history.\n * - `'invited'` - Members can only read the history from the point they\n * where invited to the room.\n * - `'joined'` - Members can only read the history from the point they\n * joined the room.\n * - `'public'` - All events in the room can be read by anyone, including guest accounts.\n *\n * **NOTE:** The visibility rules apply when an event is sent, for each event.\n * The visibility of events cannot be changed retrospectively.\n *\n * @typedef {\"invited\"|\"joined\"|\"shared\"|\"public\"} Room~HistoryVisibility\n */\n\n/**\n * The join rule of a room determines how users are able to join the room.\n * - `'open'` - the user can be joined by anyone that has the room id or an\n * alias of the room.\n * - `'invite'` - only allows users to join after first being invited to the\n * room by an existing member.\n * @typedef {'open'|'invite'} Room~JoinRule\n */\n\n/**\n * The guest access rule of a room determines how guests are able to join the room.\n * - `'open'` - guests are allowed to join the room, but are still subject to the\n * join rule of the room.\n * - `'closed'` - guests are not allowed to join the room.\n * @typedef {'open'|'closed'} Room~GuestAccessRule\n */\n\n/**\n * Emitted when the alias of the room changes\n * @event Room#alias\n * @param {RoomAlias[]} alias - The new alias of the room.\n */\n\n/**\n * Emitted when there is an incoming call to this room. Incoming calls are stopped and\n * need to be started with {@link Call#start} before a connection is set up.\n * @event Room#call\n * @param {Call} call - The call object\n */\n\n/**\n * Emitted when a new {@link Room~Event} is triggered in the room.\n * Will not trigger when loading old events.\n * @event Room#event\n * @param {Room~Event} event - The event\n */\n\n/**\n * Same as {@link Room#event:event}, but listens to a specific event type\n * @event Room#event:&lt;type&gt;\n * @param {Room~Event} event - The event\n */\n\n/**\n * Emitted when the list of {@link Room~Event}s in the room change\n * @event Room#events\n * @param {Room~Event[]} events - The list of events for the room\n */\n\n/**\n * Emitted when a user is invited to the room\n * @event Room#invite\n * @param {User} user - The user that was invited\n * @param {User} doneBy - The user responsible for the membership change\n */\n\n/**\n * Emitted when the `invited` user collection is changed.\n *\n * This event does not have any parameters, the updated list of users\n * can instead be accessed via the {@link Room#invited}.\n *\n * @event Room#invited\n */\n\n/**\n * Emitted when a user joins the room\n * @event Room#join\n * @param {User} user - The user that joined\n * @param {User} doneBy - The user responsible for the membership change\n */\n\n/**\n * Emitted when a user leaves the room\n * @event Room#leave\n * @param {User} user\n * @param {User} doneBy - The user responsible for the membership change\n */\n\n/**\n * Emitted when the `members` user collection is changed.\n *\n * This event does not have any parameters, the updated list of users\n * can instead be accessed via the {@link Room#members}.\n *\n * @event Room#members\n */\n\n/**\n * Emitted when the `otherMembers` user collection is changed.\n *\n * This event does not have any parameters, the updated list of users\n * can instead be accessed via the {@link Room#otherMembers}.\n *\n * @event Room#otherMembers\n */\n\n/**\n * Emitted when the membership of any user in the room is changed.\n * @event Room#memberships\n * @param {Object.<UserId,Room~Membership>} memberships - The new memberships\n */\n\n/**\n * Emitted when the authenticated users membership of the room is changed\n * @event Room#membership\n * @param {Room~Membership} membership - The new membership of the room\n * @param {Room~Membership} prev - The previous membership of the room\n */\n\n/**\n * Emitted when the name of the room is changed\n * @event Room#name\n * @param {string} name - The new name\n */\n\n/**\n * Emitted when the power levels of the room change\n * @event Room#powerLevels\n * @param {PowerLevelsReader} powerLevels - The new power levels in the room\n */\n\n/**\n * Emitted when a state of the room is changed\n * @event Room#state\n * @param {RoomState} state - The state that was changed\n */\n\n/**\n * Same as {@link Room#event:state}, but listens to a specific state type\n * @event Room#state:&lt;stateType&gt;\n * @param {RoomState} state - The state that was changed\n */\n\n/**\n * Emitted when the topic of the room is changed\n * @event Room#topic\n * @param {string} topic - The new topic\n */\n\n/**\n * Emitted when the avatar of the room is changed\n * @event Room#avatar\n * @param {ImageResource} avatar - The new avatar\n */\n\n/**\n * Emitted when the history visibility of the room changes.\n * @event Room#historyVisibility\n * @param {Room~HistoryVisibility} historyVisibility - The new history visibility\n */\n\n/**\n * Emitted when the type of the room is changed\n * @event Room#type\n * @param {string} roomType - The new room type\n */\n\n/**\n * Emitted when the creator of the room is changed\n * @event Room#creator\n * @param {User} creator - The new room creator\n */\n\n/**\n * Emitted when the creation content of the room is changed\n * @event Room#creationContent\n * @param {JsonTypes} creationContent - The new room creationContent\n */\n\n/**\n * Emitted when the list of users who are currently typing is changed.\n *\n * This event does not have any parameters, the updated list of users\n * can instead be accessed via the {@link Room#typing}.\n *\n * @event Room#typing\n */\n\n/**\n * Emitted when the join rule of the room changes.\n * @event Room#joinRule\n * @param {Room~JoinRule} joinRule - The new join rule\n * @param {Room~JoinRule} oldJoinRule - The old join rule of the room\n */\n\n/**\n * Emitted when the guest access rule of the room changes.\n * @event Room#guestAccessRule\n * @param {Room~GuestAccessRule} guestAccessRule - The new guest access rule\n * @param {Room~GuestAccessRule} oldGuestAccessRule - The old guest access rule\n */\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/room.js","'use strict'\n\nimport EmitterMixin from 'common/emitter'\nimport log from 'common/log'\nimport {\n  assertPriv,\n  hiddenProp,\n} from 'common/utils'\n\nimport {parseIdForServer} from 'matrix/ids'\n\n// eslint-disable-next-line\n/**\n * Represents a user.\n *\n * @abstract\n * @class User\n * @extends EventEmitter\n */\nexport default function User(priv, config, imageResourceFactory) {\n  assertPriv('User', priv)\n  var self = this\n\n  let id = parseIdForServer('User constructor', config.matrixId, config.serverName, 'user')\n  let matrixId = config.matrixId\n\n  this._membershipUpdateTime = 0\n\n  var name = null\n  var avatar = null\n  var presence = 'offline'\n  var statusMessage = null\n  var lastActive = null\n\n  function applyUpdate(config) {\n    var newName = config.displayname\n    if (!('displayname' in config)) {\n      newName = config.name\n    }\n    if (newName !== undefined && newName !== name) {\n      name = newName\n      self._emit('name', name)\n    }\n    var newAvatarUrl = config.avatar_url || config.avatarUrl\n    if (newAvatarUrl !== undefined) {\n      if (newAvatarUrl === null) {\n        if (avatar !== null) {\n          avatar = null\n          self._emit('avatar', avatar)\n        }\n      } else {\n        var newAvatar = imageResourceFactory(newAvatarUrl)\n        if (newAvatar !== avatar) {\n          avatar = newAvatar\n          self._emit('avatar', avatar)\n        }\n      }\n    }\n    if ('avatar' in config) {\n      avatar = config.avatar\n      self._emit('avatar', avatar)\n    }\n    var newPresence = config.presence\n    if (newPresence !== undefined && newPresence !== presence) {\n      presence = newPresence\n      self._emit('presence', presence)\n    }\n    var newStatusMessage = config.status_msg\n    if (!('status_msg' in config)) {\n      newStatusMessage = config.statusMessage\n    }\n    if (newStatusMessage !== undefined && newStatusMessage !== statusMessage) {\n      statusMessage = newStatusMessage\n      self._emit('statusMessage', statusMessage)\n    }\n    var lastActiveAgo = config.last_active_ago || config.lastActiveAgo\n    if (lastActiveAgo !== undefined) {\n      if (isNaN(lastActiveAgo)) {\n        if (lastActive !== null) {\n          lastActive = null\n          self._emit('lastActive', lastActive)\n        }\n      } else {\n        var time = new Date().getTime() - (lastActiveAgo || 0)\n        if (Math.abs(time - (lastActive || 0)) > 1000) {\n          lastActive = new Date(time)\n          self._emit('lastActive', lastActive)\n        }\n      }\n    }\n  }\n\n  hiddenProp(this, '_applyUpdate', applyUpdate)\n  hiddenProp(this, '_matrixId', matrixId)\n\n  /**\n   * The id of the user\n   * @readonly\n   * @member {string} User#id\n   */\n  Object.defineProperty(this, 'id', {\n    enumerable: true,\n    value: id,\n  })\n\n  Object.defineProperty(this, 'localId', {\n    enumerable: false,\n    get() {\n      log.warning('user', 'user.localId is deprecated, use user.id instead')\n      return id\n    },\n  })\n\n  /**\n   * The name of the user\n   * @readonly\n   * @member {string} User#name\n   */\n  Object.defineProperty(this, 'name', {\n    enumerable: true,\n    get: function () {\n      return name\n    },\n  })\n\n  /**\n   * The url to the user's avatar\n   * @readonly\n   * @member {ImageResource} User#avatar\n   */\n  Object.defineProperty(this, 'avatar', {\n    enumerable: true,\n    get: function () {\n      return avatar\n    },\n  })\n\n  /**\n   * The users presence type\n   * @readonly\n   * @member {\"online\"|\"unavailable\"|\"offline\"} User#presence\n   */\n  Object.defineProperty(this, 'presence', {\n    enumerable: true,\n    get: function () {\n      return presence\n    },\n  })\n\n  /**\n   * A message set by the user\n   * @readonly\n   * @member {string} User#statusMessage\n   */\n  Object.defineProperty(this, 'statusMessage', {\n    enumerable: true,\n    get: function () {\n      return statusMessage\n    },\n  })\n\n  /**\n   * The last time the user was active\n   * @readonly\n   * @member {?Date} User#lastActive\n   */\n  Object.defineProperty(this, 'lastActive', {\n    enumerable: true,\n    get: function () {\n      return lastActive\n    },\n  })\n\n  applyUpdate(config)\n}\n\nUser.prototype = {\n  constructor: 'User',\n  tag: 'user',\n\n  toString: function () {\n    return this.id\n  },\n\n  _update: function (info) {\n    this._applyUpdate(info)\n  },\n\n  _membershipEventUpdate: function (event) {\n    if (this._membershipUpdateTime < event.origin_server_ts) {\n      this._membershipUpdateTime = event.origin_server_ts\n      this._applyUpdate(event.content)\n    }\n  },\n}\n\nEmitterMixin.call(User.prototype)\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/user.js","'use strict'\n\nimport EmitterMixin from 'common/emitter'\n\nimport MediaSink from 'media/mediaSink'\n\n/**\n * A callback that will be called whenever the input stream is changed.\n *\n * @callback StreamSink~OnStreamCallback\n * @param {MediaStream} stream - The new stream.\n */\n\n/**\n * A simple media sink that emits a stream event and provides a stream property. Mainly useful for testing.\n *\n * @class StreamSink\n * @extends MediaSink\n * @extends EventEmitter\n * @param {Object} [options] - Optional options object.\n * @param {StreamSink~OnStreamCallback} [options.onStream] - Callback that will be called whenever the stream changes.\n */\nexport default class StreamSink extends EmitterMixin(MediaSink) {\n  constructor({onStream} = {}) {\n    super()\n    if (onStream) {\n      this._onStream = onStream\n    }\n  }\n\n  /**\n   * Emitted whenever the stream is changed.\n   *\n   * @event MediaTee#stream\n   * @param {?MediaStream} stream - The media stream, or null.\n   */\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  onStream(stream) {\n    if (this._onStream) {\n      this._onStream(stream)\n    }\n    this._emit('stream', stream)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/streamSink.js","'use strict'\n\nimport MediaSource from 'media/mediaSource'\n\n/**\n * A simple media node that forwards a single media stream. Useful for testing and bridging with other libraries.\n *\n * @class StreamSource\n * @extends MediaSource\n * @param {Object} [options] - Optional options object.\n * @param {?MediaStream} [options.stream] - The media stream.\n */\nexport default class StreamSource extends MediaSource {\n  constructor({stream} = {}) {\n    super()\n    if (stream) {\n      this.setStream(stream)\n    }\n  }\n\n  // Override superclass docs\n  /**\n   * Sets the current media stream.\n   *\n   * @function StreamSource#setStream\n   * @param {?MediaStream} stream - The media stream.\n   */\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/streamSource.js","'use strict'\n\nimport {MediaStream} from 'webrtc/utils'\n\nimport MediaNodeOutput from 'media/mediaNodeOutput'\nimport MediaSink from 'media/mediaSink'\n\n/**\n * A media node that splits a single media stream into one stream with the audio track, and another stream\n * with the video track.\n *\n * @class StreamSplitter\n * @extends MediaSink\n */\nexport default class StreamSplitter extends MediaSink {\n  constructor() {\n    super()\n    this._audioOutput = new MediaNodeOutput({\n      name: 'audio',\n      parent: this,\n    })\n    this._videoOutput = new MediaNodeOutput({\n      name: 'video',\n      parent: this,\n    })\n  }\n\n  /**\n   * The output that will contain the audio track.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} StreamSplitter#audioOutput\n   */\n  get audioOutput() {\n    return this._audioOutput\n  }\n\n  /**\n   * The output that will contain the video track.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} StreamSplitter#videoOutput\n   */\n  get videoOutput() {\n    return this._videoOutput\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  onStream(stream) {\n    if (!stream) {\n      this._audioOutput.setStream(null)\n      this._videoOutput.setStream(null)\n      return\n    }\n\n    if (stream.getAudioTracks().length) {\n      let newStream = new MediaStream()\n      newStream.addTrack(stream.getAudioTracks()[0])\n      this._audioOutput.setStream(newStream)\n    } else {\n      this._audioOutput.setStream(null)\n    }\n\n    if (stream.getVideoTracks().length) {\n      let newStream = new MediaStream()\n      newStream.addTrack(stream.getVideoTracks()[0])\n      this._videoOutput.setStream(newStream)\n    } else {\n      this._videoOutput.setStream(null)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/streamSplitter.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\nimport {\n  forEach,\n  mapValues,\n  ReadOnlyMap,\n} from 'common/utils'\n\nimport MediaNode, {InputMap, OutputMap} from 'media/mediaNode'\n\nimport RtcComponent from 'webrtc/rtcComponent'\nimport {JsonChannelBroadcastController} from 'webrtc/channelControllers'\nimport {getMediaStreamId} from 'webrtc/utils'\n\n/**\n * This class provides a point of interaction with remote peers of an attached {@link RtcComponent}.\n * Peers are accessed either through {@link AttachPoint#peers}, or via the overridable methods of {@link AttachPoint}.\n *\n * @abstract\n * @class RtcPeer\n * @extends MediaNode\n * @extends ConnectMixin\n */\nexport class RtcPeer extends MediaNode.connectMixin(MediaNode) {\n  constructor({id, onUpdate, onCreateChannel}) {\n    super()\n    this._id = id\n    this._onUpdate = onUpdate\n    this._onCreateChannel = onCreateChannel\n\n    this._remoteChannels = []\n    this._inputs = new InputMap({parent: this})\n    this._outputs = new OutputMap({parent: this})\n\n    this.createChannel = this.createChannel.bind(this)\n  }\n\n  /**\n   * The id of the remote peer.\n   *\n   * @readonly\n   * @member {string} RtcPeer#id\n   */\n  get id() {\n    this._checkValid()\n    return this._id\n  }\n\n  set id(value) {\n    throw new TypeError('RtcPeer.id is read-only')\n  }\n\n  /**\n   * The default media input for this peer.\n   *\n   * This is provided as a convenience to be able to connect directly to the peer when only a\n   * single media stream is needed. Using this input is the same as using the input named\n   * `'media'` from the inputs collection.\n   *\n   * @readonly\n   * @member {MediaNodeInput} RtcPeer#input\n   */\n  get input() {\n    return this.inputs.get('media')\n  }\n\n  /**\n   * The default media output for this peer.\n   *\n   * This is provided as a convenience to be able to connect directly from the peer when only a\n   * single media stream is needed. Using this output is the same as using the output named\n   * `'media'` from the outputs collection.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} RtcPeer#output\n   */\n  get output() {\n    return this.outputs.get('media')\n  }\n\n  /**\n   * A collection of media inputs. The inputs functions as a media pipe to the peer, as the streams\n   * sent to each input can be retrived from the outputs on the peers end.\n   *\n   * @readonly\n   * @member {InputMap} RtcPeer#inputs\n   */\n  get inputs() {\n    this._checkValid()\n    return this._inputs\n  }\n\n  /**\n   * A collection of media outputs. The outputs will forward the streams that the peer sent in via\n   * it's inputs.\n   *\n   * @readonly\n   * @member {OutputMap} RtcPeer#outputs\n   */\n  get outputs() {\n    this._checkValid()\n    return this._outputs\n  }\n\n  /**\n   * @private\n   */\n  onStream() {\n    this._onUpdate()\n  }\n\n  // Docs from mixin\n  connect(target) {\n    this._checkValid()\n    return super.connect(target)\n  }\n\n  // Docs from mixin\n  disconnect(target) {\n    this._checkValid()\n    return super.disconnect(target)\n  }\n\n  /**\n   * @private\n   * @returns {Object<MediaStream>} Returns the local streams for this peer.\n   */\n  _getLocalStreams() {\n    this._checkValid()\n    let streams = {}\n    this.inputs.forEach((input, name) => {\n      if (input.stream) {\n        streams[name] = input.stream\n      }\n    })\n    return streams\n  }\n\n  /**\n   * Sets the remote media streams for this peer.\n   *\n   * @private\n   * @param {Object<MediaStream>} streams - A set of remote streams, where the key is the name of the stream.\n   */\n  _setRemoteStreams(streams) {\n    this._checkValid()\n    this.outputs.forEach((output, name) => {\n      if (!streams.hasOwnProperty(name)) {\n        output.setStream(null)\n      }\n    })\n    for (let name in streams) {\n      let output = this.outputs.get(name)\n      output.setStream(streams[name])\n    }\n  }\n\n  /**\n   * Creates a new data channel to the peer, see {@link DataChannel}.\n   *\n   * The default behavior when creating a channel is that a local channel is created,\n   * and a remote version of the channel will be received in the\n   * {@link RtcComponent#rtcComponentReceivedChannel} method. This means that the\n   * channel setup is asymmetric, one side creates a new channel, and the other\n   * side receives it. This works best in request-type scenarios, where the component\n   * that receives the channel doesn't know about it ahead of time.\n   *\n   * The other way to set up a channel is by specifying a pairingId, which is a quite\n   * simple and symmetrical way of setting up channels. If both components specify\n   * the same pairingId when creating a channel, the channels will pair up and connect\n   * to each other. The label and protocol of paired channels must also match.\n   * Paired channels will not be received in {@link RtcComponent#rtcComponentReceivedChannel}.\n   * It's also not possible to close paired channels.\n   *\n   * Created and received channels are closed whenever the peer is lost. So paired channels\n   * need to be recreated whenever a new peer is received.\n   *\n   * @param {Object} config - Configuration object.\n   * @param {string} config.label - A label describing the data channel.\n   * @param {string} [config.protocol] - A protocol that can be used to identify the purpose of the channel.\n   * @param {string} [config.paringId] - The id used to pair the channel with a remote one.\n   * @returns {DataChannel} The newly created data channel.\n   */\n  createChannel(config) {\n    this._checkValid()\n    return this._onCreateChannel(config)\n  }\n\n  /**\n   * Sets the remote channels for this peer.\n   *\n   * @private\n   * @param {Array<DataChannel>} channels - An array of data channels.\n   */\n  _setRemoteChannels(channels) {\n    let newChannels = channels.slice(this._remoteChannels.length)\n    this._remoteChannels = channels.slice()\n    return newChannels\n  }\n\n  /**\n   * Checks if the RtcPeer is still valid and can be used. Throws an error if it is not.\n   *\n   * @private\n   */\n  _checkValid() {\n    if (this._id === null) {\n      throw new Error('Tried to access invalidated RtcPeer')\n    }\n  }\n\n  /**\n   * Cleans up and invalidates the peer, any methods called afterwards will throw an error.\n   *\n   * @private\n   */\n  _invalidate() {\n    this._id = null\n    this._remoteChannels = null\n    this._inputs.clear()\n    this._outputs.clear()\n    this._inputs = null\n    this._outputs = null\n  }\n}\n\n/**\n * A class which provides an interface for RtcComponents that are attached to a call or conference.\n * Should not be constructed directly.\n *\n * The lifetime of the attach point is tied to the attachment of the component. The attach point can\n * only be accessed while the components is attached to something, if it isn't an error will be thrown.\n *\n * @class AttachPoint\n * @abstract\n */\nexport class AttachPoint {\n  constructor({type, ownId, data, component, onUpdate, onCreateChannel}) {\n    this.tag = 'attach-point'\n    this._type = type\n    this._ownId = ownId\n    this._data = data\n    this._component = component\n    this._onUpdate = onUpdate\n    this._onCreateChannel = onCreateChannel\n\n    this._peers = new ReadOnlyMap()\n    this._streams = {}\n  }\n\n  /**\n   * The identitfy of the own user, this will always be equal to what other users will see as the\n   * `peerId`. This is usually equal to the userId, but that is not guaranteed.\n   *\n   * @readonly\n   * @member {string} AttachPoint#ownId\n   */\n  get ownId() {\n    this._checkValid()\n    return this._ownId\n  }\n\n  set ownId(value) {\n    throw new TypeError('AttachPoint.ownId is read-only')\n  }\n\n  /**\n   * The type of the object that the component is attached to.\n   *\n   * @readonly\n   * @member {'call'|'conference'} AttachPoint#type\n   */\n  get type() {\n    this._checkValid()\n    return this._type\n  }\n\n  set type(value) {\n    throw new TypeError('AttachPoint.type is read-only')\n  }\n\n  /**\n   * A map of remote peers that we can interact with. Only peers we have an active connection to and\n   * who have mounted a compatible component to the same point will be visible in this collection.\n   *\n   * @readonly\n   * @member {ReadOnlyMap<string,RtcPeer>} AttachPoint#peers\n   */\n  get peers() {\n    this._checkValid()\n    return this._peers\n  }\n\n  set peers(value) {\n    throw new TypeError('AttachPoint.peers is read-only')\n  }\n\n  /**\n   * Data that is synchronized between all peers.\n   *\n   * @member {AttachData} AttachPoint#data\n   */\n  get data() {\n    this._checkValid()\n    return this._data\n  }\n\n  set data(value) {\n    throw new TypeError('AttachPoint.data is read-only')\n  }\n\n  _getPeer(id) {\n    this._checkValid()\n    if (!this._peers.has(id)) {\n      this._addPeer(id)\n    }\n    return this._peers.get(id)\n  }\n\n  _addPeer(id) {\n    this._checkValid()\n    let peer = new RtcPeer({\n      id,\n      onUpdate: this._onUpdate.bind(null, id), // peer updates are always specific to the peer\n      onCreateChannel: config => this._onCreateChannel(id, config),\n    })\n    this._peers._set(id, peer)\n    try {\n      this._component.rtcComponentDidReceivePeer(peer)\n    } catch (error) {\n      log.error(this.tag, `Error thrown in rtcComponentDidReceivePeer: ${error}`)\n    }\n  }\n\n  _setPeerChannels(peer, channels) {\n    let added = peer._setRemoteChannels(channels)\n    added.forEach(channel => {\n      try {\n        this._component.rtcComponentReceivedChannel(peer, channel)\n      } catch (error) {\n        log.error(this.tag, `Error thrown in rtcComponentReceivedChannel: ${error}`)\n      }\n    })\n  }\n\n  _removePeer(id) {\n    this._checkValid()\n    let peer = this._peers.get(id)\n    if (!peer) {\n      return log.debug(this.tag, `peer ${id} not present, nothing to remove`)\n    }\n\n    peer._setRemoteStreams({})\n\n    if (!this._peers._delete(id)) {\n      log.error(this.tag, `Error when removing peer, peer '${id}' was not removed from the peer map.`)\n    }\n    try {\n      this._component.rtcComponentDidLosePeer(peer)\n    } catch (error) {\n      log.error(this.tag, `Error thrown in rtcComponentDidLosePeer: ${error}`)\n    }\n    peer._invalidate()\n  }\n\n  _checkValid() {\n    if (this._type === null) {\n      throw new Error('Tried to access invalidated AttachPoint')\n    }\n  }\n\n  _invalidate() {\n    this._type = null\n    this._ownId = null\n    this._data = null\n    this._component = null\n    this._onUpdate = null\n    this._peers = null\n    this._streams = null\n  }\n}\n\n/**\n * A class which manages a set of attachments. Used by {@link Call} and {@link Conference}.\n *\n * @class AttachmentManager\n * @private\n */\nexport default class AttachmentManager {\n  constructor({type, ownId, dataHub, onUpdate}) {\n    this.tag = 'attachment-manager'\n\n    this._onAttachPointUpdate = this._onAttachPointUpdate.bind(this)\n\n    this._type = type\n    this._ownId = ownId\n    this._dataHub = dataHub\n    this._onUpdate = onUpdate\n\n    if (dataHub) {\n      dataHub.setOnUpdateListener(this._onDataUpdate.bind(this))\n    }\n\n    this._attachSignaler = new JsonChannelBroadcastController({\n      onPeerChannelOpen: peerId => {\n        let attachMap = this._getAttachMapForPeer(peerId)\n        if (!this._attachSignaler.sendMessageToPeer(peerId, attachMap)) {\n          log.error(this.tag, 'failed to send attach map just after channel was opened')\n        }\n      },\n      onPeerChannelClose: peerId => this.cleanupPeer(peerId),\n      onMessageFromPeer: (peerId, attachMap) => {\n        log.debug(this.tag, 'got remote source map:', attachMap)\n        this._setAttachMapForPeer(peerId, attachMap)\n      },\n    })\n\n    this._pausedPeers = new Set()\n    this._attachPoints = new Map()\n    this._peerDatamuxes = new Map()\n    this._peerAttachMaps = new Map()\n    this._peerChannelMaps = new Map()\n    this._peerRemoteStreams = new Map()\n  }\n\n  setDatamuxForPeer(peerId, datamux, channels) {\n    if (this._attachSignaler) {\n      this._attachSignaler.addPeer(peerId, channels.negotiationChannel)\n    }\n    if (this._dataHub) {\n      this._dataHub.setChannelForPeer(peerId, channels.dataHubChannel)\n    }\n    this._peerDatamuxes.set(peerId, datamux)\n  }\n\n  handlePeerChannel(peerId, channel) {\n    if (channel._namespaceId.indexOf('attach-') !== 0) {\n      return\n    }\n\n    let name = channel._namespaceId.slice(7) // 'attach-'.length\n    let channelMap = this._peerChannelMaps.get(peerId) || {}\n    let channels = channelMap[name] || []\n    channels.push(channel)\n    channelMap[name] = channels\n    this._peerChannelMaps.set(peerId, channelMap)\n    this._updateAttachmentsForPeer(peerId)\n\n    return true\n  }\n\n  attach(name, component) {\n    log.verbose(this.tag, this, `attaching to ${name}: ${component}`)\n    argCheck.string('attach()', 'name', name)\n    if (!(component instanceof RtcComponent)) {\n      throw new TypeError(`Attach to ${this._type} at ${name} failed, ${component} is not an RtcComponent instance.`)\n    }\n    if (this._attachPoints.has(name)) {\n      throw new TypeError(`A component is already attached to '${name}'`)\n    }\n    let attachPoint = new AttachPoint({\n      component,\n      type: this._type,\n      ownId: this._ownId,\n      data: this._dataHub && this._dataHub.get(name),\n      onUpdate: this._onAttachPointUpdate,\n      onCreateChannel: (peerId, config) => {\n        // using attach- for forwards compatibility to not reserve all namespace names\n        config.namespaceId = `attach-${name}`\n        let datamux = this._peerDatamuxes.get(peerId)\n        return datamux.createChannel(config)\n      },\n    })\n    try {\n      component.rtcComponentWillAttach(attachPoint)\n    } catch (error) {\n      log.error(this.tag, `Error thrown in rtcComponentWillAttach, component was not attached: ${error}`)\n      attachPoint._invalidate()\n      return false\n    }\n    this._attachPoints.set(name, attachPoint)\n    component._internalAttach(attachPoint)\n    this._updateAttachments()\n    this._onAttachPointUpdate()\n    return true\n  }\n\n  detach(name, component = null) {\n    log.verbose(this.tag, this, `detaching from ${name}: ${component}`)\n    if (component && !(component instanceof RtcComponent)) {\n      throw new TypeError(\"Called detach with a second argument that isn't an RtcComponent.\")\n    }\n    let attachPoint = this._attachPoints.get(name)\n    if (!attachPoint) {\n      throw new TypeError(`Failed to detach '${name}', no component was attached.`)\n    }\n    if (component && attachPoint._component !== component) {\n      throw new TypeError(`Failed to detach '${name}', currently attached component did not match.`)\n    }\n    attachPoint.peers.forEach((_, peerId) => {\n      let datamux = this._peerDatamuxes.get(peerId)\n      if (datamux) {\n        datamux.closeChannelsInNamespace(`attach-${name}`)\n      }\n      attachPoint._removePeer(peerId)\n    })\n    let detachedComponent = attachPoint._component\n    try {\n      detachedComponent.rtcComponentWillDetach(attachPoint)\n    } catch (error) {\n      log.error(this.tag, `Error thrown in rtcComponentWillDetach: ${error}`)\n    }\n    this._attachPoints.delete(name)\n    attachPoint._invalidate()\n    this._updateAttachments()\n    this._onAttachPointUpdate()\n  }\n\n  getAttachments() {\n    let attachments = {}\n    this._attachPoints.forEach((attachPoint, name) => {\n      attachments[name] = attachPoint._component\n    })\n    return attachments\n  }\n\n  getLocalStreamsForPeer(peerId) {\n    argCheck.string('AttachManager.getLocalStreamsForPeer', 'peerId', peerId)\n    let streams = []\n\n    if (!this._pausedPeers.has(peerId)) {\n      this._attachPoints.forEach(attachPoint => {\n        let peer = attachPoint.peers.get(peerId)\n        if (peer) {\n          Object.values(peer._getLocalStreams()).forEach(stream => {\n            if (stream && streams.indexOf(stream) === -1) {\n              streams.push(stream)\n            }\n          })\n        }\n      })\n    }\n\n    return streams\n  }\n\n  setRemoteStreamsForPeer(peerId, streams) {\n    argCheck.string('AttachManager.setRemoteStreamsForPeer', 'peerId', peerId)\n    argCheck.array('AttachManager.setRemoteStreamsForPeer', 'streams', streams)\n    let streamMap = {}\n    streams.forEach(stream => {\n      streamMap[getMediaStreamId(stream)] = stream\n    })\n    this._peerRemoteStreams.set(peerId, streamMap)\n    this._updateAttachmentsForPeer(peerId)\n  }\n\n  setPeerPausedState(peerId, isPaused) {\n    var changed\n    if (isPaused) {\n      changed = !this._pausedPeers.has(peerId)\n      if (changed) {\n        this._pausedPeers.add(peerId)\n      }\n    } else {\n      changed = this._pausedPeers.delete(peerId)\n    }\n\n    if (changed) {\n      this._updateAttachmentsForPeer(peerId)\n      this._onAttachPointUpdate(peerId)\n    }\n  }\n\n  cleanupPeer(peerId) {\n    this._attachPoints.forEach(attachPoint => {\n      attachPoint._removePeer(peerId)\n    })\n\n    if (this._attachSignaler) {\n      this._attachSignaler.removePeer(peerId)\n    }\n    if (this._dataHub) {\n      this._dataHub.setChannelForPeer(peerId, null)\n    }\n\n    this._peerAttachMaps.delete(peerId)\n    this._peerChannelMaps.delete(peerId)\n    this._peerRemoteStreams.delete(peerId)\n    this._peerDatamuxes.delete(peerId)\n  }\n\n  cleanup() {\n    // Updates are disabled here, so the called is responsible for updating or cleaning\n    // up local streams, etc.\n    this._onUpdate = null\n\n    this._attachPoints.forEach((attachPoint, name) => {\n      this.detach(name, attachPoint._component)\n    })\n    if (this._attachSignaler) {\n      this._attachSignaler.cleanup()\n      this._attachSignaler = null\n    }\n    if (this._dataHub) {\n      this._dataHub.cleanup()\n      this._dataHub = null\n    }\n  }\n\n  // If peerId is set we know that the update only affected a single peer, so we only send\n  // the updated map to that peer.\n  _onAttachPointUpdate(peerId = null) {\n    if (!this._attachSignaler) {\n      return\n    }\n    if (peerId) {\n      let attachMap = this._getAttachMapForPeer(peerId)\n      this._attachSignaler.sendMessageToPeer(peerId, attachMap)\n    } else {\n      this._peerAttachMaps.forEach((_, peerId) => {\n        let attachMap = this._getAttachMapForPeer(peerId)\n        this._attachSignaler.sendMessageToPeer(peerId, attachMap)\n      })\n    }\n    if (this._onUpdate) {\n      this._onUpdate()\n    }\n  }\n\n  _onDataUpdate(name, update) {\n    let attachPoint = this._attachPoints.get(name)\n    if (attachPoint) {\n      attachPoint._component.rtcComponentUpdatedData(update)\n    }\n  }\n\n  _getAttachMapForPeer(peerId) {\n    argCheck.string('AttachManager._getAttachMapForPeer', 'peerId', peerId)\n    let attachMap = {}\n    this._attachPoints.forEach((attachPoint, name) => {\n      let attachData = {\n        label: attachPoint._component._label,\n        streams: {},\n      }\n      let peer = attachPoint.peers.get(peerId)\n      if (peer) {\n        attachData.streams = mapValues(peer._getLocalStreams(), stream => getMediaStreamId(stream))\n      }\n      attachMap[name] = attachData\n    })\n    return attachMap\n  }\n\n  _setAttachMapForPeer(peerId, attachMap) {\n    argCheck.string('AttachManager._setAttachMapForPeer', 'peerId', peerId)\n    argCheck.object('AttachManager._setAttachMapForPeer', 'attachMap', attachMap)\n    this._peerAttachMaps.set(peerId, attachMap)\n    this._updateAttachmentsForPeer(peerId)\n  }\n\n  _updateAttachments() {\n    this._peerAttachMaps.forEach((_, peerId) => {\n      this._updateAttachmentsForPeer(peerId)\n    })\n  }\n\n  _updateAttachmentsForPeer(peerId) {\n    argCheck.string('AttachManager._updateAttachmentsForPeer', 'peerId', peerId)\n    let streams = this._peerRemoteStreams.get(peerId)\n    let attachMap = this._peerAttachMaps.get(peerId)\n    let attachChannelMap = this._peerChannelMaps.get(peerId)\n    let missingPoints = new Set(this._attachPoints.keys())\n\n    // Paused peers are peers who we have a connection to and we would like to maintain the state for,\n    // but currently we don't want them to be present in attachments. e.g. non-raft members in conferences.\n    if (this._pausedPeers.has(peerId)) {\n      attachMap = {}\n    }\n\n    for (let name in attachMap) {\n      let localPoint = this._attachPoints.get(name)\n      if (!localPoint) {\n        continue\n      }\n\n      let label = attachMap[name].label\n      let ownLabel = localPoint._component._label\n      let ownRemoteLabel = localPoint._component._remoteLabel\n      if (ownRemoteLabel) {\n        if (typeof(ownRemoteLabel) === 'string') {\n          if (ownRemoteLabel !== label) {\n            log.error(this.tag, `peer label '${label}' does not match own remote label '${ownRemoteLabel}'`)\n            continue\n          }\n        } else if (!label.match(ownRemoteLabel)) {\n          log.error(this.tag, `peer label '${label}' does not match own remote label pattern '${ownRemoteLabel}'`)\n          continue\n        }\n      } else if (ownLabel !== label) {\n        log.error(this.tag, `peer label '${label}' does not match own label '${ownLabel}'`)\n        continue\n      }\n      let streamMap = {}\n      // merge objects {[name]: streamId} + {[streamId]: stream} -> {[name]: stream}\n      if (streams) {\n        forEach(attachMap[name].streams, (streamId, name) => {\n          let stream = streams[streamId]\n          if (stream) {\n            streamMap[name] = stream\n          }\n        })\n      }\n\n      try {\n        let peer = localPoint._getPeer(peerId)\n        peer._setRemoteStreams(streamMap)\n        let channels = attachChannelMap ? attachChannelMap[name] || [] : []\n        localPoint._setPeerChannels(peer, channels)\n        missingPoints.delete(name)\n      } catch (error) {\n        log.error(this.tag, `Error updating component peer: ${error}`)\n      }\n    }\n\n    missingPoints.forEach(name => {\n      // When the remote peer detaches a component we close all the channels\n      // and remove the peer.\n      let datamux = this._peerDatamuxes.get(peerId)\n      if (datamux) {\n        datamux.closeChannelsInNamespace(`attach-${name}`)\n      }\n\n      let localPoint = this._attachPoints.get(name)\n      localPoint._removePeer(peerId)\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/attachmentManager.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {\n  ReadOnlyMap,\n} from 'common/utils'\n\nimport {JsonChannelBroadcastController} from 'webrtc/channelControllers'\n\nfunction randomSeq() {\n  return Math.random() * 1000000000 | 0\n}\n\nexport const OP_SET = 1\nexport const OP_DELETE = 2\nexport const OP_NAME = [undefined, 'set', 'delete']\n\n/**\n * A class which provides a way to read and modify a set of data that is synchronized between all\n * the peers of an {@link RtcComponent}.\n *\n * @abstract\n * @class AttachData\n * @extends Map\n */\nexport class AttachData extends Map {\n  constructor({onUpdate, onSendUpdate}) {\n    super()\n    this.tag = 'attach-data'\n    this._seqs = new Map()\n    this._ownerIds = new ReadOnlyMap()\n    this._ownOwnerIds = new Map()\n\n    this._onUpdate = onUpdate\n    this._onSendUpdate = onSendUpdate\n  }\n\n  /**\n   * A collection of all owner ids for the data in this map. If an owner id exists for a given key\n   * a entry must exist in the map as well, although the opposite is not always true.\n   *\n   * See {@link AttachData#setWithOwnership} for more information about ownership.\n   *\n   * @readonly\n   * @member {ReadOnlyMap<string,string>} AttachData#owners\n   */\n  get owners() {\n    return this._ownerIds\n  }\n\n  /**\n   * The number of entries in the map.\n   *\n   * @readonly\n   * @member {number} AttachData#size\n   */\n  get size() {\n    this._checkValid()\n    return super.size\n  }\n\n  /**\n   * @returns {Iterator<string>} An iterator of all the keys in the map.\n   */\n  keys() {\n    this._checkValid()\n    return super.keys()\n  }\n\n  /**\n   * @returns {Iterator<JsonTypes>} An iterator of all the values in the map.\n   */\n  values() {\n    this._checkValid()\n    return super.values()\n  }\n\n  /**\n   * @returns {Iterator<Array<*>>} An iterator of all the values in the map.\n   */\n  entries() {\n    this._checkValid()\n    return super.entries()\n  }\n\n  /**\n   * @param {string} key - The key to look for.\n   * @returns {boolean} True if there is an entry for the given key.\n   */\n  has(key) {\n    argCheck.string('AttachData.has', 'key', key)\n    this._checkValid()\n    return super.has(key)\n  }\n\n  /**\n   * @param {string} key - The key of the value to retrive.\n   * @returns {JsonTypes} Returns the value for the given key.\n   */\n  get(key) {\n    argCheck.string('AttachData.get', 'key', key)\n    this._checkValid()\n    return super.get(key)\n  }\n\n  /**\n   * Sets set value for the given key.\n   *\n   * Setting a local value will **not** trigger a {@link RtcComponent#rtcComponentUpdatedData} call,\n   * that only happens for remote updates.\n   *\n   * @param {string} key - The key of the value.\n   * @param {JsonTypes} value - The value to set.\n   */\n  set(key, value) {\n    argCheck.count('AttachData.set', 2, arguments.length)\n    argCheck.string('AttachData.set', 'key', key)\n    return this.setWithOwnership(key, value, null)\n  }\n\n  /**\n   * Sets set value for the given key, along with an ownership id.\n   *\n   * Setting the ownership allows data to be transparently overridden by users that are joining or\n   * rejoining the data synchronization network. Usually the `ownerId` will be set to the id of the user,\n   * but it can sometimes be useful to use other values, such as the role of the user, e.g. `'moderator'`.\n   *\n   * Since values can be updated while a call is not connected, the values that are set when disconnected\n   * may be updated once you are connected with the rest of the users. When relaying some kind of state\n   * to other peers this can cause problems, as the updates that you sent out before a reconnect will\n   * cause an update to your local values. By tagging data with an owner id, it is possible to rejoin\n   * a data synchronization group and transparently update your exsting values with the new state, without\n   * causing a local update to trigger.\n   *\n   * Setting a local value will not trigger a {@link RtcComponent#rtcComponentUpdatedData} call,\n   * that only happens for remote updates.\n   *\n   * @param {string} key - The key of the value.\n   * @param {JsonTypes} value - The value to set.\n   * @param {?string} ownerId - The owner id to use when setting the value.\n   */\n  setWithOwnership(key, value, ownerId) {\n    argCheck.count('AttachData.setWithOwnership', 3, arguments.length)\n    argCheck.string('AttachData.setWithOwnership', 'key', key)\n    argCheck.optString('AttachData.setWithOwnership', 'ownerId', ownerId)\n    this._checkValid()\n    let ret = super.set(key, value)\n\n    let seq = this._seqs.get(key) || 0\n    seq += randomSeq()\n    this._seqs.set(key, seq)\n    if (ownerId) {\n      this._ownerIds._set(key, ownerId)\n      this._ownOwnerIds.set(key, ownerId)\n    }\n    this._onSendUpdate(this._toSetMessage(seq, ownerId, key, value))\n    return ret\n  }\n\n  /**\n   * Deletes an existing value of the corresponding key.\n   *\n   * Deleting a local value will not trigger a {@link RtcComponent#rtcComponentUpdatedData} call,\n   * that only happens for remote updates.\n   *\n   * @param {string} key - The key to delete the value for.\n   * @returns {boolean} True if a value existed.\n   */\n  delete(key) {\n    argCheck.count('AttachData.delete', 1, arguments.length)\n    argCheck.string('AttachData.delete', 'key', key)\n    return this.deleteWithOwnership(key, null)\n  }\n\n  /**\n   * Deletes an existing value of the corresponding key, using an ownership id.\n   *\n   * See {@link AttachData#setWithOwnership} for more information about ownership.\n   *\n   * Deleting a local value will not trigger a {@link RtcComponent#rtcComponentUpdatedData} call,\n   * that only happens for remote updates.\n   *\n   * @param {string} key - The key to delete the value for.\n   * @param {?string} ownerId - The owner id to use when deleting the value.\n   * @returns {boolean} True if a value existed.\n   */\n  deleteWithOwnership(key, ownerId) {\n    argCheck.count('AttachData.deleteWithOwnership', 2, arguments.length)\n    argCheck.string('AttachData.deleteWithOwnership', 'key', key)\n    argCheck.optString('AttachData.deleteWithOwnership', 'ownerId', ownerId)\n    this._checkValid()\n    let ret = super.delete(key)\n\n    let seq = this._seqs.get(key) || 0\n    seq += randomSeq()\n    this._seqs.set(key, seq)\n    if (ownerId) {\n      this._ownerIds._set(key, ownerId)\n      this._ownOwnerIds.set(key, ownerId)\n    }\n    this._onSendUpdate(this._toDeleteMessage(seq, ownerId, key))\n    return ret\n  }\n\n  /**\n   * Clears all the data in the map.\n   *\n   * Clearing the map locally will not trigger a {@link RtcComponent#rtcComponentUpdatedData} call,\n   * that only happens for remote updates.\n   */\n  clear() {\n    // TODO: This could be more efficient\n    this._checkValid()\n    super.forEach(key => this.delete(key))\n  }\n\n  /**\n   * Clears all the data in the map, using an ownership.\n   *\n   * See {@link AttachData#setWithOwnership} for more information about ownership.\n   *\n   * Clearing the map locally will not trigger a {@link RtcComponent#rtcComponentUpdatedData} call,\n   * that only happens for remote updates.\n   *\n   * @param {?string} ownerId - The owner id to use when clearing the map.\n   */\n  clearWithOwnership(ownerId) {\n    this._checkValid()\n    super.forEach(key => this.deleteWithOwnership(key, ownerId))\n  }\n\n  /**\n   * The iterator function passed to {@link ReadOnlyMap#forEach}.\n   *\n   * @callback AttachData~ForEachCallback\n   * @param {*} key - The key of the current entry.\n   * @param {JsonTypes} value - The value of the current entry.\n   * @param {AttachData} map - The map itself.\n   */\n\n  /**\n   * Synchronously calls an interator function once for each entry in the map.\n   *\n   * Errors thrown inside the iterator function will cancel the iteration.\n   *\n   * @param {AttachData~ForEachCallback} func - The iterator function.\n   * @param {*} [thisArg] - The value to use as `this` inside the iterator function.\n   */\n  forEach(func, thisArg) {\n    this._checkValid()\n    return super.forEach(func, thisArg)\n  }\n\n  /**\n   * This symbol allows the map to be used directly inside a `for..of` loop.\n   *\n   * @function AttachData#@@iterator\n   * @returns {Object} An iterator for all the entries in this map.\n   */\n  [Symbol.iterator]() {\n    this._checkValid()\n    return super[Symbol.iterator]()\n  }\n\n  // A local update uses the form {key, value, oldValue, ownerId}\n  // An update that is sent over the wire uses an array to keep the json form more compact\n  //   [op, key, value, seq] | [op, key, value, seq, ownerId]\n  //   where op is either 1 for set\n  _toDeleteMessage(seq, ownerId, key) {\n    return [OP_DELETE, seq, ownerId || 0, key]\n  }\n\n  _toSetMessage(seq, ownerId, key, value) {\n    return [OP_SET, seq, ownerId || 0, key, value]\n  }\n\n  // returns an array of updates\n  _getCurrentState() {\n    let states = []\n    this._seqs.forEach((seq, key) => {\n      let value = super.get(key)\n      let ownerId = this._ownerIds.get(key)\n      states.push(this._toSetMessage(seq, ownerId, key, value))\n    })\n    return states\n  }\n\n  // Handles a received update\n  _onReceiveUpdate(peerId, [op, seq, ownerId, key, value]) {\n    log.verbose(this.tag, `message from '${peerId}' op=${OP_NAME[op]} key='${key}' seq=${seq} ownerId='${ownerId}'`)\n    if (!(op === OP_SET || op === OP_DELETE)) {\n      log.error(this.tag, `update had invalid op code: '${op}', ignoring`)\n      return\n    }\n    let localSeq = this._seqs.get(key) || 0\n    let ownOwnerId = this._ownOwnerIds.get(key)\n    let receivedOwnValue = ownerId && ownOwnerId && ownerId === ownOwnerId\n    let receivedIsNewer = localSeq < seq\n\n    if (receivedOwnValue && receivedIsNewer) {\n      // Own value, so we increment seq and send update without signaling a local change\n      seq += randomSeq()\n      this._seqs.set(key, seq)\n      if (super.has(key)) {\n        let value = super.get(key)\n        this._onSendUpdate(this._toSetMessage(seq, ownerId, key, value))\n      } else { // If key is not present in main map, then it's been deleted\n        this._onSendUpdate(this._toDeleteMessage(seq, ownerId, key))\n      }\n    } else if (receivedIsNewer) {\n      this._seqs.set(key, seq)\n      if (ownerId) {\n        this._ownerIds._set(key, ownerId)\n      }\n      let oldValue = super.get(key)\n      if (op === OP_SET) {\n        super.set(key, value)\n      } else {\n        super.delete(key)\n        value = undefined\n      }\n      this._onUpdate({key, value, oldValue, ownerId})\n    }\n  }\n\n  _invalidate() {\n    this._seqs.clear()\n    this._ownerIds._clear()\n    this._seqs = null\n    this._ownerIds = null\n  }\n\n  _checkValid() {\n    if (!this._seqs) {\n      throw new TypeError('AttachData was accessed after the component was detached.')\n    }\n  }\n}\n\n/**\n * A class that keeps track of a set of {@link AttachData}. Used by {@link AttachmentManager}.\n *\n * @private\n * @class DataHub\n */\nexport default class DataHub {\n  constructor() {\n    this.attachDatas = new Map()\n\n    this.onUpdateListener = null\n\n    this.controller = new JsonChannelBroadcastController({\n      onPeerChannelOpen: this.onPeerChannelOpen.bind(this),\n      onMessageFromPeer: this.onMessageFromPeer.bind(this),\n    })\n  }\n\n  get(name) {\n    let attachData = this.attachDatas.get(name)\n    if (!attachData) {\n      attachData = new AttachData({\n        onUpdate: update => this.onUpdate(name, update),\n        onSendUpdate: update => this.onSendUpdate(name, update),\n      })\n      this.attachDatas.set(name, attachData)\n    }\n    return attachData\n  }\n\n  setOnUpdateListener(listener) {\n    this.onUpdateListener = listener\n  }\n\n  onUpdate(name, update) {\n    if (this.onUpdateListener) {\n      this.onUpdateListener(name, update)\n    }\n  }\n\n  onSendUpdate(name, update) {\n    let updatesMap = {[name]: [update]}\n    this.controller.sendMessage({map: updatesMap})\n  }\n\n  setChannelForPeer(peerId, channel) {\n    if (channel) {\n      this.controller.addPeer(peerId, channel)\n    } else {\n      this.controller.removePeer(peerId)\n    }\n  }\n\n  onPeerChannelOpen(peerId) {\n    let updatesMap = {}\n    this.attachDatas.forEach((attachData, name) => {\n      let updates = attachData._getCurrentState()\n      updatesMap[name] = updates\n    })\n    this.controller.sendMessageToPeer(peerId, {map: updatesMap})\n  }\n\n  onMessageFromPeer(peerId, message) {\n    let updatesMap = message.map\n    if (updatesMap) {\n      Object.entries(updatesMap).forEach(([name, updates]) => {\n        let attachData = this.get(name)\n        updates.forEach(update => attachData._onReceiveUpdate(peerId, update))\n      })\n    }\n  }\n\n  cleanup() {\n    this.onUpdateListener = null\n    this.controller.cleanup()\n    this.controller = null\n    this.attachDatas.forEach(attachData => {\n      attachData._invalidate()\n    })\n    this.attachDatas.clear()\n    this.attachDatas = null\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/dataHub.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\n\nimport {ConfigurationData, Members} from 'conference/raftConfiguration'\nimport {SnapshotRequest} from 'conference/raftMessages'\nimport {OpEntry, ConfigurationEntry} from 'conference/raftLogEntry'\n\nconst TAG = 'raft'\n\nexport default class RaftLog {\n  constructor({stateMachine, meshTopology, configuration}) {\n    this._stateMachine = stateMachine\n    this._meshTopology = meshTopology\n    this._configuration = configuration\n\n    this._entries = []\n    this._offset = 0\n    this._commitIndex = 0\n    this._lastApplied = 0\n    this._snapshot = null\n    this._configurationIndex = 0\n  }\n\n  toString() {\n    let entries = this._entries.slice(this._lastApplied - this._offset).join(',')\n    return `log{lli=${this.lastLogIndex},llt=${this.lastLogTerm},ci=${this.commitIndex}` +\n    `,la=${this._lastApplied},${this._configuration},es=[${entries}]}`\n  }\n\n  get meshTopology() {\n    return this._meshTopology\n  }\n\n  get configuration() {\n    return this._configuration\n  }\n\n  get lastEntry() {\n    return this.entryAtIndex(this.lastLogIndex)\n  }\n\n  get lastLogIndex() {\n    return this._offset + this._entries.length\n  }\n\n  get lastLogTerm() {\n    return this.entryTermAtIndex(this.lastLogIndex)\n  }\n\n  get commitIndex() {\n    return this._commitIndex\n  }\n\n  entryAtIndex(index) {\n    if (index === 0) {\n      return null\n    }\n    return this._entries[index - 1 - this._offset] || null\n  }\n\n  entryTermAtIndex(index) {\n    if (this._snapshot) {\n      if (index < this._snapshot.lastIndex) {\n        throw new Error(\"can't get term for entry ahead of local snapshot\")\n      } else if (index === this._snapshot.lastIndex) {\n        return this._snapshot.lastTerm\n      }\n    }\n    if (index > this._entries.length + this._offset || index < 1) {\n      return 0\n    }\n    return this.entryAtIndex(index).term\n  }\n\n  // from fromIndex, to, but not including toIndex\n  sliceEntries(fromIndex, toIndex) {\n    fromIndex = Math.max(fromIndex - 1 - this._offset, 0)\n    toIndex = Math.max(toIndex - 1 - this._offset, 0)\n    return this._entries.slice(fromIndex, toIndex)\n  }\n\n  handleAppendEntriesRequest(message) {\n    if (message.prevIndex > this.lastLogIndex) {\n      // Appending these entries would leave a gap\n      return message.response({meshTopology: this._meshTopology})\n    }\n\n    // Check if we have a snapshot installed and and the request is older, in that\n    // case we just ignore it since it must be a delayed/repeated message and the leader\n    // should know to send a post-snapshot append\n    if (this._snapshot && message.prevIndex < this._offset) {\n      return\n    }\n\n    let localPrevTerm = this.entryTermAtIndex(message.prevIndex)\n    let remoteEntries = message.entries\n    if (localPrevTerm === message.prevTerm) {\n      // Loop through remote entries until we don't have a local one or find a term mismatch\n      for (let index = 0; index < remoteEntries.length; index += 1) {\n        let remoteEntry = remoteEntries[index]\n        // +1 since prevIndex is the entry before the one we want to match against\n        let localIndex = message.prevIndex + index + 1\n        if (localIndex > this.lastLogIndex) {\n          // We've run out of local entires to match against, append the rest\n          this._pushEntries(remoteEntries.slice(index))\n          break\n        }\n        let localTerm = this.entryTermAtIndex(localIndex)\n        if (localTerm !== remoteEntry.term) {\n          // if an entry term doesn't match, delete the rest and append all\n          this._revertEntries(localIndex)\n          this._pushEntries(remoteEntries.slice(index))\n          break\n        }\n      }\n      let matchIndex = message.prevIndex + remoteEntries.length\n      if (message.commitIndex > this._commitIndex) {\n        // increase commit index to the remote one, but not higher than the last entry we received\n        let newCommitIndex = Math.min(message.commitIndex, matchIndex)\n        this._incrementCommitIndex(newCommitIndex)\n      }\n      return message.response({success: true, matchIndex, meshTopology: this._meshTopology})\n    } else {\n      return message.response({meshTopology: this._meshTopology})\n    }\n  }\n\n  getCommittedConfigurationData() {\n    let committedEntries = this.sliceEntries(0, this.commitIndex + 1)\n    for (let index = committedEntries.length - 1; index >= 0; index -= 1) {\n      let entry = committedEntries[index]\n      if (entry instanceof ConfigurationEntry) {\n        return entry.data\n      }\n    }\n    if (this._snapshot) {\n      return this._snapshot.configuration\n    }\n    return new ConfigurationData(new Members())\n  }\n\n  tryCommitIndexForTerm(newCommitIndex, expectedTerm) {\n    if (newCommitIndex <= this._commitIndex) {\n      return []\n    }\n    let actualTerm = this.entryTermAtIndex(newCommitIndex)\n    if (actualTerm !== expectedTerm) {\n      log.debug(TAG, `Commit index ${newCommitIndex} rejected, expected term was ${expectedTerm}, got ${actualTerm}`)\n      return []\n    }\n    return this._incrementCommitIndex(newCommitIndex)\n  }\n\n  createConfigurationEntry({term, data}) {\n    let index = this.lastLogIndex + 1\n    let entry = new ConfigurationEntry({term, index, data})\n    this._configuration.set(data)\n    this._configurationIndex = index\n    this._entries.push(entry)\n    return entry\n  }\n\n  createOpEntry({term, id, op, args}) {\n    let index = this.lastLogIndex + 1\n    let entry = new OpEntry({term, index, id, op, args})\n    this._entries.push(entry)\n    return entry\n  }\n\n  _incrementCommitIndex(newCommitIndex) {\n    this._commitIndex = newCommitIndex\n    let fromApplied = this._lastApplied\n    if (this._lastApplied < newCommitIndex) {\n      this._lastApplied = newCommitIndex\n    }\n    let committed = this.sliceEntries(fromApplied + 1, newCommitIndex + 1)\n    this._stateMachine.commitEntries(committed)\n    return committed\n  }\n\n  _revertEntries(fromIncludingIndex) {\n    if (fromIncludingIndex <= this.commitIndex) {\n      throw new Error(`tried to revert committed entries, ci=${this.commitIndex}, revert=${fromIncludingIndex}`)\n    }\n    if (fromIncludingIndex <= this._lastApplied) {\n      throw new Error(`tried to revert applied entries, la=${this._lastApplied}, revert=${fromIncludingIndex}`)\n    }\n    let reverted = this._entries.splice(fromIncludingIndex - 1 - this._offset)\n    reverted.reverse() // newest first\n    this._stateMachine.revertEntries(reverted)\n\n    if (this._configurationIndex < fromIncludingIndex) {\n      return // no need to revert configuration\n    }\n\n    for (let index = fromIncludingIndex - 1; index > 0; index -= 1) {\n      if (this._snapshot && this._snapshot.lastIndex === index) {\n        this._configuration.set(this._snapshot.configuration)\n        this._configurationIndex = index\n        return\n      }\n      let entry = this.entryAtIndex(index)\n      if (entry instanceof ConfigurationEntry) {\n        this._configuration.set(entry.data)\n        this._configurationIndex = index\n        return\n      }\n    }\n\n    // no configuration found\n    this._configuration.set(new ConfigurationData(new Members()))\n    this._configurationIndex = 0\n  }\n\n  _pushEntries(entries) {\n    this._entries.push(...entries)\n\n    for (let index = entries.length - 1; index >= 0; index -= 1) {\n      let entry = entries[index]\n      if (entry instanceof ConfigurationEntry) {\n        this._configuration.set(entry.data)\n        this._configurationIndex = index\n        break\n      }\n    }\n  }\n\n  createSnapshot(term) {\n    return SnapshotRequest.create({\n      term,\n      lastTerm: this.entryTermAtIndex(this._lastApplied),\n      lastIndex: this._lastApplied,\n      configuration: this._configuration.get(),\n      state: this._stateMachine.state,\n    })\n  }\n\n  loadSnapshot(snapshot) {\n    argCheck.instance('RaftLog.loadSnapshot', 'snapshot', snapshot, SnapshotRequest)\n    let {lastIndex, configuration} = snapshot\n\n    this._entries = []\n    this._offset = lastIndex\n    this._commitIndex = lastIndex\n    this._lastApplied = lastIndex\n    this._configurationIndex = lastIndex\n    this._configuration.set(configuration)\n    this._snapshot = snapshot\n\n    this._stateMachine.loadSnapshot(snapshot)\n  }\n\n  clear() {\n    this._stateMachine.clear()\n    this._entries = []\n    this._offset = 0\n    this._commitIndex = 0\n    this._lastApplied = 0\n    this._snapshot = null\n    this._configurationIndex = 0\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raftLog.js","'use strict'\n\nimport log from 'common/log'\nimport {defer, randomString} from 'common/utils'\n\nimport {OpEntry, ConfigurationEntry} from 'conference/raftLogEntry'\nimport {StateOpRequest, StateOpResponse} from 'conference/raftMessages'\nimport {EXPECTED_RTT_MS} from 'conference/raftState'\n\nconst TAG = 'raft'\n\nconst TICK_INTERVAL = 100\nconst TICK_APPLIED_FACTOR = 10\nconst STATE_OP_APPLY_TTL_MS = 30 * 1000\nconst RESEND_RTT_FACTOR = 6\n\n// The StateMachine keeps the local state of the Raft cluster, and applies\n// committed entries to that state after deduplication. It is also responsible\n// for keeping track of operations that have been requested by the local\n// client, and to retry them if needed.\n//\n// This diagram describes the flow of a successful state operation where the\n// local client is the leader.\n//\n//      Raft --3-> LeaderState --4b-> ...\n//      |  ^            |\n//      1  2            4a\n//      v  |            v\n// StateMachine <-5-- RaftLog\n//\n// 1. An operation is requested.\n// 2. The state machine sends a request via the onStateOpRequest callback.\n// 3. Raft forwards the request to the current state.\n// 4a. Append the OpEntry to the log.\n// 4b. Raft algorithm in action, which ends up committing the entry.\n// 5. The log forwards committed entries to the state machine.\n//\n// And now a diagram for if we're a follower.\n//\n//      Raft --3-> FollowerState --4-> LeaderState --5a->\n//      |  ^                                |\n//      1  2                                5a\n//      v  |                                v\n// StateMachine <-7-- RaftLog <- - 6 - - RaftLog\n//\n// 1-3. Same as above.\n// 4. Send StateOpRequest to the current leader.\n// 5a 5b. Same as 4a 4b above.\n// 6. Raft algorithm ends up committing the entry in the follower's log.\n// 7. Same as 5 above.\n//\nexport default class StateMachine {\n  constructor({onStateChange, onStateOpRequest, onConfigurationCommitted}) {\n    this._tick = this._tick.bind(this)\n\n    this._state = {}\n    this._tickMod = 0\n\n    // Client requests are tracked here, type is Map<opId, [expiryMs, deferred, StateOpRequest]>\n    this._tuples = new Map()\n\n    // All members keep track of all op entry IDs that have been applied.\n    this._appliedIds = new Map()\n    this._onStateChange = onStateChange\n    this._onStateOpRequest = onStateOpRequest\n    this._onConfigurationCommitted = onConfigurationCommitted\n  }\n\n  toString() {\n    return `stateMachine{${JSON.stringify(this.state)}}`\n  }\n\n  get state() {\n    return this._state\n  }\n\n  start() {\n    this.stop()\n    this._tickMod = 0\n    this._intervalId = setInterval(this._tick, TICK_INTERVAL)\n  }\n\n  stop() {\n    this.clear()\n    if (this._intervalId) {\n      clearInterval(this._intervalId)\n      this._intervalId = null\n    }\n  }\n\n  clear() {\n    this._state = {}\n    this._tuples.clear()\n    this._appliedIds.clear()\n  }\n\n  requestStateOp({op, args, retryTtlMs}) {\n    let id = randomString(OpEntry.idSize)\n    let request = StateOpRequest.create({id, op, args})\n    let now = Date.now()\n    let expiry = now + retryTtlMs\n    let nextResend = now + EXPECTED_RTT_MS * RESEND_RTT_FACTOR\n    let deferred = defer()\n    this._tuples.set(id, {expiry, nextResend, deferred, request})\n    this._onStateOpRequest(request)\n    return deferred.promise\n  }\n\n  handleStateOpResponse(peerId, message) {\n    let {id, errorCode} = message\n    let tuple = this._tuples.get()\n    if (!tuple) {\n      log.info(TAG, this, ` got StateOpResponse for unknown tuple, ${id}`)\n      return\n    }\n    if (errorCode) {\n      if (errorCode === StateOpResponse.NOT_LEADER) {\n        this._onStateOpRequest(tuple.request)\n        tuple.nextResend = Date.now() + EXPECTED_RTT_MS * RESEND_RTT_FACTOR\n      } else {\n        log.error(TAG, this, ` got unknown StateOpResponse errorCode for ${id}, ${errorCode}`)\n      }\n    } else {\n      // Success, reset resend timeout\n      tuple.nextResend = Date.now() + EXPECTED_RTT_MS * RESEND_RTT_FACTOR\n    }\n  }\n\n  _tick() {\n    let now = Date.now()\n    // Applied ids don't need to be checked nearly as often as tuple resends, so\n    // only do it every nth tick.\n    this._tickMod = (this._tickMod + 1) % TICK_APPLIED_FACTOR\n    if (this._tickMod === 0) {\n      this._appliedIds.forEach((expiry, entryId) => {\n        if (expiry < now) {\n          this._appliedIds.delete(entryId)\n        }\n      })\n    }\n    this._tuples.forEach((tuple, entryId) => {\n      if (tuple.expiry < now) {\n        this._tuples.delete(entryId)\n        tuple.deferred.reject(new Error('Timed out'))\n      } else if (tuple.nextResend < now) {\n        this._onStateOpRequest(tuple.request)\n        tuple.nextResend = now + EXPECTED_RTT_MS * RESEND_RTT_FACTOR\n      }\n    })\n  }\n\n  commitEntries(entries) {\n    let updated = false\n    entries.forEach(entry => {\n      if (entry instanceof OpEntry) {\n        if (this._appliedIds.has(entry.id)) {\n          log.debug(TAG, this, `ignored duplicate entry, ${entry}`)\n        } else {\n          let expiry = Date.now() + STATE_OP_APPLY_TTL_MS\n          if (entry.id) {\n            this._appliedIds.set(entry.id, expiry)\n          }\n          let newState = entry.apply(this._state)\n          if (newState) {\n            updated = true\n            this._state = newState\n          }\n        }\n        let tuple = this._tuples.get(entry.id)\n        if (tuple) {\n          tuple.deferred.resolve()\n          this._tuples.delete(entry.id)\n        }\n      } else if (entry instanceof ConfigurationEntry) {\n        this._onConfigurationCommitted && this._onConfigurationCommitted(entry.data)\n      }\n    })\n    if (updated) {\n      this._onStateChange && this._onStateChange()\n    }\n  }\n\n  revertEntries(entries) {\n    entries.forEach(entry => {\n      let tuple = this._tuples.get(entry.id)\n      if (tuple) {\n        this._onStateOpRequest(tuple.request)\n        tuple.nextResend = Date.now() + EXPECTED_RTT_MS * RESEND_RTT_FACTOR\n      }\n    })\n  }\n\n  loadSnapshot(snapshot) {\n    this._state = snapshot.state\n\n    this._onStateChange && this._onStateChange()\n    this._onConfigurationCommitted && this._onConfigurationCommitted(snapshot.configuration)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/raftStateMachine.js","'use strict'\n\nimport CctError, {NotAllowedError, NotFoundError, UnknownError} from 'common/errors'\n\n/**\n * The request was malformed. This error shouldn't be encountered since input is validated\n * on the client-side.\n *\n * @class BadRequestError\n * @extends CctError\n */\nexport class BadRequestError extends CctError {\n}\nBadRequestError.errorName = 'BadRequestError'\n\n/**\n * The request was too large, encountered e.g. when sending messages in a room.\n *\n * @class TooLargeError\n * @extends CctError\n */\nexport class TooLargeError extends CctError {\n}\nTooLargeError.errorName = 'TooLargeError'\n\n/**\n * Authentication failed, or authentication is required to perform the action.\n *\n * @class AuthenticationError\n * @extends CctError\n */\nexport class AuthenticationError extends CctError {\n}\nAuthenticationError.errorName = 'AuthenticationError'\n\n/* placeholder */\nexport class InvalidCaptchaError extends CctError {\n}\nInvalidCaptchaError.errorName = 'InvalidCaptchaError'\n\n/**\n * The requested action could not be performed because the authenticated user has a guest account.\n *\n * @class GuestAccessError\n * @extends CctError\n */\nexport class GuestAccessError extends CctError {\n}\nGuestAccessError.errorName = 'GuestAccessError'\n\n/**\n * The requested action would result in a conflict, such as trying to create a room with an\n * alias that already exists, or registering a user with an existing username.\n *\n * @class ConflictError\n * @extends CctError\n */\nexport class ConflictError extends CctError {\n}\nConflictError.errorName = 'ConflictError'\n\n/**\n * The requested username is invalid. Usernames must at most be 512 characters long\n * and may only contain `a-z`, `0-9`, and `_-./`.\n *\n * @class InvalidUsernameError\n * @extends CctError\n */\nexport class InvalidUsernameError extends CctError {\n}\nInvalidUsernameError.errorName = 'InvalidUsernameError'\n\n/**\n * The requested password is invalid. Passwords must at most be 512 characters long.\n *\n * @class InvalidPasswordError\n * @extends CctError\n */\nexport class InvalidPasswordError extends CctError {\n}\nInvalidPasswordError.errorName = 'InvalidPasswordError'\n\n/**\n * The requested room alias is invalid because it contains forbidden characters. Aliases are\n * not allowed to contain whitespace characters.\n *\n * @class InvalidAliasError\n * @extends CctError\n */\nexport class InvalidAliasError extends CctError {\n}\nInvalidAliasError.errorName = 'InvalidAliasError'\n\n/**\n * The action could not be performed because it hit the rate limit of the server. This is\n * currently only used internally since requests are automatically retried if they hit the\n * rate limit.\n *\n * @class RateLimitError\n * @extends CctError\n */\nexport class RateLimitError extends CctError {\n  constructor(message, body) {\n    super(message)\n    if (body && ('retry_after_ms' in body)) {\n      this.retryAfterMs = body.retry_after_ms\n    } else {\n      this.retryAfterMs = RateLimitError.defaultRetryTimeoutMs\n    }\n  }\n}\nRateLimitError.errorName = 'RateLimitError'\nRateLimitError.defaultRetryTimeoutMs = 1000\n\n/**\n * The server encountered an error because of an unexpected code path or an invalid state.\n *\n * @class InternalServerError\n * @extends CctError\n */\nexport class InternalServerError extends CctError {\n}\nInternalServerError.errorName = 'InternalServerError'\n\nconst errorParsers = {\n  M_UNKNOWN: {\n    parse(message) {\n      if (message.indexOf('Room alias') === 0 && message.indexOf('already exists') !== -1) {\n        return ConflictError\n      } else if (message.indexOf('Room') === 0 && message.indexOf('does not exist') !== -1) {\n        return NotFoundError\n      }\n    },\n    exact: {\n      'Room alias already taken': ConflictError,\n      'HMAC incorrect': AuthenticationError,\n      'Invalid username': InvalidUsernameError,\n      'Invalid password': InvalidPasswordError,\n      'Invalid characters in room alias': InvalidAliasError,\n      'Registration has been disabled': NotAllowedError,\n      'Guest access is disabled': GuestAccessError,\n      'Upload request body is too large': TooLargeError,\n    },\n    Default: UnknownError,\n  },\n  M_FORBIDDEN: {\n    parse(message) {\n      if (message.indexOf('is already in the room.') !== -1) {\n        return ConflictError\n      }\n    },\n    exact: {\n      'Guest access not allowed': GuestAccessError,\n      'Invalid password': AuthenticationError,\n      'Invalid token': AuthenticationError,\n    },\n    Default: NotAllowedError,\n  },\n  M_NOT_FOUND: {Default: NotFoundError},\n  M_LIMIT_EXCEEDED: {Default: RateLimitError},\n  M_UNAUTHORIZED: {Default: NotAllowedError},\n  M_MISSING_TOKEN: {Default: BadRequestError},\n  M_UNKNOWN_TOKEN: {Default: AuthenticationError},\n  M_UNRECOGNIZED: {Default: BadRequestError},\n  M_BAD_JSON: {Default: BadRequestError},\n  M_NOT_JSON: {Default: BadRequestError},\n  M_USER_IN_USE: {Default: ConflictError},\n  M_ROOM_IN_USE: {Default: ConflictError},\n  M_BAD_PAGINATION: {Default: BadRequestError},\n  M_BAD_STATE: {Default: ConflictError}, // only for trying to ban/unban users\n  M_GUEST_ACCESS_FORBIDDEN: {Default: GuestAccessError},\n  M_CAPTCHA_NEEDED: {Default: BadRequestError},\n  M_CAPTCHA_INVALID: {Default: InvalidCaptchaError},\n  M_MISSING_PARAM: {Default: BadRequestError},\n  M_TOO_LARGE: {Default: TooLargeError},\n  M_EXCLUSIVE: {Default: ConflictError},\n  M_THREEPID_AUTH_FAILED: {Default: UnknownError},\n  M_THREEPID_IN_USE: {Default: UnknownError},\n  M_THREEPID_NOT_FOUND: {Default: UnknownError},\n  M_INVALID_USERNAME: {Default: InvalidUsernameError},\n  M_SERVER_NOT_TRUSTED: {Default: AuthenticationError},\n}\n\nexport function parseSynapseErrorResponse(error) {\n  if (error instanceof Error) {\n    return error\n  }\n\n  let status = error.status\n  let name = error.body && error.body.errcode\n  let message = error.body && error.body.error\n\n  if (!message && !name && typeof(error.body) === 'string') {\n    name = 'M_UNKNOWN'\n    message = error.body\n  }\n\n  // console.error(`Synapse error: [${status}] ${name}: ${message}`)\n  if (status === 404) {\n    return new NotFoundError(message || 'Not Found', error.body)\n  }\n  message = message || 'No message'\n  if (status === 500) {\n    return new InternalServerError(message, error.body)\n  }\n\n  let parser = errorParsers[name]\n  if (!parser) {\n    return new UnknownError(`[${name}] ${message}`, error.body)\n  }\n  let ExactMatch = parser.exact && parser.exact[message]\n\n  if (ExactMatch) {\n    return new ExactMatch(message, error.body)\n  } else {\n    if (parser.parse) {\n      let Match = parser.parse(message)\n      if (Match) {\n        return new Match(message, error.body)\n      }\n    }\n    if (parser.Default) {\n      return new parser.Default(message, error.body)\n    }\n  }\n  return new UnknownError(`[${name}] ${message}`, error.body)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/errors.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {isObject, priv} from 'common/utils'\nimport {toMatrixIdForServer} from 'matrix/ids'\nimport User from 'matrix/user'\n\nexport default function UserRegistry() {\n  this._dependencies = null\n  this._users = {}\n}\n\nUserRegistry.prototype = {\n  constructor: UserRegistry,\n  tag: 'user-registry',\n  toString: function () {\n    return 'userRegistry{}'\n  },\n  getUser: function getUser(arg) {\n    let matrixId = toUserId('UserRegistry.get', arg, this._dependencies.serverName)\n    let user = this._users[matrixId]\n    if (!user) {\n      user = priv(User, {\n        matrixId,\n        serverName: this._dependencies.serverName,\n      }, this._dependencies.imageResourceFactory)\n      this._users[matrixId] = user\n    }\n    return user\n  },\n\n  // dependencies.ownUserId\n  // dependencies.imageResourceFactory\n  init: function (dependencies) {\n    this._dependencies = dependencies\n    return this\n  },\n  clear: function () {\n    this._dependencies = null\n    this._users = {}\n  },\n\n  _handlePresenceSync: function (presenceEvents) {\n    for (var i in presenceEvents) {\n      var event = presenceEvents[i]\n      var content = event.content\n      var matrixId = event.sender\n      var user = this.getUser(matrixId)\n      user._update(content)\n      log.verbose('events', `got presence event for user ${matrixId}`, user)\n    }\n  },\n}\n\nexport function toUserId(context, user, serverName) {\n  var id\n  if (user instanceof User) {\n    id = user._matrixId\n  } else if (isObject(user)) {\n    id = user.user_id || user.userId || user.id\n  } else {\n    id = user\n  }\n  argCheck.string(context, 'id', id)\n  return toMatrixIdForServer(context, id, serverName, 'user')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/userRegistry.js","module.exports = { \"default\": require(\"core-js/library/fn/object/get-own-property-names\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/get-own-property-names.js\n// module id = 189\n// module chunks = 0 3","require('../../modules/es6.object.assign');\nmodule.exports = require('../../modules/_core').Object.assign;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/assign.js\n// module id = 190\n// module chunks = 0 3","require('../../modules/es6.object.get-own-property-names');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function getOwnPropertyNames(it){\n  return $Object.getOwnPropertyNames(it);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/get-own-property-names.js\n// module id = 191\n// module chunks = 0 3","'use strict';\n// 19.1.2.1 Object.assign(target, source, ...)\nvar getKeys  = require('./_object-keys')\n  , gOPS     = require('./_object-gops')\n  , pIE      = require('./_object-pie')\n  , toObject = require('./_to-object')\n  , IObject  = require('./_iobject')\n  , $assign  = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nmodule.exports = !$assign || require('./_fails')(function(){\n  var A = {}\n    , B = {}\n    , S = Symbol()\n    , K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function(k){ B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source){ // eslint-disable-line no-unused-vars\n  var T     = toObject(target)\n    , aLen  = arguments.length\n    , index = 1\n    , getSymbols = gOPS.f\n    , isEnum     = pIE.f;\n  while(aLen > index){\n    var S      = IObject(arguments[index++])\n      , keys   = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S)\n      , length = keys.length\n      , j      = 0\n      , key;\n    while(length > j)if(isEnum.call(S, key = keys[j++]))T[key] = S[key];\n  } return T;\n} : $assign;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-assign.js\n// module id = 192\n// module chunks = 0 3","// 19.1.3.1 Object.assign(target, source)\nvar $export = require('./_export');\n\n$export($export.S + $export.F, 'Object', {assign: require('./_object-assign')});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.assign.js\n// module id = 193\n// module chunks = 0 3","// 19.1.2.7 Object.getOwnPropertyNames(O)\nrequire('./_object-sap')('getOwnPropertyNames', function(){\n  return require('./_object-gopn-ext').f;\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.get-own-property-names.js\n// module id = 194\n// module chunks = 0 3","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {assertPriv, browser, priv, randomString} from 'common/utils'\n\nimport DataHub from 'webrtc/dataHub'\nimport AttachmentManager from 'webrtc/attachmentManager'\n\nimport Raft from 'conference/raft'\nimport Switcher from 'conference/switcher'\nimport MeshTopology from 'conference/meshTopology'\nimport ConferencePeers from 'conference/conferencePeers'\nimport ConferenceConnectionPool from 'conference/conferenceConnectionPool'\nimport ConferenceConnection from 'conference/conferenceConnection'\nimport VoiceActivityDetector from 'conference/voiceActivityDetector'\n\nconst TAG = 'conference'\n\nconst SIGNALING_STATE_SEARCHING = 'searching'\nconst SIGNALING_STATE_JOINING = 'joining'\nconst SIGNALING_STATE_MEMBER = 'member'\nconst SIGNALING_STATE_CLOSED = 'closed'\n\n// We haven't found a cluster to join yet\nconst CONNECTION_STATE_SIGNALING = 'signaling'\n// Connecting to the cluster\nconst CONNECTION_STATE_CONNECTING = 'connecting'\n// Connected to at least one other member of the current cluster\nconst CONNECTION_STATE_CONNECTED = 'connected'\n// Duh\nconst CONNECTION_STATE_CLOSED = 'closed'\n\nconst MEMBER_ADD_TTL_MS = 20 * 1000\n\nexport function calculateClientPower(navigator) {\n  if (navigator.hardwareConcurrency) {\n    return Math.log2(navigator.hardwareConcurrency) | 0\n  } else if (navigator.userAgent.match(/iPad|iPhone/)) {\n    return 2\n  } else {\n    return 2\n  }\n}\n\nconst switcherAttachPoint = '__c3-switcher'\n\n/**\n * A peer-to-peer WebRTC call between multiple users.\n *\n * The main role of the conference is to manage a set of connections to other\n * peers in the conference. Just like with {@link Call}, functionality is\n * added via {@link RtcComponent}s that are attached to the conference\n * using {@link Conference#attach}. An exception to this is the {@link Switcher},\n * which provides specialized media streaming capabilities for conferences.\n *\n * A conference always happens within a {@link Room}, and there's is only\n * a single conference in a room at a given time. Any member of the room\n * that calls {@link Room#startConference} will join the conference, as long\n * as they have permission to do so, which is default.\n *\n * @example <caption>Example of starting a conference with switching, broadcasting and data sharing.</caption>\n * let conference = room.startConference({\n *   switcherMode: 'automatic', // Use voice-activated switching\n * })\n *\n * let mediaSource = new cct.DeviceSource({\n *   audio: true,\n *   video: true,\n * })\n *\n * // We use a splitter to get hold of separate audio and video streams\n * let streamSplitter = new cct.StreamSplitter()\n * mediaSource.connect(streamSplitter)\n *\n * // The conference switcher can send a single high-quality media stream\n * streamSplitter.videoOutput.connect(conference.switcher)\n * // It also receives a high-quality video stream from the current speaker.\n * conference.switcher.connect(largeVideoView)\n *\n * // See MediaBroadcaster for how to broadcast audio\n *\n * // Use a DataShare to share data with all participants.\n * let data = new cct.DataShare()\n * conference.attach('test-data', data)\n * data.on('update', ({key, value}) => console.log(`updated test-data:s ${key}=${value}`))\n * data.set('some-key', 'some-value')\n *\n * @abstract\n * @class Conference\n * @extends EventEmitter\n */\nexport default class Conference extends EmitterMixin(null) {\n  static create(config) {\n    argCheck.options('Conference.create', 'config', config)\n      .optString('userId')\n      .optArray('iceServers')\n      .optFunc('iceCandidateFilter')\n      .optString('switcherMode')\n      .func('onSignalingMessage')\n\n    let {\n      userId = 'self',\n      iceServers = null,\n      iceCandidateFilter = null,\n      switcherMode,\n      onSignalingMessage,\n    } = config\n\n    return priv(Conference, {\n      userId,\n      iceServers,\n      iceCandidateFilter,\n      switcherMode,\n      onSignalingMessage,\n    })\n  }\n\n  constructor(priv, deps) {\n    super()\n    assertPriv('Conference', priv)\n\n    this._onRaftStateChange = this._onRaftStateChange.bind(this)\n    this._onRaftMembersChange = this._onRaftMembersChange.bind(this)\n    this._onRaftLeadershipChange = this._onRaftLeadershipChange.bind(this)\n    this._onAttachmentUpdate = this._onAttachmentUpdate.bind(this)\n    this._onPeersUpdate = this._onPeersUpdate.bind(this)\n    this._onDisconnected = this._onDisconnected.bind(this)\n    this._invitePeer = this._invitePeer.bind(this)\n\n    // this._id = randomString(16)\n    this._connectionState = CONNECTION_STATE_SIGNALING\n    this._signalingState = null\n    this._joiningCluster = null\n    this._ownId = deps.userId\n    this._onClosed = deps.onClosed\n    this._iceServers = deps.iceServers\n    this._onSignalingMessage = deps.onSignalingMessage\n    this._iceCandidateFilter = deps.iceCandidateFilter\n    this._statsFormatterFactory = deps.statsFormatterFactory\n\n    this._peers = new ConferencePeers({\n      ownId: this._ownId,\n      onUpdate: this._onPeersUpdate,\n    })\n\n    this._voiceActivityDetector = new VoiceActivityDetector({\n      active: Switcher.modeUsesVoiceDetection(deps.switcherMode),\n    })\n\n    this._meshTopology = new MeshTopology({\n      power: calculateClientPower(navigator),\n      ownId: this._ownId,\n      voiceActivityDetector: this._voiceActivityDetector,\n    })\n\n    this._connectionPool = new ConferenceConnectionPool({\n      ownId: this._ownId,\n      connectionFactory: this._createConnection.bind(this),\n      meshTopology: this._meshTopology,\n      onRaftMessage: (raftId, message) => this._raft.handleMessage(raftId, message),\n      onDisconnected: this._onDisconnected,\n      onInvite: this._invitePeer,\n      onBestConnection: connection => {\n        if (connection) {\n          this._voiceActivityDetector.setPeerConnection(connection._peerConnection)\n        } else {\n          this._voiceActivityDetector.setPeerConnection(null)\n        }\n      },\n    })\n\n    this._raft = new Raft({\n      id: this._ownId,\n      meshTopology: this._meshTopology,\n      onMessage: this._connectionPool.handleRaftMessage,\n      onStateChange: this._onRaftStateChange,\n      onMembersChange: this._onRaftMembersChange,\n      onLeadershipChange: this._onRaftLeadershipChange,\n      onReplicationDeadlock: this._onDisconnected,\n    })\n\n    this._switcher = new Switcher({\n      ownId: this._ownId,\n      raft: this._raft,\n      mode: deps.switcherMode,\n      voiceActivityDetector: this._voiceActivityDetector,\n    })\n\n    this._attachmentManager = new AttachmentManager({\n      ownId: this._ownId,\n      type: 'conference',\n      dataHub: new DataHub(),\n      onUpdate: this._onAttachmentUpdate,\n    })\n\n    this._attachmentManager.attach(switcherAttachPoint, this._switcher._component)\n  }\n\n  /**\n   * Emitted when there is an error within the conference, e.g. the signaling fails.\n   *\n   * @event Conference#error\n   * @param {Error} error - The error.\n   */\n\n  toString() {\n    return `conference{ownId=${this._ownId},state=${this._signalingState}}`\n  }\n\n  /**\n   * Attach a component that will be shared in the conference.\n   *\n   * @function Conference#attach\n   * @param {string} name - Name of the attachment point.\n   * @param {RtcComponent} component - A component to attach.\n   */\n  attach(name, component) {\n    if (name === switcherAttachPoint) {\n      argCheck.error('Conference.attach', 'name', `not use reserved name ${name}`)\n    }\n    if (!this._attachmentManager) {\n      log.error(TAG, `Tried to attach component at '${name}' on a closed conference.`)\n    } else {\n      this._attachmentManager.attach(name, component)\n    }\n  }\n\n  /**\n   * Detach a component that was previously attached. If the component argument\n   * is given and it does not match the currently attached component, a `TypeError`\n   * will be thrown.\n   *\n   * @function Conference#detach\n   * @param {string} name - Name of the attachment point.\n   * @param {RtcComponent} [component] - An optional specific component to detach.\n   */\n  detach(name, component) {\n    if (name === switcherAttachPoint) {\n      argCheck.error('Conference.detach', 'name', `not use reserved name ${name}`)\n    }\n    if (!this._attachmentManager) {\n      log.error(TAG, `Tried to detach component at '${name}' from a closed conference.`)\n    } else {\n      this._attachmentManager.detach(name, component)\n    }\n  }\n\n  /**\n   * The client's own user id in the conference, this is what other members\n   * will see as `peerId`. This will be the same as the logged in user ID.\n   *\n   * @member {UserId} Conference#ownId\n   */\n  get ownId() {\n    return this._ownId\n  }\n\n  /**\n   * A map representing the conference peers.\n   *\n   * @member {ConferencePeers} Conference#peers\n   */\n  get peers() {\n    return this._peers\n  }\n\n  /**\n   * The {@link ConferenceSwitcher} instance for this conference.\n   *\n   * Conferences always have a single switcher instance associated with them.\n   * As long as the switcher mode is set to `'off'`, which is default, the switcher\n   * will not consume any resources.\n   *\n   * @member {ConferenceSwitcher} Conference#switcher\n   */\n  get switcher() {\n    return this._switcher\n  }\n\n  /**\n   * Emitted when the connection state of the conference changes.\n   *\n   * @event Conference#connectionState\n   * @param {PeerConnectionState} connectionState - The new connection state.\n   * @param {PeerConnectionState} oldConnectionState - The old connection state.\n   */\n\n  /**\n   * The connection state of the conference.\n   *\n   * @readonly\n   * @member {PeerConnectionState} Conference#connectionState\n   */\n  get connectionState() {\n    return this._connectionState\n  }\n\n  /**\n   * True if the conference has been closed.\n   *\n   * A closed conference can not be started again, and will have had all attachments removed. It will\n   * alse have been removed from {@link Room#conference}, so that a new conference can be started in the room.\n   *\n   * @member {boolean} Conference#closed\n   */\n  get closed() {\n    return this._signalingState === SIGNALING_STATE_CLOSED\n  }\n\n  /**\n   * True if the conference is stopped. This is the initial state for incoming conferences.\n   *\n   * Stopped conferences will keep all attachments and state, but will not have any connections to\n   * other peers.\n   *\n   * @member {boolean} Conference#stopped\n   */\n  get stopped() {\n    return this._signalingState === null\n  }\n\n  /**\n   * Start an incoming conference. This only needs to be called if listening\n   * to the conference events on a client or room.\n   *\n   * @param {Object} options - Options object.\n   * @param {ConferenceSwitcherMode} [options.switcherMode] - The default switcher mode for this conference.\n   */\n  start(options = {}) {\n    if (this._signalingState !== null) {\n      return log.warning(TAG, `tried to start conference in wrong state: ${this._signalingState}`)\n    }\n    log.debug(TAG, this, 'starting conference')\n    this._connectionPool.start()\n    this._switcher._setDefaultMode(options.switcherMode)\n    this._startSearch()\n  }\n\n  /**\n   * Leave the conference, remove all attachments, and cleanup all resources.\n   *\n   * Note that like {@link Call#close}, this does not signal the other\n   * participants in the conference. To do a room-wide conference start/stop,\n   * one should use application specific signaling, e.g. using room state.\n  */\n  close() {\n    if (this._signalingState !== SIGNALING_STATE_CLOSED) {\n      log.debug(TAG, `closing ${this}`)\n      if (this._onClosed) {\n        this._onClosed()\n      }\n      this._setSignalingState(SIGNALING_STATE_CLOSED)\n      this._raft.stop()\n      this._raft = null\n      this._connectionPool.stop()\n      this._connectionPool = null\n      this._peers._cleanup()\n      this._peers = null\n      this._attachmentManager.cleanup()\n      this._attachmentManager = null\n      this._emit('closed', {\n        reason: 'closed',\n        source: 'self',\n        conference: this,\n      })\n      this._clearListeners()\n    }\n  }\n\n  _onAttachmentUpdate() {\n    this._connectionPool.connections.forEach((connection, peerId) => {\n      let streams = this._attachmentManager.getLocalStreamsForPeer(peerId)\n      connection._updateLocalStreams(streams)\n    })\n  }\n\n  // Join message\n  // {type: 'search', browser: <string>, [multiOffer: <offer>]}\n  //\n  // Connect message\n  // {type: 'invite', [multiAnswer: <answer>]}\n  //\n  // multiOffer and multiAnswer reuses the same certificate for multiple peer connections, avoiding\n  // an RTT and speeding up setup time\n  //\n  // Connection signaling\n  // {type: 'connection'}\n  handleSignalingMessage(peerId, message) {\n    if (this._signalingState === null || this._signalingState === SIGNALING_STATE_CLOSED) {\n      return log.verbose(TAG, this, 'ignoring signaling message for stopped conference')\n    }\n\n    let {type} = message\n    if (!type) {\n      log.warning(TAG, this, `got signaling message without type from ${peerId}`)\n      return\n    }\n\n    if (type === 'search') {\n      return this._handleSearchMessage(peerId, message)\n    } else if (type === 'invite') {\n      return this._handleInviteMessage(peerId, message)\n    } else if (type === 'connection') {\n      return this._connectionPool.handleConnectionMessage(peerId, message)\n    }\n  }\n\n  _handleSearchMessage(peerId, message) {\n    if (this._signalingState === SIGNALING_STATE_SEARCHING) {\n      log.info(TAG, this, `got search message from ${peerId} while searching, creating new cluster`)\n\n      // An invite message is sent to the peer,\n      this._invitePeer(peerId)\n      this._setSignalingState(SIGNALING_STATE_MEMBER)\n    } else if (this._signalingState === SIGNALING_STATE_JOINING) {\n      log.info(TAG, this, `got search message from ${peerId} while joining, ignoring`)\n      // If we are currently joining a cluster, we only add the searching peer to the member waitlist\n      // If we then become leader while the member is still on the waitlist\n      // FIXME: a connection needs to be set up to the peer if we become leader\n      this._raft.addPeer(peerId, {waitlistTtlMs: MEMBER_ADD_TTL_MS})\n      this._connectionPool.addGhostConnection(peerId, {ttlMs: MEMBER_ADD_TTL_MS})\n    } else if (this._signalingState === SIGNALING_STATE_MEMBER) {\n      log.debug(TAG, this, `got search message from ${peerId} as ${this._raft.isLeader ? 'leader' : 'member'}`)\n      if (this._raft.isLeader) {\n        // An invite message is sent to the peer,\n        this._invitePeer(peerId)\n      } else {\n        // Keep track of the peer in case we become leader within the TTL\n        this._raft.addPeer(peerId, {waitlistTtlMs: MEMBER_ADD_TTL_MS})\n        this._connectionPool.addGhostConnection(peerId, {ttlMs: MEMBER_ADD_TTL_MS})\n      }\n    }\n  }\n\n  _getClusterInfo() {\n    if (this._joiningCluster) {\n      return this._joiningCluster\n    }\n    return {\n      id: this._raft.get('clusterId'),\n      size: this._raft.members.size,\n      term: this._raft.term,\n    }\n  }\n\n  _compareClusters(clusterA, clusterB) {\n    if (clusterA.size !== clusterB.size) {\n      return clusterB.size - clusterA.size\n    } else if (clusterA.id !== clusterB.id) {\n      return clusterA.id.localeCompare(clusterB.id)\n    } else {\n      return clusterB.term - clusterA.term\n    }\n  }\n\n  _joinCluster({leaderId, cluster}) {\n    log.debug(TAG, this, `joining cluster led by ${leaderId}: ${JSON.stringify(cluster)}`)\n    this._setSignalingState(SIGNALING_STATE_JOINING)\n    this._joiningCluster = cluster\n    this._raft.startPassive()\n    this._connectionPool.connectToClusterLeader(leaderId)\n    this._peers._setPeers([leaderId], this._connectionPool.connections)\n  }\n\n  _handleInviteMessage(peerId, message) {\n    if (message.recipient === this._ownId) {\n      let {cluster} = message\n      log.debug(TAG, this, `received invite in state ${this._signalingState} for ${JSON.stringify(cluster)}`)\n      if (this._signalingState === SIGNALING_STATE_SEARCHING) {\n        this._joinCluster({leaderId: peerId, cluster})\n      } else if (this._signalingState === SIGNALING_STATE_JOINING || this._signalingState === SIGNALING_STATE_MEMBER) {\n        // we are already joining a cluster, so we need to figure out if we should abort that process\n        // and accept the new invite instead. For now we just error out\n        let ownCluster = this._getClusterInfo()\n        let compareResult = this._compareClusters(ownCluster, cluster)\n        if (compareResult > 0) {\n          log.info(TAG, this, `left existing cluster to join cluster of ${peerId}, ` +\n            `old: ${JSON.stringify(ownCluster)}, new: ${JSON.stringify(cluster)}, result: ${compareResult}`)\n          this._joinCluster({leaderId: peerId, cluster})\n        }\n      }\n    } else {\n      if (this._signalingState === SIGNALING_STATE_JOINING || this._signalingState === SIGNALING_STATE_MEMBER) {\n        let {cluster} = message\n        let ownCluster = this._getClusterInfo()\n        let compareResult = this._compareClusters(ownCluster, cluster)\n        if (compareResult > 0) {\n          log.info(TAG, this, 'saw invite from other cluster with higher priority' +\n            `, abanding ${JSON.stringify(ownCluster)} for ${JSON.stringify(cluster)}`)\n          this._joinCluster({leaderId: peerId, cluster})\n        }\n      }\n    }\n  }\n\n  _onRaftStateChange() {\n    this._switcher._handleStateChange()\n  }\n\n  _onRaftMembersChange(peerIds) {\n    this._switcher._setMembers(peerIds)\n    this._connectionPool.setExpectedConnections(peerIds)\n\n    let {connections} = this._connectionPool\n    this._peers._setPeers(peerIds, connections)\n\n    let isMember = peerIds.has(this._ownId)\n    connections.forEach((connection, peerId) => {\n      let isPaused = !isMember || !this._raft.members.has(peerId)\n      connection.setPausedState(isPaused)\n      this._attachmentManager.setPeerPausedState(peerId, isPaused)\n    })\n\n    if (this._signalingState === SIGNALING_STATE_MEMBER) {\n      // If we lost membership it means we're considered disconnected by the cluster\n      // and need to rejoin.\n      if (!isMember) {\n        log.info(TAG, this, 'got new cluster members in connected state without self present')\n        this._onDisconnected()\n      }\n    } else if (this._signalingState === SIGNALING_STATE_JOINING) {\n      if (isMember) {\n        log.info(TAG, this, 'got new cluster members with itself as member, promoting to member')\n        this._setSignalingState(SIGNALING_STATE_MEMBER)\n      }\n    }\n  }\n\n  _onRaftLeadershipChange(isLeader) {\n    log.info(TAG, this, `${isLeader ? 'got' : 'lost'} cluster leadership`)\n    this._switcher._handleLeadershipChange(isLeader)\n    if (isLeader) {\n      this._connectionPool.materializeGhostConnections()\n    }\n  }\n\n  _onPeersUpdate() {\n    if (this._connectionState === CONNECTION_STATE_CONNECTING) {\n      if (this._peers._hasConnection()) {\n        this._setConnectionState(CONNECTION_STATE_CONNECTED)\n      }\n    } else if (this._connectionState === CONNECTION_STATE_CONNECTED) {\n      if (!this._peers._hasConnection()) {\n        this._setConnectionState(CONNECTION_STATE_CONNECTING)\n      }\n    }\n  }\n\n  _setSignalingState(newSignalingState) {\n    if (this._signalingState === SIGNALING_STATE_CLOSED) {\n      return\n    }\n    this._signalingState = newSignalingState\n\n    if (newSignalingState !== SIGNALING_STATE_JOINING) {\n      this._joiningCluster = null\n    }\n\n    var newConnectionState = null\n\n    if (newSignalingState === SIGNALING_STATE_SEARCHING) {\n      if (this._connectionState !== CONNECTION_STATE_SIGNALING) {\n        newConnectionState = CONNECTION_STATE_SIGNALING\n      }\n    } else if (newSignalingState === SIGNALING_STATE_JOINING) {\n      if (this._connectionState !== CONNECTION_STATE_SIGNALING) {\n        newConnectionState = CONNECTION_STATE_SIGNALING\n      }\n    } else if (newSignalingState === SIGNALING_STATE_MEMBER) {\n      if (this._connectionState === CONNECTION_STATE_SIGNALING) {\n        if (this._peers._hasConnection()) {\n          newConnectionState = CONNECTION_STATE_CONNECTED\n        } else {\n          newConnectionState = CONNECTION_STATE_CONNECTING\n        }\n      }\n    } else if (newSignalingState === SIGNALING_STATE_CLOSED) {\n      newConnectionState = CONNECTION_STATE_CLOSED\n    }\n\n    if (newConnectionState) {\n      this._setConnectionState(newConnectionState)\n    }\n  }\n\n  _setConnectionState(newConnectionState) {\n    let oldConnectionState = this._connectionState\n    this._connectionState = newConnectionState\n    this._emit('connectionState', newConnectionState, oldConnectionState)\n  }\n\n  _onDisconnected() {\n    // We keep the connection pool going on disconnects, which means that we don't kill\n    // existing connections that we are trying to set up. That means that triggering a\n    // disconnect is quite cheack, there's only ome matrix signaling overhead.\n    // Because of that we can keep disconnect timeouts low.\n\n    this._raft.stop()\n    this._peers._clear()\n\n    log.debug(TAG, this, 'resetting conference due to disconnect')\n    this._startSearch()\n  }\n\n  _startSearch() {\n    log.debug(TAG, this, 'is starting search')\n    // We start in active state with no other peers, which will immediately make us leader\n    this._raft.start()\n    let clusterId = randomString(16)\n    // While being leader, we set and commit the clusterId, which should then never be touched for\n    // the history of this cluster's log.\n    this._raft.set('clusterId', clusterId)\n\n    this._switcher._initializeLeader()\n\n    this._setSignalingState(SIGNALING_STATE_SEARCHING)\n    this._onSignalingMessage({\n      type: 'search',\n      browser,\n      cluster: this._getClusterInfo(),\n    })\n  }\n\n  _invitePeer(peerId) {\n    log.debug(TAG, this, `inviting ${peerId} to cluster`)\n    this._raft.addPeer(peerId, {waitlistTtlMs: MEMBER_ADD_TTL_MS})\n    this._onSignalingMessage({\n      type: 'invite',\n      browser,\n      recipient: peerId,\n      cluster: this._getClusterInfo(),\n    })\n    this._connectionPool.ensureTemporaryConnection(peerId)\n  }\n\n  _createConnection({peerId, peerLinkInfo}) {\n    argCheck.string('Conference._createConnection', 'peerId', peerId)\n\n    let conferencePeer = this._peers.get(peerId) || null\n\n    let connection = new ConferenceConnection({\n      ownId: this._ownId,\n      peerId,\n      peerLinkInfo,\n      conferencePeer,\n      offer: null,\n      iceServers: this._iceServers,\n      iceCandidateFilter: this._iceCandidateFilter,\n      statsFormatter: this._statsFormatterFactory && this._statsFormatterFactory(peerId),\n      attachmentManager: this._attachmentManager,\n      onSignalingMessage: message => {\n        this._onSignalingMessage({\n          type: 'connection',\n          recipient: peerId,\n          content: message,\n        })\n      },\n    })\n\n    let isPaused = !this._raft.members.has(peerId)\n    connection.setPausedState(isPaused)\n    this._attachmentManager.setPeerPausedState(peerId, isPaused)\n\n    if (conferencePeer) {\n      connection._setConferencePeer(conferencePeer)\n    }\n\n    return connection\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/conference.js","'use strict'\n\nimport log from 'common/log'\nimport EmitterMixin from 'common/emitter'\nimport {\n  assertPriv,\n  getter,\n  hiddenProp,\n  prop,\n} from 'common/utils'\n\n/**\n * Emitted when the result of the query has changed.\n *\n * @event RoomQuery#update\n * @param {Array<*>} rows - The resulting rows, MUST NOT be modified.\n */\n\n/**\n * Emitted when a row is added to the result of the query.\n *\n * @event RoomQuery#added\n * @param {*} row - The added row\n */\n\n/**\n * Emitted when a row is removed from the result of the query.\n *\n * @event RoomQuery#removed\n * @param {*} row - The removed row\n */\n\n/**\n * Represents a live query that selects a subset of all rooms and transforms\n * them using a map function.\n *\n * Whenever a room receives an event, the map function is run for every query.\n * If the map function returns a falsy value, it is ignored. If the value is\n * truthy, the value is added to the resulting rows.\n *\n * This is an example of a map function that lists all public rooms that the user is\n * a member of:\n *\n * ```js\n * function (room) {\n *     if (room.membership === 'member' && room.visibility === 'public') {\n *         return room;\n *     }\n * }\n * ```\n *\n * Whenever the value returned by the map function changes, an `'update'` event is\n * emitted, as well as `'added'` and/or `'removed'` events.\n * The value is considered changed if it switches between truthy and falsy, or\n * if the id property of the value changes.\n * If multiple return values are bundled in an object, it is important to\n * include an id property to avoid unnecessary change events.\n *\n * This is an example of a map function that lists all rooms to which the user has\n * been invited, as well as the inviting user:\n *\n * ```js\n * function (room) {\n *     if (room.membership === 'invited') {\n *         return {\n *             id: room.invitedBy.id,\n *             user: room.invitedBy,\n *             room: room,\n *         };\n *     }\n * }\n * ```\n *\n * @abstract\n * @class RoomQuery\n * @extends EventEmitter\n */\n\nexport default function RoomQuery(priv, mapFunction) {\n  assertPriv('RoomQuery', priv)\n  var self = this\n  var rows = []\n  var items = []\n  var stateChangeFunctions = []\n  var stopped = false\n  var deferredEmit = 0\n\n  /**\n   * The resulting rows of the RoomQuery, MUST NOT be modified.\n   * @readonly\n   * @member {Array<*>} RoomQuery#rows\n   */\n  getter(this, 'rows', function () {\n    return items\n  })\n\n  /**\n   * Stops the query and frees all resources.\n   *\n   * @function\n   * @name RoomQuery#stop\n   */\n  prop(this, 'stop', function () {\n    stopped = true\n    rows = []\n    items = []\n    stateChangeFunctions = []\n    self._emit('update', items)\n    self._clearListeners('update')\n    self._clearListeners('added')\n    self._clearListeners('removed')\n  })\n\n  /**\n   * Forces the map function to be rerun for all rooms.\n   *\n   * @function\n   * @name RoomQuery#forceUpdate\n   */\n  prop(this, 'forceUpdate', function () {\n    if (stopped) {\n      return\n    }\n    stateChangeFunctions.forEach(function (fn) {\n      fn()\n    })\n  })\n\n  function handleNewRoom(room) {\n    if (stopped) {\n      return\n    }\n    var item = mapFunction(room)\n    var row = null\n    if (item) {\n      row = {\n        item: item,\n      }\n      addRow(row)\n    }\n    var stateChangeFunction = onStateChangeFunction(room, row)\n    stateChangeFunctions.push(stateChangeFunction)\n    room._registerQuery(stateChangeFunction)\n    return true\n  }\n\n  hiddenProp(this, '_handleNewRoom', handleNewRoom)\n\n  hiddenProp(this, '_clear', function () {\n    if (stopped) {\n      return\n    }\n    rows = []\n    items = []\n    self._emit('update', items)\n  })\n\n  function deferEmit() {\n    if (!deferredEmit) {\n      deferredEmit = setTimeout(function () {\n        if (stopped) {\n          return\n        }\n        self._emit('update', items)\n        deferredEmit = 0\n      })\n    }\n  }\n\n  function addRow(row) {\n    rows.push(row)\n    items.push(row.item)\n    self._emit('added', row.item)\n    deferEmit()\n  }\n\n  function removeRow(row) {\n    var index = rows.indexOf(row)\n    if (index === -1) {\n      log.error('room-query', 'RoomQuery removeRow: room does not exist', row.item)\n    } else {\n      rows.splice(index, 1)\n      items.splice(index, 1)\n      self._emit('removed', row.item)\n      deferEmit()\n    }\n  }\n\n  function onStateChangeFunction(room, row) {\n    return function onStateChange() {\n      if (stopped) {\n        return true\n      }\n\n      var newItem = mapFunction(room)\n      if (row) {\n        if (newItem) {\n          if (newItem === row.item) {\n            return\n          } else if (newItem.id === row.item.id) {\n            return\n          }\n        }\n        removeRow(row)\n      } else if (!newItem) {\n        return\n      }\n\n      var newRow = null\n      if (newItem) {\n        newRow = {\n          item: newItem,\n        }\n        addRow(newRow)\n      }\n      row = newRow\n    }\n  }\n}\n\nEmitterMixin.call(RoomQuery.prototype)\n\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/roomQuery.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {\n  assertPriv,\n  getter,\n  hiddenProp,\n  prop,\n} from 'common/utils'\n\n/**\n * Emitted when the default value of the room state is changed.\n *\n * @event RoomState#value\n * @param {JsonTypes} value - The new value.\n * @param {JsonTypes} oldValue - The old value, if any.\n */\n\n/**\n * Emitted when any value but the default value is changed.\n *\n * @event RoomState#update\n * @param {Object} change\n * @param {string} change.key - The key whose value was changed.\n * @param {JsonTypes} change.value - The new value that the key is now associated with.\n * @param {JsonTypes} change.oldValue - The value that the key was previously associated with, if any.\n */\n\n/**\n * Emitted when the value associated with the given key is changed.\n *\n * @event RoomState#update:&lt;key&gt;\n * @param {JsonTypes} value - The new value that the key is now associated with.\n * @param {JsonTypes} oldValue - The value that the key was previously associated with, if any.\n */\n\n// eslint-disable-next-line\n/**\n * Represents a state in a room identified by a state type, and synchronized between all clients.\n *\n * Each room state is a key-value pair store that emits events when values are changed.\n *\n * The room state also has a default value which can be accessed by omitting the\n *  key parameter to any of the methods. The default value is handy for simple states\n *  such as setting a hex color for the room.\n *\n * @abstract\n * @class RoomState\n * @extends EventEmitter\n */\nexport default function RoomState(priv, type, room, setState) {\n  assertPriv('RoomState', priv)\n  var self = this\n  var values = {}\n\n  hiddenProp(this, '_set', function (key, value) {\n    key = '' + key\n    if (value && ('__value__' in value)) {\n      value = value.__value__\n    }\n    var oldValue = values[key]\n    values[key] = value\n    if (key === '') {\n      this._emit('value', value, oldValue)\n    } else {\n      this._emit('update:' + key, value, oldValue)\n    }\n    this._emit('update', {\n      key: key,\n      value: value,\n      oldValue: oldValue,\n    })\n  })\n\n  /**\n   * The type of the RoomState\n   * @readonly\n   * @member {string} RoomState#type\n   */\n  prop(this, 'type', type)\n\n  /**\n   * The room that the RoomState is derived from\n   * @readonly\n   * @member {Room} RoomState#room\n   */\n  prop(this, 'room', room)\n\n  /**\n   * Returns true if the key has been set\n   *\n   * @name RoomState#has\n   * @function\n   * @param {string} [key] - The key to test if it has been set.\n   * @returns {boolean} - True if the key has been set, false otherwise\n   */\n  prop(this, 'has', function (key) {\n    if (!argCheck.optString('RoomState.has', 'key', key)) {\n      key = ''\n    }\n    return key in values\n  })\n\n  /**\n   * Gets the value for the corresponding key.\n   *\n   * If the key is omitted the default value of the RoomState will returned instead\n   *\n   * @name RoomState#get\n   * @function\n   * @param {string} [key] - The key whose associated value should be returned,\n   *  or omitted if the default value is desired instead.\n   * @returns {JsonTypes} - The value associated with the key\n   */\n  prop(this, 'get', function (key) {\n    if (!argCheck.optString('RoomState.get', 'key', key)) {\n      key = ''\n    }\n    return values[key]\n  })\n\n  /**\n   * Sets the value that a key should be associated with. This will override any\n   * existing association with the key.\n   *\n   * If the key is omitted the value of the RoomState will set instead.\n   *\n   * **NOTE:**\n   * It is best to avoid relying on the returned promise to modify application state,\n   * e.g. UI updates, as that will lead to race conditions and undefined behaviour.\n   * It is better to use the returned promise for feedback that the state was changed\n   * was successfully, and tie application state changes an 'update' event handler.\n   * This is due to the fact that state changes are received via the event stream, but\n   * the returned promise is resolved when the request is returned, and those two events\n   * can happen in any order.\n   *\n   * ##### Errors:\n   * - {@link TooLargeError} - The serialized value is too large, as in it occupies too many bytes.\n   * - {@link NotAllowedError} - The user must be a member of the room and have enough power level.\n   * - {@link GuestAccessError} - Guest access is not allowed.\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method</i>\n   *\n   * @name RoomState#set\n   * @function\n   * @param {string} [key] - The key that should be associated with the value.\n   * @param {JsonTypes} value - The value that should be associated with the key.\n   * @returns {Promise<RoomState, CctError>} - The room state\n   */\n  prop(this, 'set', function (key, value) {\n    argCheck.count('RoomState.set', 1, arguments.length)\n    if (arguments.length === 1) {\n      value = key\n      key = ''\n    } else {\n      argCheck.string('RoomState.get', 'key', key)\n    }\n    if (typeof(value) !== 'object' || value === null || Array.isArray(value)) {\n      value = {\n        __value__: value,\n      }\n    }\n    return setState(key, value).then(function () {\n      return self\n    })\n  })\n\n  /**\n   * A list of all keys who are associated to a value\n   *\n   * @readonly\n   * @member {string[]} RoomState#keys\n   */\n  getter(this, 'keys', function () {\n    return Object.keys(values).filter(x => x)\n  })\n}\n\nRoomState.prototype.toString = function () {\n  return 'RoomState{type=' + this.type +\n        ', value=' + this.get() +\n        ', keys=' + this.keys +\n        '}'\n}\n\nEmitterMixin.call(RoomState.prototype)\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/roomState.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {NotFoundError, NotAllowedError} from 'common/errors'\n\nimport {getUserMedia} from 'media/common'\nimport ConcreteMediaSource from 'media/concreteMediaSource'\n\nconst TAG = 'chrome-screen-source'\n\nexport function getChromeMediaSourceId(extensionId, sourceTypes) {\n  return new Promise(function (resolve, reject) {\n    const installedStatusTimeout = setTimeout(() => {\n      window.removeEventListener('message', onMessage)\n      let error = new NotFoundError('Screen sharing extension not installed')\n      error.reason = new Error('Extension did not respond to install status check')\n      reject(error)\n    }, 1000)\n    const onMessage = event => {\n      var data = event.data\n      if (data.extensionId === extensionId) {\n        switch (data.message) {\n          case 'extensionIsInstalled':\n            clearTimeout(installedStatusTimeout)\n            window.postMessage({\n              extensionId, sourceTypes,\n              message: 'requestChromeMediaSourceId',\n            }, '*')\n            break\n          case 'chromeMediaSourceId':\n            window.removeEventListener('message', onMessage)\n            var sourceId = data.content\n            if (sourceId) {\n              resolve(sourceId)\n            } else { // user denied the request\n              reject(new NotAllowedError('The user denied the request to share the screen'))\n            }\n        }\n      }\n    }\n\n    window.addEventListener('message', onMessage)\n    window.postMessage({\n      extensionId: extensionId,\n      message: 'getInstalledStatus',\n    }, '*')\n  })\n}\n\nexport function getChromeScreenConstraints({audio = false, video, sourceId} = {}) {\n  if (!video) {\n    video = {}\n  }\n  if (!(video.width || video.height)) {\n    video.width = {max: window.screen.width}\n    video.height = {max: window.screen.height}\n  }\n  video.chromeMediaSourceId = {exact: sourceId}\n  video.chromeMediaSource = {exact: 'desktop'}\n\n  return {audio, video}\n}\n\nfunction _sendChromeMessage(extensionId, message) {\n  return new Promise((resolve, reject) => {\n    window.chrome.runtime.sendMessage(extensionId, message, response => {\n      if (response) {\n        resolve(response)\n      } else {\n        let error = new Error('No response received')\n        error.name = 'NotFoundError'\n        reject(error)\n      }\n    })\n  })\n}\n\nexport function getChromeMediaSourceIdEx(extensionId, sourceTypes) {\n  return new Promise(function (resolve, reject) {\n    const installedStatusTimeout = setTimeout(() => {\n      let error = new NotFoundError('Screen sharing extension not installed')\n      error.reason = new Error('Extension did not respond to install status check')\n      reject(error)\n    }, 1000)\n\n    _sendChromeMessage(extensionId,\n      {\n        extensionId,\n        message: 'getInstalledStatus',\n      }).then(response => {\n        clearTimeout(installedStatusTimeout)\n        return response\n      }).then(_sendChromeMessage(extensionId,\n        {\n          extensionId,\n          sourceTypes,\n          message: 'requestChromeMediaSourceId',\n        }).then(response => {\n          var sourceId = response.content\n          if (sourceId) {\n            resolve(sourceId)\n          } else { // user denied the request\n            reject(new NotAllowedError('The user denied the request to share the screen'))\n          }\n        }).catch(error => reject(error))\n      ).catch(error => reject(error))\n  })\n}\n\n/**\n * Internal media node for acquiring a Chrome screen sharing stream.\n *\n * @private\n * @class ChromeScreenSource\n * @extends ConcreteMediaSource\n * @param {Object} options - Options object.\n * @param {string} options.chromeExtensionId - The id of the chrome extension to use.\n * @param {ScreenSharingType|null} [options.type=null] - The screen sharing type to use. Specifying\n *   null will let the user choose either screen or window.\n * @param {boolean} [options.audio=false] - Whether desktop audio should be captured as well.\n * @param {Object} [options.video] - Constraints for the video, defaults to max resolution and no\n *   framerate limit.\n */\nexport default class ChromeScreenSource extends ConcreteMediaSource {\n  constructor(options) {\n    super()\n\n    argCheck.options('ChromeScreenSource constructor', 'options', options)\n      .string('chromeExtensionId')\n      .optString('type')\n      .optBoolean('audio')\n      .optObject('video')\n\n    let sourceTypes = options.type ? [options.type] : ['screen', 'window']\n\n    getChromeMediaSourceIdEx(options.chromeExtensionId, sourceTypes)\n      .then(sourceId => getChromeScreenConstraints({\n        sourceId,\n        type: options.type,\n        audio: options.audio,\n        video: options.video,\n      }))\n      .then(constraints => getUserMedia(constraints))\n      .then(\n      stream => this.setStream(stream),\n      error => {\n        if (error.name && error.name === 'NotFoundError') {\n          log.warning('deprecated', 'This Extension implementation will be DEPRICATED in later release')\n          let p2 = getChromeMediaSourceId(options.chromeExtensionId, sourceTypes)\n          this._handleExtensionId(p2, options).catch(() => {\n            this.setError(error)\n          })\n        } else {\n          this.setError(error)\n        }\n      }\n      ).catch(error => {\n        log.error(TAG, `unexpected error in ChromeScreenSource: ${error}`)\n      })\n  }\n  _handleExtensionId(promise, options) {\n    return promise.then(sourceId => getChromeScreenConstraints({\n      sourceId,\n      type: options.type,\n      audio: options.audio,\n      video: options.video,\n    }))\n      .then(constraints => getUserMedia(constraints))\n      .then(\n      stream => this.setStream(stream),\n      error => this.setError(error)\n      ).catch(error => {\n        log.error(TAG, `unexpected error in ChromeScreenSource: ${error}`)\n      })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/chromeScreenSource.js","'use strict'\n\nimport MediaSource from 'media/mediaSource'\nimport {audioContextUtil} from 'webrtc/utils'\n\n/**\n * A dummy source that can generate a silent audio stream and a 1x1 black video stream.\n *\n * Useful for testing and working around browser bugs where streams have to be present.\n *\n * @class DummySource\n * @extends MediaSource\n * @param {Object} [options] - Optional options object\n * @param {boolean} [options.video=true] - Whether to generate dummy video.\n * @param {boolean} [options.audio=true] - Whether to generate dummy audio.\n */\nexport default class DummySource extends MediaSource {\n  constructor({audio, video} = {audio: true, video: true}) {\n    super()\n    let tracks = []\n    if (audio) {\n      this._audioContext = audioContextUtil.get()\n      this._destination = this._audioContext.createMediaStreamDestination()\n      let [track] = this._destination.stream.getTracks()\n      // track.enabled = false\n      tracks.push(track)\n\n      this._silence = this._audioContext.createBufferSource()\n      this._silence.connect(this._destination, 0, 0)\n    }\n    if (video) {\n      this._canvas = document.createElement('canvas')\n      this._canvas.style.width = '1px'\n      this._canvas.style.height = '1px'\n      this._canvas.width = 1\n      this._canvas.height = 1\n\n      // Otherwise Firefox will complain about the canvas not being initialized\n      this._canvas.getContext('2d')\n\n      let stream = this._canvas.captureStream(1)\n      let [track] = stream.getTracks()\n      // track.enabled = false\n      tracks.push(track)\n    }\n    this._stream = new MediaStream(tracks)\n    this.setStream(this._stream)\n  }\n\n  get output() {\n    return this._output\n  }\n\n  /**\n   * Stops the source and cleans up all resources. This has to be called once the source\n   * is no longer used in order to clean up resources.\n   *\n   * Calling this method multiple times has no effect.\n   */\n  stop() {\n    if (this._stream) {\n      this.setStream(null)\n      this._stream.getTracks().forEach(track => track.stop())\n      this._stream = null\n      this._canvas = null\n      if (this._audioContext) {\n        audioContextUtil.release()\n        this._audioContext = null\n        this._destination = null\n        this._silence.stop()\n        this._silence = null\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @function DummySource#setStream\n   */\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/dummySource.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {NotAllowedError, NotFoundError} from 'common/errors'\n\nimport {getUserMedia} from 'media/common'\nimport ConcreteMediaSource from 'media/concreteMediaSource'\n\nconst TAG = 'firefox-screen-source'\nconst ERROR_TIME_BREAKPOINT_MS = 100\n\n/**\n * Internal media node for acquiring a Firefox screen sharing stream.\n *\n * @private\n * @class FirefoxScreenSource\n * @extends ConcreteMediaSource\n * @param {Object} [options] - Optional options object.\n * @param {ScreenSharingType} [options.type='window'] - The screen sharing type to use.\n *   The difference between window and application is that application will show all application windows\n *   at once, while window only shows a single window. e.g. only a single Firefox window or all open Firefox\n *   windows.\n * @param {boolean} [options.audio=false] - Whether audio should be requested as well.\n * @param {Object} [options.video] - Constraints for the video, defaults to max resolution and no\n *   framerate limit.\n */\nexport default class FirefoxScreenSource extends ConcreteMediaSource {\n  constructor(options) {\n    super()\n\n    const audio = options.audio || false\n    const video = options.video || {}\n    const type = options.type || 'window'\n\n    argCheck.optBoolean('FirefoxScreenSource constructor', 'options.audio', audio)\n    argCheck.optObject('FirefoxScreenSource constructor', 'options.video', video)\n    argCheck.optString('FirefoxScreenSource constructor', 'options.type', type)\n\n    if (!video.mediaSource) {\n      video.mediaSource = type\n    }\n    let startTime = Date.now()\n    getUserMedia({audio, video}).then(\n      stream => this.setStream(stream),\n      error => {\n        if (error.name === 'NotAllowedError') {\n          var actualError\n          // If the diff is too short we can assume it's not the user...\n          let timeToError = Date.now() - startTime\n          if (timeToError < ERROR_TIME_BREAKPOINT_MS) {\n            if (location.protocol !== 'https:') {\n              actualError = new NotAllowedError('Screen sharing is only allowed over HTTPS')\n            } else {\n              let msg = 'Screen sharing is not allowed on this domain, it needs to be added to ' +\n                'the media.getusermedia.screensharing.allowed_domains preference in about:config, ' +\n                'either manually or using an extension.'\n              actualError = new NotFoundError(msg)\n            }\n          } else {\n            actualError = new NotAllowedError('The user denied the request to share the screen')\n          }\n          actualError.reason = error.reason\n          error = actualError\n        }\n        this.setError(error)\n      }\n    ).catch(error => {\n      log.error(TAG, `unexpected error in FirefoxScreenSource: ${error}`)\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/firefoxScreenSource.js","'use strict'\n\nimport log from 'common/log'\nimport EmitterMixin from 'common/emitter'\n\nimport StreamSink from 'media/streamSink'\nimport MediaNode from 'media/mediaNode'\nimport MuteFilter from 'media/muteFilter'\n\nconst TAG = 'media-tee'\n\n/**\n * A simple {@link MediaNode} that can be used to expose media together with the basic utilities\n * of emitting stream events, exposing a stream stream property, and a mute property.\n *\n * @class MediaTee\n * @extends ConnectMixin\n */\nexport default class MediaTee extends EmitterMixin(MediaNode.connectMixin()) {\n  constructor() {\n    super()\n    this._streamSink = new StreamSink({onStream: stream => this._emit('stream', stream)})\n    this._muteFilter = new MuteFilter()\n    this._muteFilter.connect(this._streamSink)\n  }\n\n  /**\n   * Emitted whenever the stream is changed.\n   *\n   * @event MediaTee#stream\n   * @param {?MediaStream} stream - The media stream, or null.\n   */\n\n  set sink(target) {\n    log.error(TAG, 'mediaTee.sink is removed, just connect directly to the sink instead')\n  }\n\n  /**\n   * The tee's current media stream, or null.\n   *\n   * @readonly\n   * @member {MediaStream} MediaTee#stream\n   */\n  get stream() {\n    return this._streamSink.stream\n  }\n\n  /**\n   * The input of the media tee.\n   *\n   * @readonly\n   * @member {MediaNodeInput} MediaTee#input\n   */\n  get input() {\n    return this._muteFilter\n  }\n\n  /**\n   * The output of the media tee.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} MediaTee#output\n   */\n  get output() {\n    return this._muteFilter\n  }\n\n  /**\n   * Mute property as documented in {@link MuteFilter#mute}.\n   *\n   * @member {Object} MediaTee#mute\n   */\n  get mute() {\n    return this._muteFilter.mute\n  }\n\n  set mute(value) {\n    this._muteFilter.mute = value\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/mediaTee.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\n\nimport {getUserMedia} from 'media/common'\nimport ConcreteMediaSource from 'media/concreteMediaSource'\n\nconst TAG = 'user-media-source'\n\n/**\n * Low level media node that wraps a `getUserMedia` call. Applications will typically want to use\n * {@link DeviceSource} or {@link ScreenSource} instead.\n *\n * @class UserMediaSource\n * @extends ConcreteMediaSource\n * @param {Object} [options] - Optional options object.\n * @param {Object} [options.constraints] - Constraints passed to `getUserMedia`.\n * @param {boolean|Object} [options.constraints.audio=true] - Set to `true` if audio is desired, or a\n *  {@link http://w3c.github.io/mediacapture-main/getusermedia.html#idl-def-MediaTrackConstraints MediaTrackConstraints}\n *  object if more detailed constraints is required.\n * @param {boolean|Object} [options.constraints.video=true] - Set to `true` if video is desired, or a\n *  {@link http://w3c.github.io/mediacapture-main/getusermedia.html#idl-def-MediaTrackConstraints MediaTrackConstraints}\n *  object if more detailed configuration is required.\n */\nexport default class UserMediaSource extends ConcreteMediaSource {\n  constructor(options = {}) {\n    argCheck.optOptions('UserMediaSource constructor', 'options', options)\n      .optObject('constraints')\n    let {constraints = {audio: true, video: true}} = options\n    super()\n\n    getUserMedia(constraints).then(\n      stream => this.setStream(stream),\n      error => this.setError(error)\n    ).catch(error => {\n      log.error(TAG, `unexpected error in UserMediaSource: ${error}`)\n    })\n  }\n\n  /**\n   * @private\n   * @function UserMediaSource#setStream\n   */\n\n  /**\n   * @private\n   * @function UserMediaSource#setError\n   */\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/userMediaSource.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\n\nimport {audioContextUtil, AudioContext} from 'webrtc/utils'\n\nimport MediaFilter from 'media/mediaFilter'\n\nconst TAG = 'web-audio-filter'\n\n/**\n * A base class for media filter nodes that wish to use the WebAudio APIs.\n *\n * @class WebAudioFilter\n * @extends MediaFilter\n * @param {Object} [options] - Optional options object\n * @param {AudioContext} [options.context] - Audio context to use within this media node,\n *   which must not be closed as while the filter is still being used.\n *   If omitted, an internal context will be used.\n */\nexport default class WebAudioFilter extends MediaFilter {\n  constructor(options = {}) {\n    super()\n    argCheck.optOptions('WebAudioFilter constructor', 'options', options)\n      .optInstance('context', AudioContext)\n\n    if (options.context) {\n      this._releaseContext = false\n      this._audioContext = options.context\n    } else {\n      this._releaseContext = true\n      this._audioContext = null\n    }\n\n    this._source = null\n    this._destination = null\n  }\n\n  get context() {\n    return this._audioContext\n  }\n\n  get audioSource() {\n    return this._source\n  }\n\n  get audioDestination() {\n    return this._destination\n  }\n\n  onStream(stream, oldStream) {\n    if (this._source) {\n      this._source.disconnect()\n      this._source = null\n    }\n    if (stream) {\n      if (this._releaseContext) {\n        this._audioContext = audioContextUtil.get()\n      }\n      this._source = this._audioContext.createMediaStreamSource(stream)\n      this._destination = this._audioContext.createMediaStreamDestination()\n      this.setStream(this._destination.stream)\n    } else {\n      if (this._audioContext && this._releaseContext) {\n        audioContextUtil.release()\n        this._audioContext = null\n      }\n      this._destination = null\n      this.setStream(null)\n    }\n\n    try {\n      this.onAudioSource(this._source, this._destination, this._audioContext)\n    } catch (error) {\n      log.error(TAG, `Error thrown in WebAudioFilter.onAudioSource: ${error}`)\n    }\n  }\n\n  onAudioSource(source, destination, context) {\n    if (source) {\n      if (this.onSetupFilter) {\n        try {\n          let result = this.onSetupFilter(context)\n          if (result instanceof AudioNode) {\n            source.connect(result)\n            result.connect(destination)\n          } else if (Array.isArray(result)) {\n            let [input, output] = result\n            if (!(input instanceof AudioNode)) {\n              throw new TypeError('returned input node must be an AudioNode')\n            }\n            if (!(output instanceof AudioNode)) {\n              throw new TypeError('returned output node must be an AudioNode')\n            }\n            source.connect(input)\n            output.connect(destination)\n          } else {\n            throw new TypeError('return value must be an AudioNode or array of [input, output] nodes')\n          }\n        } catch (error) {\n          log.error(TAG, `Error thrown in WebAudioFilter.onSetupFilter: ${error}`)\n        }\n      } else {\n        log.warning(TAG, 'WebAudioFilter should override onAudioSource(source, destination, context) ' +\n          'or implement onSetupFilter(context)')\n      }\n    } else {\n      if (this.onTeardownFilter) {\n        try {\n          this.onTeardownFilter(context)\n        } catch (error) {\n          log.error(TAG, `Error thrown in WebAudioFilter.onTeardownFilter: ${error}`)\n        }\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/webAudioFilter.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport {registerInstance, unregisterInstance} from 'common/utils'\n\nimport {audioContextUtil, AudioContext} from 'webrtc/utils'\n\nimport MediaSource from 'media/mediaSource'\n\n/**\n * A base class for media source nodes that wish to use the WebAudio APIs.\n *\n * @class WebAudioSource\n * @extends MediaSource\n * @param {Object} [options] - Optional options object\n * @param {AudioContext} [options.context] - Audio context to use within this media node,\n *   which must not be closed as while the filter is still being used.\n *   If omitted, an internal context will be used.\n */\nexport default class WebAudioSource extends MediaSource {\n  constructor(options = {}) {\n    super()\n    argCheck.optOptions('WebAudioSource constructor', 'options', options)\n      .optInstance('context', AudioContext)\n\n    registerInstance('webAudioSource', this)\n\n    if (options.context) {\n      this._releaseContext = false\n      this._audioContext = options.context\n    } else {\n      this._releaseContext = true\n      this._audioContext = audioContextUtil.get()\n    }\n\n    this._destination = this._audioContext.createMediaStreamDestination()\n    this.setStream(this._destination.stream)\n  }\n\n  /**\n   * The audio context that is used within this media node.\n   */\n  get context() {\n    return this._audioContext\n  }\n\n  /**\n   * The web audio media stream destination node, whose stream is set as the output stream\n   * of this source. Audio nodes should be connected to this node in order to generate an output.\n   *\n   * This property should only be accessed by subclasses of the web audio source.\n   */\n  get audioDestination() {\n    return this._destination\n  }\n\n  /**\n   * Stops the source and cleans up all resources. This has to be called once the source\n   * is no longer used in order to clean up resources.\n   *\n   * Calling this method multiple times has no effect.\n   */\n  stop() {\n    if (this._stopped) {\n      return\n    }\n    this._stopped = true\n    unregisterInstance('webAudioSource', this)\n    this.setStream(null)\n    this._destination = null\n    if (this._releaseContext) {\n      audioContextUtil.release()\n      this._audioContext = null\n    }\n  }\n\n  /**\n   * @private\n   * @function WebAudioSource#setStream\n   */\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/webAudioSource.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {priv, assertPriv} from 'common/utils'\n\nimport {ConnectionSignalingError} from 'webrtc/errors'\nimport {streamDiff} from 'webrtc/utils'\nimport PeerConnectionProxy from 'webrtc/peerConnectionProxy'\nimport DataHub from 'webrtc/dataHub'\nimport monitorDataChannels from 'webrtc/dataChannelMonitor'\nimport AttachmentManager from 'webrtc/attachmentManager'\nimport {PeerMediaPipe} from 'webrtc/components'\nimport Signaler from 'webrtc/signaler'\n\nimport DataChannelMultiplexer from 'datamux/datamux'\n\nimport MediaNode from 'media/mediaNode'\nimport MediaNodeInput from 'media/mediaNodeInput'\n\nconst TAG = 'call'\n\nconst PEER_SWITCH_TIMEOUT_MS = 5000\n\n/**\n * A WebRTC call to a single peer.\n *\n * The call only manages the connection to a single peer. Functionality is added by attaching\n * different {@link RtcComponent}s using {@link Call#attach}.\n *\n * @abstract\n * @class Call\n * @extends EventEmitter\n */\nexport default class Call extends EmitterMixin(null) {\n  /**\n   * Emitted when the call is closed. Closing the call is permanent, and removes it from the\n   * active calls in a room.\n   * @event Call#closed\n   * @param {object} info - Information about who closed the call and how.\n   * @param {string} info.reason -\n   * An identifier for the reason that the call closed\n   * * `closed` - The call was closed locally.\n   * * `hangup` - Someone hangs up the call, can be caused by both parties.\n   * @param {string} info.source - Who caused the call to close\n   * * `self` - The call was closed locally.\n   * * `peer` - The call was closed by the peer.\n   * @param {Call} info.call - The call that was closed\n   */\n\n  /**\n   * Emitted when the connection state of the call changes.\n   *\n   * @event Call#connectionState\n   * @param {PeerConnectionState} connectionState - The new connection state.\n   */\n\n  /**\n   * Emitted when the call error state is changed.\n   *\n   * @event Call#error\n   * @param {(ConnectionFailedError|ConnectionLostError)?} error - The new error state.\n   */\n\n  /**\n   * Emitted when there is a signaling error.\n   *\n   * @event Call#signalingError\n   * @param {ConnectionSignalingError} signalingError - A signaling error.\n   */\n\n  static create(config) {\n    argCheck.options('Call.create', 'config', config)\n      .func('onSignalingMessage')\n      .optString('userId')\n      .optString('peerId')\n      .optArray('iceServers')\n      .optFunc('iceCandidateFilter')\n      .optObject('receivedOffer')\n\n    let {\n      onSignalingMessage,\n      userId = 'self',\n      peerId = 'peer',\n      iceServers = null,\n      iceCandidateFilter = null,\n      receivedOffer = null,\n    } = config\n\n    if (userId === peerId) {\n      argCheck.error('Call.create', 'config', 'not have identical userId and peerId')\n    }\n\n    return priv(Call, {onSignalingMessage, userId, peerId, iceServers, iceCandidateFilter, receivedOffer})\n  }\n\n  constructor(priv, deps) {\n    super()\n    assertPriv('Call', priv)\n    this._ownId = deps.userId || null\n    this._peerId = deps.peerId || null\n    this._isPassive = !deps.peerId\n    this._onClosed = deps.onClosed\n    this._statsFormatter = deps.statsFormatter\n\n    this._disconnectTimeoutId = 0\n\n    this._attachmentManager = new AttachmentManager({\n      ownId: deps.userId,\n      type: 'call',\n      dataHub: new DataHub(),\n      onUpdate: this._onAttachmentUpdate.bind(this),\n    })\n\n    this._datamux = new DataChannelMultiplexer({\n      onChannel: channel => this._attachmentManager.handlePeerChannel(this._peerId, channel),\n      onConnect: () => this._signaler.handleDataChannelConnect(),\n      onDisconnect: reason => this._signaler.handleDataChannelDisconnect(reason),\n    })\n\n    // All builtin channels should be created here\n    let renegotiationChannel = this._datamux.createChannel({\n      builtin: true,\n      label: 'cct.call',\n      protocol: 'cct.call.v0',\n    })\n    this._attachmentChannels = {\n      negotiationChannel: this._datamux.createChannel({\n        builtin: true,\n        label: 'cct.call.attach-map',\n        protocol: 'cct.call.attach-map.v0',\n      }),\n      dataHubChannel: this._datamux.createChannel({\n        builtin: true,\n        label: 'cct.attach.data',\n        protocol: 'cct.attach.data.v0',\n      }),\n      messagingChannel: this._datamux.createChannel({\n        builtin: true,\n        label: 'cct.attach.messaging',\n        protocol: 'cct.attach.messaging.v0',\n      }),\n    }\n\n    this._peerConnectionConfiguration = {\n      iceServers: deps.iceServers,\n      iceCandidateFilter: deps.iceCandidateFilter,\n      statsFormatter: deps.statsFormatter,\n    }\n\n    this._onAddRemoteStream = this._onRemoteStreamChange.bind(this, 'got')\n    this._onRemoveRemoteStream = this._onRemoteStreamChange.bind(this, 'lost')\n\n    this._signaler = new Signaler({\n      label: `${this._ownId}=>${this._peerId}`,\n      receivedOffer: deps.offer,\n      renegotiationChannel,\n      onMessage: deps.onSignalingMessage,\n      onSignalingError: this._onSignalingError.bind(this),\n      onErrorStateChange: this._onErrorStateChange.bind(this),\n      onConnectionStateChange: this._onConnectionStateChange.bind(this),\n      onCreatePeerConnection: this._createPeerConnection.bind(this),\n    })\n  }\n\n  toString() {\n    return 'call{id=' + this.id + ',' + this._peerConnection + '}'\n  }\n\n  _onErrorStateChange(error) {\n    this._emit('errorState', error)\n    this._emit('error', error)\n    if (error && this._statsFormatter) {\n      this._statsFormatter.handleStats([{\n        timestamp: Date.now(),\n        pcId: this._peerConnection && this._peerConnection.id,\n        sourceId: 'errorState',\n        name: error.name,\n        message: error.message,\n      }])\n    }\n  }\n\n  _onConnectionStateChange(state, prevState) {\n    if (state === 'connected') {\n      this._emit('connected', this)\n    }\n    if (prevState === 'connected') {\n      this._emit('disconnected', this)\n    }\n    this._emit('connectionState', state, prevState)\n  }\n\n  _onSignalingError(error) {\n    let signalingError = new ConnectionSignalingError(error)\n    this._emit({\n      eventType: 'signalingError',\n      defaultHandler() {\n        log.error(TAG, 'unhandled call signaling error', signalingError)\n      },\n    }, signalingError)\n    if (this._statsFormatter) {\n      this._statsFormatter.handleStats([{\n        timestamp: Date.now(),\n        pcId: this._peerConnection && this._peerConnection.id,\n        sourceId: 'signalingError',\n        name: error.name,\n        message: error.message,\n      }])\n    }\n  }\n\n  /**\n   * Attaches an {@link RtcComponent} to the call. If the peer attaches a compatible component\n   * to the same attachment point, the two components will be paired together.\n   *\n   * A common use case is for two peers to each attach a {@link DataShare} to 'data'.\n   * Once the call has connected, both peers will be able to use the attached DataShare to share data.\n   *\n   * The attachment point name can be any string, although excessively long names should be avoided.\n   *\n   * This method can be called at any point during a call, but will have no effect if the call is closed.\n   *\n   * @param  {string} name - The attachment point where the component should be attached.\n   * @param  {RtcComponent} component - An RtcComponent instance to attach.\n   */\n  attach(name, component) {\n    if (!this._attachmentManager) {\n      log.debug(TAG, `Tried to attach component at '${name}' on a closed call.`)\n    } else {\n      this._attachmentManager.attach(name, component)\n    }\n  }\n\n  /**\n   * Detaches the {@link RtcComponent} currently attached to the given attachment point.\n   * If no component is currently attached, an error will be thrown. If the component argument is\n   * given and it does not match the currently attached component, an error will be thrown.\n   *\n   * This method can be called at any point during a call, but will have no effect if the call is closed.\n   *\n   * @param {string} name - The attachment point from where the component should be detached.\n   * @param {RtcComponent} [component] - An RtcComponent instance that is expected to be attached\n   *   at the point.\n   */\n  detach(name, component) {\n    if (!this._attachmentManager) {\n      log.debug(TAG, `Tried to detach component at '${name}' from a closed call.`)\n    } else {\n      this._attachmentManager.detach(name, component)\n    }\n  }\n\n  /**\n   * A object containing all the attachments of the call.\n   *\n   * @readonly\n   * @member {Object<RtcComponent>} Call#attachments\n   */\n  get attachments() {\n    return this._attachmentManager.getAttachments()\n  }\n\n  _getMediaPipe(name) {\n    if (!this._attachmentManager) {\n      return new PeerMediaPipe()\n    }\n    let pipe = this._attachmentManager.getAttachments()[name]\n    if (pipe && !(pipe instanceof PeerMediaPipe)) {\n      throw new Error(`Attachment conflict for ${name}, another component is attached.`)\n    } else if (!pipe) {\n      pipe = new PeerMediaPipe()\n      this._attachmentManager.attach(name, pipe)\n    }\n    return pipe\n  }\n\n  /**\n   * Returns a {@link MediaTee} that represents a remote source with a specific name.\n   *\n   * This method is guaranteed to always return a {@link MediaTee}, unless the call is closed.\n   * If there is no remote source with the given name, it will be created.\n   *\n   * Under the hood this method will ensure that a {@link PeerMediaPipe} component is attached to the given point.\n   *\n   * @example <caption>Rendering a remote stream to a &lt;video&gt; element</caption>\n   *\n   * call.getRemoteSource('main').connect(videoElement)\n   *\n   * @function Call#getRemoteSource\n   * @param {string} name - The name of the remote source to return.\n   * @returns {MediaTee} A media tee that forwards the remote stream.\n   */\n  getRemoteSource(name) {\n    return this._getMediaPipe(name).output\n  }\n\n  /**\n   * Sets or removes a local media source that will be streamed to the peer.\n   *\n   * Under the hood this method will ensure that a {@link MediaPipe} component is attached to the given point.\n   *\n   * @function Call#setLocalSource\n   * @param {string} name - The name of the stream, e.g. 'main'.\n   * @param {?MediaNode} source - The media source.\n   */\n  setLocalSource(name, source) {\n    if (arguments.length < 2) {\n      throw new TypeError('Call.setLocalSource: requires at least 2 arguments')\n    }\n    if (typeof(name) !== 'string') {\n      throw new TypeError('Call.setLocalSource: name has to be a string')\n    }\n    if (source) {\n      MediaNode.connect(source, this._getMediaPipe(name))\n    } else {\n      let input = MediaNodeInput.resolve(this._getMediaPipe(name))\n      if (input.target) {\n        input.target.disconnect(input)\n      }\n    }\n  }\n\n  _onAttachmentUpdate() {\n    if (!this._peerConnection) {\n      return\n    }\n    if (!this.peerId) {\n      return log.error(TAG, 'got attachment update while no peer id was set')\n    }\n    let streams = this._attachmentManager.getLocalStreamsForPeer(this.peerId)\n    let currentStreams = this._peerConnection.getLocalStreams()\n    let [added, removed] = streamDiff(currentStreams, streams)\n    added.forEach(stream => this._peerConnection.addStream(stream))\n    removed.forEach(stream => this._peerConnection.removeStream(stream))\n  }\n\n  _onRemoteStreamChange(op, event) {\n    let {stream} = event\n    log.debug(TAG, `${op} remote stream '${stream.id}:'`, stream)\n    let streams = this._peerConnection.getRemoteStreams()\n    this._attachmentManager.setRemoteStreamsForPeer(this.peerId, streams)\n  }\n\n  _setPeerId(peerId) {\n    if (this._peerId !== peerId) {\n      this._oldPeers = this._oldPeers || new Map()\n      let now = Date.now()\n      let switchTimeout = this._oldPeers.get(peerId)\n      if (now < switchTimeout) {\n        log.info(TAG, this, `ignoring peer change from ${this._peerId} to ${peerId}, timeout has not expired`)\n        return false\n      }\n      this._oldPeers.set(peerId, now + PEER_SWITCH_TIMEOUT_MS)\n\n      if (this._peerId) {\n        log.info(TAG, this, 'changed peer, sending hangup to old peer')\n        this._signaler.sendHangup()\n      }\n\n      this._reset()\n      this._peerId = peerId\n      this._emit('peerId', peerId)\n      if (this._statsFormatter) {\n        this._statsFormatter.setPeerId(peerId)\n      }\n    }\n    return true\n  }\n\n  handleSignalingMessage(message) {\n    argCheck.object('Call.handleSignalingMessage', 'message', message)\n    try {\n      this._signaler.handleMessage(message)\n    } catch (error) {\n      if (error.message === 'hangup') {\n        if (this._signaler.transitionToClosed()) {\n          this._closeCall('hangup', 'peer')\n        }\n      } else {\n        log.error(TAG, `${this} error when handling signaling message: ${error}`)\n      }\n    }\n  }\n\n  _createPeerConnection() {\n    log.verbose(TAG, `${this} replacing peer connection`)\n    this._reset()\n\n    this._peerConnection = PeerConnectionProxy.create(this._peerConnectionConfiguration)\n    if (this._statsFormatter) {\n      monitorDataChannels(this._peerConnection, this._statsFormatter)\n    }\n    let dataChannelFactory = this._peerConnection.createDataChannel.bind(this._peerConnection)\n    this._datamux.createDataChannels(dataChannelFactory)\n    this._attachmentManager.setDatamuxForPeer(this._peerId, this._datamux, this._attachmentChannels)\n    this._onAttachmentUpdate()\n    this._peerConnection.addEventListener('addstream', this._onAddRemoteStream)\n    this._peerConnection.addEventListener('removestream', this._onRemoveRemoteStream)\n\n    this._emit('peerConnection', this._peerConnection)\n\n    return this._peerConnection\n  }\n\n  // Members\n\n  /**\n   * The id of the call.\n   *\n   * This is not guaranteed to be constant, as it can be changed due to negotiation\n   * conflicts. If the id is changed, an `'id` event will be emitted.\n   *\n   * @readonly\n   * @member {string} Call#id\n   */\n  get id() {\n    return this._signaler.ticket\n  }\n\n  // these two are added in callRegistry.js\n  /**\n   * The room that the call is taking place in.\n   *\n   * @readonly\n   * @member {Room} Call#room\n   */\n  /**\n   * The peer that the call is connecting to.\n   *\n   * @readonly\n   * @member {User} Call#peer\n   */\n\n  /**\n   * Your own id that the peer will see as {@link Call#peerId}.\n   *\n   * @readonly\n   * @member {string} Call#ownId\n   */\n  get ownId() {\n    return this._ownId\n  }\n\n  /**\n   * The id of the peer that the call is connecting to.\n   *\n   * @readonly\n   * @member {string} Call#peerId\n   */\n  get peerId() {\n    return this._peerId\n  }\n\n  /**\n   * The state of the signalling channel, `true` if the channel is open, `false` otherwise.\n   *\n   * @readonly\n   * @member {boolean} Call#connected\n   */\n  get connected() {\n    return this._signaler.isConnected()\n  }\n\n  /**\n   * Whether the call is closed or not. A closed call cannot be started again.\n   *\n   * @readonly\n   * @member {boolean} Call#closed\n   */\n  get closed() {\n    return this._signaler.closed\n  }\n\n  /**\n   * Whether the call is stopped or not. The initial state of incoming calls is stopped,\n   * and calls will also transition to the stopped state if the connection has failed.\n   *\n   * @readonly\n   * @member {boolean} Call#stopped\n   */\n  get stopped() {\n    return this._signaler.stopped\n  }\n\n  /**\n   * The connection state of the call.\n   *\n   * @readonly\n   * @member {PeerConnectionState} Call#connectionState\n   */\n  get connectionState() {\n    return this._signaler.connectionState\n  }\n\n  /**\n   * An error describing why the call connection is failing, or null if there is no error.\n   * Will always be null if {@link Call#connectionState} is `'connected'` or `'closed'`.\n   *\n   * @readonly\n   * @member {(ConnectionFailedError|ConnectionLostError)?} Call#errorState\n   */\n  get errorState() {\n    return this._signaler.errorState\n  }\n\n  get error() {\n    log.warning('deprecated', 'call.error is deprecated, use call.errorState instead')\n    return this._signaler.errorState\n  }\n\n  // Methods\n  /**\n   * Signal to the peer that the call is has been hung up, and then stop the call.\n   *\n   * When a call is hung up all components will be detached, and all resources cleaned up. It will\n   * not be possible to start the call again.\n   *\n   * @function Call#hangup\n   * @returns {Promise<Room>} A promise that is resolved if the hangup event is sent successfully.\n   */\n  hangup() {\n    if (this._signaler.transitionToClosed()) {\n      this._signaler.sendHangup()\n      this._closeCall('hangup', 'self')\n    }\n  }\n  /**\n   * Abruptly close the call without signaling to the peer.\n   *\n   * When a call is hung up all components will be detached, and all resources cleaned up. It will\n   * not be possible to start the call again.\n   *\n   * @function Call#close\n   */\n  close() {\n    if (this._signaler.transitionToClosed()) {\n      this._closeCall('closed', 'self')\n    }\n  }\n  /**\n   * Starts an incoming call, or tries to reconnect the call if the connection has failed.\n   *\n   * @function Call#start\n   */\n  start() {\n    this._signaler.start()\n    return this\n  }\n\n  _closeCall(reason, source) {\n    this._reset()\n    this._datamux.cleanup()\n    this._attachmentManager.cleanup()\n    this._attachmentManager = null\n    if (this._onClosed) {\n      this._onClosed(this)\n    }\n    log.info(TAG, 'closed call: ' + this)\n    this._emit('closed', {\n      reason: reason,\n      source: source,\n      call: this,\n    })\n  }\n\n  _reset() {\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('addstream', this._onAddRemoteStream)\n      this._peerConnection.removeEventListener('removestream', this._onRemoveRemoteStream)\n    }\n    this._signaler.reset()\n    try {\n      if (this._peerConnection && this._peerConnection.signalingState !== 'closed') {\n        this._peerConnection.close()\n      }\n    } catch (e) {\n      log.error(TAG, 'failed to close peer connection: ', e)\n    }\n    this._peerConnection = null\n    this._datamux.reset()\n    this._attachmentManager.cleanupPeer(this.peerId)\n  }\n}\n\nCall._deprecatedEvents = {\n  // FIXME: remove once call.error is removed\n  error: funcName => `call.${funcName}('error', ...) is deprecated, use call.${funcName}('errorState', ...) instead`,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/call.js","\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {priv} from 'common/utils'\n\nimport FileRef from 'webrtc/fileRef'\nimport RtcComponent from 'webrtc/rtcComponent'\nimport {Candidate} from 'webrtc/candidater'\nimport PeerConnectionProxy from 'webrtc/peerConnectionProxy'\n\nimport MediaNode from 'media/mediaNode'\nimport MediaTee from 'media/mediaTee'\nimport Passthrough from 'media/passthrough'\nimport StreamSource from 'media/streamSource'\n\n/**\n * A component that is used to broadcast media to all peers.\n *\n * Label: `'cct.media.broadcaster'`\n *\n * @example <caption>Example of connecting a MediaBroadcaster to a conference</caption>\n * var conference = room.startConference();\n *\n * var camera = new cct.DeviceSource();\n * var broadcaster = new cct.MediaBroadcaster();\n * camera.connect(broadcaster)\n *\n * broadcaster.on('remoteSource', function (update) {\n *   var peerId = update.peer;\n *   var peerCamera = update.source;\n *   peerCamera.connect(someVideoElements[peerId])\n * });\n *\n * conference.attach('my-broadcaster', broadcaster);\n *\n * @class MediaBroadcaster\n * @implements RtcComponent\n * @extends EventEmitter\n */\nexport class MediaBroadcaster extends EmitterMixin(RtcComponent) {\n  /**\n   * Emitted when remote sources are added.\n   *\n   * @event MediaBroadcaster#added\n   * @param {Array<MediaTee>} added - An array of remote sources that were added.\n   */\n\n  /**\n   * Emitted when remote sources are removed.\n   *\n   * @event MediaBroadcaster#removed\n   * @param {Array<MediaTee>} removed - An array of remote sources that were removed.\n   */\n\n  /**\n   * Emitted when remote sources are updated.\n   *\n   * @event MediaBroadcaster#remoteSources\n   * @param {Array<MediaTee>} remoteSources - The current list of remote sources.\n   */\n\n  constructor() {\n    super({label: 'cct.media.broadcaster'})\n    this.tag = 'media-broadcaster'\n    this._input = new Passthrough()\n    this._peerSources = new Map()\n    this._remoteSources = []\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidReceivePeer(peer) {\n    this._input.connect(peer)\n\n    let source = new MediaTee()\n    peer.connect(source)\n\n    source.peerId = peer.id\n    this._peerSources.set(peer.id, source)\n    this._emit('added', [source])\n    this._remoteSources = [...this._peerSources.values()]\n    this._emit('remoteSources', this._remoteSources)\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidLosePeer(peer) {\n    let source = this._peerSources.get(peer.id)\n    if (!source) {\n      log.warning(this.tag, 'could not find source for removed peer')\n      return\n    }\n    this._peerSources.delete(peer.id)\n    this._emit('removed', [source])\n    this._remoteSources = [...this._peerSources.values()]\n    this._emit('remoteSources', this._remoteSources)\n  }\n\n  /**\n   * The input for the media that will be broadcasted to all peers.\n   *\n   * @readonly\n   * @member {MediaNodeInput} MediaBroadcaster#input\n   */\n  get input() {\n    return this._input\n  }\n\n  /**\n   * The remote sources of all the peers that are broadcasting media.\n   *\n   * Each of the sources have a `peerId` property set, which identifies the peer\n   * that the source is from.\n   *\n   * @readonly\n   * @member {Array<MediaTee>} MediaBroadcaster#remoteSources\n   */\n  get remoteSources() {\n    return this._remoteSources\n  }\n}\n\n/**\n * A component that allows data to be synchronized between all peers, using the Map API.\n *\n * Label: `'cct.data.share'`\n *\n * @class DataShare\n * @implements RtcComponent\n * @extends EventEmitter\n * @param {Object} [options] - Optional options object.\n * @param {string} [options.ownerId=null] - The owner id used for all updated to the store,\n *   see {@link AttachData#setWithOwnership} for more info.\n */\nexport class DataShare extends EmitterMixin(RtcComponent) {\n  constructor({ownerId = null} = {}) {\n    super({label: 'cct.data.share'})\n    this.tag = 'data-share'\n    argCheck.optString(ownerId)\n    this.ownerId = ownerId\n  }\n\n  /**\n   * Emitted whenever any entry in the map is added, changed, or removed. Events are emitted for both\n   * local and remote updates.\n   *\n   * @event DataShare#update\n   * @param {Object} update - Information about the update that occured.\n   * @param {string} update.key - The key for the entry that was updated.\n   * @param {JsonTypes} update.value - The value that was updated. If the value was deleted this will\n   *   be set to `undefined`.\n   * @param {JsonTypes} update.oldValue - The previous value, or undefined if it did not exists.\n   */\n\n  /**\n   * Emitted whenever a specific entry in the map is added, changed, or removed. Events are emitted for both\n   * local and remote updates.\n   *\n   * The `<key>` part of the event name should be replaced with the key you want to listen for, i.e.\n   * to listen for the entry for `'position'` to change, you should listen to the `'update:position'` event.\n   *\n   * @event DataShare#update:&lt;key&gt;\n   * @param {JsonTypes} value - The value that was updated. If the value was deleted this will\n   *   be set to `undefined`.\n   * @param {JsonTypes} oldValue - The previous value, or undefined if it did not exists.\n   */\n\n  /**\n   * The number of entries in the map.\n   *\n   * @readonly\n   * @member {number} DataShare#size\n   */\n  get size() {\n    this._checkAttached()\n    return this.attachPoint.data.size\n  }\n\n  /**\n   * @returns {Iterator<string>} An iterator of all the keys in the map.\n   */\n  keys() {\n    this._checkAttached()\n    return this.attachPoint.data.keys()\n  }\n\n  /**\n   * @returns {Iterator<JsonTypes>} An iterator of all the values in the map.\n   */\n  values() {\n    this._checkAttached()\n    return this.attachPoint.data.values()\n  }\n\n  /**\n   * @returns {Iterator<Array>} An iterator of all the entries in the map.\n   */\n  entries() {\n    this._checkAttached()\n    return this.attachPoint.data.entries()\n  }\n\n  /**\n   * @param {string} key - The key to look for.\n   * @returns {boolean} True if there is an entry for the given key.\n   */\n  has(key) {\n    this._checkAttached()\n    return this.attachPoint.data.has(key)\n  }\n\n  /**\n   * @param {string} key - The key of the value to retrive.\n   * @returns {JsonTypes} Returns the value for the given key.\n   */\n  get(key) {\n    this._checkAttached()\n    return this.attachPoint.data.get(key)\n  }\n\n  /**\n   * Sets set value for the given key.\n   *\n   * Setting a local value **will** cause an update event to be emitted for that key.\n   * The update event does not get emitted synchronously, but is instead scheduled in a microtask.\n   *\n   * @param {string} key - The key of the value.\n   * @param {JsonTypes} value - The value to set.\n   */\n  set(key, value) {\n    this._checkAttached()\n    let oldValue = this.attachPoint.data.get(key)\n    let ret = this.attachPoint.data.setWithOwnership(key, value, this.ownerId)\n    Promise.reject().catch(() => {\n      this.rtcComponentUpdatedData({key, value, oldValue})\n    })\n    return ret\n  }\n\n  /**\n   * Deletes the entry for a given key.\n   *\n   * Deleting a local entry **will** cause an update event to be emitted for that key.\n   * The update event does not get emitted synchronously, but is instead scheduled in a microtask.\n   *\n   * @param {string} key - The key of the entry to delete.\n   * @returns {boolean} True if the entry existed.\n   */\n  delete(key) {\n    this._checkAttached()\n    let oldValue = this.attachPoint.data.get(key)\n    let ret = this.attachPoint.data.deleteWithOwnership(key, this.ownerId)\n    Promise.reject().catch(() => {\n      this.rtcComponentUpdatedData({key, value: undefined, oldValue})\n    })\n    return ret\n  }\n\n  /**\n   * Clears all entries from the map.\n   *\n   * Clearing the map locally **will** cause an update event to be emitted for every entry.\n   * The update event does not get emitted synchronously, but is instead scheduled in a microtask.\n   */\n  clear() {\n    return this.forEach((_, key) => this.delete(key))\n  }\n\n  /**\n   * The iterator function passed to {@link DataShare#forEach}.\n   *\n   * @callback DataShare~ForEachCallback\n   * @param {*} key - The key of the current entry.\n   * @param {JsonTypes} value - The value of the current entry.\n   * @param {DataShare} map - The map itself.\n   */\n\n  /**\n   * Synchronously calls an interator function once for each entry in the map.\n   *\n   * Errors thrown inside the iterator function will cancel the iteration.\n   *\n   * @param {DataShare~ForEachCallback} func - The iterator function.\n   * @param {*} [thisArg] - The value to use as `this` inside the iterator function.\n   */\n  forEach(func, thisArg) {\n    this._checkAttached()\n    return this.attachPoint.data.forEach(func, thisArg)\n  }\n\n  /**\n   * This symbol allows the map to be used directly inside a `for..of` loop.\n   *\n   * @function DataShare#@@iterator\n   * @returns {Object} An iterator for all the entries in this map.\n   */\n  [Symbol.iterator]() {\n    this._checkAttached()\n    return this.attachPoint.data[Symbol.iterator]()\n  }\n\n  _checkAttached() {\n    if (!this.attachPoint) {\n      throw new TypeError('DataShare needs to be attached before it can be used.')\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentUpdatedData({key, value, oldValue}) {\n    this._emit('update', {key, value, oldValue})\n    this._emit(`update:${key}`, value, oldValue)\n  }\n}\n\n/**\n * A component that allows file sharing between peers, using the Map API.\n *\n * Label: `'cct.file.share'`\n *\n * @class FileShare\n * @implements RtcComponent\n * @extends EventEmitter\n */\nexport class FileShare extends EmitterMixin(RtcComponent) {\n  constructor() {\n    super({label: 'cct.file.share'})\n    this.tag = 'file-share'\n    this._refMap = new Map() // key -> FileRef\n    this._fileRefs = new Map() // FileRef._id -> FileRef\n  }\n\n  /**\n   * Emitted whenever any entry in the map is added, changed, or removed. Events are emitted for both\n   * local and remote updates.\n   *\n   * @event FileShare#update\n   * @param {Object} update - Information about the update that occured.\n   * @param {string} update.key - The key for the entry that was updated.\n   * @param {FileRef} update.value - The value that was updated. If the value was deleted this will\n   *   be set to `undefined`.\n   * @param {FileRef} update.oldValue - The previous value, or undefined if it did not exists.\n   */\n\n  /**\n   * Emitted whenever a specific entry in the map is added, changed, or removed. Events are emitted for both\n   * local and remote updates.\n   *\n   * The `<key>` part of the event name should be replaced with the key you want to listen for, i.e.\n   * to listen for the entry for `'position'` to change, you should listen to the `'update:position'` event.\n   *\n   * @event FileShare#update:&lt;key&gt;\n   * @param {FileRef} value - The value that was updated. If the value was deleted this will\n   *   be set to `undefined`.\n   * @param {FileRef} oldValue - The previous value, or undefined if it did not exists.\n   */\n\n  /**\n   * The number of entries in the map.\n   *\n   * @readonly\n   * @member {number} FileShare#size\n   */\n  get size() {\n    this._checkAttached()\n    return this._refMap.size\n  }\n\n  /**\n   * @returns {Iterator<string>} An iterator of all the keys in the map.\n   */\n  keys() {\n    this._checkAttached()\n    return this._refMap.keys()\n  }\n\n  /**\n   * @returns {Iterator<FileRef>} An iterator of all the file refs in the map.\n   */\n  values() {\n    this._checkAttached()\n    return this._refMap.values()\n  }\n\n  /**\n   * @returns {Iterator<Array<*>>} An iterator of all the entries in the map.\n   */\n  entries() {\n    this._checkAttached()\n    return this._refMap.entries()\n  }\n\n  /**\n   * @param {string} key - The key to look for.\n   * @returns {boolean} True if there is an entry for the given key.\n   */\n  has(key) {\n    this._checkAttached()\n    return this._refMap.has(key)\n  }\n\n  /**\n   * @param {string} key - The key of the file ref to retrive.\n   * @returns {FileRef} Returns the file ref for the given key.\n   */\n  get(key) {\n    this._checkAttached()\n    return this._refMap.get(key)\n  }\n\n  /**\n   * Sets set file ref for the given key.\n   *\n   * Setting a local value **will** cause an update event to be emitted for that key.\n   * The update event does not get emitted synchronously, but is instead scheduled in a microtask.\n   *\n   * @param {string} key - The key of the value.\n   * @param {FileRef} fileRef - The value to set.\n   */\n  set(key, fileRef) {\n    this._checkAttached()\n    if (!(fileRef instanceof FileRef)) {\n      argCheck.error('fileShare.set', 'fileRef', 'must be a FileRef instance')\n    }\n    if (!fileRef.isLocal) {\n      argCheck.error('fileShare.set', 'fileRef', 'must be a local FileRef')\n    }\n    let oldRef = this._refMap.get(key)\n    if (fileRef === oldRef) {\n      return\n    }\n    this._fileRefs.set(fileRef._id, fileRef)\n    this._refMap.set(key, fileRef)\n\n    let value = this._fromFileRef(fileRef)\n    let ret = this.attachPoint.data.setWithOwnership(key, value, this.attachPoint.ownId)\n    Promise.reject().catch(() => {\n      this._emit('update', {key, value: fileRef})\n      this._emit(`update:${key}`, fileRef)\n    })\n    return ret\n  }\n\n  _fromFileRef({isLocal, _id, name, size, type}) {\n    if (!isLocal) {\n      throw new TypeError('Tried to serialize remote FileRef')\n    }\n    return {id: _id, name, size, type}\n  }\n\n  _toFileRef(value, peer) {\n    let {id} = value\n    let fileRef = this._fileRefs.get(id)\n    if (!fileRef) {\n      log.debug(this.tag, `got file ref meta ${JSON.stringify(value)} for nonexistent id '${id}'`)\n      let createDataChannel = peer.createChannel.bind(peer)\n      fileRef = priv(FileRef, value, createDataChannel, peer.id)\n      this._fileRefs.set(id, fileRef)\n    } else {\n      log.debug(this.tag, `got file ref meta ${JSON.stringify(value)} for existing id '${id}', ${fileRef}`)\n    }\n    return fileRef\n  }\n\n  /**\n   * Deletes the entry for a given key.\n   *\n   * Deleting a local entry **will** cause an update event to be emitted for that key.\n   * The update event does not get emitted synchronously, but is instead scheduled in a microtask.\n   *\n   * @param {string} key - The key of the entry to delete.\n   * @returns {boolean} True if the entry existed.\n   */\n  delete(key) {\n    this._checkAttached()\n    // TODO: not enough to set null here\n    let fileRef = this._refMap.get(key)\n    if (fileRef) {\n      this._fileRefs.delete(fileRef._id)\n    }\n    this._refMap.delete(key)\n\n    let ret = this.attachPoint.data.deleteWithOwnership(key, this.attachPoint.ownId)\n    Promise.reject().catch(() => {\n      this._emit('update', {key, value: undefined})\n      this._emit(`update:${key}`, undefined)\n    })\n    return ret\n  }\n\n  /**\n   * Clears all entries from the map.\n   *\n   * Clearing the map locally **will** cause an update event to be emitted for every entry.\n   * The update event does not get emitted synchronously, but is instead scheduled in a microtask.\n   */\n  clear() {\n    return this.forEach((_, key) => this.delete(key))\n  }\n\n  /**\n   * The iterator function passed to {@link FileShare#forEach}.\n   *\n   * @callback FileShare~ForEachCallback\n   * @param {*} key - The key of the current entry.\n   * @param {FileRef} value - The value of the current entry.\n   * @param {FileShare} map - The map itself.\n   */\n\n  /**\n   * Synchronously calls an interator function once for each entry in the map.\n   *\n   * Errors thrown inside the iterator function will cancel the iteration.\n   *\n   * @param {FileShare~ForEachCallback} func - The iterator function.\n   * @param {*} [thisArg] - The value to use as `this` inside the iterator function.\n   */\n  forEach(func, thisArg) {\n    this._checkAttached()\n    return this._refMap.forEach(func, thisArg)\n  }\n\n  /**\n   * This symbol allows the map to be used directly inside a `for..of` loop.\n   *\n   * @function FileShare#@@iterator\n   * @returns {Object} An iterator for all the entries in this map.\n   */\n  [Symbol.iterator]() {\n    this._checkAttached()\n    return this._refMap[Symbol.iterator]()\n  }\n\n  _checkAttached() {\n    if (!this.attachPoint) {\n      throw new TypeError('FileShare needs to be attached before it can be used.')\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidReceivePeer(peer) {\n    this.attachPoint.data.owners.forEach((ownerId, key) => {\n      if (ownerId === peer.id) {\n        let value = this.attachPoint.data.get(key)\n        this.rtcComponentUpdatedData({key, value, ownerId})\n      }\n    })\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidLosePeer(peer) {\n    let deleted = []\n    this._fileRefs.forEach((fileRef, id) => {\n      if (fileRef.isLocal) {\n        return\n      }\n      if (fileRef.peerId === peer.id) {\n        this._fileRefs.delete(id)\n        deleted.push(fileRef._id)\n      }\n    })\n    this._refMap.forEach((fileRef, key) => {\n      if (deleted.indexOf(fileRef._id) !== -1) {\n        this._refMap.delete(key)\n        this._emit('update', {key, value: null, oldValue: fileRef})\n        this._emit(`update:${key}`, null, fileRef)\n      }\n    })\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentReceivedChannel(peer, channel) {\n    if (channel.protocol !== 'cct.data.file.v1') {\n      return log.warning(this.tag, `got channel with unknown protocol: ${channel.protocol}`)\n    }\n    let fileRef = this._fileRefs.get(channel.label)\n\n    if (fileRef) {\n      fileRef._startTransfer(channel, peer).catch(error => {\n        log.error(this.tag, `File transfer error, ${error}`)\n        channel.close()\n      })\n    } else {\n      log.warning(this.tag, `got transfer request for unknown file: ${channel.label}`)\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentUpdatedData({key, value, ownerId}) {\n    if (!ownerId) {\n      return log.error(this.tag, `got data without owner for key: '${key}', ignoring`)\n    }\n    let peer = this.attachPoint.peers.get(ownerId)\n    if (!peer) {\n      return log.debug(this.tag, `peer not found: ${ownerId}`)\n    }\n    let oldValue = this._refMap.get(key)\n\n    if (value) {\n      let fileRef = this._toFileRef(value, peer)\n      if (oldValue !== fileRef) {\n        this._refMap.set(key, fileRef)\n        this._emit('update', {key, value: fileRef, oldValue})\n        this._emit(`update:${key}`, fileRef, oldValue)\n      }\n    } else {\n      this._refMap.delete(key)\n      this._emit('update', {key, value: undefined, oldValue})\n      this._emit(`update:${key}`, undefined, oldValue)\n    }\n  }\n}\n\n/**\n * A simple component that allows a single media stream to be sent and received within a call.\n * This component can only be used by calls, and will throw an error if attached to a conference.\n *\n * Media does not have to be sent both ways, i.e. the component will work even if none or just one\n * of the peers are sending media.\n *\n * This component is usually not used directly, as it is used in the implementation of\n * {@link Call#setLocalSource} and {@link Call#getRemoteSource}.\n *\n * Label: `'cct.media.direct'`\n *\n * @class PeerMediaPipe\n * @implements RtcComponent\n * @extends ConnectMixin\n */\nexport class PeerMediaPipe extends MediaNode.connectMixin(RtcComponent) {\n  constructor() {\n    super({label: 'cct.media.direct'})\n    this.tag = 'direct-media'\n\n    this._remoteSource = new MediaTee()\n    this._localSource = new Passthrough()\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillAttach(attachPoint) {\n    if (attachPoint.type !== 'call') {\n      throw new Error('Peer media pipe may only be attached to calls.')\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidReceivePeer(peer) {\n    if (this.attachPoint.peers.size > 1) {\n      throw new Error(\"Peer media pipe can't handle a second peer, something went wrong.\")\n    }\n    this._localSource.connect(peer)\n    peer.connect(this._remoteSource)\n  }\n\n  /**\n   * The input for the media that will be sent to the peer.\n   *\n   * @member {MediaNodeInput} PeerMediaPipe#input\n   */\n  get input() {\n    return this._localSource\n  }\n\n  /**\n   * Output for media that is sent from the peer.\n   *\n   * @member {MediaNodeOutput} PeerMediaPipe#output\n   */\n  get output() {\n    return this._remoteSource\n  }\n}\n\n// Private API for now\nexport class ProxySink extends EmitterMixin(RtcComponent) {\n  constructor() {\n    super({label: 'cct.proxy.sink', remoteLabel: 'cct.proxy.source'})\n    this.tag = 'proxy-sink'\n\n    this._onMessage = this._onMessage.bind(this)\n\n    this._offer = null\n    this._answer = null\n    this._localCandidates = []\n    this._remoteCandidates = []\n  }\n\n  get id() {\n    return this._id\n  }\n  get connected() {\n    return !!this._channel\n  }\n  get offer() {\n    return this._offer\n  }\n  get answer() {\n    return this._answer\n  }\n  get remoteCandidates() {\n    return this._remoteCandidates\n  }\n\n  setOffer(offer) {\n    if (offer) {\n      offer = { // Guard for un-serializeable temasys objects\n        type: offer.type,\n        sdp: offer.sdp,\n      }\n    } else {\n      offer = null\n    }\n    this._offer = offer\n    this._answer = null\n    this._localCandidates.splice(0)\n    this._remoteCandidates.splice(0)\n    if (this._channel) {\n      this._channel.send({type: 'offer', content: offer})\n    }\n    log.debug(this.tag, 'offer set', offer)\n  }\n\n  addCandidate(candidate) {\n    if (candidate) {\n      candidate = new Candidate(candidate)\n      this._localCandidates.push(candidate)\n      if (this._channel) {\n        this._channel.send({type: 'candidate', content: candidate})\n      }\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillAttach(attachPoint) {\n    if (attachPoint.type !== 'call') {\n      throw new Error('ProxySink may only be attached to calls.')\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidReceivePeer(peer) {\n    if (this.attachPoint.peers.size > 1) {\n      throw new Error(\"ProxySink can't handle a second peer, something went wrong.\")\n    }\n\n    this._channel = peer.createChannel({label: 'proxy', pairingId: 'proxy'})\n    this._channel.on('message', this._onMessage)\n    this._channel.send({type: 'offer', content: this._offer})\n    this._localCandidates.forEach(candidate => {\n      this._channel.send({type: 'candidate', content: candidate})\n    })\n\n    log.debug(this.tag, 'connected to peer, sent offer and candidates', this._offer, this._localCandidates)\n    this._emit('connected', this)\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidLosePeer() {\n    this._offer = null\n    this._answer = null\n    this._channel = null\n    this._localCandidates.splice(0)\n    this._remoteCandidates.splice(0)\n  }\n\n  _onMessage({type, content}) {\n    log.verbose(this.tag, `Got message with type '${type}'.`)\n    if (type === 'candidate') {\n      let candidate = new RTCIceCandidate(content)\n      this._remoteCandidates.push(candidate)\n      this._emit('candidate', candidate)\n    } else if (type === 'answer') {\n      let answer = new RTCSessionDescription(content)\n      this._answer = answer\n      this._emit('answer', answer)\n    } else {\n      log.error(this.tag, `Got unknown message type: ${type}.`)\n    }\n  }\n}\n\n// Private API for now\nexport class ProxySource extends MediaNode.connectMixin(RtcComponent) {\n  constructor({connectionConfig} = {}) {\n    super({label: 'cct.proxy.source', remoteLabel: 'cct.proxy.sink'})\n    this.tag = 'proxy-source'\n\n    this._onMessage = this._onMessage.bind(this)\n\n    this._source = new StreamSource()\n    this._connectionConfig = connectionConfig\n    this._onAddStream = this._onAddStream.bind(this)\n    this._onRemoveStream = this._onRemoveStream.bind(this)\n    this._onIceCandidate = this._onIceCandidate.bind(this)\n  }\n\n  get output() {\n    return this._source\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillAttach(attachPoint) {\n    if (attachPoint.type !== 'call') {\n      throw new Error('ProxySource may only be attached to calls.')\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidReceivePeer(peer) {\n    if (this.attachPoint.peers.size > 1) {\n      throw new Error(\"ProxySource can't handle a second peer, something went wrong.\")\n    }\n    this._channel = peer.createChannel({label: 'proxy', pairingId: 'proxy'})\n    this._channel.on('message', this._onMessage)\n  }\n\n  _createPeerConnection() {\n    this._peerConnection = PeerConnectionProxy.create(this._connectionConfig)\n    this._peerConnection.addEventListener('addstream', this._onAddStream)\n    this._peerConnection.addEventListener('removestream', this._onRemoveStream)\n    this._peerConnection.addEventListener('icecandidate', this._onIceCandidate)\n  }\n\n  _cleanupPeerConnection() {\n    this._source.setStream(null)\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('addstream', this._onAddStream)\n      this._peerConnection.removeEventListener('removestream', this._onRemoveStream)\n      this._peerConnection.removeEventListener('icecandidate', this._onIceCandidate)\n      try {\n        this._peerConnection.close()\n      } catch (error) {\n        log.verbose(this.tag, `Failed to close peer connection: ${error}`)\n      }\n      this._peerConnection = null\n    }\n  }\n\n  _onAddStream({stream}) {\n    log.debug(this.tag, `Added stream '${stream.id}' to proxy source connection.`)\n    this._source.setStream(stream)\n  }\n\n  _onRemoveStream({stream}) {\n    log.debug(this.tag, `Removed stream '${stream.id}' from proxy source connection.`)\n    if (this.output.stream === stream) {\n      this._source.setStream(null)\n    }\n  }\n\n  _onIceCandidate({candidate}) {\n    if (candidate) {\n      candidate = new Candidate(candidate)\n      log.verbose(this.tag, `got candidate: ${candidate}`)\n      if (this._channel) {\n        this._channel.send({type: 'candidate', content: candidate})\n      } else {\n        log.info(this.tag, 'Ignoring candidate since peer was not connected')\n      }\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidLosePeer() {\n    this._channel = null\n    this._cleanupPeerConnection()\n  }\n\n  _onMessage({type, content}) {\n    if (type === 'offer') {\n      this._setOffer(content)\n    } else if (type === 'candidate') {\n      this._addCandidate(content)\n    } else {\n      log.error(this.tag, `Got unknown message type: ${type}.`)\n    }\n  }\n\n  _setOffer(offer) {\n    this._cleanupPeerConnection()\n    if (offer) {\n      this._createPeerConnection()\n      this._peerConnection.performAnswer({offer})\n        .then(answer => {\n          if (this._channel) {\n            this._channel.send({type: 'answer', content: answer})\n          }\n        })\n        .catch(error => {\n          log.error(this.tag, `Failed to set offer and generate answer: ${error}`)\n        })\n    }\n  }\n\n  _addCandidate(candidate) {\n    if (this._peerConnection) {\n      this._peerConnection.addIceCandidate(candidate).catch(error => {\n        log.error(this.tag, `Failed to add candidate: ${error}`)\n      })\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/components.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport AsyncQueue from 'common/queue'\nimport {\n  arrayBufferSha1IfSupported,\n  assertPriv,\n  binaryStringToArrayBuffer,\n  blobToArrayBuffer,\n  bufferToFile,\n  bufferToHex,\n  concatenateArrayBuffers,\n  defer,\n  hiddenProp,\n  parseDataUri,\n  priv,\n  randomString,\n} from 'common/utils'\n\nimport {FileTransferError, TransferInterruptedError} from 'webrtc/errors'\n\nconst FILE_TRANSFER_SLICE_SIZE = 1024 * 64\nconst FILE_TRANSFER_CHUNK_SIZE = 64 * FILE_TRANSFER_SLICE_SIZE // 4 MiB\nconst FILE_TRANSFER_TIMEOUT_MS = 8000\n\nconst TAG = 'file-ref'\n\n/**\n * Represents a reference to a file, which resides either locally, or at some remote peer.\n *\n * If the file is available locally it can be accessed directly,\n *  otherwise it has to be downloaded first.\n *\n * @class FileRef\n * @abstract\n */\nexport default class FileRef extends EmitterMixin(null) {\n  /**\n   * Emitted when the file download ends, both on success and failure.\n   *\n   * @event FileRef#end\n   * @param {'done'|'error'|'aborted'} reason - A string identifying the reason the download ended.\n   */\n\n  /**\n   * Emitted when the file download ends before it is completed.\n   *\n   * @event FileRef#error\n   * @oaram {Error} error - The error that caused the download to fail\n   */\n\n  /**\n   * Emitted when the file download is completed successfully.\n   *\n   * @event FileRef#load\n   */\n\n  /**\n   * Emitted each time the progress of the file download changes.\n   *\n   * @event FileRef#progress\n   */\n\n  /**\n   * Emitted each time a remote peer starts downloading the file.\n   *\n   * @event FileRef#transfer\n   * @param {FileTransfer} transfer - The object representing the transfer to the remote peer\n   */\n\n  /**\n   * Emitted when the list of file transfers is changes.\n   *\n   * @event FileRef#transfers\n   * @param {FileTransfer[]} transfers - A list of file transfers\n   */\n\n  /**\n   * Creates a new file reference from a file.\n   *\n   * @param {external:File} file - An HTML5 file object.\n   * @returns {FileRef} - A new file ref.\n   */\n  static fromFile(file) {\n    return priv(FileRef, {\n      file: file,\n    })\n  }\n\n  /**\n   * Creates a new file reference from a blob and a filename.\n   *\n   * @param {string} filename - The filename to be used to the file.\n   * @param {external:Blob} blob - An HTML5 blob object.\n   * @returns {FileRef} - A new file ref.\n   */\n  static fromBlob(filename, blob) {\n    blob.lastModifiedDate = new Date()\n    blob.name = filename\n    return priv(FileRef, {\n      file: blob,\n    })\n  }\n\n  /**\n   * Creates a new file reference from a data uri and a filename.\n   *\n   * @param {string} filename - The filename to be used to the file.\n   * @param {string} dataUri - A data uri.\n   * @returns {FileRef} - A new file ref.\n   */\n  static fromDataUri(filename, dataUri) {\n    let parsed = parseDataUri(dataUri)\n    let buffer = binaryStringToArrayBuffer(parsed.binaryString)\n    return priv(FileRef, {\n      file: bufferToFile(buffer, filename, parsed.mimeType),\n    })\n  }\n\n  /**\n   * Creates a new file reference from a binary string, mime type, and a filename.\n   *\n   * @param {string} filename - The filename to be used to the file.\n   * @param {string} mimeType - The mime type of the file.\n   * @param {string} binaryString - File contents as a binary string.\n   * @returns {FileRef} - A new file ref.\n   */\n  static fromBinaryString(filename, mimeType, binaryString) {\n    let buffer = binaryStringToArrayBuffer(binaryString)\n    return priv(FileRef, {\n      file: bufferToFile(buffer, filename, mimeType),\n    })\n  }\n\n  constructor(priv, config, dataChannelFactory, peerId) {\n    super()\n    assertPriv('FileRef', priv)\n\n    if (peerId) {\n      this._id = config.id\n      this._file = null\n      this._name = config.name\n      this._size = config.size\n      this._type = config.type\n      this._download = null\n      this._downloadPromise = null\n      this._transfers = []\n      this._progress = 0\n      this._peerId = peerId\n      this._dataChannelFactory = dataChannelFactory\n    } else {\n      this._id = randomString(16)\n      this._file = config.file\n      this._name = config.file.name\n      this._size = config.file.size\n      this._type = config.file.type\n      this._transfers = []\n      this._progress = 1\n      this._peerId = null\n\n      FileRef._localFileRefs[this._id] = this\n    }\n  }\n\n  toString() {\n    return `fileRef{id=${this._id},name=${this._name},size=${this._size},type=${this._type},peerId=${this._peerId}}`\n  }\n\n  /**\n   * The referenced file, or null if it isn't available locally.\n   *\n   * @readonly\n   * @member {external:File} FileRef#file\n   */\n  get file() {\n    return this._file\n  }\n\n  /**\n   * The name of the file.\n   *\n   * @readonly\n   * @member {string} FileRef#name\n   */\n  get name() {\n    return this._name\n  }\n\n  get peer() {\n    log.warning('deprecated', 'FileRef.peer is deprecated, use FileTransfer.peerId instead')\n    return this._peerId || null\n  }\n\n  /**\n   * The id of the peer that shared the file, or null if the file is local.\n   *\n   * @readonly\n   * @member {string?} FileRef#peerId\n   */\n  get peerId() {\n    return this._peerId || null\n  }\n\n  /**\n   * The size of the file in bytes.\n   *\n   * @readonly\n   * @member {number} FileRef#size\n   */\n  get size() {\n    return this._size\n  }\n\n  /**\n   * The mime type of the file.\n   *\n   * @readonly\n   * @member {string} FileRef#type\n   */\n  get type() {\n    return this._type\n  }\n\n  /**\n   * A list of ongoing transfers of the file to other peers.\n   *\n   * @readonly\n   * @member {FileTransfer[]} FileRef#transfers\n   */\n  get transfers() {\n    return this._transfers\n  }\n\n  /**\n   * True if the file reference points to a local file, false otherwise.\n   *\n   * @readonly\n   * @member {boolean} FileRef#isLocal\n   */\n  get isLocal() {\n    return !!this._file\n  }\n\n  /**\n   * The progress of the file download in the range [0, 1].\n   *\n   * Will always be 1 for local files.\n   *\n   * @readonly\n   * @member {number} FileRef#progress\n   */\n  get progress() {\n    return this._progress\n  }\n\n  /**\n   * Downloads the file from a remote peer. If the file has already been downloaded\n   * or the reference points to a local file, the returned promise will be immediately resolved.\n   *\n   * Calling this method multiple times will not cause multiple downloads, subsequent call will\n   * return the same promise. The exception to that rule is if the previous download failed, in\n   * that case a new download will be started.\n   *\n   * This method of downloading the file will cause the entire file to be stored in memory, so it\n   * can only be used with files that are a couple of hundred MB in size. For large files, use\n   * {@link FileRef#stream} instead.\n   *\n   * @name FileRef#fetch\n   * @function\n   * @returns {Promise<external:File>} - A promise for the file.\n   */\n  fetch() {\n    if (this._file) {\n      return Promise.resolve(this._file)\n    }\n    if (!this._downloadPromise) {\n      let chunks = []\n      this._download = this.stream()\n      this._download.on('chunk', chunk => chunks.push(chunk))\n      this._download.on('progress', _progress => {\n        this._progress = _progress\n        this._emit('progress', this._progress)\n      })\n      this._downloadPromise = this._download.promise.then(() => {\n        this._file = new Blob(chunks, {type: this._type})\n        this._file.name = name\n        this._file.lastModifiedDate = new Date()\n        this._emit('load', this._file)\n        this._emit('end', 'done')\n        return this._file\n      }, error => {\n        this._emit('error', error)\n        if (error.name === 'TransferInterruptedError' && error.reason === 'aborted') {\n          this._emit('end', 'aborted')\n        } else {\n          this._emit('end', 'error')\n        }\n        this._progress = 0\n        this._emit('progress', 0)\n        throw error\n      })\n    }\n    return this._downloadPromise\n  }\n\n  /**\n   * Downloads the file from a remote peer. As opposed to {@link FileRef#fetch}, this method\n   * returns a {@link FileDownload} instance. It is also disconnected from the {@link FileRef} instance,\n   * and has it's own progress tracking.\n   *\n   * This method allows much larger files to be transferred compared to {@link FileRef#fetch},\n   * since the entire file doesn't need to be loaded into memory at once.\n   *\n   * Each call to this method will start a new separate download.\n   *\n   * @returns {FileDownload} - A newly created {@link FileDownload} instance.\n   */\n  stream() {\n    if (!this._peerId) {\n      throw new TypeError('Only remote files can be streamed.')\n    }\n    let channel = this._dataChannelFactory({\n      label: this._id,\n      protocol: 'cct.data.file.v1',\n    })\n    log.debug(TAG, `created download channel: ${channel}`)\n    return FileDownload.stream({channel, size: this._size})\n  }\n\n  /**\n   * Aborts any ongoing file download. Has no effect if the file download\n   * is complete or hasn't started.\n   *\n   * @name FileRef#abort\n   * @function\n   * @returns {boolean} - True if a download was aborted, false otherwise.\n   */\n  abort() {\n    if (this._download) {\n      return this._download.abort()\n    } else {\n      return false\n    }\n  }\n\n  toJSON() {\n    if (!this._file) {\n      throw new TypeError('Tried to serialize remote FileRef')\n    }\n    return {\n      __cct_type__: 'file',\n      id: this._id,\n      name: this._name,\n      size: this._size,\n      type: this._type,\n    }\n  }\n\n  _startTransfer(channel, peer) {\n    log.info(TAG, `starting transfer to ${peer} via ${channel}`)\n\n    let transfer = priv(FileTransfer, channel, peer, this._file, () => {\n      let index = this._transfers.indexOf(transfer)\n      if (index !== -1) {\n        this._transfers.splice(index, 1)\n      }\n      this._emit('transfers', this._transfers)\n    })\n    let executePromise = transfer._execute()\n    this._transfers.push(transfer)\n    this._emit('transfer', transfer)\n    this._emit('transfers', this._transfers)\n    return executePromise\n  }\n}\n\nhiddenProp(FileRef, '_localFileRefs', {})\n\n/**\n * A utility to split a file into chunks. The main purpose is to always be one read ahead\n * of the consumer, to speed up the transfer process. Reading a chunk can take 40ms or more,\n * which could be enough time to empty the send buffer on a quick network.\n *\n * @class FileChunker\n * @private\n */\nclass FileChunker {\n  constructor(file) {\n    this._file = file\n    this._chunkStart = 0\n    this.totalBytes = file.size\n    this.chunkCount = Math.ceil(this.totalBytes / FILE_TRANSFER_CHUNK_SIZE)\n\n    this._read()\n  }\n\n  _read() {\n    if (this._chunkStart >= this.totalBytes) {\n      this._nextChunk = Promise.resolve(null)\n      return\n    }\n\n    let chunkStart = this._chunkStart\n    let chunkEnd = this._chunkStart + FILE_TRANSFER_CHUNK_SIZE\n    let chunk = this._file.slice(chunkStart, chunkEnd)\n    this._chunkStart = chunkEnd\n\n    this._nextChunk = blobToArrayBuffer(chunk).then(chunkBuffer => {\n      return arrayBufferSha1IfSupported(chunkBuffer).then(sha1 => {\n        let {byteLength} = chunkBuffer\n        return {chunkBuffer, byteLength, sha1}\n      })\n    })\n  }\n\n  next() {\n    let nextChunk = this._nextChunk\n    this._read()\n    return nextChunk\n  }\n\n  cleanup() {\n    this._file = null\n    this._nextChunk = null\n  }\n}\n\n/**\n * Represents the transfer of a local file to a remote peer.\n *\n * @abstract\n * @class FileTransfer\n */\nexport class FileTransfer extends EmitterMixin {\n  /**\n   * A low-level API for sending a file over a data channel to be received by a {@link FileDownload}.\n   *\n   * As soon as this method is called and the channel has been opened, the file transfer will begin, which\n   * means that a {@link FileDownload} must be ready to receive the file at that time.\n   *\n   * @private\n   * @param {File|Blob} file - The file to be sent.\n   * @param {DataChannel} channel - The data channel to send the file through.\n   * @returns {Promise} - A promise that is resolved when the transfer is complete, or is rejected\n   *   with a data channel error.\n   */\n  static transferFileInChannel(file, channel) {\n    argCheck.object('FileTransfer.transferFileInChannel', 'file', file)\n    argCheck.object('FileTransfer.transferFileInChannel', 'channel', channel)\n    let transfer = priv(FileTransfer, channel, null, file)\n    return transfer._execute()\n  }\n\n  /**\n   * Emitted when the file transfer is completed successfully.\n   *\n   * @event FileTransfer#done\n   */\n\n  /**\n   * Emitted when the file transfer fails.\n   *\n   * @event FileTransfer#error\n   * @oaram {Error} error - The error that caused the transfer to fail.\n   */\n\n  /**\n   * Emitted when the file transfer ends, both on success and failure.\n   *\n   * @event FileTransfer#end\n   * @param {'done'|'error'|'aborted'} reason - A string identifying the reason the transfer ended.\n   */\n\n  /**\n   * Emitted when the file transfer is completed successfully.\n   *\n   * @event FileTransfer#done\n   */\n\n  /**\n   * Emitted each time the progress of the file transfer changes.\n   *\n   * @event FileTransfer#progress\n   */\n\n  constructor(priv, channel, peer, file, onEnded) {\n    super()\n    assertPriv('FileTransfer', priv)\n    this._channel = channel\n    this._peer = peer\n    this._chunker = new FileChunker(file)\n    this._onEnded = onEnded\n\n    this._done = false\n    this._ended = false\n    this._error = null\n    this._progress = 0\n  }\n\n  /**\n   * Aborts the file transfer, if it is still ongoing.\n   *\n   * @function FileTransfer#abort\n   */\n  abort() {\n    this._end('aborted')\n  }\n\n  get peer() {\n    log.warning('deprecated', 'FileTransfer.peer is deprecated, use FileTransfer.peerId instead')\n    return this._peer\n  }\n\n  /**\n   * The id of the remote peer that the file is being transferred to.\n   *\n   * @readonly\n   * @member {string} FileTransfer#peer\n   */\n  get peerId() {\n    return this._peer.id\n  }\n\n  /**\n   * The progress of the file transfer, in the range [0, 1].\n   *\n   * @readonly\n   * @member {number} FileTransfer#progress\n   */\n  get progress() {\n    return this._progress\n  }\n\n  /**\n   * The error that ended the file transfer, or null\n   * if the transfer hasn't ended with an error.\n   *\n   * @readonly\n   * @member {Error} FileTransfer#error\n   */\n  get error() {\n    return this._error\n  }\n\n  _end(reason) {\n    if (!this._ended) {\n      this._ended = true\n      this._onEnded && this._onEnded()\n      this._emit('end', reason)\n      this._chunker.cleanup()\n      this._chunker = null\n    }\n  }\n\n  _execute() {\n    return this._channel.sendWithGenerator(function * () {\n      // For tracking progress\n      let sentBytes = 0\n      let totalBytes = this._chunker.totalBytes\n\n      let chunkSha1s = []\n\n      for (;;) {\n        let nextChunk = yield this._chunker.next()\n        if (!nextChunk) {\n          break\n        }\n        let {chunkBuffer, byteLength, sha1} = nextChunk\n        if (sha1) {\n          chunkSha1s.push(sha1)\n          sha1 = bufferToHex(sha1)\n        }\n        let bufferView = new window.Uint8Array(chunkBuffer)\n\n        let chunkSpec = {type: 'chunk', byteLength, sha1}\n        log.verbose(TAG, `file transfer sent chunk spec: ${chunkSpec}`)\n        yield chunkSpec\n\n        let offset = 0\n        while (offset < byteLength) {\n          let slice = bufferView.subarray(offset, offset + FILE_TRANSFER_SLICE_SIZE)\n          yield slice\n          offset += slice.byteLength\n\n          sentBytes += slice.byteLength\n          this._progress = sentBytes / totalBytes\n          this._emit('progress', this._progress)\n        }\n      }\n\n      let sha1 = null\n      if (chunkSha1s.length) {\n        let sha1SumBuffer = concatenateArrayBuffers(chunkSha1s)\n        sha1 = yield arrayBufferSha1IfSupported(sha1SumBuffer).then(bufferToHex)\n      }\n      let fileSpec = {\n        type: 'file',\n        chunkCount: this._chunker.chunkCount,\n        byteLength: totalBytes,\n        sha1,\n      }\n      yield fileSpec\n    }.bind(this), {timeoutMs: FILE_TRANSFER_TIMEOUT_MS}).then(() => {\n      this._emit('done')\n      this._end('done')\n    }, error => {\n      this._error = error\n      this._emit('error', error)\n      this._end('error')\n      throw error\n    })\n  }\n}\n\n/**\n * Represents the download of a single file from a remote peer.\n *\n * The download will emit `'chunk'` events for every chunk of the file that is\n * downloaded. The size of each chunk is 4MiB, unless it's the last chunk, which\n * may be smaller.\n *\n * To reconstruct the file, all chunks should be concatenated in the order they are emitted.\n *\n * The chunks are not stored internally, so if the `'chunk'` events are not captured, the\n * chunks will be lost.\n *\n * The {@link FileDownload#promise} property exposes a promise that will be resolved\n * when the download is complete, i.e. the last chunk has been received. If the download\n * is interrupted, aborted, or corrupt, the promise will be rejected.\n *\n * @class FileDownload\n * @abstract\n */\nexport class FileDownload extends EmitterMixin(null) {\n  /**\n   * Emitted when the progress of the download is updated.\n   *\n   * @event FileDownload#progress\n   * @param {number} progress - The progress in the range [0, 1].\n   */\n\n  /**\n   * Emitted when a full chunk of the file has been downloaded and verified.\n   *\n   * @event FileDownload#chunk\n   * @param {ArrayBuffer} chunk - The chunk of the file.\n   */\n\n  /**\n   * A low-level API for downloading files that are being sent using a {@link FileTransfer}.\n   *\n   * This expects that the next messages emitted from the channel are the ones sent by a transfer,\n   * which means that this should usually by used just after creating a channel, or after some other\n   * signaling mechanism has completed.\n   *\n   * @private\n   * @param {Options} options - Options object.\n   * @param {DataChannel} options.channel - The channel from which the file is downloaded.\n   * @param {number} [options.size=-1] - The expected size of the file in bytes, used to keep track of progress.\n   *   The download will stop just because the given number of bytes has been downloaded.\n   * @param {string} [options.mimeType] - The mime type of the file, will be used as\n   *   the type of the blob if given.\n   * @param {boolean} [options.leaveChannelOpen=false] - Whether to leave the channel\n   *   open after the download is complete.\n   * @returns {FileDownload} A newly created file download instance.\n   */\n  static stream(options) {\n    argCheck.options('FileDownload.fetch', 'options', options)\n      .object('channel')\n      .optNumber('size')\n      .optBoolean('leaveChannelOpen')\n    let download = new FileDownload(options)\n    download._execute()\n    return download\n  }\n\n  /**\n   * This is a higher-level version of {@link FileDownload.stream}, which merges together the downloaded\n   * chunks into a {@link external:Blob}. This method does not expose the download instance\n   * so it is not possible to keep track of the progress.\n   *\n   * @private\n   * @param {Options} options - Options object.\n   * @param {DataChannel} options.channel - The channel from which the file is downloaded.\n   * @param {string} [options.mimeType] - The mime type of the file, will be used as\n   *   the type of the blob if given.\n   * @param {boolean} [options.leaveChannelOpen=false] - Whether to leave the channel\n   *   open after the download is complete.\n   * @returns {Promise<external:Blob>} A promise that resolves to a blob of the downloaded file, or\n   *   may be rejected for the same reasons as {@link FileDownload#promise}.\n   */\n  static fetch(options) {\n    argCheck.options('FileDownload.fetch', 'options', options)\n      .object('channel')\n      .optString('mimeType')\n      .optBoolean('leaveChannelOpen')\n\n    let {channel, leaveChannelOpen, mimeType} = options\n    let download = new FileDownload({channel, leaveChannelOpen})\n    let chunks = []\n    download.on('chunk', chunk => chunks.push(chunk))\n    return download._execute().then(() => {\n      let blob = new Blob(chunks, {type: mimeType})\n      chunks.length = 0\n      return blob\n    })\n  }\n\n  constructor({channel, size = -1, leaveChannelOpen = false}) {\n    super()\n    this._size = size\n    this._channel = channel\n    this._leaveChannelOpen = leaveChannelOpen\n    this._state = null\n    this._downloaded = 0\n    this._chunkCount = 0\n    this._chunkProcessQueue = new AsyncQueue()\n    this._chunkSha1s = []\n    this._deferred = defer()\n  }\n\n  /**\n   * The progress of the file download, in the range [0, 1].\n   *\n   * @readonly\n   * @member {number} FileDownload#progress\n   */\n  get progress() {\n    return this._downloaded / this._size\n  }\n\n  /**\n   * A promise that will be resolved when the download is complete, i.e. the last chunk\n   * has been received.\n   *\n   * If the download is aborted, the promise will be rejected with a {@link TransferInterruptedError}\n   * with `reason` set to 'aborted'.\n   *\n   * If the download failes because the connection failed, the promise will be rejected with a\n   * {@link TransferInterruptedError} with `reason` set to 'closed'.\n   *\n   * If the file transfer either encounters a protocol error, or if the transmitted file was\n   * correupted, the promise will be rejected with a {@link FileTransferError}.\n   *\n   * @returns {Promise} A promise that is resolved or rejected when the transfer ends.\n   */\n  get promise() {\n    return this._deferred.promise\n  }\n\n  /**\n   * Aborts the file download. This will cause {@link FileDownload#promise} to be rejected with\n   * a {@link TransferInterruptedError} with `reason` set to 'aborted'.\n   *\n   * @returns {boolean} - True if the download was aborted, or false if it was already finished.\n   */\n  abort() {\n    if (this._state !== 'downloading') {\n      return false\n    }\n    this._end('aborted', new TransferInterruptedError('aborted', this._downloaded, this._size))\n    return true\n  }\n\n  _execute() {\n    if (this._state !== null) {\n      throw new Error(`tried to execute file download at invalid state: ${this._state}`)\n    }\n    this._state = 'downloading'\n\n    this._channel.receiveWithGenerator(function * () {\n      for (;;) {\n        let spec = yield\n        log.verbose(TAG, `file download got spec: ${spec}`)\n        if (spec.type === 'chunk') {\n          let {byteLength} = spec\n\n          let chunk = new Uint8Array(byteLength)\n          let offset = 0\n          while (offset < byteLength) {\n            let slice = new Uint8Array(yield)\n            chunk.set(slice, offset)\n            offset += slice.byteLength\n\n            this._downloaded += slice.byteLength\n            if (this._size >= 0) {\n              this._emit('progress', this._downloaded / this._size)\n            }\n          }\n\n          this._emitChunk(chunk, spec)\n        } else if (spec.type === 'file') {\n          this._finish(spec)\n        } else {\n          throw new FileTransferError(`Unexpected message '${spec}', expected spec`)\n        }\n      }\n    }.bind(this), {timeoutMs: FILE_TRANSFER_TIMEOUT_MS}).catch(error => {\n      if (this._state === 'downloading') {\n        if (error.name === 'ChannelClosedError') {\n          this._end('error', new TransferInterruptedError('closed', this._downloaded, this._size))\n        } else {\n          this._end('error', error)\n        }\n      }\n    })\n\n    return this._deferred.promise\n  }\n\n  _emitChunk(chunk, chunkSpec) {\n    if (this._state !== 'downloading') {\n      return\n    }\n    let {sha1, byteLength} = chunkSpec\n    if (chunk.byteLength !== byteLength) {\n      let msg = `Chunk size ${chunk.byteLength} does not match the expected size ${byteLength}`\n      this._end('error', new FileTransferError(msg))\n      return\n    }\n\n    this._chunkProcessQueue.push(() => arrayBufferSha1IfSupported(chunk).then(actualSha1 => {\n      if (this._state !== 'downloading') {\n        return\n      }\n\n      if (sha1 && actualSha1) {\n        if (bufferToHex(actualSha1) === sha1) {\n          this._chunkSha1s.push(actualSha1)\n        } else {\n          this._end('error', new FileTransferError(`Chunk checksums don't match, ${sha1} != ${actualSha1}`))\n          return\n        }\n      }\n      this._chunkCount += 1\n      this._emit('chunk', chunk.buffer)\n    })).catch(error => {\n      log.error(TAG, `Error processing chunk: ${error}`)\n    })\n  }\n\n  _finish(fileSpec) {\n    if (this._state !== 'downloading') {\n      return\n    }\n    let {sha1, byteLength, chunkCount} = fileSpec\n\n    if (this._downloaded !== byteLength) {\n      let msg = `File size ${this._downloaded} does not match the expected size ${byteLength}`\n      this._end('error', new FileTransferError(msg))\n      return\n    }\n\n    this._chunkProcessQueue.push(() => {\n      if (this._chunkSha1s.length) {\n        let sha1SumBuffer = concatenateArrayBuffers(this._chunkSha1s)\n        return arrayBufferSha1IfSupported(sha1SumBuffer)\n      } else {\n        return Promise.resolve()\n      }\n    }).then(actualSha1 => {\n      if (this._state !== 'downloading') {\n        return\n      }\n\n      if (this._chunkCount !== chunkCount) {\n        let msg = `File chunk count ${this._chunkCount} does not match the expected ${chunkCount}`\n        this._end('error', new FileTransferError(msg))\n        return\n      }\n\n      if (sha1 && actualSha1) {\n        if (bufferToHex(actualSha1) !== sha1) {\n          this._end('error', new FileTransferError(`File checksums don't match, ${sha1} != ${actualSha1}`))\n          return\n        }\n      }\n      this._end('done')\n    }).catch(error => {\n      log.error(TAG, `Error processing file: ${error}`)\n    })\n  }\n\n  _end(state, error = null) {\n    if (error) {\n      this._chunkCount = 0\n      this._downloaded = 0\n      this._emit('progress', 0)\n      this._deferred.reject(error)\n    } else {\n      this._deferred.resolve()\n    }\n\n    this._state = state\n    this._error = error\n    this._clearListeners()\n    if (!this._leaveChannelOpen) {\n      this._channel.close()\n      this._channel = null\n    }\n    this._chunkProcessQueue.clear()\n    this._chunkProcessQueue = null\n    this._chunkSha1s = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/fileRef.js","'use strict'\n\n// This module contains the main datamux implementation,\n// which ties together the other utilities.\n// It is the only internal API that is exposed to the\n// rest of the library.\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {\n  urlSafeBase64ToUtf8,\n  utf8ToUrlSafeBase64,\n} from 'common/utils'\n\nimport ChannelDriver from 'datamux/channelDriver'\nimport ChannelController from 'datamux/channelController'\nimport MuxChannelRegistry from 'datamux/registry'\nimport MuxedDataChannel from 'datamux/channel'\nimport ActivityTracker from 'datamux/activityTracker'\nimport {BandwidthEstimator} from 'datamux/bandwidthEstimation'\nimport {PrioritizedBuffer} from 'datamux/buffers'\nimport {\n  TransferItem,\n  TransferReceiver,\n  createTransferHeader,\n} from 'datamux/transfer'\nimport {\n  MT_OPEN,\n  MT_OPEN_ACK,\n  MT_DECLARE,\n  MT_CLOSE,\n  MT_CLEAR,\n  MT_DATA,\n  MT_TRANSFER_HEADER,\n  M_SEP,\n  ID_BASE,\n} from 'datamux/constants'\n\nconst isWebRtcPlugin = process.env.NODEJS ? false : require('webrtc/utils').isWebRtcPlugin\n\nconst TAG = 'datamux'\n\n/*\nData channels in WebRTC have a number of problems that make them difficult to use:\n\n- Only supported message types are strings and arraybuffers, which means that\n    applications need to handle serialization and type conversions.\n- They have somewhat arbitrary limits on message size, which varies depending\n    on the browsers involved. Large messages will be divided automatically, but there is\n    no obvious way for the sender or the receiver to detect that a message has been split.\n- If the application tries to send too much data too quickly the channel will\n    be closed, and the method of sending data at the correct pace varies\n    between WebRTC implementations.\n- Between Chrome and Firefox opening new data channel breaks after the first\n    renegotiation, so all channels have to be opened at the start of a connection.\n- Channels will silently stop working if data is not sent at regular intervals,\n    forcing the application to have heartbeats going in both directions.\n\nAll of these issues is too much complexity to leave to application developers, so\nwe provide an abstraction that aims to solve all of the above issues. The biggest\ndownside of this abstraction apart from the internal complexity it adds, is that we\nwill only support messaging in reliable and ordered mode.\n\nThe abstraction should provide the following:\n  - All channels opened at connection time, one main channel and a number or transfer channels.\n  - Transfer channels are used to transfer large (> 4096 byte) objects.\n  - Latency of small messages need to be kept low by separating them from large transfers.\n  - Large messages are transparently broken down and reconstructed.\n  - Support for sending object as JSON with support for serialization of some data types.\n  - Should at least support serialization of ArrayBuffers, typed arrays, Blobs.\n  - Message sending is throttled to maximize throughput without disconnecting channels.\n  - Application needs to be aware of the throttling to avoid back pressure.\n  - Replacing the RTCPeerConnection should result in a channel disconnect and reconnect.\n  - Channels are kept alive with heartbeats.\n  - Channel RTT is measured as part of the heartbeats.\n  - The API should be similar to the existing data channel API, but with the above features.\n\nHere's a diagram of the internal API design:\n\n    DataChannelMultiplexer ---> N x MuxedDataChannel\n      1 x |     1 x |\n          |         v\n          |   PriorityChannelSender // main channel sender\n          |     1 x |\n          |         v\n          |   RTCDataChannel // main channel\n          v\n    TransferChannelController ---> N x TransferItem, N x TransferAssembler\n      N x |\n          v\n    PriorityChannelSender // transfer channel senders\n      1 x |\n          v\n    RTCDataChannel // transfer channels\n\nThe DataChannelMultiplexer is responsible for the main channel messaging protocol\nand message serialization. It will split out large chunks of data and hand them\noff to the transfer manager.\n\nMuxedDataChannel is the public API to be used by the application. They work a lot\nlike normal WebRTC DataChannels, but with the improvements mentioned above.\n\nThe TransferChannelController is responsible for the transfer message protocol, but\nnot the data serialization.\n\nTransferItem and TransferAssembler are responsible for serializing and deserializing\ntransfers.\n\nPriorityChannelSender makes sure data is not sent too quickly, but also makes it\npossible to manage back-pressure to avoid large send queues and delays.\n\nRTCDataChannel are the regular built-in WebRTC DataChannels. They are set up at\nconnection time using pre-negotiated ids and always run in reliable and ordered mode.\n\nPausing:\n\nThe concept of pausing the datamux had to be added because of how the\nconference API works. A connection to a peer in a conference may be\nin the state where the connection is up, but the peer or oneself is\nnot a member of the raft configuration. We refer to that state as paused,\nsince we want to keep the connection around and resume it once we're both\na member of the raft configuration.\n\nIn the paused state, the RtcComponent API will report the peer as\ndisconnected, and it should not be possible to open channels to that peer.\nFurthermore, any channels that have been opened and messages that have\nbeen sent should all be cleared. Although we still want to keep the builtin\nchannels around.\n\nWe make one important assumption from the conference/raft abstraction layer\nin our implementation: pauses are always symmetrical, i.e. if we are\npaused, the peer will also be paused once, or we are disconnected.\n\nWith the above assumption the signaling becomes significantly simpler,\nsince it's enough that we close our own channels, and then send information\nabout what channels we closed to the peer.\n\nWe signal the channels we close by sending the next ID in our channel id\ncounter. Any channels below that ID are the ones we closed, except for\nbuiltin ones. The peer sets this as the new minimum channel ID, and if\nany messages are received for channels lower than that ID, they are ignored.\n\nClosing namespace:\n\nBeing able to close all channels in a channel had to be added because it's possible\nto detach an RtcComponent, which should lead to the channels being closed on both ends.\n\nWhen closing a namespace, all channels and pairing infos are removed and moved\nto the close state. This is only done locally, which means that the signaling in the\nattachment manager is relied upon for making sure the same channels are closed on the\nremote side.\n\nRemoving transfer channels:\n\nEarlier implementations used transfer channels for transmitting large chunks of data.\nIt was also possible to have multiple transfer channels, with the transfers spread\nout across them. However, testing showed that the fewer channels you use, the more\nreliable the connection will be. The most critical issue is that sent data is not\nproperly distributed across all channels. One channel would frequently be the only one\ntransmitting data, while the other ones waited, breaking pinging on the other channels.\nThis was especially frequent on low-throughput networks.\n\nThe pros of using transfer channels apart from hoping to be able to maintain a higher\nthroughput, was that the send queue implementation and protocol was simpler. Now we have\nto keep track of individual data chunks, since they will be interleaved with smaller messages.\n\n*/\n\n// Maximum size for high-priority messages. If they are\n// largeer they will be put in the low-priority queue.\nconst HIGH_PRIORITY_MTU = 4096\n\nconst CONNECT_TIMEOUT_MS = 10000\n\nconst CHANNEL_BASE_ID = 20 // The negotiated RtcDataChannel id\n\nconst TRANSFER_PLACEHOLDER_PREFIX = '__c3_t'\n\nconst STATE_CONNECTED = 'connected'\nconst STATE_CONNECTING = 'connecting'\nconst STATE_DISCONNECTED = 'disconnected'\n\nexport default class DataChannelMultiplexer {\n  constructor(options = {}) {\n    let {\n      onChannel,\n      onConnect,\n      onDisconnect,\n      onRttChange,\n      onUpStateChange,\n      targetKbps,\n      transferEncoding,\n      disablePinging = false,\n      connectTimeoutMs = CONNECT_TIMEOUT_MS,\n    } = options\n\n    this._onMessage = this._onMessage.bind(this)\n    this._onConnectTimeout = this._onConnectTimeout.bind(this)\n\n    this._onChannel = onChannel\n    this._onConnectCallback = onConnect\n    this._onDisconnectCallback = onDisconnect\n    this._onRttChangeCallback = onRttChange\n    this._onUpStateChangeCallback = onUpStateChange\n\n    this._channel = null\n    this._transferReceiver = new TransferReceiver()\n    this._transferIdCounter = 1\n    this._connectionState = STATE_DISCONNECTED\n    this._connectTimeoutId = null\n    this._disablePinging = disablePinging\n    this._onConnectTimeoutMs = connectTimeoutMs\n\n    if (!transferEncoding) {\n      if (isWebRtcPlugin) {\n        transferEncoding = 'base64'\n      } else {\n        transferEncoding = 'binary'\n      }\n    }\n\n    if (!targetKbps) {\n      if (isWebRtcPlugin) {\n        targetKbps = 400\n      } else {\n        targetKbps = Infinity\n      }\n    }\n\n    this._activityTracker = new ActivityTracker()\n    this._sendBuffer = new PrioritizedBuffer()\n    this._channelController = new ChannelController({\n      buffer: this._sendBuffer,\n      channelDriver: new ChannelDriver(),\n      activityTracker: this._activityTracker,\n      bandwidthEstimator: new BandwidthEstimator({\n        initialTargetKbps: targetKbps,\n      }),\n      transferEncoding: transferEncoding,\n    })\n\n    // This is used to figure out if Temasys are randomly\n    // sending us old events or not.\n    // It is incremented when removing listeners, and then we\n    // only handle events that match the current epoch.\n    this._eventEpoch = 1\n\n    this._channelRegistry = new MuxChannelRegistry()\n    // These are channels that we have received an open message for while\n    // we were paused, so we wait for a resume before we open them.\n    this._pendingRemoteChannels = new Map()\n\n    // Builtin channels can only be created synchronously after instantiation\n    // and before other channel types\n    this._builtinsLocked = false\n    Promise.reject().catch(() => {\n      this._builtinsLocked = true\n    })\n  }\n\n  get up() {\n    return this._activityTracker.active\n  }\n\n  get rttMs() {\n    return this._channelController.rttMs\n  }\n\n  createDataChannels(dataChannelFactory) {\n    this.reset()\n    this._builtinsLocked = true\n    this._connectionState = STATE_CONNECTING\n\n    log.info(TAG, this, 'creating RTCDataChannels')\n\n    this._channel = dataChannelFactory('datamux', {\n      ordered: true,\n      reliable: true,\n      negotiated: true,\n      protocol: 'c3.datamux',\n      id: CHANNEL_BASE_ID,\n    })\n\n    // binaryType must be set early for mocked channels\n    this._channel.binaryType = 'arraybuffer'\n    this._channel.onopen = this._onChannelOpened.bind(this, this._eventEpoch)\n    this._channel.onclose = this._onChannelClosed.bind(this, this._eventEpoch)\n    this._channel.onerror = this._onChannelError.bind(this, this._eventEpoch)\n\n    // Mainly for mocked tests, but who knows, maybe this can\n    // happen in the wild as well?\n    if (this._channel.readyState === 'open') {\n      this._onChannelOpened(this._eventEpoch)\n    }\n\n    this._connectTimeoutId = setTimeout(this._onConnectTimeout, this._onConnectTimeoutMs)\n  }\n\n  toString() {\n    return `channelMuxer{state=${this._connectionState},${this._channelController},${this._channelRegistry}}`\n  }\n\n  get connectionState() {\n    return this._connectionState\n  }\n\n  /**\n   * Pauses the datamux. This will close or disconnect all non-builtin\n   * mux channels and clear all send and receive buffers. It will not\n   * touch the underlying connection however, and the datamux may be\n   * resumed at a later time.\n   *\n   * The paused state takes presedence over the connected state, i.e. if the\n   * underlying connection is disconnected and a new one is opened, the datamux\n   * will still remain in paused state.\n   *\n   * @param {boolean} isPaused - Whether or not the datamux is paused.\n   */\n  setPausedState(isPaused) {\n    argCheck.boolean('datamux.setPausedState', 'isPaused', isPaused)\n    if (this._paused === isPaused) {\n      return\n    }\n    this._paused = isPaused\n\n    if (this._connectionState !== STATE_CONNECTED) {\n      return\n    }\n\n    log.info(TAG, this, isPaused ? 'paused' : 'resumed')\n\n    if (isPaused) {\n      let nextId = this._channelRegistry.clearAppConnections()\n      this._sendBuffer.pushMessage(MT_CLEAR + nextId)\n    } else {\n      this._pendingRemoteChannels.forEach((channel, remoteId) => {\n        this._openChannel(remoteId, channel)\n      })\n    }\n    this._pendingRemoteChannels.clear()\n  }\n\n  cleanup() {\n    this.reset()\n    this._channelRegistry.cleanup()\n    this._channelRegistry = null\n    this._pendingRemoteChannels = null\n    this._transferReceiver = null\n    this._activityTracker = null\n    this._channelController = null\n    this._sendBuffer = null\n  }\n\n  reset() {\n    if (this._connectTimeoutId) {\n      clearTimeout(this._connectTimeoutId)\n      this._connectTimeoutId = null\n    }\n    this._connectionState = STATE_DISCONNECTED\n    this._channelRegistry.clearConnections()\n    this._pendingRemoteChannels.clear()\n    this._transferReceiver.clear()\n    this._transferIdCounter = 1\n    if (this._channelController.running) {\n      this._channelController.stop()\n    }\n    if (this._activityTracker.running) {\n      this._activityTracker.stop()\n    }\n    this._eventEpoch += 1\n\n    if (this._channel) {\n      this._channel.onopen = null\n      this._channel.onclose = null\n      this._channel.onerror = null\n      try {\n        let {readyState} = this._channel\n        if (readyState !== 'closed' && readyState !== 'closing') {\n          this._channel.close()\n        }\n      } catch (error) {\n        log.warning(TAG, `failed to close channel, ${error}`)\n      }\n      this._channel = null\n    }\n  }\n\n  _onConnected() {\n    this._connectionState = STATE_CONNECTED\n\n    clearTimeout(this._connectTimeoutId)\n    this._connectTimeoutId = null\n\n    log.info(TAG, this, 'connected')\n    this._channelController.start({\n      channel: this._channel,\n      onMessage: this._onMessage,\n      onRttChange: this._onRttChangeCallback,\n      disablePinging: this._disablePinging,\n    })\n    this._activityTracker.start({\n      onActiveStateChange: this._onUpStateChangeCallback,\n      onDisconnect: () => this._onChannelTimeout(this._channel),\n    })\n    this._transferReceiver.clear()\n    this._transferIdCounter = 1\n\n    this._channelRegistry.connectBuiltins()\n    this._channelRegistry.forEachLocalChannel(channel => {\n      let initMessage = this._createChannelInitMessage(channel)\n      this._sendBuffer.pushMessage(initMessage)\n      log.debug(TAG, this, `sent init message, ${initMessage}`)\n    })\n\n    this._onConnectCallback && this._onConnectCallback()\n  }\n\n  _onDisconnected(reason) {\n    log.debug(TAG, this, `disconnected because of ${reason}`)\n    let alreadyDisconnected = this._connectionState === STATE_DISCONNECTED\n    this.reset()\n    if (!alreadyDisconnected) {\n      this._onDisconnectCallback && this._onDisconnectCallback(reason)\n    }\n  }\n\n  _onChannelOpened(epoch) {\n    if (epoch !== this._eventEpoch) {\n      return\n    }\n    log.info(TAG, this, `channel '${this._channel.label}' opened`)\n    this._onConnected()\n  }\n\n  _onChannelClosed(epoch) {\n    if (epoch !== this._eventEpoch) {\n      return\n    }\n    log.info(TAG, this, `channel '${this._channel.label}' closed`)\n    this._onDisconnected('closed')\n  }\n\n  _onChannelTimeout() {\n    log.info(TAG, this, `channel '${this._channel.label}' communication timed out`)\n    this._onDisconnected('channelTimeout')\n  }\n\n  _onChannelError(epoch, error) {\n    if (epoch !== this._eventEpoch) {\n      return\n    }\n    log.error(TAG, this, `channel '${this._channel.label}' received error, ${error}`)\n    this._onDisconnected('channelError')\n  }\n\n  _onConnectTimeout() {\n    log.info(TAG, this, 'timeout out while trying to connect channels')\n    this._onDisconnected('connectTimeout')\n  }\n\n  createChannel(config) {\n    argCheck.options('DataChannel constructor', 'config', config)\n      .string('label')\n      .optString('protocol')\n      .optString('namespaceId')\n      .optString('pairingId')\n      .optBoolean('builtin')\n\n    if (this._paused) {\n      throw new Error('may not create channels while connection is paused')\n    }\n\n    let {label, protocol, namespaceId, pairingId, builtin} = config\n    protocol = protocol || ''\n    namespaceId = namespaceId || ''\n\n    if (!builtin && this._connectionState !== STATE_CONNECTED) {\n      throw new Error('must be connected to create channels')\n    }\n\n    this._channelRegistry.validateConfig({label, protocol, namespaceId, pairingId, builtin})\n\n    let localId = this._channelRegistry.getNextId()\n    let channel = new MuxedDataChannel({\n      isLocal: true,\n      localId,\n      label,\n      protocol,\n      namespaceId,\n      pairingId,\n      builtin,\n      onMessage: this._forwardMuxChannelMessage.bind(this, localId),\n      onClose: this._onLocalMuxChannelClosed.bind(this, localId),\n    })\n    log.debug(TAG, this, `created ${builtin ? 'buildin ' : ''}channel ${channel}`)\n\n    if (builtin) {\n      if (this._builtinsLocked) {\n        throw new Error('builtin channels can only be created internally up instantiation')\n      }\n      this._channelRegistry.addBuiltin(channel)\n    } else {\n      this._builtinsLocked = true\n\n      this._channelRegistry.addLocal(channel)\n\n      if (this._connectionState === STATE_CONNECTED) {\n        let initMessage = this._createChannelInitMessage(channel)\n        this._sendBuffer.pushMessage(initMessage)\n        log.debug(TAG, this, `sent init message, ${initMessage}`)\n      }\n    }\n\n    return channel\n  }\n\n  closeChannelsInNamespace(namespaceId) {\n    this._channelRegistry.clearNamespace(namespaceId)\n  }\n\n  _createChannelInitMessage(channel) {\n    let messageType = MT_OPEN\n    let params = [channel._label, channel._protocol, channel._namespaceId]\n    if (channel._pairingId) {\n      messageType = MT_DECLARE\n      params.push(channel._pairingId)\n    }\n    let paramStr = params.map(param => utf8ToUrlSafeBase64(param)).join(M_SEP)\n    return messageType + channel._localId.toString(ID_BASE) + M_SEP + paramStr\n  }\n\n  // Returns [transferId, transferPromise] if the value had to be\n  // transferred, otherwise return undefined.\n  // Transfers are a more advanced way of sending data that doesn't\n  // fit into a message.\n  // When transferring a value, it's converted into a TransferItem,\n  // and the receiving end uses a TransferAssembler to reassemble\n  // the value.\n  _maybeTransferValue(value) {\n    if (!TransferItem.supportsType(value)) {\n      return\n    }\n\n    let transferId = this._transferIdCounter\n    this._transferIdCounter += 1\n\n    let transferPromise = TransferItem.createFromData(value).then(transferItem => {\n      let transferHeader = createTransferHeader({transferId, transferItem})\n\n      this._sendBuffer.pushTransfer(MT_TRANSFER_HEADER + transferHeader)\n      this._sendBuffer.pushTransfer(transferItem)\n\n      return transferItem.promise\n    })\n\n    return [transferId, transferPromise]\n  }\n\n  _forwardMuxChannelMessage(localId, message) {\n    if (this._connectionState !== STATE_CONNECTED) {\n      throw new Error('tried to forward message when datamux was not connected')\n    }\n\n    // Here we stringify the message and replace all binary values with transfer placeholders.\n    // The result will always be a JSON encoded string, so if we're sending a binary blob,\n    // we will get a JSON encoded placeholder string back, e.g. \"__c3_t5\", including quotes.\n    let transferPromises = []\n    let data = JSON.stringify(message, (key, value) => {\n      if (typeof(value) !== 'object' || value === null) {\n        return value\n      }\n      let transferResult = this._maybeTransferValue(value)\n      if (transferResult) {\n        let [transferId, transferPromise] = transferResult\n        transferPromises.push(transferPromise)\n        return TRANSFER_PLACEHOLDER_PREFIX + transferId.toString(ID_BASE)\n      } else {\n        return value\n      }\n    })\n\n    // If the resulting JSON encoded string is too long, we will send it as a transfer instead.\n    // The message will be replaced by a transfer placeholder string, this time without quotes.\n    if (data.length > HIGH_PRIORITY_MTU) {\n      let [transferId, transferPromise] = this._maybeTransferValue(data)\n      transferPromises.push(transferPromise)\n      data = TRANSFER_PLACEHOLDER_PREFIX + transferId.toString(ID_BASE)\n    }\n\n    this._sendBuffer.pushMessage(MT_DATA + localId.toString(ID_BASE) + M_SEP + data)\n    return Promise.all(transferPromises)\n  }\n\n  _onLocalMuxChannelClosed(localId, channel) {\n    this._channelRegistry.remove(channel)\n    if (this._connectionState === STATE_CONNECTED) {\n      this._sendBuffer.pushMessage(MT_CLOSE + localId.toString(ID_BASE))\n    }\n  }\n\n  _onMessage(data) {\n    if (typeof(data) !== 'string') {\n      return this._transferReceiver.handleBinaryData(data)\n    }\n\n    let messageType = data[0]\n    let message = data.slice(1)\n\n    // Handle message types without remote channel id prefix\n    switch (messageType) {\n      case MT_TRANSFER_HEADER:\n        return this._transferReceiver.setHeader(message)\n    }\n\n    // All other message types are prefixed with a remote channel id\n    let sepIndex = data.indexOf(M_SEP)\n    let channelIdStr = data.slice(1, sepIndex < 0 ? undefined : sepIndex)\n    let remoteId = parseInt(channelIdStr, ID_BASE)\n    let body = data.slice(sepIndex + M_SEP.length)\n\n    let isInteger = (remoteId | 0) === remoteId\n    let isPositive = Math.sign(remoteId) === 1\n    if (!isInteger || !isPositive) {\n      log.error(TAG, `received message with invalid channel id, '${channelIdStr}'`)\n      return\n    }\n\n    switch (messageType) {\n      case MT_DATA:\n        return this._handleDataMessage(remoteId, body)\n      case MT_OPEN:\n        return this._handleOpenMessage(remoteId, body)\n      case MT_OPEN_ACK:\n        return this._handleOpenAckMessage(remoteId, body)\n      case MT_CLOSE:\n        return this._handleCloseMessage(remoteId, body)\n      case MT_DECLARE:\n        return this._handleDeclareMessage(remoteId, body)\n      case MT_CLEAR:\n        return this._handleClearMessage(remoteId)\n      default:\n        log.warning(TAG, `received message with unknown type, '${messageType}'`)\n    }\n  }\n\n  _handleDataMessage(remoteId, data) {\n    log.verbose(TAG, this, `received data message with remote id ${remoteId}`)\n    let channel = this._channelRegistry.getByRemoteId(remoteId)\n    if (!channel) {\n      log.debug(TAG, `got message for unknown channel, ${remoteId}`)\n      return\n    }\n    if (this._paused && !channel._builtin) {\n      log.verbose(TAG, this, 'ignored data message for app channel while paused')\n      return\n    }\n\n    var messagePromise\n\n    // Check if we've received a plain transfer placeholder, i.e. a placeholder for the\n    // JSON encoded string of the message.\n    if (data.indexOf(TRANSFER_PLACEHOLDER_PREFIX) === 0) {\n      let transferId = parseInt(data.slice(TRANSFER_PLACEHOLDER_PREFIX.length), ID_BASE)\n      messagePromise = this._transferReceiver.awaitDownload(transferId).then(result => {\n        // Now that we have received the JSON message we can parse it as usual.\n        return this._parseDataMessageJson(result)\n      })\n    } else {\n      messagePromise = this._parseDataMessageJson(data)\n    }\n\n    channel._handleRecievedMessagePromise(messagePromise)\n  }\n\n  _parseDataMessageJson(data) {\n    // used to look up the transfer result in the array of promise results\n    let transferIndices = {}\n    let transferPromises = []\n    // Start off by deserializing and check if we encounter any transfer placeholders\n    let message = JSON.parse(data, (key, value) => {\n      if (typeof(value) === 'string' && value.indexOf(TRANSFER_PLACEHOLDER_PREFIX) === 0) {\n        let transferId = parseInt(value.slice(TRANSFER_PLACEHOLDER_PREFIX.length), ID_BASE)\n        let promise = this._transferReceiver.awaitDownload(transferId)\n        transferIndices[transferId] = transferPromises.length\n        transferPromises.push(promise)\n      } else {\n        return value\n      }\n    })\n\n    if (transferPromises.length === 0) {\n      return Promise.resolve(message) // skip second parse if we didn't have any transfers\n    } else {\n      return Promise.all(transferPromises).then(results => {\n        // Deserialize again, this time with synchronous access to all transfer results\n        return JSON.parse(data, (key, value) => {\n          if (typeof(value) === 'string' && value.indexOf(TRANSFER_PLACEHOLDER_PREFIX) === 0) {\n            let transferId = parseInt(value.slice(TRANSFER_PLACEHOLDER_PREFIX.length), ID_BASE)\n            let index = transferIndices[transferId]\n            return results[index]\n          } else {\n            return value\n          }\n        })\n      })\n    }\n  }\n\n  _handleOpenMessage(remoteId, data) {\n    log.debug(TAG, this, `received open message with remote id ${remoteId}, ${data}`)\n    let [base64Label, base64Protocol, base64NamespaceId] = data.split(M_SEP)\n    let existingChannel = this._channelRegistry.getByRemoteId(remoteId)\n    let label = urlSafeBase64ToUtf8(base64Label)\n    let protocol = urlSafeBase64ToUtf8(base64Protocol)\n    let namespaceId = urlSafeBase64ToUtf8(base64NamespaceId)\n    if (existingChannel) {\n      log.debug(TAG, `got second open with label '${label}', protocol '${protocol}'` +\n        `, and namespaceId '${namespaceId}' for existing channel: ${existingChannel}`)\n      return\n    }\n\n    let localId = this._channelRegistry.getNextId()\n    let channel = new MuxedDataChannel({\n      localId,\n      label,\n      protocol,\n      namespaceId,\n      onMessage: this._forwardMuxChannelMessage.bind(this, localId),\n      onClose: this._onLocalMuxChannelClosed.bind(this, localId),\n    })\n\n    if (this._paused) {\n      this._pendingRemoteChannels.set(remoteId, channel)\n    } else {\n      this._openChannel(remoteId, channel)\n    }\n  }\n\n  _openChannel(remoteId, channel) {\n    this._channelRegistry.addRemote({channel, remoteId})\n    this._sendBuffer.pushMessage(MT_OPEN_ACK + channel._localId.toString(ID_BASE) + M_SEP + remoteId.toString(ID_BASE))\n    this._onChannel && this._onChannel(channel)\n  }\n\n  _handleOpenAckMessage(remoteId, data) {\n    log.debug(TAG, this, `received open ack message with remote id ${remoteId}, ${data}`)\n    let localId = parseInt(data, ID_BASE)\n    this._channelRegistry.link({localId, remoteId})\n  }\n\n  _handleCloseMessage(remoteId) {\n    let channel = this._channelRegistry.getByRemoteId(remoteId)\n    if (channel) {\n      if (channel._pairingId) {\n        log.warning(TAG, this, `got close message for paired channel '${this}'`)\n      } else {\n        log.debug(TAG, this, `received close message with remote id ${remoteId}`)\n      }\n      this._channelRegistry.remove(channel)\n      channel._close()\n    } else {\n      log.warning(TAG, this, `got close message for unknown channel ${remoteId}`)\n    }\n  }\n\n  _handleDeclareMessage(remoteId, data) {\n    log.debug(TAG, this, `received declare message with remote id ${remoteId}, ${data}`)\n    let [base64Label, base64Protocol, base64NamespaceId, base64PairingId] = data.split(M_SEP)\n    let label = urlSafeBase64ToUtf8(base64Label)\n    let protocol = urlSafeBase64ToUtf8(base64Protocol)\n    let namespaceId = urlSafeBase64ToUtf8(base64NamespaceId)\n    let pairingId = urlSafeBase64ToUtf8(base64PairingId)\n\n    this._channelRegistry.addPairingInfo({\n      remoteId,\n      label,\n      protocol,\n      namespaceId,\n      pairingId,\n    })\n  }\n\n  _handleClearMessage(minimumRemoteId) {\n    this._channelRegistry.setMinimumRemoteId(minimumRemoteId)\n\n    this._pendingRemoteChannels.forEach((channel, remoteId) => {\n      if (remoteId < minimumRemoteId) {\n        this._pendingRemoteChannels.delete(remoteId)\n      }\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/datamux.js","'use strict'\n\n// This module contains classes and utils for transferring\n// large chunks of data.\n// The data along with it's type is read into a TranferItem,\n// which is then read and split into chunks for sending.\n// A TransferAssembler is used to reassemble the TransferItem,\n// including the original type.\n\nimport log from 'common/log'\nimport {\n  arrayBufferToBinaryString,\n  arrayBufferToUnicodeString,\n  blobToArrayBuffer,\n  defer,\n  find,\n  unicodeStringToArrayBuffer,\n  urlSafeBase64ToUtf8,\n  utf8ToBase64,\n  utf8ToUrlSafeBase64,\n} from 'common/utils'\n\nimport {TransferInterruptedError} from 'webrtc/errors'\n\nimport {M_SEP, ID_BASE} from 'datamux/constants'\n\nconst TI_TYPE_BLOB = 'b'\nconst TI_TYPE_STRING = 's'\nconst TI_TYPE_ARRAY_BUFFER = 'a'\nconst TI_TYPE_BUFFER_VIEW = 't'\n\nconst TI_TYPE_SEP = '.'\n\nconst TI_VIEW_TYPE_DATA_VIEW = 'dv'\nconst TI_VIEW_TYPE_INT8 = 'i8'\nconst TI_VIEW_TYPE_UINT8 = 'u8'\nconst TI_VIEW_TYPE_UINT8_CLAMPED = 'u8c'\nconst TI_VIEW_TYPE_INT16 = 'i16'\nconst TI_VIEW_TYPE_UINT16 = 'u16'\nconst TI_VIEW_TYPE_INT32 = 'i32'\nconst TI_VIEW_TYPE_UINT32 = 'u32'\nconst TI_VIEW_TYPE_FLOAT32 = 'f32'\nconst TI_VIEW_TYPE_FLOAT64 = 'f64'\n\nconst TI_VIEW_TYPES = [\n  [DataView, TI_VIEW_TYPE_DATA_VIEW],\n  [Int8Array, TI_VIEW_TYPE_INT8],\n  [Uint8Array, TI_VIEW_TYPE_UINT8],\n  [Uint8ClampedArray, TI_VIEW_TYPE_UINT8_CLAMPED],\n  [Int16Array, TI_VIEW_TYPE_INT16],\n  [Uint16Array, TI_VIEW_TYPE_UINT16],\n  [Int32Array, TI_VIEW_TYPE_INT32],\n  [Uint32Array, TI_VIEW_TYPE_UINT32],\n  [Float32Array, TI_VIEW_TYPE_FLOAT32],\n  [Float64Array, TI_VIEW_TYPE_FLOAT64],\n]\nconst TI_VIEW_TYPE_MAP = TI_VIEW_TYPES.reduce((map, [TypeConstructor, viewType]) => {\n  map[viewType] = TypeConstructor\n  return map\n}, {})\n\nconst TAG = 'datamux'\n\n/**\n * An internal class that is used to represent typed data serialized into ArrayBuffers.\n *\n * The bulk of the work is done in {@link TransferItem.createFromData}, which serializes\n * and splits data of any of the supported types and creates a new {@link TransferItem} instance.\n */\nexport class TransferItem {\n  static supportsType(data) {\n    if (data instanceof ArrayBuffer) {\n      return true\n    } else if (data && (data.buffer instanceof ArrayBuffer)) {\n      let viewType = find(TI_VIEW_TYPES, ([TypeConstructor]) => {\n        return data instanceof TypeConstructor\n      })\n      return !!viewType\n    } else if (typeof(data) === 'string') {\n      return true\n    } else if (!process.env.NODEJS && data instanceof Blob) {\n      return true\n    } else {\n      return false\n    }\n  }\n  static createFromData(data) {\n    if (data instanceof ArrayBuffer) {\n      return Promise.resolve(new TransferItem({\n        typeDescriptor: TI_TYPE_ARRAY_BUFFER,\n        data,\n      }))\n    } else if (data && (data.buffer instanceof ArrayBuffer)) {\n      let viewType = find(TI_VIEW_TYPES, ([TypeConstructor]) => {\n        return data instanceof TypeConstructor\n      })\n      if (viewType) {\n        viewType = viewType[1] // unpack the id from the entry\n      } else {\n        throw new TypeError(`Could not serialize unsupported buffer view type: '${data}'`)\n      }\n\n      return Promise.resolve(new TransferItem({\n        typeDescriptor: TI_TYPE_BUFFER_VIEW + TI_TYPE_SEP + viewType,\n        data,\n      }))\n    } else if (typeof(data) === 'string') {\n      let buffer = unicodeStringToArrayBuffer(data)\n      return Promise.resolve(new TransferItem({\n        typeDescriptor: TI_TYPE_STRING,\n        data: buffer,\n      }))\n    } else if (!process.env.NODEJS && data instanceof Blob) {\n      return blobToArrayBuffer(data).then(buffer => {\n        let base64Type = utf8ToUrlSafeBase64(data.type || '')\n        let base64Name = utf8ToUrlSafeBase64(data.name || '')\n        return Promise.resolve(new TransferItem({\n          typeDescriptor: TI_TYPE_BLOB + TI_TYPE_SEP + base64Type + TI_TYPE_SEP + base64Name,\n          data: buffer,\n        }))\n      })\n    } else {\n      throw new TypeError(`Could not serialize unsupported data type: '${data}'`)\n    }\n  }\n\n  constructor({typeDescriptor, data, chunkSize}) {\n    // Instead of using .subarray() for views, we use the same code for buffers and\n    // views, and then create new typed arrays while keeping track of the offset.\n    if (ArrayBuffer.isView(data)) {\n      this._buffer = data.buffer\n      this._baseOffset = data.byteOffset\n    } else {\n      this._buffer = data\n      this._baseOffset = 0\n    }\n    this._byteOffset = 0\n    this._byteLength = data.byteLength\n\n    this._typeDescriptor = typeDescriptor\n\n    this._deferred = defer()\n  }\n\n  toString() {\n    return `transferItem{${this._byteOffset}/${this._byteLength},type=${this._typeDescriptor}}`\n  }\n\n  /**\n   * A string that describes the type of the serialized data using\n   * custom format. e.g. 's' for string, or 't.u8' for an Uint8Array.\n   *\n   * @readonly\n   * @member {string} TransferItem#typeDescriptor\n   */\n  get typeDescriptor() {\n    return this._typeDescriptor\n  }\n\n  /**\n   * The total length of the binary data in bytes.\n   *\n   * @readonly\n   * @member {number} TransferItem#byteLength\n   */\n  get byteLength() {\n    return this._byteLength\n  }\n\n  /**\n   * A promise that will be resolved once all chunks have been read.\n   *\n   * @readonly\n   * @member {Promise} TransferItem#promise\n   */\n  get promise() {\n    return this._deferred.promise\n  }\n\n  /**\n   * Whether there are any chunks left to read.\n   *\n   * @readonly\n   * @member {boolean} TransferItem#empty\n   */\n  get empty() {\n    return this._byteOffset === this._byteLength\n  }\n\n  /**\n   * Reads a single chunk. This will remove the chunk from the internal store.\n   *\n   * Throws an error if there are no chunks left to be read.\n   *\n   * @param {number} size - The maximum number of bytes to read.\n   * @returns {Uint8Array?} A serialized chunk of data, or null if there are no chunks left.\n   */\n  read(size = 1024) {\n    let bytesLeft = this._byteLength - this._byteOffset\n    if (bytesLeft > 0) {\n      let offset = this._byteOffset\n      if (size > bytesLeft) {\n        size = bytesLeft\n      }\n      this._byteOffset += size\n\n      if (this.empty) {\n        this._deferred.resolve()\n      }\n\n      return new Uint8Array(this._buffer, this._baseOffset + offset, size)\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Reads a single chunk. This will remove the chunk from the internal store.\n   * The result is a base64 encoded. The input size takes the encoding into\n   * account, as in the internal read size will be smaller than the given size.\n   *\n   * Throws an error if there are no chunks left to be read.\n   *\n   * @param {number} size - The maximum number of bytes to read.\n   * @returns {string?} A serialized and base64 encoded chunk of data, or null if there are no chunks left.\n   */\n  readBase64(size = 1024) {\n    let decodedSize = Math.ceil(size * 2 / 3)\n\n    let binaryData = this.read(decodedSize)\n    if (binaryData) {\n      let binaryStr = arrayBufferToBinaryString(binaryData)\n      let binaryBase64Str = utf8ToBase64(binaryStr)\n      return binaryBase64Str\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Signals that the transfer failed.\n   */\n  failed() {\n    this._deferred.reject(new TransferInterruptedError('failed', this._byteOffset, this._byteLength))\n    this._byteOffset = this._byteLength\n    this._buffer = null\n  }\n\n  /**\n   * Aborts an ongoing transfer by discarding the rest of the chunks and\n   * rejecting the transfer promise.\n   */\n  abort() {\n    this._deferred.reject(new TransferInterruptedError('interrupted', this._byteOffset, this._byteLength))\n    this._byteOffset = this._byteLength\n    this._buffer = null\n  }\n}\n\n/**\n * Given a byteLength and a typeDescriptor from a {@link TransferItem}, this class\n * reassembles the data from a number of received chunks.\n *\n * Each instance can only assemble a single transfer data item.\n */\nexport class TransferAssembler {\n  constructor({byteLength, typeDescriptor}) {\n    this._byteLength = byteLength\n    this._typeDescriptor = typeDescriptor\n\n    this._offset = 0\n    this._buffer = new Uint8Array(byteLength)\n  }\n\n  toString() {\n    return `transferAssembler{type=${this._typeDescriptor},size=${this._byteLength},offset=${this._offset}}`\n  }\n\n  /**\n   * Writes a chunk of serialized data.\n   *\n   * @param {Uint8Array} chunk - The chunk to be written.\n   * @returns {boolean} True if all chunks have been written.\n   */\n  write(chunk) {\n    if (chunk instanceof ArrayBuffer) {\n      chunk = new Uint8Array(chunk)\n    }\n    this._buffer.set(chunk, this._offset)\n    let chunkSize = chunk.byteLength || chunk.length\n    this._offset += chunkSize\n    if (isNaN(this._offset)) {\n      log.error(TAG, 'transfer assembler write position is NaN')\n    }\n    return this._byteLength === this._offset\n  }\n\n  /**\n   * Should be called once all chunks have been written.\n   *\n   * Will throw an error if all chunks haven't been written or if called more than once.\n   *\n   * @returns {*} Data deserialized from the chunks according to the typeDescriptor.\n   */\n  finalize() {\n    if (this._byteLength === undefined) {\n      throw new Error('Tried to finalize transfer a second time')\n    }\n    if (this._offset !== this._byteLength) {\n      throw new Error(`Tried to assemble transfer with offset != length, (${this._offset} != ${this._byteLength})`)\n    }\n\n    let buffer = this._buffer\n    delete this._buffer\n    delete this._byteLength\n\n    let [typeId, ...rest] = this._typeDescriptor.split(TI_TYPE_SEP)\n    if (typeId === TI_TYPE_BLOB) {\n      let [base64Type, base64Name] = rest\n      let type = urlSafeBase64ToUtf8(base64Type)\n      let name = urlSafeBase64ToUtf8(base64Name)\n      let blob = new Blob([buffer], {type})\n      if (name) {\n        blob.name = name\n      }\n      return blob\n    } else if (typeId === TI_TYPE_STRING) {\n      return arrayBufferToUnicodeString(buffer.buffer)\n    } else if (typeId === TI_TYPE_ARRAY_BUFFER) {\n      return buffer.buffer\n    } else if (typeId === TI_TYPE_BUFFER_VIEW) {\n      let [viewType] = rest\n      let TypeConstructor = TI_VIEW_TYPE_MAP[viewType]\n      if (!TypeConstructor) {\n        throw new TypeError(`Unknown view type in type descriptor: '${this._typeDescriptor}'`)\n      }\n      return new TypeConstructor(buffer.buffer)\n    } else {\n      throw new TypeError(`Unknown type id in type descriptor: '${this._typeDescriptor}'`)\n    }\n  }\n}\n\nexport function createTransferHeader({transferId, transferItem}) {\n  return [\n    transferId.toString(ID_BASE),\n    transferItem.typeDescriptor,\n    transferItem.byteLength.toString(ID_BASE),\n  ].join(M_SEP)\n}\n\nexport class TransferReceiver {\n  constructor() {\n    this._assembler = null\n    this._currentTransferItem = null\n    this._currentDownloadId = null\n    this._deferredTransferResults = new Map()\n  }\n\n  _getDeferredResult(transferId) {\n    let deferred = this._deferredTransferResults.get(transferId)\n    if (deferred) {\n      this._deferredTransferResults.delete(transferId)\n    } else {\n      deferred = defer()\n      this._deferredTransferResults.set(transferId, deferred)\n    }\n    return deferred\n  }\n\n  clear() {\n    if (this._currentTransferItem) {\n      // fine always calling this, since it will be resolved if it's done anyway\n      this._currentTransferItem.abort()\n      this._currentTransferItem = null\n    }\n    this._deferredTransferResults.forEach(deferred => {\n      deferred.reject(new Error('transfers cancelled due to reset'))\n    })\n    this._deferredTransferResults.clear()\n  }\n\n  // Returns a promise that is resolved when the download is complete\n  awaitDownload(transferId) {\n    return this._getDeferredResult(transferId).promise\n  }\n\n  setHeader(headerString) {\n    let [transferIdStr, typeDescriptor, byteLengthStr] = headerString.split(M_SEP)\n    let transferId = parseInt(transferIdStr, ID_BASE)\n    let byteLength = parseInt(byteLengthStr, ID_BASE)\n\n    if (this._assembler) {\n      log.error(TAG, `got new transfer header before assembling old transfer for ${this._assembler}`)\n\n      this._getDeferredResult(this._currentDownloadId)\n        .reject(new Error('ongoing transfer was unexpectedly replaced by a new one'))\n    }\n    this._assembler = new TransferAssembler({typeDescriptor, byteLength})\n    this._currentDownloadId = transferId\n  }\n\n  handleBinaryData(data) {\n    let done = this._assembler.write(data)\n    if (done) {\n      let result = this._assembler.finalize()\n      this._getDeferredResult(this._currentDownloadId).resolve(result)\n      this._assembler = null\n      this._currentDownloadId = null\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/transfer.js","'use strict'\n\nimport log from 'common/log'\n\nconst TAG = 'candidates'\nconst CANDIDATE_BUFFER_TIMEOUT_MS = 5\n\nexport class Candidate {\n  constructor(candidate) {\n    this.candidate = candidate.candidate\n    this.sdpMLineIndex = candidate.sdpMLineIndex\n    this.sdpMid = candidate.sdpMid\n  }\n\n  toString() {\n    return `candidate{mId=${this.sdpMid},mli=${this.sdpMLineIndex},attr=${this.candidate}}`\n  }\n\n  toJSON() {\n    return {\n      candidate: this.candidate,\n      sdpMLineIndex: this.sdpMLineIndex,\n      sdpMid: this.sdpMid,\n    }\n  }\n}\n\nexport default class Candidater {\n  constructor({send}) {\n    this._send = send\n\n    this._peerConnection = null\n    this._earlyLocal = []\n    this._earlyRemote = []\n    this._localBuffer = []\n    this._localBufferTimeout = 0\n\n    this._onLocalCandidate = this._onLocalCandidate.bind(this)\n    this._onBufferTimeout = this._onBufferTimeout.bind(this)\n  }\n\n  setPeerConnection(peerConnection) {\n    this.reset()\n    this._peerConnection = peerConnection\n    this._peerConnection.addEventListener('icecandidate', this._onLocalCandidate)\n  }\n\n  handleRemoteCandidates(candidates) {\n    if (!candidates) {\n      return\n    }\n    candidates = candidates.map(candidate => new Candidate(candidate))\n\n    if (!this._peerConnection) {\n      log.warning(TAG, `got remote candidates without peer connection: ${candidates.join(', ')}`)\n      return\n    }\n\n    if (this._peerConnection.hasRemoteDescription) {\n      candidates.forEach(candidate => {\n        log.debug(TAG, `adding remote candidate: ${candidate}`)\n        this._peerConnection.addIceCandidate(candidate).catch(error => {\n          log.error(TAG, `failed to add remote candidate: ${error}`)\n        })\n      })\n    } else {\n      log.debug(TAG, `buffering early remote candidates: ${candidates.join(', ')}`)\n      this._earlyRemote = this._earlyRemote.concat(candidates)\n    }\n  }\n\n  addEarlyRemoteCandidates() {\n    log.debug(TAG, `adding early remote candidates: ${this._earlyRemote.join(', ')}`)\n\n    this._earlyRemote.forEach(candidate => {\n      this._peerConnection.addIceCandidate(candidate).catch(error => {\n        log.error(TAG, `failed to add early remote candidate: ${error}`)\n      })\n    })\n\n    this._earlyRemote = []\n  }\n\n  extractEarlyLocal() {\n    if (!this._earlyLocal) {\n      return []\n    }\n    let earlyLocal = this._earlyLocal\n    this._earlyLocal = null\n    log.debug(TAG, `extracted early local candidates: ${earlyLocal.join(', ')}`)\n    return earlyLocal\n  }\n\n  reset() {\n    if (this._localBufferTimeout) {\n      clearTimeout(this._localBufferTimeout)\n      this._localBufferTimeout = 0\n    }\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('icecandidate', this._onLocalCandidate)\n      this._peerConnection = null\n    }\n    this._earlyRemote = []\n    this._earlyLocal = []\n  }\n\n  _onLocalCandidate(event) {\n    let {candidate} = event\n    if (!candidate) {\n      return\n    }\n    candidate = new Candidate(candidate)\n    if (this._earlyLocal) {\n      log.debug(TAG, `buffering candidates emitted before first description: ${candidate}`)\n      this._earlyLocal.push(candidate)\n    } else {\n      this._localBuffer.push(candidate)\n      if (!this._localBufferTimeout) {\n        this._localBufferTimeout = setTimeout(this._onBufferTimeout, CANDIDATE_BUFFER_TIMEOUT_MS)\n      }\n    }\n  }\n\n  _onBufferTimeout() {\n    this._localBufferTimeout = 0\n    let candidates = this._localBuffer\n    this._localBuffer = []\n    log.debug(TAG, `sending candidates via server: ${candidates.join(', ')}`)\n    this._send(candidates)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/candidater.js","\nimport log from 'common/log'\n\nconst TAG = 'json-channel-ctrl'\n\nexport class JsonChannelBroadcastController {\n  constructor({onMessageFromPeer, onPeerChannelOpen, onPeerChannelClose}) {\n    this._peers = new Map()\n\n    this._onPeerChannelOpen = onPeerChannelOpen\n    this._onPeerChannelClose = onPeerChannelClose\n    this._onMessageFromPeer = onMessageFromPeer\n  }\n\n  sendMessage(message) {\n    this._peers.forEach(({channel}, peerId) => {\n      if (channel.readyState === 'open') {\n        channel.send(message).catch(error => {\n          log.debug(TAG, `failed to send broadcast message to peer '${peerId}', ${error}`)\n        })\n      }\n    })\n  }\n\n  sendMessageToPeer(peerId, message) {\n    let peerInfo = this._peers.get(peerId)\n    if (peerInfo) {\n      peerInfo.channel.send(message).catch(error => {\n        log.debug(TAG, `failed to send message to peer '${peerId}', ${error}`)\n      })\n      return true\n    } else {\n      return false\n    }\n  }\n\n  addPeer(peerId, channel) {\n    let peerInfo = {\n      peerId,\n      channel,\n      messageListener: message => {\n        this._onMessage(peerInfo, message)\n      },\n      readyStateListener: readyState => {\n        this._onConnectionStateChange(peerInfo, readyState)\n      },\n    }\n    this._peers.set(peerId, peerInfo)\n    channel.on('message', peerInfo.messageListener)\n    channel.on('readyState', peerInfo.readyStateListener)\n  }\n\n  removePeer(peerId) {\n    if (!this._peers) return\n    let peerInfo = this._peers.get(peerId)\n    if (peerInfo) {\n      this._peers.delete(peerId)\n\n      peerInfo.channel.off('message', peerInfo.messageListener)\n      peerInfo.channel.off('readyState', peerInfo.readyStateListener)\n      peerInfo.messageListener = null\n      peerInfo.readyStateListener = null\n    }\n  }\n\n  _onConnectionStateChange(peerInfo, readyState) {\n    if (readyState === 'open') {\n      this._onPeerChannelOpen(peerInfo.peerId)\n    } else if (readyState === 'close') {\n      this._onPeerChannelClose(peerInfo.peerId)\n    }\n  }\n\n  _onMessage(peerInfo, message) {\n    this._onMessageFromPeer(peerInfo.peerId, message)\n  }\n\n  cleanup() {\n    this._onPeerChannelOpen = null\n    this._onPeerChannelClose = null\n    this._onMessageFromPeer = null\n    this._peers.forEach((_, peerId) => {\n      this.removePeer(peerId)\n    })\n    this._peers.clear()\n    this._peers = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/channelControllers.js","'use strict'\n\nimport log from 'common/log'\nimport {assign, getStringByteLength} from 'common/utils'\n\nfunction dataChannelMessageSize(message) {\n  if (window.ArrayBuffer.isView(message)) {\n    return message.byteLength || 0\n  }\n  if (message instanceof Blob) {\n    return message.size || 0\n  }\n  if (message instanceof window.ArrayBuffer) {\n    return message.byteLength || 0\n  }\n  if (typeof(message) === 'string') {\n    return getStringByteLength(message) || 0\n  }\n  return 0\n}\n\nfunction monitorDataChannel(pcId, channel, statsHandler) {\n  var bytesSent = 0\n  var bytesReceived = 0\n  var messagesSent = 0\n  var messagesReceived = 0\n  var timeout = 0\n  var identity = {\n    pcId: pcId,\n    id: channel.id,\n    label: channel.label,\n    protocol: channel.protocol,\n    ordered: channel.ordered,\n    reliable: channel.reliable,\n    sourceId: 'channel-' + channel.id,\n  }\n\n  function maybeStartStatTimer() {\n    if (!timeout) {\n      timeout = setTimeout(function () {\n        timeout = 0\n        var sample = assign({\n          bytesSent: bytesSent,\n          bytesReceived: bytesReceived,\n          messagesSent: messagesSent,\n          messagesReceived: messagesReceived,\n          timestamp: Date.now(),\n        }, identity)\n        statsHandler.handleStats([sample])\n      }, monitorDataChannels.MONITOR_INTERVAL)\n    }\n  }\n\n  if (channel.addEventListener) {\n    channel.addEventListener('message', function (event) {\n      bytesReceived += dataChannelMessageSize(event.data)\n      messagesReceived += 1\n      maybeStartStatTimer()\n    })\n  } else {\n    channel.attachEvent('message', function (event) {\n      bytesReceived += dataChannelMessageSize(event.data)\n      messagesReceived += 1\n      maybeStartStatTimer()\n    })\n  }\n\n  var realDataChannelSend = channel.send\n  channel.send = function (message) {\n    bytesSent += dataChannelMessageSize(message)\n    messagesSent += 1\n    maybeStartStatTimer()\n    return realDataChannelSend.call(channel, message)\n  }\n}\n\nexport default function monitorDataChannels(peerConnection, statsHandler) {\n  var tag = 'stats-monitor'\n\n  peerConnection.addEventListener('datachannel', function (event) {\n    var channel = event.channel\n    log.debug(tag, 'Setting up monitoring for remote data channel:', channel)\n    monitorDataChannel(peerConnection.id, channel, statsHandler)\n  })\n\n  var realCreateDataChannel = peerConnection.createDataChannel\n  peerConnection.createDataChannel = function () {\n    var channel = realCreateDataChannel.apply(peerConnection, arguments)\n    log.debug(tag, 'Setting up monitoring for created data channel:', channel)\n    monitorDataChannel(peerConnection.id, channel, statsHandler)\n    return channel\n  }\n}\n\nmonitorDataChannels.MONITOR_INTERVAL = 1000\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/dataChannelMonitor.js","'use strict'\n\nimport log from 'common/log'\nimport {ConnectionFailedError, ConnectionLostError} from 'webrtc/errors'\nimport {browser, randomString, errorForwarder} from 'common/utils'\n\nimport Candidater from 'webrtc/candidater'\nimport Renegotiator from 'webrtc/renegotiator'\n\nconst TAG = 'signaler'\n\n// state of the WebRTC offer/answer signaling\nconst SIGNALING_STATE_IDLE = 'idle'\nconst SIGNALING_STATE_OFFERED = 'offered'\nconst SIGNALING_STATE_STABLE = 'stable'\n\n/*\n      .-------------+--------------.\n      v             |              |\n  signaling -> connecting ---> connected\n      ^                          |   ^\n      |                          v   |\n      `--------------------- reconnecting\n\n*/\n// signaling, peer connection is not in stable state\nconst CONNECTION_STATE_SIGNALING = 'signaling'\n// peer connection in stable state, ice not connected\nconst CONNECTION_STATE_CONNECTING = 'connecting'\n// peer connection stable and ice connected\nconst CONNECTION_STATE_CONNECTED = 'connected'\n// ice was connected but has disconnected, might recover\nconst CONNECTION_STATE_RECONNECTING = 'reconnecting'\n// call has been closed\nconst CONNECTION_STATE_CLOSED = 'closed'\n\nconst DATACHANNEL_BANDWIDTH = 2048 // TODO: Too high and stuff will break, figure out the right number.\nconst DISCONNECT_TIMEOUT_MS = 5000\nconst SIGNALING_PROTOCOL_VERSION = 3\n\nfunction createTicket(remoteTicket) {\n  if (remoteTicket) {\n    // we have a remote ticket already, need to\n    // make sure our ticket is greater than it.\n    return remoteTicket + '.'\n  } else {\n    return Date.now() + randomString(8)\n  }\n}\n\nexport default class Signaler {\n  constructor(deps) {\n    if (deps.receivedOffer) {\n      this._ticket = deps.receivedOffer.ticket\n      this._signalingState = null\n    } else {\n      this._ticket = null\n      this._signalingState = SIGNALING_STATE_IDLE\n    }\n    this._label = deps.label\n    this._isInitiator = null\n    this._peerConnection = null\n    this._receivedOffer = deps.receivedOffer\n    this._disconnectedTicket = null\n\n    this._errorState = null\n    this._connectionState = CONNECTION_STATE_SIGNALING\n    this._hasDataConnection = false\n    this._connectionFailCount = 0\n    this._disconnectTimeoutId = 0\n\n    this._closeCall = deps.closeCall\n    this._onMessage = deps.onMessage\n    this._onSignalingError = deps.onSignalingError\n    this._onErrorStateChange = deps.onErrorStateChange\n    this._onConnectionStateChange = deps.onConnectionStateChange\n    this._createPeerConnection = deps.onCreatePeerConnection\n\n    this._renegotiator = new Renegotiator({\n      label: this._label,\n      onError: deps.onSignalingError,\n      channel: deps.renegotiationChannel,\n    })\n\n    this._candidater = new Candidater({\n      send: candidates => {\n        this._sendMessage({candidates})\n      },\n    })\n    this._onIceStateChange = this._onIceStateChange.bind(this)\n  }\n\n  _sendMessage(message, ticket = this._ticket) {\n    return this._onMessage({\n      ticket,\n      version: SIGNALING_PROTOCOL_VERSION,\n      ...message,\n    })\n  }\n\n  handleDataChannelConnect() {\n    log.debug(TAG, this, 'signaling channel opened')\n    if (this.closed) {\n      return log.debug(TAG, this, 'signaling channel opened in closed state')\n    }\n    this._hasDataConnection = true\n    this._renegotiator.start(this._isInitiator)\n    this._setConnectionState(CONNECTION_STATE_CONNECTED)\n    this._setErrorState(null)\n    this._connectionFailCount = 0\n  }\n\n  // 'closed' | 'channelTimeout' | 'connectTimeout'\n  handleDataChannelDisconnect(reason) {\n    this._hasDataConnection = false\n    log.debug(TAG, this, `data connection lost because of ${reason}`)\n    if (this._connectionState === CONNECTION_STATE_CONNECTED) {\n      this._connectionHasFailed(new ConnectionLostError('The data connection was lost'))\n    }\n  }\n\n  toString() {\n    return `signaler{\"${this._label}\",state=${this._signalingState},` +\n      `ticket=${this._ticket},isInitiator=${this._isInitiator}}`\n  }\n\n  get ticket() {\n    return this._ticket\n  }\n\n  get connectionState() {\n    return this._connectionState\n  }\n\n  get errorState() {\n    return this._errorState\n  }\n\n  /* true, false, null - tribool wombo-combo ! */\n  get isInitiator() {\n    return this._isInitiator\n  }\n\n  isConnected() {\n    return this._hasDataConnection\n  }\n\n  get closed() {\n    return this._connectionState === CONNECTION_STATE_CLOSED\n  }\n\n  get stopped() {\n    return !this._signalingState\n  }\n\n  transitionToClosed() {\n    if (this.closed) {\n      return false\n    }\n    this._setConnectionState(CONNECTION_STATE_CLOSED)\n    return true\n  }\n\n  _replacePeerConnection() {\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('iceconnectionstatechange', this._onIceStateChange)\n    }\n    this._peerConnection = this._createPeerConnection()\n    this._peerConnection.addEventListener('iceconnectionstatechange', this._onIceStateChange)\n\n    this._candidater.setPeerConnection(this._peerConnection)\n    this._renegotiator.setPeerConnection(this._peerConnection)\n  }\n\n  _sendDescription(description, ticket) {\n    let content = {\n      browser,\n      candidates: this._candidater.extractEarlyLocal(),\n      [description.type]: {\n        type: description.type,\n        sdp: description.sdp,\n        unifiedPlanSdp: description.unifiedPlanSdp,\n      },\n    }\n    log.debug(TAG, this, `sending description, ${JSON.stringify(content)}`)\n    this._sendMessage(content, ticket)\n  }\n\n  handleMessage(message) {\n    if (this.closed) {\n      return\n    }\n    log.debug(TAG, this, 'handling signaling message', message)\n    let {ticket, hangup, offer, answer, candidates, version} = message\n    if (version < SIGNALING_PROTOCOL_VERSION) {\n      log.error(TAG, this, `ignoring message with incompatible protocol version: ${version}`)\n      return\n    }\n    if (hangup) {\n      if (!(ticket === this._ticket || ticket === this._disconnectedTicket)) {\n        log.warning(TAG, this, `ignored hangup with wrong ticket: ${ticket}, old ticket = ${this._disconnectedTicket}`)\n        return\n      }\n      throw new Error('hangup')\n    }\n    if (offer) {\n      this._handleOffer(message)\n    } else if (answer) {\n      if (ticket !== this._ticket) {\n        log.warning(TAG, this, `ignored answer with wrong ticket: ${ticket}`)\n        return\n      }\n      this._handleAnswer(message)\n    }\n    if (candidates) {\n      if (ticket !== this._ticket) {\n        log.info(TAG, this, `ignored candidates with wrong ticket: ${ticket}`)\n        return\n      }\n      this._candidater.handleRemoteCandidates(candidates)\n    }\n  }\n\n  _setConnectionState(connectionState) {\n    let prevState = this._connectionState\n    this._connectionState = connectionState\n    if (prevState !== connectionState) {\n      this._onConnectionStateChange(connectionState, prevState)\n    }\n  }\n\n  _setErrorState(errorState) {\n    if (errorState !== this._errorState) {\n      this._errorState = errorState\n      this._onErrorStateChange(errorState)\n    }\n  }\n\n  _connectionHasFailed(error) {\n    clearTimeout(this._disconnectTimeoutId)\n    this._disconnectTimeoutId = 0\n    if (this.closed) {\n      return\n    }\n\n    if (this._connectionState === CONNECTION_STATE_SIGNALING) {\n      log.warning(TAG, this, 'connection failed while signaling')\n    }\n    this._setConnectionState(CONNECTION_STATE_SIGNALING)\n    this._setErrorState(error)\n    this._disconnectedTicket = this._ticket\n\n    if (this.closed) {\n      return // application closed the call in the error handler\n    }\n    log.info(TAG, this, 'trying to restart call because connection failed')\n    // channel and ice listeners are cleared here, so this method won't be called twice for the same pc\n    this._replacePeerConnection()\n    this._doOffer()\n  }\n\n  _onIceStateChange() {\n    if (this.closed) {\n      return\n    }\n    var connState = this._peerConnection.iceConnectionState\n    log.debug(TAG, this, `changed ice connection state to ${connState}`)\n\n    if (connState === 'failed') {\n      this._connectionFailCount += 1\n      this._connectionHasFailed(new ConnectionFailedError(this._connectionFailCount))\n    } else if (connState === 'disconnected') {\n      this._setConnectionState(CONNECTION_STATE_RECONNECTING)\n      this._disconnectTimeoutId = setTimeout(() => {\n        this._connectionHasFailed(new ConnectionLostError('Timed out in disconnected state'))\n      }, DISCONNECT_TIMEOUT_MS)\n    } else {\n      clearTimeout(this._disconnectTimeoutId)\n      this._disconnectTimeoutId = 0\n      if (connState === 'connected' && this.isConnected()) {\n        this._setConnectionState(CONNECTION_STATE_CONNECTED)\n      }\n    }\n  }\n\n  _doOffer(remoteTicket) {\n    if (this.closed) {\n      return log.warning(TAG, this, 'trying to do offer in closed state')\n    }\n    // Need to make sure this ticket is used in the closure below. The _ticket member might\n    // get updated because of a conflict, and then we would send the offer with\n    // the wrong (new) ticket.\n    let ticket = createTicket(remoteTicket)\n    this._ticket = ticket\n    log.info(TAG, this, `doing offer with ticket ${this._ticket}`)\n    this._signalingState = SIGNALING_STATE_OFFERED\n    this._isInitiator = true\n    this._peerConnection.performOffer({bandwidth: DATACHANNEL_BANDWIDTH})\n      .then(description => this._sendDescription(description, ticket))\n      .catch(errorForwarder(this._onSignalingError, '_doOffer'))\n  }\n\n  _doAnswer(offer, ticket) {\n    if (this.closed) {\n      return log.warning(TAG, this, 'trying to do answer in closed state')\n    }\n    this._ticket = ticket\n    log.info(TAG, this, `doing answer with ticket ${this._ticket}`)\n    this._signalingState = SIGNALING_STATE_STABLE\n    this._isInitiator = false\n    this._peerConnection.performAnswer({offer, bandwidth: DATACHANNEL_BANDWIDTH})\n      .then(description => this._sendDescription(description, ticket))\n      .then(() => {\n        this._candidater.addEarlyRemoteCandidates()\n        this._signalingState = SIGNALING_STATE_STABLE\n        if (this._connectionState !== CONNECTION_STATE_CONNECTED) {\n          this._setConnectionState(CONNECTION_STATE_CONNECTING)\n        }\n      })\n      .catch(errorForwarder(this._onSignalingError, '_doAnswer'))\n  }\n\n  _handleOffer({offer, ticket, browser: remoteBrowser, candidates}) {\n    // this.candidater.handleRemoteCandidates(candidates)\n    var alwaysOffer = false\n    log.debug(TAG, this, `got offer in state '${this._signalingState}' with tickets ${ticket} >= ${this._ticket}`)\n    let isChromeToOther = browser === 'chrome' && remoteBrowser !== 'chrome'\n    let isPluginToFirefox = browser === 'other' && remoteBrowser === 'firefox'\n    if (isChromeToOther || isPluginToFirefox) {\n      log.debug(TAG, `offer is from ${remoteBrowser} and this is ${browser}, forcing offer`)\n      alwaysOffer = true\n    }\n    if (this._signalingState === SIGNALING_STATE_IDLE) {\n      this._replacePeerConnection()\n      if (alwaysOffer) {\n        this._doOffer(ticket)\n      } else {\n        log.info(TAG, this, 'restarting call and applying offer')\n        this._doAnswer(offer, ticket)\n      }\n    } else if (this._signalingState === SIGNALING_STATE_OFFERED) {\n      if (ticket >= this._ticket) { // call needs to be aborted\n        this._replacePeerConnection()\n        if (alwaysOffer) {\n          log.info(TAG, this, 'resolving always offer conflict by resetting and offering')\n          this._doOffer(ticket)\n        } else {\n          log.info(TAG, this, 'resolving conflict by aborting dial out and sending answer')\n          this._doAnswer(offer, ticket)\n        }\n      } else {\n        log.debug(TAG, this, 'resolving conflict by waiting for answer')\n      }\n    } else if (this._signalingState === SIGNALING_STATE_STABLE) {\n      if (alwaysOffer) {\n        log.warning(TAG, this, 'resetting call and offering')\n        this._replacePeerConnection()\n        this._doOffer(ticket)\n      } else if (ticket >= this._ticket) { // call should be reset\n        log.info(TAG, this, 'resetting call and applying offer')\n        this._replacePeerConnection()\n        this._doAnswer(offer, ticket)\n      } else {\n        log.debug(TAG, this, 'ignoring offer for old call')\n      }\n    } else if (this.closed) {\n      log.info(TAG, this, 'got offer in closed state, ignoring')\n    }\n  }\n\n  _handleAnswer({answer, ticket}) {\n    if (this._signalingState !== SIGNALING_STATE_OFFERED) {\n      return log.error(TAG, this, `got answer in wrong state: ${this._signalingState}`)\n    }\n    this._signalingState = SIGNALING_STATE_STABLE\n    log.verbose(TAG, this, 'got answer, initial call setup stabilized')\n\n    this._peerConnection.handleAnswer({answer})\n      .then(() => {\n        this._candidater.addEarlyRemoteCandidates()\n        if (this._connectionState !== CONNECTION_STATE_CONNECTED) {\n          this._setConnectionState(CONNECTION_STATE_CONNECTING)\n        }\n      })\n      .catch(errorForwarder(this._onSignalingError, '_handleAnswer'))\n  }\n\n  sendHangup() {\n    this._sendMessage({hangup: true})\n  }\n\n  start() {\n    if (this.closed) {\n      return false\n    }\n\n    if (this._receivedOffer) {\n      log.debug(TAG, this, 'accepting incoming call:', this._receivedOffer)\n      this._signalingState = SIGNALING_STATE_IDLE\n      this._handleOffer(this._receivedOffer)\n      this._receivedOffer = null\n    } else {\n      log.info(TAG, `call started or restarted in state '${this._signalingState}'`)\n      this._signalingState = SIGNALING_STATE_OFFERED\n      this._replacePeerConnection()\n      setTimeout(() => this._doOffer())\n    }\n    return true\n  }\n\n  reset() {\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('iceconnectionstatechange', this._onIceStateChange)\n    }\n    clearTimeout(this._disconnectTimeoutId)\n    this._disconnectTimeoutId = 0\n    this._hasDataConnection = false\n    this._peerConnection = null\n    this._isInitiator = null\n    this._renegotiator.reset()\n    this._candidater.reset()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/signaler.js","module.exports = { \"default\": require(\"core-js/library/fn/object/define-properties\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/define-properties.js\n// module id = 218\n// module chunks = 0","module.exports = { \"default\": require(\"core-js/library/fn/object/entries\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/entries.js\n// module id = 219\n// module chunks = 0","var getKeys   = require('./_object-keys')\n  , toIObject = require('./_to-iobject')\n  , isEnum    = require('./_object-pie').f;\nmodule.exports = function(isEntries){\n  return function(it){\n    var O      = toIObject(it)\n      , keys   = getKeys(O)\n      , length = keys.length\n      , i      = 0\n      , result = []\n      , key;\n    while(length > i)if(isEnum.call(O, key = keys[i++])){\n      result.push(isEntries ? [key, O[key]] : O[key]);\n    } return result;\n  };\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_object-to-array.js\n// module id = 220\n// module chunks = 0","var grammar = module.exports = {\n  v: [{\n      name: 'version',\n      reg: /^(\\d*)$/\n  }],\n  o: [{ //o=- 20518 0 IN IP4 203.0.113.1\n    // NB: sessionId will be a String in most cases because it is huge\n    name: 'origin',\n    reg: /^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,\n    names: ['username', 'sessionId', 'sessionVersion', 'netType', 'ipVer', 'address'],\n    format: \"%s %s %d %s IP%d %s\"\n  }],\n  // default parsing of these only (though some of these feel outdated)\n  s: [{ name: 'name' }],\n  i: [{ name: 'description' }],\n  u: [{ name: 'uri' }],\n  e: [{ name: 'email' }],\n  p: [{ name: 'phone' }],\n  z: [{ name: 'timezones' }], // TODO: this one can actually be parsed properly..\n  r: [{ name: 'repeats' }],   // TODO: this one can also be parsed properly\n  //k: [{}], // outdated thing ignored\n  t: [{ //t=0 0\n    name: 'timing',\n    reg: /^(\\d*) (\\d*)/,\n    names: ['start', 'stop'],\n    format: \"%d %d\"\n  }],\n  c: [{ //c=IN IP4 10.47.197.26\n      name: 'connection',\n      reg: /^IN IP(\\d) (\\S*)/,\n      names: ['version', 'ip'],\n      format: \"IN IP%d %s\"\n  }],\n  b: [{ //b=AS:4000\n      push: 'bandwidth',\n      reg: /^(TIAS|AS|CT|RR|RS):(\\d*)/,\n      names: ['type', 'limit'],\n      format: \"%s:%s\"\n  }],\n  m: [{ //m=video 51744 RTP/AVP 126 97 98 34 31\n      // NB: special - pushes to session\n      // TODO: rtp/fmtp should be filtered by the payloads found here?\n      reg: /^(\\w*) (\\d*) ([\\w\\/]*)(?: (.*))?/,\n      names: ['type', 'port', 'protocol', 'payloads'],\n      format: \"%s %d %s %s\"\n  }],\n  a: [\n    { //a=rtpmap:110 opus/48000/2\n      push: 'rtp',\n      reg: /^rtpmap:(\\d*) ([\\w\\-]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,\n      names: ['payload', 'codec', 'rate', 'encoding'],\n      format: function (o) {\n        return (o.encoding) ?\n          \"rtpmap:%d %s/%s/%s\":\n          o.rate ?\n          \"rtpmap:%d %s/%s\":\n          \"rtpmap:%d %s\";\n      }\n    },\n    {\n      //a=fmtp:108 profile-level-id=24;object=23;bitrate=64000\n      //a=fmtp:111 minptime=10; useinbandfec=1\n      push: 'fmtp',\n      reg: /^fmtp:(\\d*) ([\\S| ]*)/,\n      names: ['payload', 'config'],\n      format: \"fmtp:%d %s\"\n    },\n    { //a=control:streamid=0\n        name: 'control',\n        reg: /^control:(.*)/,\n        format: \"control:%s\"\n    },\n    { //a=rtcp:65179 IN IP4 193.84.77.194\n      name: 'rtcp',\n      reg: /^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,\n      names: ['port', 'netType', 'ipVer', 'address'],\n      format: function (o) {\n        return (o.address != null) ?\n          \"rtcp:%d %s IP%d %s\":\n          \"rtcp:%d\";\n      }\n    },\n    { //a=rtcp-fb:98 trr-int 100\n      push: 'rtcpFbTrrInt',\n      reg: /^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,\n      names: ['payload', 'value'],\n      format: \"rtcp-fb:%d trr-int %d\"\n    },\n    { //a=rtcp-fb:98 nack rpsi\n      push: 'rtcpFb',\n      reg: /^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,\n      names: ['payload', 'type', 'subtype'],\n      format: function (o) {\n        return (o.subtype != null) ?\n          \"rtcp-fb:%s %s %s\":\n          \"rtcp-fb:%s %s\";\n      }\n    },\n    { //a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n      //a=extmap:1/recvonly URI-gps-string\n      push: 'ext',\n      reg: /^extmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,\n      names: ['value', 'uri', 'config'], // value may include \"/direction\" suffix\n      format: function (o) {\n        return (o.config != null) ?\n          \"extmap:%s %s %s\":\n          \"extmap:%s %s\";\n      }\n    },\n    {\n      //a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:PS1uQCVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR|2^20|1:32\n      push: 'crypto',\n      reg: /^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,\n      names: ['id', 'suite', 'config', 'sessionConfig'],\n      format: function (o) {\n        return (o.sessionConfig != null) ?\n          \"crypto:%d %s %s %s\":\n          \"crypto:%d %s %s\";\n      }\n    },\n    { //a=setup:actpass\n      name: 'setup',\n      reg: /^setup:(\\w*)/,\n      format: \"setup:%s\"\n    },\n    { //a=mid:1\n      name: 'mid',\n      reg: /^mid:([^\\s]*)/,\n      format: \"mid:%s\"\n    },\n    { //a=msid:0c8b064d-d807-43b4-b434-f92a889d8587 98178685-d409-46e0-8e16-7ef0db0db64a\n      name: 'msid',\n      reg: /^msid:(.*)/,\n      format: \"msid:%s\"\n    },\n    { //a=ptime:20\n      name: 'ptime',\n      reg: /^ptime:(\\d*)/,\n      format: \"ptime:%d\"\n    },\n    { //a=maxptime:60\n      name: 'maxptime',\n      reg: /^maxptime:(\\d*)/,\n      format: \"maxptime:%d\"\n    },\n    { //a=sendrecv\n      name: 'direction',\n      reg: /^(sendrecv|recvonly|sendonly|inactive)/\n    },\n    { //a=ice-lite\n      name: 'icelite',\n      reg: /^(ice-lite)/\n    },\n    { //a=ice-ufrag:F7gI\n      name: 'iceUfrag',\n      reg: /^ice-ufrag:(\\S*)/,\n      format: \"ice-ufrag:%s\"\n    },\n    { //a=ice-pwd:x9cml/YzichV2+XlhiMu8g\n      name: 'icePwd',\n      reg: /^ice-pwd:(\\S*)/,\n      format: \"ice-pwd:%s\"\n    },\n    { //a=fingerprint:SHA-1 00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33\n      name: 'fingerprint',\n      reg: /^fingerprint:(\\S*) (\\S*)/,\n      names: ['type', 'hash'],\n      format: \"fingerprint:%s %s\"\n    },\n    {\n      //a=candidate:0 1 UDP 2113667327 203.0.113.1 54400 typ host\n      //a=candidate:1162875081 1 udp 2113937151 192.168.34.75 60017 typ host generation 0\n      //a=candidate:3289912957 2 udp 1845501695 193.84.77.194 60017 typ srflx raddr 192.168.34.75 rport 60017 generation 0\n      //a=candidate:229815620 1 tcp 1518280447 192.168.150.19 60017 typ host tcptype active generation 0\n      //a=candidate:3289912957 2 tcp 1845501695 193.84.77.194 60017 typ srflx raddr 192.168.34.75 rport 60017 tcptype passive generation 0\n      push:'candidates',\n      reg: /^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?/,\n      names: ['foundation', 'component', 'transport', 'priority', 'ip', 'port', 'type', 'raddr', 'rport', 'tcptype', 'generation'],\n      format: function (o) {\n        var str = \"candidate:%s %d %s %d %s %d typ %s\";\n\n        str += (o.raddr != null) ? \" raddr %s rport %d\" : \"%v%v\";\n\n        // NB: candidate has three optional chunks, so %void middles one if it's missing\n        str += (o.tcptype != null) ? \" tcptype %s\" : \"%v\";\n\n        if (o.generation != null) {\n          str += \" generation %d\";\n        }\n        return str;\n      }\n    },\n    { //a=end-of-candidates (keep after the candidates line for readability)\n      name: 'endOfCandidates',\n      reg: /^(end-of-candidates)/\n    },\n    { //a=remote-candidates:1 203.0.113.1 54400 2 203.0.113.1 54401 ...\n      name: 'remoteCandidates',\n      reg: /^remote-candidates:(.*)/,\n      format: \"remote-candidates:%s\"\n    },\n    { //a=ice-options:google-ice\n      name: 'iceOptions',\n      reg: /^ice-options:(\\S*)/,\n      format: \"ice-options:%s\"\n    },\n    { //a=ssrc:2566107569 cname:t9YU8M1UxTF8Y1A1\n      push: \"ssrcs\",\n      reg: /^ssrc:(\\d*) ([\\w_]*):(.*)/,\n      names: ['id', 'attribute', 'value'],\n      format: \"ssrc:%d %s:%s\"\n    },\n    { //a=ssrc-group:FEC 1 2\n      push: \"ssrcGroups\",\n      reg: /^ssrc-group:(\\w*) (.*)/,\n      names: ['semantics', 'ssrcs'],\n      format: \"ssrc-group:%s %s\"\n    },\n    { //a=msid-semantic: WMS Jvlam5X3SX1OP6pn20zWogvaKJz5Hjf9OnlV\n      name: \"msidSemantic\",\n      reg: /^msid-semantic:\\s?(\\w*) (\\S*)/,\n      names: ['semantic', 'token'],\n      format: \"msid-semantic: %s %s\" // space after \":\" is not accidental\n    },\n    { //a=group:BUNDLE audio video\n      push: 'groups',\n      reg: /^group:(\\w*) (.*)/,\n      names: ['type', 'mids'],\n      format: \"group:%s %s\"\n    },\n    { //a=rtcp-mux\n      name: 'rtcpMux',\n      reg: /^(rtcp-mux)/\n    },\n    { //a=rtcp-rsize\n      name: 'rtcpRsize',\n      reg: /^(rtcp-rsize)/\n    },\n    { // any a= that we don't understand is kepts verbatim on media.invalid\n      push: 'invalid',\n      names: [\"value\"]\n    }\n  ]\n};\n\n// set sensible defaults to avoid polluting the grammar with boring details\nObject.keys(grammar).forEach(function (key) {\n  var objs = grammar[key];\n  objs.forEach(function (obj) {\n    if (!obj.reg) {\n      obj.reg = /(.*)/;\n    }\n    if (!obj.format) {\n      obj.format = \"%s\";\n    }\n  });\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-transform/lib/grammar.js\n// module id = 221\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 222\n// module chunks = 0","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport {\n  assertPriv,\n  binaryStringToArrayBuffer,\n  bufferToHex,\n  noVendor,\n  randomString,\n} from 'common/utils'\nimport Request from 'common/request'\n\nimport {parseSynapseErrorResponse} from 'matrix/errors'\n\n/**\n * An object containing the necessary information to connect and authenticate to a server.\n *\n * The serverUrl will be used as base for all requests, and must include protocol\n * and hostname, optionally port, and nothing else. A trailing slash is an error.\n *\n * The home serverName is appended to all ids that are generated, using the\n * following pattern: `<symbol><id>:<serverName>`\n * Where symbol is `@` for user ids, `!` for room ids, and `#` for room aliases.\n *\n * By default the serverName is parsed from the userId, but can also be set explicitly.\n * AuthInfo objects returned by the built-in authentication functions will not set the serverName,\n * so it will have to be set as a middle step before passing the authInfo on to {@link Client#auth}.\n *\n *\n * @typedef {Object} AuthInfo\n * @property {string} serverUrl - The absolute url of the home server.\n * @property {string} [serverName] - An optional server name, will be parsed from the userId if not present.\n * @property {string} [userId] - An optional user id that should match the user id of the access token,\n *   otherwise authentication will fail.\n * @property {string} accessToken - The access token\n */\n\n/**\n * Represents a step in an authentication flow. Currently all authenication\n * flows only use a single step, so this function is used as a namespace\n * for static atuhentication functions.\n *\n * @class Auth\n * @abstract\n */\n\nexport default function Auth(priv) {\n  assertPriv('Auth', priv)\n}\n\n/**\n * Login a user using username and password.\n * ##### Errors:\n * - {@link AuthenticationError} - The username or password is incorrect.\n *\n * @param {Object} options - Configuration object.\n * @param {string} options.serverUrl - The absolute url of the home server.\n * @param {UserId} options.username - The username.\n * @param {string} options.password - The password.\n * @returns {Promise<AuthInfo, CctError>} - Auth info or an error.\n */\nAuth.loginWithPassword = function (options) {\n  argCheck.options('Auth.loginWithPassword', 'options', options)\n        .string('serverUrl')\n        .string('username')\n        .string('password')\n\n  return Auth._simpleAuthRequest({\n    serverUrl: options.serverUrl,\n  }, 'login', {\n    type: 'm.login.password',\n    user: options.username,\n    password: options.password,\n  })\n}\n\n// eslint-disable-next-line jsdoc/require-description-complete-sentence\n/**\n * Register a new user.\n *\n * A registration secret should be used iff the server is configured to only allow\n * registration using a secret token. The secret token is used to compute an HMAC\n * and is not sent to the server.\n * ##### Errors:\n * - {@link ConflictError} - The username is taken.\n * - {@link InvalidUsernameError} - The username contains invalid characters.\n * - {@link AuthenticationError} - The provided secret was incorrect.\n * - {@link NotAllowedError} - No secret was provided but the server requires one.\n *\n * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n *\n * @param {Object} options - Configuration object.\n * @param {string} options.serverUrl - The absolute url of the home server.\n * @param {UserId} options.username - The username.\n * @param {string} options.password - The password.\n * @param {string} [options.secret] - Shared registration secret.\n * @returns {Promise<AuthInfo, CctError>} - Auth info or an error.\n *\n */\nAuth.registerWithPassword = function (options) {\n  argCheck.options('Auth.registerWithPassword', 'options', options)\n        .string('serverUrl')\n        .string('username')\n        .string('password')\n        .optString('secret')\n\n  var body = {\n    auth: {\n      session: randomString(20),\n      type: 'm.login.dummy',\n    },\n    username: options.username,\n    password: options.password,\n  }\n  var req = Auth._simpleAuthRequest.bind(0, {\n    serverUrl: options.serverUrl,\n  }, 'register')\n\n  if ('secret' in options) {\n    return Auth._createHmac(options).then(function (mac) {\n      body.auth.type = 'org.matrix.login.shared_secret'\n      body.mac = mac\n      return req(body)\n    })\n  }\n\n  return req(body)\n}\n\n/**\n * Set a new password using an existing login session and the old password.\n * ##### Errors:\n * - {@link AuthenticationError} - The provided session is invalid, or the old password is incorrecct.\n *\n * @param {Object} options - Configuration object.\n * @param {AuthInfo} options.authInfo - Auth info object.\n * @param {string} options.oldPassword - Old password.\n * @param {string} options.newPassword - New password.\n * @returns {Promise<AuthInfo, CctError>} - Auth info or an error.\n */\nAuth.resetPasswordWithPassword = function (options) {\n  argCheck.options('Auth.resetPasswordWithPassword', 'options', options)\n        .object('authInfo')\n        .string('oldPassword')\n        .string('newPassword')\n\n  var authInfo = options.authInfo\n  argCheck.options('Auth.resetPasswordWithPassword', 'options.authInfo', options.authInfo)\n        .string('serverUrl')\n        .string('userId')\n        .string('accessToken')\n\n  return Request()\n        .errorHandler(parseSynapseErrorResponse)\n        .origin(authInfo.serverUrl)\n        .path('_matrix', 'client', 'v2_alpha', 'account', 'password')\n        .query('access_token', authInfo.accessToken)\n        .post({\n          auth: {\n            type: 'm.login.password',\n            user: authInfo.userId,\n            password: options.oldPassword,\n          },\n          new_password: options.newPassword,\n        })\n        .then(function (response) {\n          return response.body\n        }, function (response) {\n          throw response\n        })\n}\n\n/**\n * Register a new account with a generated username.\n * This should primarily be used for testing.\n *\n * A password can optionally be added to the account.\n * ##### Errors:\n * - {@link AuthenticationError} - The provided secret was incorrect.\n * - {@link NotAllowedError} - No secret was provided but the server requires one.\n *\n * @param {Object} options - Configuration object.\n * @param {string} options.serverUrl - The absolute url of the home server.\n * @param {string} [options.password] - The password to use for the account.\n * @param {string} [options.secret] - Shared registration secret.\n * @returns {Promise<AuthInfo, CctError>} - Auth info or an error.\n */\nAuth.anonymous = function (options) {\n  argCheck.options('Auth.anonymous', 'options', options)\n        .string('serverUrl')\n        .optString('password')\n        .optString('secret')\n\n  let body = {\n    auth: {\n      session: randomString(20),\n      type: 'm.login.dummy',\n    },\n    password: options.password || randomString(32),\n  }\n  let req = Auth._simpleAuthRequest.bind(0, {\n    serverUrl: options.serverUrl,\n  }, 'register')\n\n  if ('secret' in options) {\n    body.username = Math.random().toString(16).slice(2) + Math.random().toString(16).slice(2)\n    return Auth._createHmac({username: body.username, secret: options.secret}).then(mac => {\n      body.auth.type = 'org.matrix.login.shared_secret'\n      body.mac = mac\n      return req(body)\n    })\n  }\n\n  return req(body)\n}\n\n/**\n * Authenticate as a guest user with a generated user id. Guest accounts are limited\n * to a subset of the functionality of full acounts.\n *\n * At the moment guests are only allowed to join rooms where `room.guestAccess` has been\n * set to 'open'. They are not allowed to modify the state of a room, but can send messages\n * and setup calls.\n *\n * Guests are also not able to set their avatar or status, but they can set their display name.\n * ##### Errors:\n * - {@link GuestAccessError} - Guest access is not enabled in the target server.\n *\n * @param {Object} options - Configuration object.\n * @param {string} options.serverUrl - The absolute url of the home server.\n * @returns {Promise<AuthInfo, CctError>} - Auth info or an error.\n */\nAuth.guest = function (options) {\n  argCheck.options('Auth.anonymous', 'options', options)\n        .string('serverUrl')\n\n  return Request()\n        .errorHandler(parseSynapseErrorResponse)\n        .origin(options.serverUrl)\n        .path('_matrix', 'client', 'r0', 'register')\n        .query('kind', 'guest')\n        .post({})\n        .then(function (response) {\n          var authInfo = {\n            serverUrl: options.serverUrl,\n          }\n          authInfo.accessToken = response.body.access_token\n          authInfo.userId = response.body.user_id\n          if (response.body.refresh_token) {\n            authInfo.refreshToken = response.body.refresh_token\n          }\n          return authInfo\n        }, function (response) {\n          throw response\n        })\n}\n\nAuth._simpleAuthRequest = function (authInfo, path, body) {\n  return Request()\n        .errorHandler(parseSynapseErrorResponse)\n        .origin(authInfo.serverUrl)\n        .path('_matrix', 'client', 'r0', path)\n        .post(body)\n        .then(function (response) {\n          authInfo.accessToken = response.body.access_token\n          authInfo.userId = response.body.user_id\n          if (response.body.refresh_token) {\n            authInfo.refreshToken = response.body.refresh_token\n          }\n          return authInfo\n        }, function (response) {\n          throw response\n        })\n}\n\nAuth._createHmac = function ({username, secret}) {\n  if (process.env.NODEJS) {\n    return Promise.resolve().then(() => {\n      let hmac = require('crypto').createHmac('sha1', secret)\n      hmac.update(username)\n      return hmac.digest('hex')\n    })\n  } else {\n    let rawKey = binaryStringToArrayBuffer(secret)\n    let data = binaryStringToArrayBuffer(username)\n    let crypto = noVendor(window, 'crypto')\n    let subtle = noVendor(crypto, 'subtle')\n\n    let promise = subtle.importKey('raw', rawKey, {\n      name: 'HMAC',\n      hash: {\n        name: 'SHA-1',\n      },\n    }, false, ['sign'])\n    if (promise.then) {\n      return promise.then(key => {\n        return subtle.sign(key.algorithm, key, data)\n      }).then(bufferToHex)\n    } else {\n      // IE11 webcrypto is not promise based\n      // Edge is promise based\n      return new Promise(resolve => {\n        promise.oncomplete = e => {\n          let key = e.target.result\n          subtle.sign(key.algorithm, key, data).oncomplete = e => {\n            resolve(bufferToHex(e.target.result))\n          }\n        }\n      })\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/auth.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport Reporter from 'common/reporter'\nimport Request, {SerializedJsonRetryClient, FileUploadClient} from 'common/request'\nimport {NotFoundError, UnknownError} from 'common/errors'\nimport {\n  binaryStringToArrayBuffer,\n  find,\n  getter,\n  isObject,\n  parseDataUri,\n  priv,\n  prop,\n  registerInstance,\n  shallowCopy,\n  unregisterInstance,\n  urlSafeBase64ToUtf8,\n} from 'common/utils'\n\nimport AccountData from 'matrix/accountData'\nimport CallRegistry from 'matrix/callRegistry'\nimport ImageResource, {createImageResourceFactory} from 'matrix/resources'\nimport RoomQuery from 'matrix/roomQuery'\nimport RoomRegistry from 'matrix/roomRegistry'\nimport SyncStream from 'matrix/syncStream'\nimport UserRegistry, {toUserId} from 'matrix/userRegistry'\nimport {parseSynapseErrorResponse, AuthenticationError} from 'matrix/errors'\nimport {parseId, toMatrixIdForServer} from 'matrix/ids'\nimport {PowerLevelsEdit, PowerLevelsReader} from 'matrix/powerLevels'\n\nconst API_VERSION = 'r0.0.1'\n\n// eslint-disable-next-line\n/**\n * Represents a client.\n *\n * @class Client\n * @extends EventEmitter\n * @param {Object} [options] - An object with extra options.\n * @param {IceServer|IceServer[]} [options.iceServers] - One or more helper servers to use as default for all calls.\n * @param {IceCandidateFilter} [options.iceCandidateFilter] - A function used to\n *   filter the ice candidates in all calls and conferences.\n * @param {string} [options.statsUrl] - The stats report URL to which to post, e.g. `https://example.com/path`.\n */\nexport default function Client(options) {\n  argCheck.optOptions('Client', 'options', options)\n        .optString('statsUrl')\n        .optFunc('iceCandidateFilter')\n\n  var self = this\n  options = options || {}\n  var authedRequest = null\n  var activeAuthInfo = null\n  var user = null\n  var imageResourceFactory = null\n  var userRegistry = new UserRegistry()\n  var roomRegistry = new RoomRegistry({\n    delegate: this,\n  })\n  var callRegistry = new CallRegistry({\n    userRegistry: userRegistry,\n    roomRegistry: roomRegistry,\n    delegate: this,\n  })\n  this._syncStream = new SyncStream({\n    userRegistry: userRegistry,\n    roomRegistry: roomRegistry,\n    delegate: this,\n  })\n  var iceServers = [].concat(options.iceServers || [])\n  var iceCandidateFilter = options.iceCandidateFilter || null\n  var roomQueries = []\n  var userRequests = {}\n  var reporter = null\n\n  this._setAccountData = this._setAccountData.bind(this)\n  this._accountData = priv(AccountData, this._setAccountData)\n\n  if (options.statsUrl) {\n    reporter = new Reporter(options.statsUrl)\n  }\n\n  function authed() {\n    if (!authedRequest) {\n      return Promise.reject(new AuthenticationError('not authenticated'))\n    } else {\n      return Promise.resolve(authedRequest)\n    }\n  }\n\n  /**\n   * Forgets the auth session and resets the client state.\n   *\n   * @function Client#logout\n   */\n  function logout() {\n    if (!authedRequest) {\n      return\n    }\n    authedRequest = null\n    activeAuthInfo = null\n    user = null\n    callRegistry.clear()\n    roomRegistry.clear()\n    roomQueries.forEach(function (query) {\n      return query._clear()\n    })\n    userRequests = {}\n    userRegistry.clear()\n    imageResourceFactory = null\n    self._syncStream.stop()\n    self._accountData._clear()\n    unregisterInstance('client', self)\n  }\n\n  /**\n   * Set the name of the authenticated user.\n   *\n   * There is no guarantee that `client.user.name` will be up to date if and when\n   * the returned promise is resolved. UI updates to reflect the new name should\n   * instead be triggered by the 'name' event of the user.\n   * ##### Errors:\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * @function Client#setName\n   * @param {string} name - A new name, or `null`.\n   * @returns {Promise<string, CctError>} - The name.\n   */\n  function setName(name) {\n    argCheck.optString('client.setName', 'name', name)\n    return authed().then(authedRequest => {\n      return authedRequest.setName.put({displayname: name}).then(() => name)\n    })\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Set the avatar of the authenticated user. The avatar can be either a\n   * {@link MatrixContentUri}, or an {@link ImageResource}.\n   *\n   * Typical usage is to first upload an image file using {@link Client#uploadMedia},\n   * and then setting it as the avatar.\n   *\n   * There is no guarantee that `client.user.avatar` will be up to date if and when\n   * the returned promise is resolved. UI updates to reflect the new avatar should\n   * instead be triggered by the 'avatar' event of the user.\n   * ##### Errors:\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   * - {@link GuestAccessError} - Guests are not allowed to set an avatar.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Client#setAvatar\n   * @param {MatrixContentUri|ImageResource} avatar - A new avatar url or image resource, or null.\n   * @returns {Promise<ImageResource, CctError>} - The avatar.\n   */\n  function setAvatar(avatar) {\n    argCheck.count('client.setAvatar', 1, arguments.length)\n    if (!activeAuthInfo) {\n      let msg = 'client.setAvatar: client needs to be authenticated to set an avatar'\n      return Promise.reject(new AuthenticationError(msg))\n    }\n    var avatar_url\n    if (avatar) {\n      if (!(avatar instanceof ImageResource)) {\n        argCheck.string('client.setAvatar', 'avatar', avatar)\n        avatar = imageResourceFactory(avatar)\n      }\n      avatar_url = avatar.resourceUri\n    } else {\n      avatar_url = null\n      avatar = null\n    }\n    return authed().then(authedRequest => {\n      return authedRequest.setAvatar.put({avatar_url}).then(() => avatar)\n    })\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Sets the status of the authenticated user.\n   * ##### Errors:\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   * - {@link GuestAccessError} - Guests are not allowed to set their status.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Client#setStatus\n   * @param {Object} status - An object describing the status of the authenticated user.\n   * @param {\"online\"|\"unavailable\"|\"offline\"} [status.presence] - The presence type to set.\n   * @param {string} [status.statusMessage] - A status message to display to other users.\n   * @returns {Promise<Client, CctError>} - The client.\n   */\n  function setStatus(status) {\n    argCheck.options('client.setStatus', 'status', status)\n            .optValues('presence', ['online', 'unavailable', 'offline'])\n            .optStringOrEmpty('statusMessage')\n\n    var presence = status.presence || user.presence\n    return authed().then(authedRequest => {\n      return authedRequest.setStatus.put({\n        presence: presence,\n        status_msg: status.statusMessage,\n      }).then(() => self)\n    })\n  }\n\n  /**\n   * The state of the client.\n   * @readonly\n   * @member Client#state {ClientConnectionState}\n   */\n  Object.defineProperty(this, 'state', {\n    enumerable: true,\n    get: function () {\n      return this._syncStream.state\n    },\n  })\n\n  /**\n   * Authenticates the client using authentication information that has been obtained\n   * in some way, usually using {@link Auth}.\n   * ##### Errors:\n   * - {@link NotAllowedError} - The provided authentication information is invalid.\n   *\n   * @function Client#auth\n   * @param {AuthInfo} authInfo - An object containing the necessary information\n   * to connect and authenticate to a server.\n   * @returns {Promise<Client, CctError>} - The client or error.\n   */\n  function auth(authInfo) {\n    argCheck.options('client.auth', 'authInfo', authInfo)\n            .string('accessToken')\n            .string('serverUrl')\n            .optString('userId')\n            .optString('serverName')\n\n    return new Promise(resolve => {\n      activeAuthInfo = authInfo\n      registerInstance('client', self)\n\n      // Allow trailing slash in serverUrl, but remove it here\n      const serverUrl = authInfo.serverUrl = authInfo.serverUrl.replace(/\\/$/, '')\n\n      // Decode the macaroon and read the userId\n      let rawMacaroon\n      try {\n        rawMacaroon = urlSafeBase64ToUtf8(authInfo.accessToken)\n      } catch (error) {\n        throw new AuthenticationError(`Failed to decode access token: ${error}`)\n      }\n      let macaroonMatch = rawMacaroon.match(/^[0-9a-f]{4}cid user_id = (.*)$/m)\n      if (!macaroonMatch) {\n        throw new AuthenticationError('Access token is malformed, no user info present')\n      }\n      let matrixUserId = macaroonMatch[1]\n\n      // authInfo.userId is optional, but if it's present, make sure it matches the macaroon\n      if (authInfo.userId && authInfo.userId !== matrixUserId) {\n        throw new AuthenticationError('Invalid auth info, userId does not match the token')\n      }\n\n      let serverName = parseId(matrixUserId)[2]\n\n      if ('serverName' in authInfo) {\n        if (serverName !== authInfo.serverName) {\n          let msg = `Invalid auth info, serverName does not match, '${serverName}' != '${auth.serverName}'`\n          throw new AuthenticationError(msg)\n        }\n      }\n      authInfo.serverName = serverName\n\n      imageResourceFactory = createImageResourceFactory(serverUrl)\n      userRegistry.init({\n        serverName,\n        ownMatrixUserId: matrixUserId,\n        imageResourceFactory: imageResourceFactory,\n      })\n\n      var baseRequest = Request()\n              .client(new SerializedJsonRetryClient())\n              .errorHandler(parseSynapseErrorResponse)\n              .origin(serverUrl)\n              .path('_matrix')\n              .query('access_token', authInfo.accessToken)\n              .params('userId', matrixUserId)\n\n      authedRequest = baseRequest.path('client', 'r0')\n      self._authedRequest = authedRequest\n\n      var profile = authedRequest.path('profile', '{userId}')\n\n      authedRequest.profile = profile\n      authedRequest.setName = profile.path('displayname')\n      authedRequest.setAvatar = profile.path('avatar_url')\n      authedRequest.getPublicRooms = authedRequest.path('publicRooms')\n      authedRequest.createRoom = authedRequest.path('createRoom')\n      authedRequest.directory = authedRequest.path('directory', 'room')\n      authedRequest.setAccountData = authedRequest.path('user', '{userId}', 'account_data')\n      authedRequest.setStatus = authedRequest.path('presence', '{userId}', 'status')\n      // Used to check if a room exists, there might be a better way to do this in the future\n      authedRequest.leaveRoom = authedRequest.path('rooms', '{roomId}', 'leave')\n      authedRequest.uploadMedia = baseRequest\n        .client(new FileUploadClient())\n        .errorHandler(parseSynapseErrorResponse)\n        .path('media', 'v1', 'upload')\n\n      user = userRegistry.getUser(matrixUserId)\n\n      // TODO: remove call-specific dependencies\n      roomRegistry.init({\n        ownUser: user,\n        delegate: self,\n        baseRequest: authedRequest,\n        serverName,\n        userRegistry,\n        callRegistry,\n        imageResourceFactory,\n      })\n\n      callRegistry.init({\n        ownUser: user,\n        reporter: reporter,\n        iceServers: iceServers,\n        iceCandidateFilter: iceCandidateFilter,\n        baseRequest: authedRequest,\n      })\n\n      resolve(authedRequest)\n    }).then(authedRequest => {\n      return self._syncStream.start({authedRequest}).catch(error => {\n        logout()\n        throw error\n      })\n    }).then(() => {\n      var foundMemberRoom = find(self.rooms, room => room.membership === 'member')\n      if (!foundMemberRoom) {\n        return self.fetchUser(self.user.id)\n      }\n    }).then(() => {\n      // This is done in parallel, don't return promise\n      Request().origin(authInfo.serverUrl)\n        .path('_matrix', 'client', 'versions')\n        .get()\n        .then(res => {\n          let versions = res.body && res.body.versions\n          if (!Array.isArray(versions)) {\n            log.error(self.tag, `invalid versions response: ${res.body}`)\n          }\n          if (versions.indexOf(API_VERSION) === -1) {\n            log.error(self.tag, `invalid server version: ${versions.join(', ')}`)\n          }\n        })\n        .catch(error => {\n          log.error(self.tag, `version check request failed: ${error}`)\n        })\n    }).then(() => self)\n  }\n\n  /**\n   * Room configuration passed to {@link Client#createRoom}.\n   *\n   * @typedef {Object} Client.RoomConfiguration\n   * @property {UserId|User|UserId[]|User[]} [invite] - A single or list of users\n   * to invite when creating the room.\n   * @property {string} [name] - The display name of the room.\n   * @property {string} [type] - The type that should be assigned to the room.\n   * @property {string} [topic] - The topic to display for the room.\n   * @property {MatrixContentUri|ImageResource} [avatar] - The avatar for the room.\n   * @property {RoomAlias} [alias] - A local alias for the room id.\n   * @property {PowerLevelsEdit|PowerLevelsReader} [powerLevels] - The initial\n   *  power levels in the room.\n   * @property {Room~HistoryVisibility} [historyVisibility='shared'] - The desired\n   *  history visibility of the room.\n   * @property {Room~JoinRule} [joinRule] - The desired join rule of the room.\n   *  By default it will match the visiblity of the room, meaning that a public room\n   *  will use the `'open'` join rule while a private room will user `'invite'`.\n   * @property {Room~GuestAccessRule} [guestAccessRule='closed'] - The desired guest access rule of the room.\n   * @property {JsonTypes} [creationContent] - Values that will be accessible via {@link Room#creationContent}\n   *  and can not be changed by anyone.\n   * @property {Object[]} [state] - An array of custom initial states of the room.\n   * @property {string} state.type - The type of the state.\n   * @property {string} [state.stateKey] - An optional state key.\n   * @property {*} state.content - The content of the state.\n   * @property {Object} [recording] - Recording options object. Will only work if the server has enabled recording.\n   * @property {Object} recording.meta - The room-level metadata object that will be stored together with the recording.\n   */\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Creates a new room.\n   * ##### Errors:\n   * - {@link ConflictError} - The room alias already exists.\n   * - {@link InvalidAliasError} - The room alias is invalid\n   * - {@link GuestAccessError} - Guests are not allowed to create new rooms.\n   * - {@link NotAllowedError} - If creating a room with modified power levels this may happen\n   *     when setting the own user's power level too low.\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * @function Client#createRoom\n   * @param {Client.RoomConfiguration} [options] - Room configuration.\n   * @returns {Promise<Room, CctError>} - Auth information or error.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @example\n   * client.createRoom().then(room => {\n   *   console.log('Created room: ' + room)\n   * })\n   *\n   * @example\n   * client.createRoom({\n   *   type: 'meeting',\n   *   name: 'Meeting with Bob',\n   *   topic: 'Widget production schedule',\n   *   invite: 'bob',\n   * }).then(room => {\n   *   console.log('Created meeting with bob: ' + room)\n   * }).catch(error => {\n   *   console.error('Failed to create meeting with bob: ' + error)\n   * })\n   */\n  function createRoom(options) {\n    argCheck.optOptions('client.createRoom', 'options', options)\n            .optString('alias')\n            .optString('name')\n            .optString('topic')\n            .optString('type')\n            .optArray('state')\n            .optObject('recording')\n            .optObject('powerLevels')\n            .optValues('historyVisibility', ['shared', 'invited', 'joined', 'public'])\n            .optValues('_visibility', ['private', 'public'])\n            .optValues('joinRule', ['open', 'invite'])\n            .optValues('guestAccessRule', ['open', 'closed'])\n\n    options = options || {}\n    var visibility = options._visibility || 'private'\n    var avatar = options.avatar || null\n    var invite\n    var state = []\n    if ('invite' in options) {\n      if (Array.isArray(options.invite)) {\n        invite = options.invite.map((user, index) => {\n          return toUserId(`createRoom.invite[${index}]`, user, activeAuthInfo.serverName)\n        })\n      } else {\n        let matrixId = toUserId('createRoom.invite', options.invite, activeAuthInfo.serverName)\n        invite = [matrixId]\n      }\n    }\n    if (visibility === 'public' && !options.alias) {\n      throw new TypeError('client.createRoom: public rooms require an alias, got \"' + options.alias + '\"')\n    }\n    if (options.state) {\n      var stateMap = {}\n      state = options.state.map(function (stateDesc) {\n        argCheck.options('client.createRoom', 'options.state', stateDesc)\n                    .string('type')\n                    .optString('stateKey')\n        var content = stateDesc.content\n        if (!isObject(content)) {\n          content = {\n            __value__: content,\n          }\n        }\n        var ret = {\n          type: stateDesc.type,\n          content: content,\n        }\n        if (stateDesc.stateKey) {\n          ret.state_key = stateDesc.stateKey\n        }\n        if (stateMap[ret.type]) {\n          if (stateMap[ret.type][ret.state_key || '']) {\n            argCheck.error('client.createRoom', 'options.state', 'duplicate initial state not allowed')\n          } else {\n            stateMap[ret.type][ret.state_key || ''] = true\n          }\n        } else {\n          stateMap[ret.type] = {}\n          stateMap[ret.type][ret.state_key || ''] = true\n        }\n        return ret\n      })\n      if (stateMap['m.room.create']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.create')\n      } else if (stateMap['m.room.member']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.member')\n      } else if (stateMap['m.room.name']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.name')\n      } else if (stateMap['m.room.avatar']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.avatar')\n      } else if (stateMap['m.room.topic']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.topic')\n      } else if (stateMap['m.room.join_rules']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.join_rules')\n      } else if (stateMap['m.room.power_levels']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: m.room.power_levels')\n      } else if (stateMap['com.ericsson.room.type']) {\n        argCheck.error('client.createRoom', 'options.state', 'must not contain state: com.ericsson.room.type')\n      }\n    }\n    if (avatar) {\n      if (!(avatar instanceof ImageResource)) {\n        argCheck.string('room.createRoom', 'options.avatar', avatar)\n        avatar = imageResourceFactory(avatar)\n      }\n      state.push({\n        type: 'm.room.avatar',\n        content: {\n          url: avatar.resourceUri,\n        },\n      })\n    }\n    if (options.historyVisibility) {\n      state.push({\n        type: 'm.room.history_visibility',\n        content: {\n          history_visibility: options.historyVisibility,\n        },\n      })\n    }\n    if (options.joinRule) {\n      var differentJoinRule = null\n      if (options.joinRule === 'invite' && visibility === 'public') {\n        differentJoinRule = 'invite'\n      } else if (options.joinRule === 'open' && visibility === 'private') {\n        differentJoinRule = 'public'\n      }\n      if (differentJoinRule) {\n        state.push({\n          type: 'm.room.join_rules',\n          content: {\n            join_rule: differentJoinRule,\n          },\n        })\n      }\n    }\n    // Only allow guest access if it is explicitly set to open\n    let guestAccessRule = options.guestAccessRule === 'open' ? 'can_join' : 'forbidden'\n    state.push({\n      type: 'm.room.guest_access',\n      content: {\n        guest_access: guestAccessRule,\n      },\n    })\n    if (options.powerLevels) {\n      var isEdit = options.powerLevels instanceof PowerLevelsEdit\n      var isReader = options.powerLevels instanceof PowerLevelsReader\n      if (!isEdit && !isReader) {\n        argCheck.error('client.createRoom', 'options.powerLevels',\n                    'must be an instance of PowerLevelsEdit or PowerLevelsReader')\n      }\n      state.push({\n        type: 'm.room.power_levels',\n        content: options.powerLevels.toRawForServer(activeAuthInfo.serverName),\n      })\n    }\n    let creationContent = {\n      c3Content: options.creationContent || null,\n    }\n    if (options.type) {\n      creationContent.cctRoomType = options.type\n    }\n    let recording = options.recording\n    if (recording) {\n      argCheck.options('client.createRoom', 'options.recording', recording)\n        .optObject('meta')\n        .optObject('mediaServiceId')\n\n      let mediaServiceId = options.mediaServiceId || 'c3-media-service'\n      let mediaService = `@${mediaServiceId}:${activeAuthInfo.serverName}`\n      if (invite) {\n        if (invite.indexOf(mediaService) === -1) {\n          invite.push(mediaService)\n        }\n      } else {\n        invite = [mediaService]\n      }\n\n      creationContent.c3Recording = {\n        meta: recording.meta || null,\n      }\n    }\n    var lastState\n    // Current order in synapse, might change. listed in synapse/handlers/room.py\n    if (options.alias) {\n      lastState = {type: 'm.room.aliases'}\n    } else if (options.topic) {\n      lastState = {type: 'm.room.topic'}\n    } else if (options.name) {\n      lastState = {type: 'm.room.name'}\n    } else if (state.length) {\n      lastState = {\n        type: state[state.length - 1].type,\n        stateKey: state[state.length - 1].state_key,\n      }\n    } else {\n      lastState = {type: 'm.room.guest_access'}\n    }\n    return authed().then(authedRequest => {\n      return authedRequest.createRoom.post({\n        visibility: visibility,\n        room_alias_name: options.alias || undefined,\n        name: options.name || undefined,\n        topic: options.topic || undefined,\n        invite: invite,\n        initial_state: state,\n        creation_content: creationContent,\n      }).then(res => {\n        if (!activeAuthInfo) {\n          throw new AuthenticationError('client was no longer authenticated when receiving response')\n        }\n        return roomRegistry.waitForRoom(res.body.room_id, lastState, invite || [])\n      })\n    })\n  }\n\n  /**\n   * Look up and retrieve a room by alias.\n   * ##### Errors:\n   * - {@link NotFoundError} - The alias does not exist.\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * @function Client#fetchRoomByAlias\n   * @param {RoomAlias} alias - The alias of the room.\n   * @returns {Promise<Room, CctError>} - The room.\n   */\n  function fetchRoomByAlias(alias) {\n    argCheck.string('client.fetchRoomByAlias', 'alias', alias)\n    if (!activeAuthInfo) {\n      let msg = 'client.fetchRoomByAlias: client needs to be authenticated to get rooms by alias'\n      return Promise.reject(new AuthenticationError(msg))\n    }\n    let fullAlias = toMatrixIdForServer('fetchRoomByAlias', alias, activeAuthInfo.serverName, 'alias')\n    return authed().then(authedRequest => {\n      return authedRequest.directory.get(fullAlias).then(res => {\n        if (!activeAuthInfo) {\n          throw new AuthenticationError('client was no longer authenticated when receiving response')\n        }\n        return roomRegistry.getOrCreateEmptyRoom(res.body.room_id)\n      })\n    }).catch(error => {\n      if (error.name === 'InternalServerError' && alias.indexOf(':') !== -1) {\n        let msg = `Room alias server not found: '${alias.split(':').slice(1).join(':')}'`\n        throw new NotFoundError(msg)\n      }\n      throw error\n    })\n  }\n\n  /**\n   * Retreive a room by id, and fail if it doesn't exist.\n   *\n   * If one can be certain that the room id points to a valid room, it is usually\n   * better to use {@link Client#getRoom} instead. This method should be used\n   * if the room id is received e.g. via user input, and it's required to check\n   * if the room exists before trying to join it.\n   * ##### Errors:\n   * - {@link NotFoundError} - The room does not exist.\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * @function Client#fetchRoomById\n   * @param {RoomId} id - The id of the room.\n   * @returns {Promise<Room, CctError>} The room.\n   */\n  function fetchRoomById(id) {\n    argCheck.string('client.fetchRoomById', 'id', id)\n    if (!activeAuthInfo) {\n      let msg = 'client.fetchRoomById: client needs to be authenticated to get room by id'\n      return Promise.reject(new AuthenticationError(msg))\n    }\n    let matrixRoomId = toMatrixIdForServer('fetchRoomById', id, activeAuthInfo.serverName, 'room')\n    var room = roomRegistry.getRoom(matrixRoomId)\n    if (room) {\n      return Promise.resolve(room)\n    }\n    return authedRequest.leaveRoom.params('roomId', matrixRoomId).post().then(response => {\n      log.error(self.tag, 'unexpected successful response when checking if room exists:', response)\n      throw new UnknownError('Failed to check if room exists')\n    }, error => {\n      if (!activeAuthInfo) {\n        throw new AuthenticationError('client was no longer authenticated when receiving response')\n      }\n      if (error.name === 'NotAllowedError') {\n        return roomRegistry.getOrCreateEmptyRoom(matrixRoomId)\n      } else {\n        throw error\n      }\n    })\n  }\n\n  /**\n   * Get a room by id.\n   *\n   * This method always returns a room, but the room might be private or\n   * nonexistent, in which case any attempt to join the room will fail.\n   *\n   * @function Client#getRoom\n   * @param {RoomId} roomId - The id of the room.\n   * @throws {AuthenticationError} If the client is not authenticated.\n   * @returns {Room} - The room.\n   */\n  function getRoom(roomId) {\n    argCheck.string('client.getRoom', 'roomId', roomId)\n    if (!activeAuthInfo) {\n      throw new AuthenticationError('client.getRoom: client needs to be authenticated to get rooms by id')\n    }\n    let matrixRoomId = toMatrixIdForServer('getRoom', roomId, activeAuthInfo.serverName, 'room')\n    return roomRegistry.getOrCreateEmptyRoom(matrixRoomId)\n  }\n\n  /**\n   * Get a user by id. This method will always result in a request to the server,\n   * regardless of what information is already available. The request fetches the\n   * current name and avatar of the user.\n   *\n   * If the user does not exist on ther server, the returned promise will be rejected.\n   *\n   * This method can be used without being authenticated.\n   * ##### Errors:\n   * - {@link NotFoundError} - The user does not exist.\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * @function Client#fetchUser\n   * @param {UserId} userId - The id of the user to fetch.\n   * @returns {Promise.<User>} - The user, or an error if the user doesn't exist.\n   */\n  function fetchUser(userId) {\n    argCheck.string('client.fetchUser', 'userId', userId)\n\n    if (!activeAuthInfo) {\n      let msg = 'client.fetchUser: client needs to be authenticated to fetch user by id'\n      return Promise.reject(new AuthenticationError(msg))\n    }\n\n    let matrixUserId = toMatrixIdForServer('fetchUser', userId, activeAuthInfo.serverName, 'user')\n\n    if (userRequests[matrixUserId]) {\n      return userRequests[matrixUserId]\n    }\n\n    var promise = authed().then(authedRequest => {\n      return authedRequest.profile.params('userId', matrixUserId).get()\n    }).then(response => {\n      log.verbose('client', `fetched user info for ${matrixUserId}: ${JSON.stringify(response.body)}`)\n      if (!activeAuthInfo) {\n        throw new AuthenticationError('client was no longer authenticated when receiving response')\n      }\n\n      delete userRequests[matrixUserId]\n      var user = userRegistry.getUser(matrixUserId)\n      user._update(response.body)\n      return user\n    }, error => {\n      delete userRequests[matrixUserId]\n      if (error.name === 'InternalServerError' && userId.indexOf(':') !== -1) {\n        let msg = `userId server not found: '${userId.split(':').slice(1).join(':')}'`\n        throw new NotFoundError(msg)\n      }\n      throw error\n    })\n    userRequests[matrixUserId] = promise\n    return promise\n  }\n\n  /**\n   * Parses a mxc resource URI. Throws a {@link external:TypeError} if the uri is invalid.\n   *\n   * @function Client#parseResourceUri\n   * @param {MatrixContentUri} uri - The mxc resource URI to parse.\n   * @throws {AuthenticationError} If the client is not authenticated.\n   * @returns {ImageResource} the parsed resource.\n   */\n  prop(this, 'parseResourceUri', function (uri) {\n    argCheck.string('client.parseResourceUri', 'uri', uri)\n    if (!imageResourceFactory) {\n      let msg = 'client.parseResourceUri: client needs to be authenticated to parse resource URIs'\n      throw new AuthenticationError(msg)\n    }\n    return imageResourceFactory(uri)\n  })\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Uploads media data to the server which can later be references as an {@link ImageResource}.\n   *\n   * The file argument will be passed directly to the `XMLHttpRequest.send` method, with the\n   * exception that if it is a string it will be treated as a data uri and will\n   * be parsed and base64 decoded before being uploaded.\n   *\n   * If a mime type is specified it will always be used. If not, the data uri type or\n   * `type` property of the {@link File} or {@link Blob} object will be used, with the last\n   * fallback being `'application/octet-stream'`.\n   * ##### Errors:\n   * - {@link AuthenticationError} - The client must be authenticated to use this method.\n   *\n   * <i style=\"color: red;\">Privacy warning: Do not pass private user information to this method.</i>\n   *\n   * @function Client#uploadMedia\n   * @param {*} file - The media data that will be uploaded\n   * @param {string} [mimeType] - Optional mime type\n   * @returns {ImageUpload}\n   */\n  prop(this, 'uploadMedia', function (file, mimeType) {\n    if (typeof(file) === 'string') {\n      var parsed = parseDataUri(file)\n      var buffer = binaryStringToArrayBuffer(parsed.binaryString)\n      file = new Blob([buffer], {\n        type: parsed.mimeType,\n      })\n      mimeType = mimeType || parsed.mimeType\n    }\n\n    if (!mimeType) {\n      mimeType = file.type || 'application/octet-stream'\n    }\n\n    if (!authedRequest) {\n      throw new AuthenticationError('not authenticated')\n    } else {\n      var upload = authedRequest.uploadMedia.header('Content-Type', mimeType).post(file)\n      upload.promise = upload.promise.then(response => {\n        return imageResourceFactory(response.body.content_uri)\n      })\n      return upload\n    }\n  })\n\n  /**\n   * All rooms the authenticated user is a member of\n   * @readonly\n   * @member Client#rooms {Room[]}\n   */\n  Object.defineProperty(this, 'rooms', {\n    enumerable: true,\n    get: function () {\n      return roomRegistry.getRooms().slice()\n    },\n  })\n\n  /**\n   * The authentication information for the authenticated user\n   * @readonly\n   * @member Client#authInfo {AuthInfo}\n   */\n  getter(this, 'authInfo', function () {\n    return shallowCopy(activeAuthInfo)\n  })\n\n  /**\n   * The authenticated user, if any\n   * @readonly\n   * @member Client#user {User}\n   */\n  Object.defineProperty(this, 'user', {\n    enumerable: true,\n    get: function () {\n      return user\n    },\n  })\n\n  function loadPublicRooms() {\n    return authed().then(authedRequest => {\n      return authedRequest.getPublicRooms.get()\n    }).then(response => {\n      return response.body.chunk.map(info => {\n        let room = roomRegistry.getOrCreateEmptyRoom(info.room_id)\n        room._addPublicInfo(info)\n        return room\n      })\n    })\n  }\n\n  this._handleAccountDataSync = function (events) {\n    for (var i in events) {\n      var event = events[i]\n      log.verbose('events', 'received account data event:', event)\n      this._accountData._set(event.type, event.content)\n    }\n  }\n\n  this._didChangeSyncStreamState = function (state) {\n    log.verbose('client', 'changed sync stream state: ' + state)\n    this._emit('state', state)\n  }\n\n  /**\n   * Emitted when an {@link Room~Event} is received in any room.\n   *\n   * @event Client#event\n   * @param {Room~Event} event - The event.\n   */\n  /**\n   * Same as {@link Client#event:event}, but listens to a specific {@link EventType}.\n   *\n   * @event Client#event:&lt;type&gt;\n   * @param {Room~Event} event - The event.\n   */\n  this._onRoomEvent = function (event) {\n    this._emit('event:' + event.type, event)\n    this._emit('event', event)\n  }\n\n  this._onRoomMembership = function (room, membership) {\n    this._emit(membership, room, membership)\n  }\n\n  this._onRoomCreated = function (room) {\n    this._willEmitRoomsEvent = true\n    roomQueries = roomQueries.filter(function (query) {\n      return query._handleNewRoom(room)\n    })\n    setTimeout(function () {\n      if (this._willEmitRoomsEvent) {\n        this._willEmitRoomsEvent = false\n        this._emit('rooms')\n      }\n    }.bind(this))\n  }\n\n  this._onIncomingCall = function (call) {\n    this._emit('call', call)\n  }\n\n  this._onIncomingConference = function (conference) {\n    this._emit('conference', conference)\n  }\n\n  /**\n   * Create a room query.\n   * @function Client#createRoomQuery\n   * @param {Function} mapFunction - The map function of the room query, see {@link RoomQuery}\n   * @returns {RoomQuery} - A newly created room query\n   */\n  prop(this, 'createRoomQuery', function (mapFunction) {\n    argCheck.func('client.createRoomQuery', 'mapFunction', mapFunction)\n    var query = priv(RoomQuery, mapFunction)\n    roomRegistry.getRooms().forEach(query._handleNewRoom)\n    roomQueries.push(query)\n    return query\n  })\n\n  this.auth = auth.bind(this)\n  this.logout = logout.bind(this)\n  this.createRoom = createRoom.bind(this)\n  this._loadPublicRooms = loadPublicRooms.bind(this)\n  this.getRoom = getRoom.bind(this)\n  this.fetchUser = fetchUser.bind(this)\n  this.fetchRoomById = fetchRoomById.bind(this)\n  this.fetchRoomByAlias = fetchRoomByAlias.bind(this)\n  this.setName = setName.bind(this)\n  this.setAvatar = setAvatar.bind(this)\n  this.setStatus = setStatus.bind(this)\n}\n\nClient.prototype = {\n  constructor: Client,\n  tag: 'client',\n\n  get getUser() {\n    throw new Error('client.getUser has been renamed to fetchUser')\n  },\n\n  get getRoomByAlias() {\n    throw new Error('client.getRoomByAlias has been renamed to fetchRoomByAlias')\n  },\n\n  get loadPublicRooms() {\n    throw new Error('client.loadPublicRooms has been removed')\n  },\n\n  toString: function () {\n    var userId = this.user ? this.user.id : null\n    return 'client{state=' + this.state + ',user=' + userId + '}'\n  },\n\n  /**\n   * Account data object that is used to access user scoped account data.\n   *\n   * @readonly\n   * @member Client#accountData {AccountData}\n   */\n  get accountData() {\n    return this._accountData\n  },\n\n  _setAccountData: function (key, value) {\n    if (!this._authedRequest) {\n      let msg = 'accountData.set: client needs to be authenticated to set account data'\n      return Promise.reject(new AuthenticationError(msg))\n    }\n    return this._authedRequest.setAccountData.path(key).put(value)\n  },\n}\n\nEmitterMixin.call(Client.prototype)\n\n/**\n * @typedef {string|object} IceServer\n * A STUN or TURN server url, e.g.\n *\n * ```\n * 'stun:stun.example.com'\n * ```\n *\n * or an object with url and credentials, e.g.\n *\n * ```\n * {\n *     urls: 'turn:turn.example.com',\n *     username: 'root',\n *     credential: 'root',\n * }\n * ```\n *\n * @property {string} url - A STUN or TURN server url\n * @property {string} [username] - The username used when accessing the helper server.\n * @property {string} [credential] - The password associated with the username.\n */\n\n/**\n * @typedef {null|'connecting'|'connected'|'disconnected'} ClientConnectionState\n *\n * A string representing the connection state of the client, or null for no active connection.\n */\n\n/**\n * @typedef {string} UserId\n *\n * A string representing a user ID. UserIds may only contain `a-z`, `0-9`, and `_-./`.\n */\n\n/**\n * @typedef {string} RoomId\n *\n * A string representing a room ID.\n */\n\n/**\n * @typedef {string} RoomAlias\n *\n * A string representing a room alias. Aliases may not contain whitespace characters.\n */\n\n/**\n * @typedef {string} EventId\n *\n * A string representing a event ID.\n */\n\n/**\n * @typedef {string} EventType\n *\n * A string representing a specific type of event. e.g. `'cct.call.dynamic.offer'`.\n * Names should follow the Java package naming convention to ensure uniqueness.\n */\n\n/**\n * @callback IceCandidateFilter\n *\n * @param {IceCandidateInfo} info - Information about the ice candidate.\n * @returns {boolean} A truthy value to use the candidate, or false to discard it.\n */\n\n/**\n * Emitted when a new room invite is received.\n * The room will contain additional information, such as {@link Room#invitedBy}.\n * @event Client#invite\n * @param {Room} room - The room that the authenticated user was invited to.\n */\n\n/**\n * Emitted whenever the list of rooms changes\n * @event Client#rooms\n */\n\n/**\n * Emitted when there is an incoming call to any room. Incoming calls are stopped and\n * need to be started with {@link Call#start} before a connection is set up.\n * @event Client#call\n * @param {Call} call - The call object\n */\n\n/**\n * Emitted when the conneciton state of the client is changed\n * @event Client#state\n * @param {ClientConnectionState} newState - The new state of the room\n * @param {ClientConnectionState} oldState - The old state of the room\n */\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/client.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {\n  binaryStringToArrayBuffer,\n  blobToArrayBuffer,\n  parseDataUri,\n} from 'common/utils'\n\nimport {audioContextUtil, AudioContext} from 'webrtc/utils'\n\nimport WebAudioSource from 'media/webAudioSource'\n\n/**\n * A class which represents an audio source that is able to playback audio buffers.\n *\n * Audio buffers can be loaded from different sources using the static methods of this class.\n *\n * @class AudioBufferSource\n * @extends WebAudioSource\n * @extends EventEmitter\n * @param {options} options - Options which are passed on to the WebAudioSource constructor.\n */\nexport default class AudioBufferSource extends EmitterMixin(WebAudioSource) {\n  /**\n   * Starts playback of a audio buffer. Audio buffers can be loaded using the static\n   * methods of {@link AudioBufferSource}.\n   *\n   * @param {Object} options - An option object.\n   * @param {AudioBuffer} options.buffer - The audio buffer to play.\n   * @param {number} [options.delay=0] - Delay in seconds before the audio buffer should start playing.\n   * @param {number} [options.offset=0] - Offset in seconds at which point the playback should begin.\n   * @param {number} [options.duration] - The duration of the playback in seconds.\n   *   Defaults to the duration of the entire buffer.\n   * @param {boolean} [options.loop=false] - Whether or not the audio buffer should be looped.\n   */\n  play(options) {\n    argCheck.options('AudioBufferSource.play', 'options', options)\n      .instance('buffer', window.AudioBuffer)\n      .optNumber('delay')\n      .optNumber('offset')\n      .optNumber('duration')\n      .optBoolean('loop')\n\n    // Stop current playback\n    this.halt()\n\n    this._audioSource = this.context.createBufferSource()\n    this._audioSource.onended = () => {\n      this._emit('ended')\n    }\n    this._audioSource.connect(this.audioDestination)\n\n    let {buffer, delay = 0, offset = 0} = options\n    let {duration = (buffer.duration - offset)} = options\n\n    log.debug('audio-buffer-source', `starting ${options.loop ? 'looping ' : ''}playback ` +\n      `of ${buffer.duration}s clip, at offset ${offset}s and duration ${duration}s`)\n    this._audioSource.buffer = buffer\n    if (options.loop) {\n      // this._audioSource.playbackRate.value = 0.5\n      this._audioSource.loop = true\n      this._audioSource.loopStart = offset\n      this._audioSource.loopEnd = offset + duration\n      this._audioSource.start(this._audioContext.currentTime + delay, offset)\n    } else {\n      this._audioSource.start(this._audioContext.currentTime + delay, offset, duration)\n    }\n    this._startTime = this._audioContext + delay\n  }\n\n  /**\n   * Stops the playback of the current buffer. Play can be called again after this method has been called.\n   *\n   * If no audio has been played yet, calling this method will have no effect.\n   */\n  halt() {\n    if (this._audioSource) {\n      this._audioSource.onended = null\n      this._audioSource.stop()\n      this._audioSource.disconnect()\n      this._audioSource = null\n    }\n  }\n\n  // Docs in super\n  stop() {\n    this.halt()\n    super.stop()\n  }\n\n  /**\n   * Decodes an array buffer of audio data into an audio buffer that can be\n   * played back in an {@link AudioBufferSource}.\n   *\n   * @param  {ArrayBuffer} arrayBuffer - An array buffer filled with encoded audio data.\n   * @param  {AudioContext} [context] - An optional audio context to be used for the decoding. Of no\n   *   context is specified one will be created if needed.\n   * @returns {Promise<AudioBuffer>} A promise for an audio buffer.\n   */\n  static decodeArrayBuffer(arrayBuffer, context) {\n    argCheck.instance('AudioBufferSource.decodeArrayBuffer', 'arrayBuffer', arrayBuffer, window.ArrayBuffer)\n    argCheck.optInstance('AudioBufferSource.decodeArrayBuffer', 'context', context, AudioContext)\n    return new Promise((resolve, reject) => {\n      let shouldReleaseContext = false\n      if (!context) {\n        shouldReleaseContext = true\n        context = audioContextUtil.get()\n      }\n      context.decodeAudioData(arrayBuffer, buffer => {\n        if (shouldReleaseContext) {\n          audioContextUtil.release()\n        }\n        resolve(buffer)\n      }, error => {\n        if (shouldReleaseContext) {\n          audioContextUtil.release()\n        }\n        reject(error)\n      })\n    })\n  }\n\n  /**\n   * Decodes a blob of audio data into an audio buffer that can be\n   * played back in an {@link AudioBufferSource}.\n   *\n   * @param  {Blob|File} blob - A blob filled with encoded audio data.\n   * @param  {AudioContext} [context] - An optional audio context to be used for the decoding. Of no\n   *   context is specified one will be created if needed.\n   * @returns {Promise<AudioBuffer>} A promise for an audio buffer.\n   */\n  static decodeBlob(blob, context) {\n    argCheck.optInstance('AudioBufferSource.decodeBlob', 'blob', blob, Blob)\n    argCheck.optInstance('AudioBufferSource.decodeBlob', 'context', context, AudioContext)\n    return blobToArrayBuffer(blob).then(data => {\n      return this.decodeArrayBuffer(data, context)\n    })\n  }\n\n  /**\n   * Decodes a binary string of audio data into an audio buffer that can be\n   * played back in an {@link AudioBufferSource}.\n   *\n   * @param  {string} binaryString - A binary string filled with encoded audio data.\n   * @param  {AudioContext} [context] - An optional audio context to be used for the decoding. Of no\n   *   context is specified one will be created if needed.\n   * @returns {Promise<AudioBuffer>} A promise for an audio buffer.\n   */\n  static decodeBinaryString(binaryString, context) {\n    argCheck.string('AudioBufferSource.decodeBinaryString', 'binaryString', binaryString)\n    argCheck.optInstance('AudioBufferSource.decodeBinaryString', 'context', context, AudioContext)\n    let arrayBuffer = binaryStringToArrayBuffer(binaryString)\n    return this.decodeArrayBuffer(arrayBuffer, context)\n  }\n\n  /**\n   * Decodes a data uri of audio data into an audio buffer that can be\n   * played back in an {@link AudioBufferSource}.\n   *\n   * @param  {string} dataUri - A data uri filled with encoded audio data.\n   * @param  {AudioContext} [context] - An optional audio context to be used for the decoding. Of no\n   *   context is specified one will be created if needed.\n   * @returns {Promise<AudioBuffer>} A promise for an audio buffer.\n   */\n  static decodeDataUri(dataUri, context) {\n    argCheck.string('AudioBufferSource.decodeDataUri', 'dataUri', dataUri)\n    argCheck.optInstance('AudioBufferSource.decodeDataUri', 'context', context, AudioContext)\n    try {\n      let parsed = parseDataUri(dataUri)\n      return this.decodeBinaryString(parsed.binaryString, context)\n    } catch (error) {\n      return Promise.reject(new Error(`Data uri decoding failed, ${error.message}`))\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/audioBufferSource.js","'use strict'\n\nimport EmitterMixin from 'common/emitter'\n\nimport WebAudioFilter from 'media/webAudioFilter'\n\n/**\n * A utility for measuring the audio level of a MediaSource.\n *\n * @example <caption>Example of using the AudioMeter.</caption>\n * var microphone = new cct.DeviceSource({audio:true})\n * var meter = new cct.AudioMeter()\n *\n * microphone.connect(meter)\n * meter.on('filtered', function (filtered) {\n *    //NOTE: This event will be emitted VERY frequently!\n *    //Consider reading meter.filtered or meter.raw instead.\n * })\n *\n * @class AudioMeter\n * @extends WebAudioFilter\n * @extends EventEmitter\n */\nexport default class AudioMeter extends EmitterMixin(WebAudioFilter) {\n  constructor(options) {\n    super(options)\n    this._raw = 0.0\n    this._filtered = 0.0\n    this._processAudio = this._processAudio.bind(this)\n  }\n\n  onAudioSource(source, destination) {\n    if (source) {\n      this._processor = this.context.createScriptProcessor(2048, 1, 1)\n      this._processor.onaudioprocess = this._processAudio\n      this._processor.connect(destination) // Should not be needed, but it is.\n      source.connect(this._processor)\n      source.connect(destination) // Otherwise we pass on silence\n    }\n\n    this._raw = 0.0\n    this._filtered = 0.0\n    this._emit('filtered', this._filtered)\n    this._emit('raw', this._raw)\n  }\n\n  toString() {\n    return `audio-meter{raw=${this.raw},filtered=${this.filtered}}`\n  }\n\n  /**\n   * Emitted when the raw audio level has changed.\n   * @event AudioMeter#raw\n   * @param {number} raw - The raw audio level.\n   */\n\n  /**\n   * The raw audio level.\n   *\n   * @readonly\n   * @member AudioMeter#raw {number}\n   */\n  get raw() {\n    return this._raw\n  }\n\n  /**\n   * Emitted when the filtered audio level has changed.\n   * @event AudioMeter#filtered\n   * @param {number} filtered - The filtered audio level.\n   */\n\n  /**\n   * The filtered audio level. This represents the \"average\"\n   * audio level over a period of time, filtering out\n   * sudden changes and spikes.\n   *\n   * @readonly\n   * @member AudioMeter#filtered {number}\n   */\n  get filtered() {\n    return this._filtered\n  }\n\n  _processAudio(event) {\n    var buffer = event.inputBuffer.getChannelData(0)\n    var rms = AudioMeter._rms(buffer)\n\n    this._raw = rms\n    this._filtered = AudioMeter._filter(this._filtered, rms)\n\n    this._emit('filtered', this._filtered)\n    this._emit('raw', this._raw)\n  }\n\n  // Root of mean of squares\n  static _rms(buffer) {\n    var count = buffer.length\n    var sumOfSquares = 0\n    buffer.forEach(val => {\n      sumOfSquares += val * val\n    })\n    let meanOfSquares = sumOfSquares / count\n    let rootMeanSquare = Math.sqrt(meanOfSquares)\n    return rootMeanSquare\n  }\n\n  // Low pass filter\n  static _filter(current, next) {\n    return 0.95 * current + 0.05 * next\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/audioMeter.js","'use strict'\n\nimport log from 'common/log'\nimport MediaSource from 'media/mediaSource'\nimport {InputMap} from 'media/mediaNode'\nimport {audioContextUtil} from 'webrtc/utils'\n\nconst TAG = 'audiomixer'\n\n/**\n * A media node that mixes the audio tracks of all input streams and ouputs a single audio stream.\n *\n * @class AudioMixer\n * @extends MediaSource\n */\nexport default class AudioMixer extends MediaSource {\n  constructor() {\n    super()\n    this._inputs = new InputMap({\n      parent: this,\n      onStream: this._onStream.bind(this),\n    })\n    this._streamSources = {}\n  }\n\n  /**\n   * An input map for all inputs to the node.\n   *\n   * @member {InputMap} AudioMixer#inputs\n   */\n  get inputs() {\n    return this._inputs\n  }\n\n  _hasInputStreams() {\n    return [...this.inputs.values()].some(input => input.stream)\n  }\n\n  _onStream(key, stream, oldStream) {\n    if (oldStream) {\n      this._streamSources[key].disconnect()\n      delete this._streamSources[key]\n      log.info(TAG, 'Stream removed:', key)\n      if (this._dest && !this._hasInputStreams()) {\n        this.setStream(null)\n        log.info(TAG, 'Destroying output')\n        this._stereoPanner.disconnect()\n        this._stereoPanner = null\n        this._dest = null\n        audioContextUtil.release()\n        this._audioContext = null\n      }\n    }\n\n    if (stream) {\n      if (!this._dest) {\n        log.info(TAG, 'Creating output')\n        this._audioContext = audioContextUtil.get()\n        this._dest = this._audioContext.createMediaStreamDestination()\n        this._stereoPanner = this._audioContext.createStereoPanner()\n        this._stereoPanner.connect(this._dest)\n        this.setStream(this._dest.stream)\n      }\n      let streamSource = this._audioContext.createMediaStreamSource(stream)\n      streamSource.connect(this._stereoPanner)\n      this._streamSources[key] = streamSource\n      log.info(TAG, 'Stream added:', key)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/audioMixer.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {assertPriv, priv, shallowCopy, registerInstance, unregisterInstance} from 'common/utils'\n\nimport MediaNode from 'media/mediaNode'\nimport MuteFilter from 'media/muteFilter'\nimport Passthrough from 'media/passthrough'\nimport UserMediaSource from 'media/userMediaSource'\n\nconst TAG = 'device-source'\n\n/**\n * Contains information about a media device, returned from {@link DeviceSource.enumerateDevices}.\n *\n * Instances can be passed as `device` media constaints to {@link DeviceSource} in order\n * to request a stream from a specific device.\n *\n * @class DeviceInfo\n * @abstract\n */\nexport class DeviceInfo {\n  constructor(priv, info) {\n    assertPriv('DeviceInfo', priv)\n    this.deviceId = info.deviceId || info._deviceId || null\n    this.groupId = info.groupId || info._groupId || null\n    this.kind = info.kind || info._kind || null\n    this.label = info.label || info._label || null\n  }\n\n  toString() {\n    let deviceId = this.deviceId\n    if (deviceId && deviceId.length > 8) {\n      deviceId = `${deviceId.slice(0, 8)}...`\n    }\n    let groupId = this.groupId\n    if (groupId && groupId.length > 8) {\n      groupId = `${groupId.slice(0, 8)}...`\n    }\n    return `deviceInfo{kind=${this.kind},deviceId=${deviceId},groupId=${groupId},label=\"${this.label}\"}`\n  }\n\n  /**\n   * An id that uniquely identifies the device.\n   *\n   * @member {string} DeviceInfo#deviceId\n   */\n\n  /**\n   * An id that uniquely identifies a group of devices.\n   *\n   * Even though there might be only one piece hardware, e.g. a webcam, each of the the different\n   * capabilities of the hardware will be represented as one device, e.g. audio input and video input.\n   * Using the `groupId` it is then possible to known which devices originate from the same physical device.\n   *\n   * @member {string} DeviceInfo#groupId\n   */\n\n  /**\n   * The device type of media that the device can deliver.\n   *\n   * @member {'videoinput'|'audioinput'} DeviceInfo#kind\n   */\n\n  /**\n   * A human-readable description of the device, e.g. \"External USB Webcam\".\n   *\n   * Some browsers will hide the label by returning an empty string until the user has allowed\n   * a user media request on the page. Currently Firefox is the only browser that does this.\n   * A workaround for this is to first create a {@link DeviceSource}, wait until the user\n   * media request has been accepted, and then enumerate device and stop the source. When creating\n   * a second {@link DeviceSource} for a specific device, the user media request should be skipped.\n   *\n   * @member {'string'} DeviceInfo#label\n   */\n}\n\nfunction convertDeviceConstraints(mediaConstraints) {\n  if (mediaConstraints && mediaConstraints.device && !mediaConstraints.deviceId) {\n    let {device} = mediaConstraints\n    var info = null\n    if (device.ideal) {\n      info = device.ideal\n      mediaConstraints.deviceId = {ideal: info.deviceId}\n    } else if (device.exact) {\n      info = device.exact\n      mediaConstraints.deviceId = {exact: info.deviceId}\n    } else {\n      info = device\n      mediaConstraints.deviceId = info.deviceId\n    }\n    delete mediaConstraints.device\n    argCheck.instance('DeviceSource constructor', 'device', info, DeviceInfo)\n  }\n}\n\n/**\n * A media source that streams from user media devices.\n *\n * @class DeviceSource\n * @extends ConnectMixin\n * @extends EventEmitter\n *\n * @param {Object} [constraints={ audio:true, video:true }] - Constraints passed to getUserMedia as defined by\n *  {@link http://w3c.github.io/mediacapture-main/getusermedia.html#methods-4 getUserMedia}.\n *  If the paramater is omitted a default configuration with both audio and video will be used.\n *\n * @param {boolean|Object} [constraints.audio=true] - Set to `true` if audio is desired, or a\n *  {@link http://w3c.github.io/mediacapture-main/getusermedia.html#idl-def-MediaTrackConstraints MediaTrackConstraints}\n *  object if more detailed constraints is required.\n *\n * @param {boolean|Object} [constraints.video=true] - Set to `true` if video is desired, or a\n *  {@link http://w3c.github.io/mediacapture-main/getusermedia.html#idl-def-MediaTrackConstraints MediaTrackConstraints}\n *  object if more detailed configuration is required.\n *\n * @see {@link http://w3c.github.io/mediacapture-main/getusermedia.html#h-capabilities video configuration}\n */\nexport default class DeviceSource extends MediaNode.connectMixin() {\n  /**\n   * Whether the current browser supports device enumeration with {@link DeviceSource.enumerateDevices}.\n   *\n   * @example\n   * if (cct.DeviceSource.canEnumerateDevices) {\n   *   cct.DeviceSource.enumerateDevices().then(...)\n   * } else {\n   *   // Device enumeration is not supported\n   * }\n   *\n   * @member {boolean} DeviceSource.canEnumerateDevices\n   */\n  static get canEnumerateDevices() {\n    return !!navigator.mediaDevices && !!navigator.mediaDevices.enumerateDevices\n  }\n\n  /**\n   * Returns a list of media devices that can be passed on to {@link DeviceSource} media constraints.\n   *\n   * This method will throw an error if the browser if not capable of enumerating media devices. Browser\n   * support should be tested using {@link DeviceSource.canEnumerateDevices}.\n   *\n   * Currently only `'videoinput'` and `'audioinput'` devices are included in the list. Chrome\n   * does supports using `'audiooutput'` devices to select the playback device for HTML media elements,\n   * but this is not yet exposed in this library. This will most likely be added in the future.\n   *\n   * @example <caption>Listing all available devices</caption>\n   * cct.DeviceSource.enumerateDevices().then(deviceList => {\n   *   console.log(`Available devices:\\n${deviceList.join('\\n')}`)\n   * }).catch(error => {\n   *   console.error(`Failed to enumerate devices, ${error}`)\n   * })\n   *\n   * @example <caption>Requesting a specific device</caption>\n   * let selectedVideoDevice = deviceList[selectedIndex]\n   * let videoSource = new cct.DeviceSource({\n   *   video: {\n   *     device: selectedVideoDevice,\n   *   },\n   * })\n   *\n   * @returns {Promise<Array<DeviceInfo>>} Promise for a list of device desciptions.\n   */\n  static enumerateDevices() {\n    if (!this.canEnumerateDevices) {\n      throw new Error('Device enumeration is not supported. Check .canEnumerateDevices before calling')\n    }\n    return navigator.mediaDevices.enumerateDevices().then(list => {\n      return list.map(info => priv(DeviceInfo, info)).filter(info => info.kind !== 'audiooutput')\n    })\n  }\n\n  constructor(constraints = {audio: true, video: true}) {\n    super()\n    registerInstance('deviceSource', this)\n\n    constraints = shallowCopy(constraints)\n    constraints.video = shallowCopy(constraints.video) || undefined\n    constraints.audio = shallowCopy(constraints.audio) || undefined\n\n    convertDeviceConstraints(constraints.audio)\n    convertDeviceConstraints(constraints.video)\n\n    this._source = new UserMediaSource({constraints})\n    this._source.promise.then(stream => {\n      this._emit('stream', stream)\n      this._clearListeners()\n    }, error => {\n      this._emit('error', error)\n      this._clearListeners()\n    }).catch(error => {\n      log.error(TAG, `unexpected error in DeviceSource: ${error}`)\n    })\n\n    this._muteFilter = new MuteFilter()\n    this._output = new Passthrough()\n    this._muteFilter.connect(this._output)\n    this._source.connect(this._muteFilter)\n  }\n\n  /**\n   * Emitted when the stream has been acquired.\n   *\n   * The node will only ever emit one of the `stream` and `error` events, and only once.\n   *\n   * @event DeviceSource#stream\n   * @param {MediaStream} stream - The media stream, will never be null.\n   */\n\n  /**\n   * Emitted if a stream could not be acquired.\n   *\n   * The node will only ever emit one of the `stream` and `error` events, and only once.\n   *\n   * For a list of possible errors, see {@link DeviceSource#error}.\n   *\n   * @event DeviceSource#error\n   * @param {CctError} error - The error.\n   */\n\n  /**\n   * Output which will forward a stream with a single video track.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} DeviceSource#output\n   */\n  get output() {\n    return this._output\n  }\n\n  /**\n   * A promise that is either resolved to a media stream or rejected with an error.\n   *\n   * For a list of possible errors, see {@link DeviceSource#error}.\n   *\n   * @readonly\n   * @member {Promise<MediaStream,CctError>} DeviceSource#promise\n   */\n  get promise() {\n    return this._source.promise\n  }\n\n  /**\n   * An error explaining why the stream could not be acquired, if that was the case.\n   *\n   * All error types will have an additional `reason` property which is the error from\n   * the underlying WebRTC implementation.\n   *\n   * Errors:\n   *  - {@link NotAllowedError} - The user denied the request to access media devices.\n   *  - {@link OverconstrainedError} - The media constraints set could not be satisfied.\n   *  - {@link NotFoundError} - Devices of the requested type are not present.\n   *\n   * @readonly\n   * @member {?CctError} DeviceSource#error\n   */\n  get error() {\n    return this._source.error\n  }\n\n  /**\n   * The current output stream.\n   *\n   * @readonly\n   * @member {?MediaStream} DeviceSource#stream\n   */\n  get stream() {\n    return this._source.stream\n  }\n\n  /**\n   * Mute property as documented in {@link MuteFilter#mute}.\n   *\n   * @member {Object} DeviceSource#mute\n   */\n  get mute() {\n    return this._muteFilter.mute\n  }\n\n  set mute(value) {\n    this._muteFilter.mute = value\n  }\n\n  set sink(sink) {\n    log.error(TAG, 'deviceSource.sink is removed, just connect directly to the sink instead')\n  }\n\n  /**\n   * Stops the source and cleans up all resources. This has to be called once the source\n   * is no longer used in order to clean up resources.\n   *\n   * If an error happened there is no need to call this function, although calling it will have no effect.\n   */\n  stop() {\n    unregisterInstance('deviceSource', this)\n    return this._source.stop()\n  }\n}\n\nEmitterMixin.call(DeviceSource.prototype)\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/deviceSource.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\n\nimport MediaSink from 'media/mediaSink'\n\nconst TAG = 'recorder'\nconst MILLISECONDS_PER_CHUNK = 100\n\nclass InternalMediaRecorder {\n  constructor(options) {\n    this._mediaRecorder = new window.MediaRecorder(options.stream, options.mediaRecorderOptions)\n    this._stopped = false\n\n    this._onData = options.onData\n\n    this._onDataAvailable = this._onDataAvailable.bind(this)\n    this._onStopped = this._onStopped.bind(this)\n    this._onWarning = this._onWarning.bind(this)\n    this._onError = this._onError.bind(this)\n  }\n\n  _onDataAvailable({data}) {\n    if (data && data.size > 0) {\n      this._chunks.push(data)\n    }\n  }\n\n  _onStopped(event) {\n    log.info(TAG, 'Recording stopped')\n\n    this._onData(new Blob(this._chunks, this._mimeType))\n\n    this._mediaRecorder.removeEventListener('dataavailable', this._onDataAvailable)\n    this._mediaRecorder.removeEventListener('stop', this._onStopped)\n    this._mediaRecorder.removeEventListener('warning', this._onWarning)\n    this._mediaRecorder.removeEventListener('error', this._onError)\n\n    delete this._chunks\n    delete this._mediaRecorder\n  }\n\n  _onWarning(error) {\n    log.warning(TAG, 'MediaRecorder error:', error)\n  }\n\n  _onError(error) {\n    log.error(TAG, 'MediaRecorder warning:', error)\n  }\n\n  start() {\n    if (this.stopped) {\n      throw new Error('Only allowed to use InternalMediaRecorder once')\n    }\n    this._mediaRecorder.addEventListener('dataavailable', this._onDataAvailable)\n    this._mediaRecorder.addEventListener('stop', this._onStopped)\n    this._mediaRecorder.addEventListener('warning', this._onWarning)\n    this._mediaRecorder.addEventListener('error', this._onError)\n\n    this._chunks = []\n\n    this._mediaRecorder.start(MILLISECONDS_PER_CHUNK)\n  }\n\n  stop() {\n    if (this.stopped) {\n      throw new Error('Only allowed to use InternalMediaRecorder once')\n    }\n    this.stopped = true\n    this._mediaRecorder.stop()\n  }\n}\n\n/**\n * A recorder media sink that uses the built-in browser recoring API:s to produce media files.\n *\n * The recorder simply needs to be connected to by a media node, and will produce a new recording any time\n * the stream changes.\n *\n * @class Recorder\n * @extends MediaSink\n * @extends EventEmitter\n * @param {Object} [options] - Optional options object.\n * @param {number} [options.audioBitsPerSecond] - Audio recording bitrate, defaults to the browser default.\n * @param {number} [options.videoBitsPerSecond] - Video recording bitrate, defaults to the browser default.\n * @param {string} [options.mimeType='video/webm'] - The desired mime type of the recording. The type needs\n *   to be supported by the browser.\n */\nexport default class Recorder extends EmitterMixin(MediaSink) {\n  constructor(options) {\n    super()\n    if (options) {\n      argCheck.options('Recorder constructor', 'options', options)\n        .optNumber('audioBitsPerSecond')\n        .optNumber('videoBitsPerSecond')\n        .optString('mimeType')\n      if (options.audioBitsPerSecond <= 0) {\n        argCheck.error('Recorder constructor', 'options.audioBitsPerSecond', 'be greater than 0')\n      }\n      if (options.videoBitsPerSecond <= 0) {\n        argCheck.error('Recorder constructor', 'options.videoBitsPerSecond', 'be greater than 0')\n      }\n      this._mediaRecorderOptions = {\n        mimeType: options.mimeType || 'video/webm',\n        audioBitsPerSecond: options.audioBitsPerSecond,\n        videoBitsPerSecond: options.videoBitsPerSecond,\n      }\n    }\n  }\n\n  /**\n   * Emitted whenever a recording has been completed.\n   *\n   * @event Recorder#blob\n   * @param {external:Blob} blob - The resulting file.\n   */\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  onStream(stream) {\n    if (this._mediaRecorder) {\n      this._mediaRecorder.stop()\n      this._mediaRecorder = null\n      log.info(TAG, 'Stop recording')\n    }\n\n    if (!stream) {\n      return\n    }\n\n    this._mediaRecorder = new InternalMediaRecorder({\n      onData: blob => this._emit('blob', blob),\n      stream,\n      mediaRecorderOptions: this._mediaRecorderOptions,\n    })\n    log.info(TAG, 'Start recording')\n    this._mediaRecorder.start()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/recorder.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {isChrome, isFirefox, shallowCopy, registerInstance, unregisterInstance} from 'common/utils'\n\nimport {AdapterJS} from 'webrtc/utils'\nconst {WebRTCPlugin} = AdapterJS\n\nimport ChromeScreenSource from 'media/chromeScreenSource'\nimport FirefoxScreenSource from 'media/firefoxScreenSource'\nimport TemasysScreenSource from 'media/temasysScreenSource'\nimport MediaNode from 'media/mediaNode'\nimport MuteFilter from 'media/muteFilter'\n\nconst TAG = 'screen-source'\nconst C3_EXTENSTION_ID = 'epajpkbdigdpepgncdpmilaoamkjgoah'\n\nconst availableImplementations = ['chrome', 'firefox', 'temasys', null]\n\n// Non-null if implementaion is set by the application, otherwise default is calculated below\nvar screenSharingImplementation = null\n\nfunction getScreenSharingImplementation() {\n  if (!screenSharingImplementation) {\n    if (isChrome) {\n      return 'chrome'\n    } else if (isFirefox) {\n      return 'firefox'\n    } else if (WebRTCPlugin && WebRTCPlugin.plugin && WebRTCPlugin.plugin.HasScreensharingFeature) {\n      return 'temasys'\n    }\n  }\n  return null\n}\n\nfunction getScreenSharingConstructor() {\n  let implementation = getScreenSharingImplementation()\n  if (implementation === 'chrome') {\n    return ChromeScreenSource\n  } else if (implementation === 'firefox') {\n    return FirefoxScreenSource\n  } else if (implementation === 'temasys') {\n    return TemasysScreenSource\n  } else {\n    throw new Error('Screen sharing is not supported')\n  }\n}\n\n/**\n * @typedef {'screen'|'window'|'application'} ScreenSharingType\n *\n * A string representing a screen sharing type, where `'screen'` is the sharing of an entire physical\n * screen, and `'window'` and `'application'` are sharing specific application windows.\n *\n * The `'application'` type is so far only available in Firefox. The difference between window and\n * application is that application will show all application windows at once, while window only shows\n * a single window. e.g. only a single Firefox window or all open Firefox windows.\n */\n\n/**\n * A media source that streams a screen or an application window.\n *\n * In Chrome a browser extension is required for the screen sharing to work. Currently a custom\n * signaling protocol is used, and a specific extension is required. Ask `patrik.oldsberg@ericsson.com`\n * for more info.\n *\n * In Firefox it's enough for the page origin to be whitelisted. This can be done either by contacting\n * Mozilla, or using an extension.\n *\n * @class ScreenSource\n * @extends ConnectMixin\n * @extends EventEmitter\n *\n * @param {Object} options - Options object.\n * @param {string} options.chromeExtensionId - The id of the chrome extension to use.\n * @param {ScreenSharingType} [options.type='window'] - The screen sharing type to use. In Chrome this will\n * default to both screen and window, letting the user select either one.\n * @param {Object} [options.video] - Constraints for the video, defaults to max resolution and no\n *   framerate limit.\n */\nexport default class ScreenSource extends EmitterMixin(MediaNode.connectMixin()) {\n  /**\n   *\n   * @param {'chrome'|'firefox'|'temasys'|null} implementation - The implementation to use.\n   */\n  static set implementation(implementation) {\n    argCheck.values('ScreenSource.implementation', 'implementation', implementation, availableImplementations)\n    screenSharingImplementation = implementation\n  }\n\n  /**\n   * The screen sharing implementation that is currently in use. Defaults to the current browser based\n   * on user agent detection.\n   *\n   * The application may change the implementation if needed, but only {@link ScreenSource}s and related\n   * calls that are made after the implementation is updated will be affected.\n   *\n   * If this is accessed close to the page load the application should first wait for {@link cct.webRtcReady}.\n   *\n   * @member {'chrome'|'firefox'|'temasys'|null} ScreenSource.implementation\n   */\n  static get implementation() {\n    return getScreenSharingImplementation()\n  }\n\n  /**\n   * Whether screen sharing is available. This is identical to checking if the screen sharing implementation\n   * is null, but makes the application code a bit more readable.\n   *\n   * If this is accessed close to the page load the application should first wait for {@link cct.webRtcReady}.\n   *\n   * @member {boolean} ScreenSource.isAvailable\n   */\n  static get isAvailable() {\n    return !!screenSharingImplementation\n  }\n\n  /**\n   * Whether the current browser supports source enumeration with {@link ScreenSource.enumerateSources}.\n   *\n   * If this is accessed close to the page load the application should first wait for {@link cct.webRtcReady}.\n   *\n   * @example\n   * if (cct.ScreenSource.canEnumerateSources) {\n   *   cct.ScreenSource.enumerateSources().then(...)\n   * } else {\n   *   // Source enumeration is not supported\n   * }\n   *\n   * @member {boolean} ScreenSource.canEnumerateSources\n   */\n  static get canEnumerateSources() {\n    let Constructor = getScreenSharingConstructor()\n    return !!Constructor.canEnumerateSources\n  }\n\n  /**\n   * Returns a list of possible screen sharing sources that can be passed to {@link ScreenSource} media constraints.\n   *\n   * This method will throw an error if the browser if not capable of enumerating sources. Browser\n   * support should be tested using {@link ScreenSource.canEnumerateSources}.\n   *\n   * Currently the only browsers that support source enumeration are Internet Explorer and Safari with\n   * the screen sharing Temasys plugin.\n   *\n   * @example <caption>Listing all available sources</caption>\n   * cct.ScreenSource.enumerateSources().then(sourceList => {\n   *   console.log(`Available sources:\\n${sourceList.join('\\n')}`)\n   * }).catch(error => {\n   *   console.error(`Failed to enumerate sources, ${error}`)\n   * })\n   *\n   * @example <caption>Requesting a specific source</caption>\n   * let selectedSource = sourceList[selectedIndex]\n   * let videoSource = new cct.ScreenSource({\n   *   video: {\n   *     source: selectedSource,\n   *   },\n   * })\n   *\n   * @returns {Promise<Array<ScreenSourceInfo>>} Promise for a list of source desciptions.\n   */\n  static enumerateSources() {\n    if (!this.canEnumerateSources) {\n      throw new Error('Source enumeration is not supported. Check .canEnumerateSources before calling')\n    }\n    let Constructor = getScreenSharingConstructor()\n    return Constructor.enumerateSources()\n  }\n\n  constructor(options = {}) {\n    super()\n    argCheck.optOptions('ScreenSource constructor', 'options', options)\n      .optString('chromeExtensionId')\n      .optString('type')\n\n    options = shallowCopy(options)\n\n    options.chromeExtensionId = (options.chromeExtensionId) ? options.chromeExtensionId : C3_EXTENSTION_ID\n    options.video = shallowCopy(options.video) || undefined\n    options.audio = shallowCopy(options.audio) || undefined\n\n    registerInstance('screenSource', this)\n\n    let ScreenSharingImplementationConstructor = getScreenSharingConstructor()\n    this._screenSource = new ScreenSharingImplementationConstructor(options)\n    this._muteFilter = new MuteFilter()\n\n    this._screenSource.connect(this._muteFilter)\n\n    this._promise = Promise.all([\n      this._screenSource.promise,\n      this._audioSource && this._audioSource.promise,\n    ])\n    this._promise.then(stream => {\n      this._emit('stream', stream)\n      this._clearListeners('error')\n      this._clearListeners('stream')\n    }, error => {\n      this.stop()\n      this._emit('error', error)\n      this._clearListeners('error')\n      this._clearListeners('stream')\n    }).catch(error => {\n      log.error(TAG, `unexpected error in ScreenSource: ${error}`)\n    })\n  }\n\n  /**\n   * Emitted when the stream has been acquired.\n   *\n   * The node will only ever emit one of the `stream` and `error` events, and only once.\n   *\n   * @event ScreenSource#stream\n   * @param {MediaStream} stream - The media stream, will never be null.\n   */\n\n  /**\n   * Emitted if a stream could not be acquired.\n   *\n   * The node will only ever emit one of the `stream` and `error` events, and only once.\n   *\n   * For a list of possible errors, see {@link ScreenSource#error}.\n   *\n   * @event ScreenSource#error\n   * @param {CctError} error - The error.\n   */\n\n  /**\n   * Output which will forward a stream with a single video track.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} ScreenSource#output\n   */\n  get output() {\n    return this._muteFilter.output\n  }\n\n  /**\n   * A promise that is resolved to the stream as soon as it is available, or rejected\n   * with an error.\n   *\n   * For a list of possible errors, see {@link ScreenSource#error}.\n   *\n   * @readonly\n   * @member ScreenSource#promise {Promise<MediaStream,CctError>} ScreenSource#promise\n   */\n  get promise() {\n    return this._promise\n  }\n\n  /**\n   * An error explaining why the stream could not be acquired, if that was the case.\n   *\n   * All error types will have an additional `reason` property which is the error from\n   * the underlying WebRTC implementation.\n   *\n   * Errors:\n   *  - {@link NotAllowedError} - The user denied the request to share the screen.\n   *  - {@link OverconstrainedError} - The media constraints set could not be satisfied.\n   *  - {@link NotFoundError} - No screen sharing implementation could be found. The reason\n   *  depends on which browser is used.\n\n   *    - Chrome - A compatible extension that provides screen sharing must be installed.\n   *    - Firefox - Screen sharing is not allowed on the current origin.\n   *    - Internet Explorer - A plugin with screen sharing capabilities must to be installed.\n   *    - Safari - A plugin with screen sharing capabilities must to be installed.\n   *\n   *\n   * The Firefox behaviour might seem odd, as one would expect a {@link NotAllowedError} instead.\n   * The reason for using a {@link NotFoundError} is to stay consistent with other browsers,\n   * since the usual method for allowing screen sharing on an origin is by installing an extension.\n   *\n   * @readonly\n   * @member {?CctError} ScreenSource#error\n   */\n  get error() {\n    if (this._audioSource) {\n      return this._screenSource.error || (this._audioSource && this._audioSource.error)\n    } else {\n      return this._screenSource.error\n    }\n  }\n\n  /**\n   * The current output stream.\n   *\n   * @readonly\n   * @member {?MediaStream} ScreenSource#stream\n   */\n  get stream() {\n    return this.output.stream\n  }\n\n  /**\n   * Mute property as documented in {@link MuteFilter#mute}.\n   *\n   * @member {Object} ScreenSource#mute\n   */\n  get mute() {\n    return this._muteFilter.mute\n  }\n\n  set mute(value) {\n    this._muteFilter.mute = value\n  }\n\n  set sink(sink) {\n    log.error(TAG, 'screenSource.sink is removed, just connect directly to the sink instead')\n  }\n\n  /**\n   * Stops the source and cleans up all resources. This has to be called once the source\n   * is no longer used in order to clean up resources.\n   *\n   * If an error happened there is no need to call this function, although calling it will have no effect.\n   */\n  stop() {\n    unregisterInstance('screenSource', this)\n    return this._screenSource.stop()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/screenSource.js","'use strict'\n\nimport {MediaStream} from 'webrtc/utils'\n\nimport MediaNodeInput from 'media/mediaNodeInput'\nimport MediaSource from 'media/mediaSource'\n\n/**\n * A media node which merges the audio and video tracks from two different streams into one stream.\n *\n * @class StreamMerger\n * @extends MediaSource\n */\nexport default class StreamMerger extends MediaSource {\n  constructor() {\n    super()\n\n    // Make sure we handle synchronous updates of both inputs as one update\n    let microtask = null\n    let onStream = () => {\n      if (!microtask) {\n        microtask = Promise.resolve().then(() => {\n          microtask = null\n          this.onStream()\n        })\n      }\n    }\n    this._audioInput = new MediaNodeInput({\n      name: 'default',\n      parent: this,\n      onStream,\n    })\n    this._videoInput = new MediaNodeInput({\n      name: 'default',\n      parent: this,\n      onStream,\n    })\n  }\n\n  /**\n   * The input that the audio track should be extracted from.\n   *\n   * @member {MediaNodeInput} StreamMerger#audioInput\n   */\n  get audioInput() {\n    return this._audioInput\n  }\n\n  /**\n   * The input that the video track should be extracted from.\n   *\n   * @member {MediaNodeInput} StreamMerger#videoInput\n   */\n  get videoInput() {\n    return this._videoInput\n  }\n\n  /**\n   * @private\n   */\n  onStream() {\n    if (!this._audioInput.stream && !this._videoInput.stream) {\n      this.setStream(null)\n      return\n    }\n    let stream = new MediaStream()\n    if (this._audioInput.stream) {\n      this._audioInput.stream.getAudioTracks().forEach(track => {\n        stream.addTrack(track)\n      })\n    }\n    if (this._videoInput.stream) {\n      this._videoInput.stream.getVideoTracks().forEach(track => {\n        stream.addTrack(track)\n      })\n    }\n    this.setStream(stream)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/streamMerger.js","'use strict'\n\nimport argCheck from 'common/argCheck'\n\nimport {doesntSupportPlugin} from 'media/common'\nimport HtmlSink from 'media/htmlSink'\nimport StreamSplitter from 'media/streamSplitter'\n\n/**\n * A sink that can be used to take snapshots of a video stream that are\n * exported as either blobs or a data URIs.\n *\n * @class VideoFrameCapture\n */\nexport default class VideoFrameCapture {\n  constructor() {\n    doesntSupportPlugin(this)\n    this._video = document.createElement('video')\n    this._canvas = document.createElement('canvas')\n    this._splitter = new StreamSplitter()\n    this._htmlSink = new HtmlSink({target: this._video})\n    this._splitter.videoOutput.connect(this._htmlSink)\n  }\n\n  /**\n   * The input from which the video will be captured.\n   *\n   * @member {MediaNodeInput} VideoFrameCapture#input\n   */\n  get input() {\n    return this._splitter\n  }\n\n  /**\n   * Saves the current video frame as a data URI.\n   *\n   * @param {Object} [options] - Optional options object.\n   * @param {number} [options.scale=1] - The scale used when capturing the video frame.\n   * @param {string} [options.mimeType='image/png'] - The file format to export the image as.\n   * @param {number} [options.imageQuality=0.92] - The image quality factory used by `'image/jpeg'` and `'image/webp'`.\n   * @returns {string} A data uri with the image data.\n   */\n  toDataUri(options = {}) {\n    argCheck.optOptions('VideoFrameCapture.toDataUri', 'options', options)\n      .optNumber('scale')\n      .optString('mimeType')\n      .optNumber('imageQuality')\n\n    let {scale = 1, mimeType = null, imageQuality = 0.92} = options\n    let canvas = this._prepareCanvas(scale)\n    return canvas.toDataURL(mimeType, imageQuality)\n  }\n\n  /**\n   * Saves the current video frame as a blob.\n   *\n   * @param {Object} [options] - Optional options object.\n   * @param {number} [options.scale=1] - The scale used when capturing the video frame.\n   * @param {string} [options.mimeType='image/png'] - The file format to export the image as.\n   * @param {number} [options.imageQuality=0.92] - The image quality factory used by `'image/jpeg'` and `'image/webp'`.\n   * @returns {Promise<Blob>} A promise that will be resolved to a blob with the image data.\n   */\n  toBlob(options = {}) {\n    argCheck.optOptions('VideoFrameCapture.toBlob', 'options', options)\n      .optNumber('scale')\n      .optString('mimeType')\n      .optNumber('imageQuality')\n\n    let {scale = 1, mimeType = null, imageQuality = 0.92} = options\n    let canvas = this._prepareCanvas(scale)\n    return new Promise(resolve => {\n      canvas.toBlob(resolve, mimeType, imageQuality)\n    })\n  }\n\n  _prepareCanvas(scale) {\n    let context = this._canvas.getContext('2d')\n    let {videoWidth, videoHeight} = this._video\n    let width = videoWidth * scale\n    let height = videoHeight * scale\n    this._canvas.width = width\n    this._canvas.height = height\n    context.clearRect(0, 0, width, height)\n    context.drawImage(this._video, 0, 0, width, height)\n    return this._canvas\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/videoFrameCapture.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EmitterMixin from 'common/emitter'\nimport {isChrome} from 'common/utils'\n\nimport Room from 'matrix/room'\n\nimport RtcComponent from 'webrtc/rtcComponent'\nimport PeerConnectionProxy from 'webrtc/peerConnectionProxy'\nimport {ConnectionFailedError, ConnectionLostError, ConnectionSignalingError} from 'webrtc/errors'\n\nimport MediaNode from 'media/mediaNode'\nimport StreamSink from 'media/streamSink'\nimport StreamSource from 'media/streamSource'\n\nconst SERVICE_LOCAL_ID = 'c3-media-service'\n\nconst CON_TAG = 'stream-connection'\nconst PUB_TAG = 'stream-publisher'\nconst SUB_TAG = 'stream-subscriber'\n\nconst CONNECTION_DISCONNECT_TIMEOUT_MS = 5000\nconst ERROR_TIMEOUT_MULTIPLIER_MS = 1000\n\n// signaling, peer connection is not in stable state\nconst CONNECTION_STATE_SIGNALING = 'signaling'\n// peer connection in stable state, ice not connected\nconst CONNECTION_STATE_CONNECTING = 'connecting'\n// peer connection stable and ice connected\nconst CONNECTION_STATE_CONNECTED = 'connected'\n// ice was connected but has disconnected, might recover\nconst CONNECTION_STATE_RECONNECTING = 'reconnecting'\n// call has been closed\nconst CONNECTION_STATE_CLOSED = 'closed'\n\nexport class StreamConnection {\n  constructor(deps) {\n    this._stream = deps.stream\n    this._configPromise = deps.configPromise\n    this._onOffer = deps.onOffer\n    this._onStream = deps.onStream\n    this._emitterTarget = deps.emitterTarget\n    this._peerConnection = null\n    this._errorState = null\n    this._connectionState = CONNECTION_STATE_SIGNALING\n    this._connectionFailCount = 0\n    this._disconnectTimeoutId = 0\n    this._errorTimeoutId = 0\n  }\n\n  get errorState() {\n    return this._errorState\n  }\n\n  get connectionState() {\n    return this._connectionState\n  }\n\n  _setConnectionState(connectionState) {\n    let prevState = this._connectionState\n    this._connectionState = connectionState\n    if (prevState !== connectionState) {\n      this._emitterTarget._emit('connectionState', connectionState)\n    }\n  }\n\n  _setErrorState(errorState) {\n    if (errorState !== this._errorState) {\n      this._errorState = errorState\n      this._emitterTarget._emit('errorState', errorState)\n    }\n  }\n\n  _connectionHasFailed(error) {\n    clearTimeout(this._disconnectTimeoutId)\n    this._disconnectTimeoutId = 0\n    if (this._connectionState === CONNECTION_STATE_CLOSED) {\n      return\n    }\n\n    if (this._connectionState === CONNECTION_STATE_SIGNALING) {\n      log.warning(CON_TAG, `${this} connection failed while signaling`)\n    }\n    log.info(CON_TAG, `${this} restarting failed connection, ${error}`)\n    this._setErrorState(error)\n    this._restart()\n  }\n\n  _restart() {\n    this._errorTimeoutId = setTimeout(() => {\n      if (this._connectionState !== CONNECTION_STATE_CLOSED) {\n        this.start()\n      }\n    }, (this._connectionFailCount - 1) * ERROR_TIMEOUT_MULTIPLIER_MS)\n  }\n\n  start() {\n    this._setConnectionState(CONNECTION_STATE_SIGNALING)\n    return this._configPromise.then(config => {\n      this._peerConnection = PeerConnectionProxy.create({\n        iceServers: config.iceServers,\n        iceCandidateFilter(info) {\n          return info.type === 'relay'\n        },\n      })\n\n      const onSignalingStateChange = () => {\n        if (!this._peerConnection) {\n          return\n        }\n        let {signalingState} = this._peerConnection\n        if (signalingState === 'closed') {\n          this._peerConnection.removeEventListener('addstream', onAddStream)\n          this._peerConnection.removeEventListener('removestream', onRemoveStream)\n          this._peerConnection.removeEventListener('signalingstatechange', onSignalingStateChange)\n          this._peerConnection.removeEventListener('iceconnectionstatechange', onIceConnectionStateChange)\n          this._peerConnection = null\n          this._onStream && this._onStream(null)\n        }\n      }\n      const onIceConnectionStateChange = () => {\n        if (!this._peerConnection) {\n          return\n        }\n        let {iceConnectionState} = this._peerConnection\n        if (iceConnectionState === 'failed') {\n          this._connectionFailCount += 1\n          this._connectionHasFailed(new ConnectionFailedError(this._connectionFailCount))\n        } else if (iceConnectionState === 'disconnected') {\n          this._setConnectionState(CONNECTION_STATE_RECONNECTING)\n          this._disconnectTimeoutId = setTimeout(() => {\n            this._connectionHasFailed(new ConnectionLostError('Timed out in disconnected state'))\n          }, CONNECTION_DISCONNECT_TIMEOUT_MS)\n        } else {\n          clearTimeout(this._disconnectTimeoutId)\n          this._disconnectTimeoutId = 0\n          if (iceConnectionState === 'connected') {\n            this._connectionFailCount = 0\n            this._setErrorState(null)\n            this._setConnectionState(CONNECTION_STATE_CONNECTED)\n          }\n        }\n      }\n      const onAddStream = event => {\n        this._onStream && this._onStream(event.stream)\n      }\n      const onRemoveStream = () => {\n        this._onStream && this._onStream(null)\n      }\n\n      if (this._stream) {\n        this._peerConnection.addStream(this._stream)\n      }\n      this._peerConnection.addEventListener('addstream', onAddStream)\n      this._peerConnection.addEventListener('removestream', onRemoveStream)\n      this._peerConnection.addEventListener('signalingstatechange', onSignalingStateChange)\n      this._peerConnection.addEventListener('iceconnectionstatechange', onIceConnectionStateChange)\n\n      let constraints = isChrome ? {\n        mandatory: {\n          OfferToReceiveAudio: true,\n          OfferToReceiveVideo: true,\n        },\n      } : {\n        offerToReceiveVideo: 1,\n        offerToReceiveAudio: 1,\n      }\n      this._peerConnection.performOffer({constraints, waitForIce: true})\n        .then(offer => this._onOffer(offer))\n        .then(answer => this._peerConnection.handleAnswer({answer}))\n        .then(() => this._setConnectionState(CONNECTION_STATE_CONNECTING))\n        .catch(error => {\n          let signalingError = new ConnectionSignalingError(error)\n          this._connectionFailCount += 1\n          log.error(CON_TAG, `failed to connect to stream, ${signalingError}`)\n          this._emitterTarget._emit({\n            eventType: 'signalingError',\n            defaultHandler() {\n              log.error(CON_TAG, 'unhandled connection signaling error', signalingError)\n            },\n          }, signalingError)\n          this._restart()\n        })\n    })\n  }\n\n  close() {\n    this._setErrorState(null)\n    this._setConnectionState(CONNECTION_STATE_CLOSED)\n    if (this._peerConnection) {\n      if (this._peerConnection.signalingState !== 'closing') {\n        this._peerConnection.close()\n      }\n    }\n  }\n}\n\n/**\n * @typedef {Object} StreamPublisher.PublishRequest\n *\n * @property {external:RTCSessionDescription} offer - A session description with type `'offer'`.\n */\n\n/**\n * @typedef {Object} StreamPublisher.PublishReply\n *\n * @property {string} streamId - The id if the stream that was published.\n * @property {external:RTCSessionDescription} answer - A session description with type `'answer'`.\n */\n\n/**\n * @callback StreamPublisher.PublishCallback\n *\n * @param {StreamPublisher.PublishRequest} request - The publish request.\n * @returns {Promise<StreamPublisher.PublishReply>} A promise that should be resolved to\n *   a publish reply object, or rejected if there was an error.\n */\n\n/**\n * An {@link RtcComponent} that will automatically publish a stream and have the peers in\n * a call subscribe to it. The peer must have a {@link StreamSubscriber} attached\n * at the matching attachment point.\n *\n * The purpose of this component is to provide a simple way to use stream relay and recording\n * features within the context of a call. The call data channel is used to negotiate subscriptions\n * automatically, so it is enough to simply attach publish and subscribe components to each end of\n * a call.\n *\n * Instances should be constructed using {@link StreamPublisher.inRoom}, although the\n * constructor can be used for testing purposes.\n *\n * @class StreamPublisher\n * @implements RtcComponent\n * @extends EventEmitter\n * @param {Options} options - An options object.\n * @param {Promise<external:RTCConfiguration>} options.configPromise - A promise that resolves\n *   to a peer connection configuration.\n * @param {StreamPublisher.PublishCallback} options.publish - A callback that is called whenever\n *   a new stream needs to be published.\n *\n * @example\n * let publisher = StreamPublisher.inRoom(room)\n * mediaSource.connect(publisher)\n *\n * let call = room.startCall(peer)\n * call.attach('stream', publisher)\n */\nexport class StreamPublisher extends EmitterMixin(RtcComponent) {\n  /**\n   * Emitted when the connection state of the publisher changes.\n   *\n   * @event StreamPublisher#connectionState\n   * @param {PeerConnectionState} connectionState - The new connection state.\n   */\n\n  /**\n   * Emitted when the error state is changed.\n   *\n   * @event StreamPublisher#errorState\n   * @param {(ConnectionFailedError|ConnectionLostError)?} errorState - The new error state.\n   */\n\n  /**\n   * Emitted when there is a signaling error. The connection will be restarted when this happens.\n   *\n   * @event StreamPublisher#signalingError\n   * @param {ConnectionSignalingError} signalingError - A signaling error.\n   */\n\n  static inRoom(options) {\n    argCheck.options('StreamPublisher.inRoom', 'options', options)\n      .object('meta')\n      .instance('room', Room)\n\n    let {room, meta} = options\n\n    return new StreamPublisher({\n      configPromise: room._serviceRequest(SERVICE_LOCAL_ID, 'c3.stream.get-config'),\n      publish({offer}) {\n        return room._serviceRequest(SERVICE_LOCAL_ID, 'c3.stream.publish', {offer, meta})\n      },\n    })\n  }\n\n  constructor({publish, configPromise}) {\n    super({label: 'c3.stream.publisher', remoteLabel: 'c3.stream.subscriber'})\n    this._sink = new StreamSink({onStream: this._onStream.bind(this)})\n    this._conneciton = null\n    this._streamId = null\n    this._publish = publish\n    this._configPromise = configPromise\n    this._setStreamId = this._setStreamId.bind(this)\n  }\n\n  /**\n   * The input for the media that will be published.\n   *\n   * @readonly\n   * @member {MediaNodeInput} StreamPublisher#input\n   */\n  get input() {\n    return this._sink\n  }\n\n  /**\n   * An error describing why the connection is failing, or null if there is no error.\n   * Will always be null if {@link StreamPublisher#connectionState} is `'connected'` or `'closed'`.\n   *\n   * @readonly\n   * @member {(ConnectionFailedError|ConnectionLostError)?} StreamPublisher#errorState\n   */\n  get errorState() {\n    if (this._connection) {\n      return this._connection.errorState\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * The connection state of the sublisher.\n   *\n   * @readonly\n   * @member {PeerConnectionState} StreamPublisher#connectionState\n   */\n  get connectionState() {\n    if (this._connection) {\n      return this._connection.connectionState\n    } else {\n      return null\n    }\n  }\n\n  _onStream(stream) {\n    if (this._connection) {\n      this._setStreamId(null)\n      this._connection.close()\n      this._connection = null\n    }\n    if (stream) {\n      this._connection = new StreamConnection({\n        stream,\n        configPromise: this._configPromise,\n        onOffer: offer => {\n          log.info(PUB_TAG, 'publishing stream')\n          return this._publish({offer}).then(content => {\n            let {streamId, answer} = content\n            log.info(PUB_TAG, `got stream id '${streamId}' and answer ${answer}`)\n            this._setStreamId(streamId)\n            return answer\n          })\n        },\n        emitterTarget: this,\n      })\n      this._connection.start().catch(error => {\n        log.error(PUB_TAG, `failed to get stream config, ${error}`)\n      })\n    }\n  }\n\n  _setStreamId(streamId) {\n    this._streamId = streamId\n    if (this.attached) {\n      this.attachPoint.data.setWithOwnership('streamId', streamId, 'streamer')\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillAttach(attachPoint) {\n    if (attachPoint.type !== 'call') {\n      throw new TypeError('StreamPublisher may only be attached to calls.')\n    }\n    attachPoint.data.setWithOwnership('streamId', this._streamId, 'streamer')\n  }\n}\n\n/**\n * @typedef {Object} StreamSubscriber.SubscriptionRequest\n *\n * @property {string} streamId - The id if the stream that is being subscribed to.\n * @property {external:RTCSessionDescription} offer - A session description with type `'offer'`.\n */\n\n/**\n * @typedef {Object} StreamSubscriber.SubscriptionReply\n *\n * @property {external:RTCSessionDescription} answer - A session description with type `'answer'`.\n */\n\n/**\n * @callback StreamSubscriber.SubscribeCallback\n *\n * @param {StreamSubscriber.SubscriptionRequest} request - The subscription request.\n * @returns {Promise<StreamSubscriber.SubscriptionReply>} A promise that should be resolved to\n *   a subscription reply object, or rejected if there was an error.\n */\n\n/**\n * An {@link RtcComponent} that will automatically subscribe to a stream that is being\n * published by the peer in a call. The peer must have a {@link StreamPublisher} attached\n * at the matching attachment point.\n *\n * The purpose of this component is to provide a simple way to use stream relay and recording\n * features within the context of a call. The call data channel is used to negotiate subscriptions\n * automatically, so it is enough to simply attach publish and subscribe components to each end of\n * a call.\n *\n * Instances should be constructed using {@link StreamSubscriber.inRoom}, although the\n * constructor can be used for testing purposes.\n *\n * @class StreamSubscriber\n * @implements RtcComponent\n * @extends EventEmitter\n * @extends ConnectMixin\n * @param {Options} options - An options object.\n * @param {Promise<external:RTCConfiguration>} options.configPromise - A promise that resolves\n *   to a peer connection configuration.\n * @param {StreamSubscriber.SubscribeCallback} options.subscribe - A callback that is called whenever\n *   a new subscription is being made.\n *\n * @example\n * let subscriber = StreamSubscriber.inRoom(room)\n * subscriber.connect(removeView)\n *\n * let call = room.startCall(peer)\n * call.attach('stream', subscriber)\n */\nexport class StreamSubscriber extends MediaNode.connectMixin(EmitterMixin(RtcComponent)) {\n  /**\n   * Emitted when the connection state of the subscriber changes.\n   *\n   * @event StreamSubscriber#connectionState\n   * @param {PeerConnectionState} connectionState - The new connection state.\n   */\n\n  /**\n   * Emitted when the error state is changed.\n   *\n   * @event StreamSubscriber#errorState\n   * @param {(ConnectionFailedError|ConnectionLostError)?} errorState - The new error state.\n   */\n\n  /**\n   * Emitted when there is a signaling error. The connection will be restarted when this happens.\n   *\n   * @event StreamSubscriber#signalingError\n   * @param {ConnectionSignalingError} signalingError - A signaling error.\n   */\n\n  /**\n   * Creates a new {@link StreamSubscriber} withing the context of a room. The room must have been\n   * created with `recording` options set in {@link Client.RoomConfiguration}, and the server must\n   * have recording enabled.\n   *\n   * @param {Object} options - Options object.\n   * @param {Room} options.room - The room.\n   * @returns {StreamSubscriber} A newly created {@link StreamSubscriber} instance.\n   */\n  static inRoom(options) {\n    argCheck.options('StreamPublisher.inRoom', 'options', options)\n      .instance('room', Room)\n\n    let {room} = options\n    return new StreamSubscriber({\n      configPromise: room._serviceRequest(SERVICE_LOCAL_ID, 'c3.stream.get-config'),\n      subscribe(subscription) {\n        return room._serviceRequest(SERVICE_LOCAL_ID, 'c3.stream.subscribe', subscription)\n      },\n    })\n  }\n\n  constructor({configPromise, subscribe}) {\n    super({label: 'c3.stream.subscriber', remoteLabel: 'c3.stream.publisher'})\n    this._source = new StreamSource()\n    this._subscribe = subscribe\n    this._streamId = null\n    this._configPromise = configPromise\n  }\n\n  /**\n   * Output for the received media.\n   *\n   * @member {MediaNodeOutput} StreamSubscriber#output\n   */\n  get output() {\n    return this._source\n  }\n\n  /**\n   * An error describing why the connection is failing, or null if there is no error.\n   * Will always be null if {@link StreamSubscriber#connectionState} is `'connected'` or `'closed'`.\n   *\n   * @readonly\n   * @member {(ConnectionFailedError|ConnectionLostError)?} StreamSubscriber#errorState\n   */\n  get errorState() {\n    if (this._connection) {\n      return this._connection.errorState\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * The connection state of the subscriber.\n   *\n   * @readonly\n   * @member {PeerConnectionState} StreamSubscriber#connectionState\n   */\n  get connectionState() {\n    if (this._connection) {\n      return this._connection.connectionState\n    } else {\n      return null\n    }\n  }\n\n  _subscribeToStreamId(streamId) {\n    if (this._streamId === streamId) {\n      return\n    }\n    this._streamId = streamId\n\n    if (this._connection) {\n      this._connection.close()\n      this._connection = null\n    }\n\n    if (!streamId) {\n      return\n    }\n\n    this._connection = new StreamConnection({\n      configPromise: this._configPromise,\n      onOffer: offer => {\n        log.info(SUB_TAG, `subscribing to stream: '${streamId}'`)\n        return this._subscribe({offer, streamId}).then(content => {\n          let {answer} = content\n          log.info(SUB_TAG, `got answer ${answer}`)\n          return answer\n        })\n      },\n      onStream: stream => {\n        this._source.setStream(stream)\n      },\n      emitterTarget: this,\n    })\n\n    this._connection.start().catch(error => {\n      log.error(PUB_TAG, `failed to get stream config, ${error}`)\n    })\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentUpdatedData({key, value, oldValue, ownerId}) {\n    if (key === 'streamId') {\n      this._subscribeToStreamId(value)\n    }\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillAttach(attachPoint) {\n    if (attachPoint.type !== 'call') {\n      throw new TypeError('StreamSubscriber may only be attached to calls.')\n    }\n    this._subscribeToStreamId(attachPoint.data.get('streamId'))\n  }\n\n  /**\n   * @private\n   */\n  rtcComponentWillDetach() {\n    this._subscribeToStreamId(null)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/streamPubSub.js","import log from 'common/log'\nimport EmitterMixin from 'common/emitter'\nimport argCheck from 'common/argCheck'\nimport {parseDataUri, binaryStringToArrayBuffer} from 'common/utils'\n\nimport ScaledCanvasFilter from 'media/scaledCanvasFilter'\nimport TemasysCanvasFilter from 'media/temasysCanvasFilter'\n\nimport RtcComponent from 'webrtc/rtcComponent'\n\nconst TAG = 'thumbnail-broadcaster'\n\n/**\n * The element renderer.\n * @abstract\n * @extends EventEmitter\n * @class ThumbnailBroadcaster.SinkRenderer\n */\nclass SinkRenderer extends EmitterMixin(null) {\n  /**\n   * Emitted when elements are added.\n   *\n   * @event ThumbnailBroadcaster.SinkRenderer#added\n   * @param {Array<HTMLElement>} added - An array of elements that were added.\n   */\n\n  /**\n   * Emitted when elements are removed.\n   *\n   * @event ThumbnailBroadcaster.SinkRenderer#removed\n   * @param {Array<HTMLElement>} removed - An array of elements that were removed.\n   */\n\n  /**\n   * Emitted when elements are updated.\n   *\n   * @event ThumbnailBroadcaster.SinkRenderer#elements\n   * @param {Array<HTMLElement>} elements - The current list of elements.\n   */\n\n  constructor(options) {\n    super()\n\n    let {\n      elementClass = '',\n    } = options || {}\n\n    this._elementClassName = elementClass\n    this._htmlElements = new Map()\n    this._elements = []\n  }\n\n  __processImage(peerId, dataUrl) {\n    if (!this._htmlElements.has(peerId)) {\n      this._addImageElementForPeer(peerId, dataUrl)\n    } else {\n      let el = this._htmlElements.get(peerId)\n      if (el.nodeName === 'IMG') {\n        el.src = dataUrl\n      }\n    }\n  }\n\n  __processRemoteSource(peerId, source) {\n    log.info(TAG, `processRemoteSource ${peerId}`)\n    if (!this._htmlElements.has(peerId) ||\n        this._htmlElements.get(peerId).nodeName === 'IMG') {\n      /* we don't have an element for this peer or it is an img */\n      log.info(TAG, 'adding video element for peer')\n      this._addVideoElementForPeer(peerId, source)\n    } else if (this._htmlElements.get(peerId).nodeName === 'VIDEO') {\n      log.info(TAG, `connecting new source to old video element for ${peerId}`)\n\n      source.connect(this._htmlElements.get(peerId))\n    }\n  }\n\n  __removePeer(peerId) {\n    if (this._htmlElements.has(peerId)) {\n      let elementToRemove = this._htmlElements.get(peerId)\n      this._removeElement(peerId, elementToRemove)\n    }\n  }\n\n  _removeElement(peerId, element) {\n    this._htmlElements.delete(peerId)\n    this._emit('removed', [element])\n    this._elements = [...this._htmlElements.values()]\n    this._emit('elements', this._elements)\n  }\n\n  /**\n   * The current set of elements.\n   *\n   * Returned HTML elements will have a property peerId indicating the peer.\n   *\n   * @readonly\n   * @member {Array<HTMLElement>} ThumbnailBroadcaster.SinkRenderer#elements\n   */\n  get elements() {\n    return this._elements\n  }\n\n  _addElement(peerId, element) {\n    element.peerId = peerId\n    if (this._htmlElements.has(peerId)) {\n      let removedElement = this._htmlElements.get(peerId)\n      this._removeElement(peerId, removedElement)\n    }\n    this._htmlElements.set(peerId, element)\n    this._emit('added', [element])\n    this._elements = [...this._htmlElements.values()]\n    this._emit('elements', this._elements)\n  }\n\n  _addImageElementForPeer(peerId, dataUrl) {\n    log.info(TAG, `adding image element for ${peerId}`)\n    var imgEl = document.createElement('img')\n    imgEl.src = dataUrl\n    imgEl.className = this._elementClassName\n    this._addElement(peerId, imgEl)\n  }\n\n  _addVideoElementForPeer(peerId, source) {\n    log.info(TAG, `adding video element for ${peerId}`)\n    var videoEl = document.createElement('video')\n    videoEl.autoplay = true\n    videoEl.className = this._elementClassName\n\n    videoEl.addEventListener('loadeddata', () => {\n      log.info(TAG, `video element loadeddata: readyState = ${videoEl.readyState}`)\n      this._addElement(peerId, videoEl)\n    })\n\n    log.info(TAG, `connecting new source to new video element (${peerId})`)\n    source.connect(videoEl)\n  }\n}\n\n/**\n * The projection configuration for ThumbnailBroadcaster.\n * @typedef {Object} ThumbnailBroadcaster.ProjectionConfiguration\n * @property {number} [width] - The width of the generated thumbnails (in pixels).\n * @property {number} [aspectRatio] - The aspect ratio of the thumbnail (width/height).\n * @property {'aspectFill'|'scaleToFill'} [contentMode='aspectFill'] - How to fill the thumbnail.\n */\n\n/**\n * An {@link RtcComponent} that will automatically publish a stream and have the peers in\n * a call subscribe to it. The peer must have a ThumbnailBroadcaster attached\n * at the matching attachment point.\n *\n * The purpose of this component is to provide a simple way to send miniature streams and\n * thumbnail images within the context of a call.\n *\n * @class ThumbnailBroadcaster\n * @implements RtcComponent\n * @param {Object} options - An options object.\n * @param {ThumbnailBroadcaster.ProjectionConfiguration} options.projectionConfiguration - An options object.\n *\n * @example\n * thumbnailBroadcaster = new cct.ThumbnailBroadcaster({\n *   projectionConfiguration: {\n *     width: 100,\n *     aspectRatio: 16/9,\n *     contentMode: 'aspectFill',\n *   },\n *   videoFrameRate: 10,\n *   imageFrameRate: 0.5,\n * })\n *\n * videoSource.connect(thumbnailBroadcaster)\n *\n * let renderer = thumbnailBroadcaster.createRenderer({elementClass: 'c3-example-thumbnail'})\n *\n * renderer.on('elements', function (elements) {\n *   addElementsToDom(elements)\n * })\n */\nexport default class ThumbnailBroadcaster extends RtcComponent {\n  constructor(options) {\n    super({label: 'cct.media.thumbnailbroadcaster'})\n    argCheck.optOptions('ThumbnailBroadcaster constructor', 'options', options)\n      .optObject('projectionConfiguration')\n      .optNumber('videoFrameRate')\n\n    let {\n      projectionConfiguration = {},\n      videoFrameRate = 15,\n      imageFrameRate = 0,\n    } = options || {}\n\n    options.projectionConfiguration = projectionConfiguration\n    options.videoFrameRate = videoFrameRate\n    options.imageFrameRate = imageFrameRate\n    this._shouldConnectCanvasFilter = false\n    this._handleStillPicture = this._handleStillPicture.bind(this)\n    this.createRenderer = this.createRenderer.bind(this)\n\n    try {\n      this._canvasFilter = new ScaledCanvasFilter(options)\n\n      log.info(TAG, 'scaled canvas filter initialized')\n      // we have a working canvas filter miniature, so we should connect it to remote peers\n      this._shouldConnectCanvasFilter = true\n    } catch (error) {\n      log.info(TAG, 'canvas filter not supported, falling back to still pictures')\n      this._canvasFilter = new TemasysCanvasFilter(options)\n    }\n\n    this._outgoingThumbChannels = new Map()\n  }\n\n  /**\n   * Create a renderer that will emit elements.\n   *\n   * @function ThumbnailBroadcaster#createRenderer\n   * @param {Object} [options] - Optional options object.\n   * @returns {ThumbnailBroadcaster.SinkRenderer} - The renderer object that will emit events.\n   */\n  createRenderer(options) {\n    this._sinkRenderer = new SinkRenderer(options)\n    return this._sinkRenderer\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillAttach(attachPoint) {\n    this._attachPoint = attachPoint\n\n    if (this._shouldConnectCanvasFilter) {\n      log.info(TAG, 'using local source as video element')\n      // we have a valid local stream, so add this to the elements\n\n      if (this._sinkRenderer) {\n        this._sinkRenderer.__processRemoteSource(attachPoint.ownId, this._canvasFilter.output)\n      }\n    } else {\n      log.info(TAG, 'using local source as image element')\n    }\n\n    this._canvasFilter.on('stillPictureCaptured', this._handleStillPicture)\n  }\n\n  _handleStillPicture(dataUrl) {\n    this._sinkRenderer.__processImage(this._attachPoint.ownId, dataUrl)\n    this._transferImageToPeers(dataUrl)\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentWillDetach(attachPoint) {\n    this._canvasFilter.off('stillPictureCaptured', this._handleStillPicture)\n  }\n\n  _transferImageToPeers(dataUrl) {\n    let blobToTransfer = this._dataURItoBlob(dataUrl)\n\n    this._outgoingThumbChannels.forEach((channel, peerId) => {\n      let isChannelOpen = channel.readyState === 'open'\n      let isChannelNotBusy = typeof(channel._isBusy) === 'undefined' || channel._isBusy === false\n      if (isChannelOpen && isChannelNotBusy) {\n        channel._isBusy = true\n        channel.send({image: blobToTransfer}).then(() => {\n          log.info(TAG, `transfer of still picture to ${peerId} completed`)\n          channel._isBusy = false\n        }).catch(error => {\n          log.debug(TAG, 'channel send error', error)\n        })\n      } else {\n        log.info(TAG, `not sending on ${channel} (isBusy = ${channel._isBusy})`)\n      }\n    })\n  }\n\n  _dataURItoBlob(dataURI) {\n    let {mimeType, binaryString} = parseDataUri(dataURI)\n    let ab = binaryStringToArrayBuffer(binaryString)\n    return new Blob([ab], {type: mimeType})\n  }\n\n  _blobToDataURI(blob, callback) {\n    var a = new FileReader()\n    a.onload = function (e) { callback(e.target.result) }\n    a.readAsDataURL(blob)\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidReceivePeer(peer) {\n    log.info(TAG, `received peer: ${peer.id}`)\n\n    if (this._shouldConnectCanvasFilter) {\n      this._canvasFilter.connect(peer)\n    }\n\n    if (this._sinkRenderer) {\n      this._sinkRenderer.__processRemoteSource(peer.id, peer)\n    }\n\n    let dataChannel = peer.createChannel({\n      label: 'cct.thumbnail',\n      protocol: 'cct.thumbnail.v0',\n      pairingId: 'default',\n    })\n\n    this._outgoingThumbChannels.set(peer.id, dataChannel)\n\n    dataChannel.on('message', ({image}) => {\n      log.info(TAG, `received thumbnail image (size=${image.size}) from peer ${peer.id} (channel: ${dataChannel})`)\n\n      this._blobToDataURI(image, dataURL => {\n        log.info(TAG, `thumbnail image successfully received (channel: ${dataChannel})`)\n\n        if (this._sinkRenderer) {\n          this._sinkRenderer.__processImage(peer.id, dataURL)\n        }\n      })\n    })\n  }\n\n  // eslint-disable-next-line\n  /**\n   * @private\n   */\n  rtcComponentDidLosePeer(peer) {\n    log.info(TAG, `lost peer: ${peer.id}`)\n    if (this._sinkRenderer) {\n      this._sinkRenderer.__removePeer(peer.id)\n    }\n\n    this._outgoingThumbChannels.delete(peer.id)\n  }\n\n  /**\n   * The input for the media that will be broadcasted to all peers.\n   *\n   * @readonly\n   * @member {MediaNodeInput} ThumbnailBroadcaster#input\n   */\n  get input() {\n    return this._canvasFilter\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/thumbnailBroadcaster.js","\n/**\n * The top level C3 Web SDK namespace.\n *\n * Classes marked with **protected** do not provide a public constructor, they either use static\n * factory methods or are only exported to provide access to the prototype and using `instanceof`.\n *\n * Base API classes:\n * - {@link AccountData} **protected** - Provides access to both room specific and global persistent account data.\n * - {@link Auth} **protected** - Provides static methods for authentication.\n * - {@link Call} **protected** - A two-way WebRTC Call.\n * - {@link Client} - Main client object, the entrypoint for server connections.\n * - {@link Conference} **protected** - A WebRTC conference with multiple participants.\n * - {@link FileRef} **protected** - Reference to a local or remote file.\n *     Has static factory methods for loading from different sources.\n * - {@link FileTransfer} **protected** - Represents a file transfer to a remote peer.\n * - {@link FileDownload} **protected** - Represents a file download from a remote peer.\n * - {@link ImageResource} **protected** - Provides access to a server-side image resource.\n * - {@link PowerLevelsEdit} **protected** - Provides a fluent API for editing the power levels in a room.\n * - {@link PowerLevelsReader} **protected** - Used to inspect the power levels in a room,\n *     as well as read a raw power levels object.\n * - {@link Room} **protected** - A representation of a room that users join in order to communicate.\n * - {@link RoomQuery} **protected** - A live query that filters the rooms known to the client.\n * - {@link RoomState} **protected** - Represents persistent state of a specific type in a room.\n * - {@link User} **protected** - Represents a user.\n *\n * RtcComponent building blocks:\n * - {@link AttachPoint} **protected** - Provides an API for RtcComponents once they have been attached to something.\n * - {@link RtcComponent} - Base class for RtcComponents that are attached to calls and conferences.\n * - {@link RtcPeer} **protected** - Provides and API for interacting with remote peers in an RtcComponent.\n *\n * Built-in {@link RtcComponent}s:\n * - {@link DataShare} - Synchronize data between all participants in a conference or call.\n * - {@link DocumentReader} - Streams an entire web page or iframe to a remote peer.\n * - {@link DocumentRenderer} - Renders a page recieved from a {@link DocumentReader}, and forwards input events.\n * - {@link FileShare} - Share files between all participants in a conference or call.\n * - {@link MediaBroadcaster} - Broadcast media to other users in a conference.\n * - {@link PeerMediaPipe} - Send and receive media from the peer in a call.\n * - {@link StreamPublisher} - Publish a stream to a stream relay with recording (requires recording service).\n * - {@link StreamSubscriber} - Subscribe to a relayed stream (requires recording service).\n *\n * Media API building blocks:\n * - {@link MediaNode} - Base class for all media nodes, which also contains some static utility methods.\n * - {@link MediaNodeInput} - An input port that receives streams for it's parent media node.\n * - {@link MediaNodeOutput} - An output port that forwards streams frmo it's parent media node.\n * - {@link MediaFilter} - Base class for nodes that receives and forwards a stream.\n * - {@link MediaSink} - Base class for nodes at the end of the chain that receive and renders a stream.\n * - {@link MediaSource} - Base class for source nodes that generate a stream.\n * - {@link ConcreteMediaSource} - Base class for a source that is backed by a single tangible stream.\n * - {@link WebAudioFilter} - Base class for WebAudio-based filter nodes.\n * - {@link WebAudioSource} - Base class for WebAudio-based source nodes.\n *\n * Build-in {@link MediaNode}s:\n * - {@link AudioBufferSource} - Plays audio buffers.\n *     Also provides utilities for decoding and loading audio buffers from files.\n * - {@link AudioMeter} - Analyses the volume of incoming audio and provides a raw, and low-pass values.\n * - {@link AudioMixer} - Mixes together audio from multiple streams into one output stream.\n * - {@link ChromeScreenSource} - Screen sharing in Chrome, you usually want to use {@link ScreenSource} instead.\n * - {@link DeviceSource} - Captures media from user microphones and cameras.\n * - {@link FirefoxScreenSource} - Screen sharing in Firefox, you usually want to use {@link ScreenSource} instead.\n * - {@link HtmlSink} - Renders the incoming audio and video to an HTMLMediaElement, i.e. `<audio>` or `<video>`.\n * - {@link MediaTee} - A container node that bundles together some common functionalities.\n *     Usually used as source node for remote streams.\n * - {@link MuteFilter} - Makes it possible to mute a media stream.\n * - {@link Passthrough} - Identity node that forwards streams, with optional logging.\n *     Used for inspection and smoothing out API surfaces.\n * - {@link Recorder} - Used for client-side recording of media streams.\n * - {@link ScreenSource} - Enables screen capture.\n * - {@link StreamMerger} - Merges the audio and video components from two incoming streams together into one stream.\n * - {@link StreamSink} - Quick access to a received MediaStream, used for testing and bridging APIs.\n * - {@link StreamSource} - Forwards a given MediaStream, used for testing and bridging APIs.\n * - {@link StreamSplitter} - Splits a stream into it's audio and video components.\n * - {@link UserMediaSource} - A low level node that requests user media, usually you\n *     want {@link DeviceSource} or {@link ScreenSource} instead.\n *\n * Error types:\n * - {@link AuthenticationError} - Authentication failed, or it is required to perform the requested action.\n * - {@link ChannelClosedError} - The operation failed because the channel was closed.\n * - {@link ChannelFailedError} - The channel failed due to a low-level error.\n * - {@link ChannelTimeoutError} - The channel operation timed out.\n * - {@link ConflictError} - The requested action would result in a conflict.\n * - {@link ConnectionFailedError} - Connection setup failed after signaling was completed.\n * - {@link ConnectionLostError} - A connection which was connected has now failed.\n * - {@link ConnectionSignalingError} - Error when trying to set up a connection.\n * - {@link FileTransferError} - Failure because of data corruption or a protocol error.\n * - {@link GuestAccessError} - Guests are not allowed to perform the requested action.\n * - {@link InternalServerError} - The server encountered an unexpected error.\n * - {@link InvalidAliasError} - The requested room alias is invalid.\n * - {@link InvalidUsernameError} - The requested username is invalid.\n * - {@link NotAllowedError} - The requested action is not allowed.\n * - {@link NotFoundError} - The requested resource could not be found.\n * - {@link TooLargeError} - The request body was too large.\n * - {@link TransferInterruptedError} - Failure because the connection was interrupted.\n *\n * @namespace cct\n */\n\nif (window.cordova && window.cordova.plugins && window.cordova.plugins.iosrtc) {\n  window.cordova.plugins.iosrtc.registerGlobals()\n}\n\nexport {default as _argCheck} from 'common/argCheck'\nexport {default as _EmitterMixin} from 'common/emitter'\nexport {default as _AsyncQueue, AsyncPipe as _AsyncPipe} from 'common/queue'\n\nimport * as utils from 'common/utils'\nexport {utils as _utils}\n\n/**\n * The log singleton, see {@link Log}.\n * @readOnly\n * @member {Log} cct#log\n */\nexport {default as log} from 'common/log'\n\n/**\n * @member {Object} cct#version\n * @readOnly\n * @property {string} number - Package version number.\n * @property {string} commit - Commit hash.\n * @property {string} synapseMinVersion - Minimum required synapse version.\n * @property {string} synapseTargetVersion - Target synapse version, versions past this\n *   could break backwards compatability.\n */\nexport const version = process.env.VERSION\n\nexport {webRtcReady, AdapterJS as _AdapterJS} from 'webrtc/utils'\n\nexport {default as AccountData} from 'matrix/accountData'\nexport {default as Auth} from 'matrix/auth'\nexport {default as Client} from 'matrix/client'\nexport {default as ImageResource} from 'matrix/resources'\nexport {default as ImageUpload} from 'matrix/resources'\nexport {PowerLevelsEdit, PowerLevelsReader} from 'matrix/powerLevels'\nexport {default as Room} from 'matrix/room'\nexport {default as RoomQuery} from 'matrix/roomQuery'\nexport {default as RoomState} from 'matrix/roomState'\nexport {default as User} from 'matrix/user'\n\nexport {default as Call} from 'webrtc/call'\nexport {default as FileRef, FileTransfer, FileDownload} from 'webrtc/fileRef'\nexport {AttachData} from 'webrtc/dataHub'\nexport {default as RtcComponent} from 'webrtc/rtcComponent'\nexport {RtcPeer} from 'webrtc/attachmentManager'\nexport {MediaBroadcaster, DataShare, FileShare, PeerMediaPipe, ProxySink, ProxySource} from 'webrtc/components'\nexport {default as ThumbnailBroadcaster} from 'webrtc/thumbnailBroadcaster'\nexport {StreamPublisher, StreamSubscriber} from 'webrtc/streamPubSub'\n\nexport {default as AudioBufferSource} from 'media/audioBufferSource'\nexport {default as AudioMeter} from 'media/audioMeter'\nexport {default as AudioMixer} from 'media/audioMixer'\nexport {default as ChromeScreenSource} from 'media/chromeScreenSource'\nexport {isMediaNode, inputs as mediaInputs, outputs as mediaOuputs} from 'media/common'\nexport {default as ConcreteMediaSource} from 'media/concreteMediaSource'\nexport {default as DeviceSource} from 'media/deviceSource'\nexport {default as DummySource} from 'media/dummySource'\nexport {default as FirefoxScreenSource} from 'media/firefoxScreenSource'\nexport {default as HtmlSink} from 'media/htmlSink'\nexport {default as MediaFilter} from 'media/mediaFilter'\nexport {default as MediaNode} from 'media/mediaNode'\nexport {default as MediaNodeInput} from 'media/mediaNodeInput'\nexport {default as MediaNodeOutput} from 'media/mediaNodeOutput'\nexport {default as MediaSink} from 'media/mediaSink'\nexport {default as MediaSource} from 'media/mediaSource'\nexport {default as MediaTee} from 'media/mediaTee'\nexport {default as MuteFilter} from 'media/muteFilter'\nexport {default as Passthrough} from 'media/passthrough'\nexport {default as Recorder} from 'media/recorder'\nexport {default as ScreenSource} from 'media/screenSource'\nexport {default as StreamMerger} from 'media/streamMerger'\nexport {default as StreamSink} from 'media/streamSink'\nexport {default as StreamSource} from 'media/streamSource'\nexport {default as StreamSplitter} from 'media/streamSplitter'\nexport {default as UserMediaSource} from 'media/userMediaSource'\nexport {default as VideoFrameCapture} from 'media/videoFrameCapture'\nexport {default as WebAudioFilter} from 'media/webAudioFilter'\nexport {default as WebAudioSource} from 'media/webAudioSource'\n\nexport {default as Conference} from 'conference/conference'\n\n\n\n// WEBPACK FOOTER //\n// ./lib/cct.js","'use strict'\n\nimport log from 'common/log'\nimport Request from 'common/request'\n\nvar REPORTER_SEND_INTERVAL = 5000\n\nexport default function Reporter(url) {\n  this.sendIntervalms = REPORTER_SEND_INTERVAL\n  this.waiting = false\n  this.pending = []\n  this.statsEndpoint = Request().origin(url)\n  this.seenError = false\n  this.tag = 'stats-reporter'\n}\n\nReporter.prototype.handleStats = function (payload) {\n  var self = this\n  self.pending.push(payload)\n  if (!self.waiting) {\n    self.waiting = true\n    setTimeout(function () {\n      self.waiting = false\n      var reports = self.processReports(self.pending)\n      log.verbose(self.tag, 'Posting reports [' + JSON.stringify(reports).length + ' bytes]', reports)\n      self.statsEndpoint.post(reports)\n                .then(function () {\n                  if (self.seenError) {\n                    self.seenError = false\n                  }\n                }).catch(function (error) {\n                  if (self.seenError) {\n                    log.warning(self.tag, 'Post failed:', error)\n                  } else {\n                    self.seenError = true\n                    log.error(self.tag, 'Post failed:', error)\n                  }\n                })\n      self.pending = []\n    }, self.sendIntervalms)\n  }\n}\n\nReporter.prototype.processReports = function (reports) {\n  var pcStats = {}\n\n  for (var i in reports) {\n    var stats = reports[i]\n    for (var j in stats) {\n      var stat = stats[j]\n      if (stat.pcId) {\n        if (!pcStats[stat.pcId]) {\n          pcStats[stat.pcId] = [stat]\n        } else {\n          pcStats[stat.pcId].push(stat)\n        }\n      }\n    }\n  }\n\n  for (var pcId in pcStats) {\n    pcStats[pcId] = this.processPcStats(pcStats[pcId])\n  }\n\n  return {\n    pcStats: pcStats,\n  }\n}\n\nReporter.prototype.processPcStats = function (stats) {\n  var sources = this.invertTimeSeries(stats)\n  this.flattenTimeSeries(sources)\n  return sources\n}\n\nReporter.prototype.invertTimeSeries = function (stats) {\n  var sources = {} // Each source has a unique source key, e.g. ssrc\n  var i\n  var key\n  var stat\n  var source\n\n    // First populate sources keys\n  for (i in stats) {\n    stat = stats[i]\n    if (!sources[stat.sourceId]) {\n      source = sources[stat.sourceId] = {}\n    } else {\n      source = sources[stat.sourceId]\n    }\n\n    for (key in stat) {\n      if (!source[key]) {\n        source[key] = []\n      }\n    }\n  }\n\n    // Then add data\n  for (i in stats) {\n    stat = stats[i]\n    source = sources[stat.sourceId]\n    for (key in source) {\n      var value = stat[key]\n      if (value !== undefined) {\n        source[key].push(value)\n      } else {\n        source[key].push('')\n      }\n    }\n  }\n  return sources\n}\n\n// Flattens an array of source values into a single value, if all values are identical\nReporter.prototype.flattenTimeSeries = function (sources) {\n  for (var sourceId in sources) {\n    var source = sources[sourceId]\n    for (var key in source) {\n      var samples = source[key]\n      if (!samples.length) {\n        continue\n      }\n      var firstValue = samples[0]\n      var seenDifferent = false\n      for (var i in samples) {\n        if (samples[i] !== firstValue) {\n          seenDifferent = true\n          break\n        }\n      }\n      if (!seenDifferent) {\n        source[key] = firstValue\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/common/reporter.js","'use strict'\n\nimport log from 'common/log'\n\nimport {streamDiff} from 'webrtc/utils'\nimport PeerConnectionProxy from 'webrtc/peerConnectionProxy'\nimport monitorDataChannels from 'webrtc/dataChannelMonitor'\nimport Signaler from 'webrtc/signaler'\n\nimport DataChannelMultiplexer from 'datamux/datamux'\n\nconst TAG = 'conference-conn'\n\nconst RTT_DIFF_THRESHOLD = 25\nconst RTT_FACTOR_THRESHOLD = 1.5\n\n/**\n * Internal class the represents the connection to a peer in the conference.\n */\nexport default class ConferenceConnection {\n  constructor(deps) {\n    this._ownId = deps.ownId\n    this._peerId = deps.peerId\n    this._peerLinkInfo = deps.peerLinkInfo\n    this._attachmentManager = deps.attachmentManager\n    this._statsFormatter = deps.statsFormatter\n    this._peerConnectionConfiguration = {\n      iceServers: deps.iceServers,\n      iceCandidateFilter: deps.iceCandidateFilter,\n      statsFormatter: deps.statsFormatter,\n    }\n    this._conferencePeer = null\n    this._connectedAt = null\n    this._lastReportedRtt = null\n\n    this._onAddRemoteStream = this._onRemoteStreamChange.bind(this, 'got')\n    this._onRemoveRemoteStream = this._onRemoteStreamChange.bind(this, 'lost')\n\n    this._datamux = new DataChannelMultiplexer({\n      onChannel: channel => this._attachmentManager.handlePeerChannel(this._peerId, channel),\n      onConnect: () => this._signaler.handleDataChannelConnect(),\n      onDisconnect: reason => this._signaler.handleDataChannelDisconnect(reason),\n      onRttChange: this._onRttChange.bind(this),\n      onUpStateChange: this._onUpStateChange.bind(this),\n    })\n    this._peerLinkInfo.update(this._datamux)\n\n    // All builtin channels should be created here\n    let renegotiationChannel = this._datamux.createChannel({\n      builtin: true,\n      label: 'cct.call',\n      protocol: 'cct.call.v0',\n    })\n    this._attachmentChannels = {\n      negotiationChannel: this._datamux.createChannel({\n        builtin: true,\n        label: 'cct.call.attach-map',\n        protocol: 'cct.call.attach-map.v0',\n      }),\n      dataHubChannel: this._datamux.createChannel({\n        builtin: true,\n        label: 'cct.attach.data',\n        protocol: 'cct.attach.data.v0',\n      }),\n      messagingChannel: this._datamux.createChannel({\n        builtin: true,\n        label: 'cct.attach.messaging',\n        protocol: 'cct.attach.messaging.v0',\n      }),\n    }\n    this._raftChannel = this._datamux.createChannel({\n      builtin: true,\n      label: 'cct.conference.raft',\n      protocol: 'cct.conference.raft.v0',\n    })\n\n    this._signaler = new Signaler({\n      label: `${this._ownId}->${this._peerId}`,\n      receivedOffer: deps.offer,\n      renegotiationChannel,\n      close: this.close.bind(this),\n      onMessage: deps.onSignalingMessage,\n      onSignalingError: this._onSignalingError.bind(this),\n      onErrorStateChange: this._onErrorStateChange.bind(this),\n      onConnectionStateChange: this._onConnectionStateChange.bind(this),\n      onCreatePeerConnection: this._createPeerConnection.bind(this),\n    })\n  }\n\n  get raftChannel() {\n    return this._raftChannel\n  }\n\n  get up() {\n    return this._datamux.up\n  }\n\n  get connected() {\n    return this._signaler.connectionState === 'connected'\n  }\n\n  get connectedAt() {\n    return this._connectedAt\n  }\n\n  start() {\n    this._signaler.start()\n  }\n\n  toString() {\n    return 'conferenceConnection{peerId=' + this._peerId + ',' + this._peerConnection + '}'\n  }\n\n  _onRttChange(rttMs) {\n    var shouldUpdate = false\n    if (this._lastReportedRtt === null) {\n      shouldUpdate = true\n    }\n\n    let rttDiff = Math.abs(this._lastReportedRtt - rttMs)\n    let rttFactor = rttMs <= 0 ? Infinity : this._lastReportedRtt / rttMs\n    if (rttFactor < 1) {\n      rttFactor = 1 / rttFactor\n    }\n    if (rttFactor > RTT_FACTOR_THRESHOLD && rttDiff > RTT_DIFF_THRESHOLD) {\n      shouldUpdate = true\n    }\n\n    if (this._peerLinkInfo && shouldUpdate) {\n      this._peerLinkInfo.update(this._datamux)\n      this._lastReportedRtt = rttMs\n    }\n  }\n\n  _onUpStateChange(up) {\n    this._peerLinkInfo.update(this._datamux)\n  }\n\n  _createPeerConnection() {\n    if (this._peerConnection) {\n      log.verbose(TAG, this, 'replacing peer connection')\n      this.reset()\n    }\n    this._peerConnection = PeerConnectionProxy.create(this._peerConnectionConfiguration)\n    if (this._statsFormatter) {\n      monitorDataChannels(this._peerConnection, this._statsFormatter)\n    }\n    let dataChannelFactory = this._peerConnection.createDataChannel.bind(this._peerConnection)\n    this._datamux.createDataChannels(dataChannelFactory)\n    this._attachmentManager.setDatamuxForPeer(this._peerId, this._datamux, this._attachmentChannels)\n    this._lastReportedRtt = null\n    this._peerConnection.addEventListener('addstream', this._onAddRemoteStream)\n    this._peerConnection.addEventListener('removestream', this._onRemoveRemoteStream)\n\n    return this._peerConnection\n  }\n\n  _updateLocalStreams(streams) {\n    if (!this._peerConnection) {\n      return\n    }\n    let currentStreams = this._peerConnection.getLocalStreams()\n    let [added, removed] = streamDiff(currentStreams, streams)\n    added.forEach(stream => this._peerConnection.addStream(stream))\n    removed.forEach(stream => this._peerConnection.removeStream(stream))\n  }\n\n  _setConferencePeer(conferencePeer) {\n    this._conferencePeer = conferencePeer\n    if (conferencePeer) {\n      conferencePeer._setErrorState(this._signaler.errorState)\n      conferencePeer._setConnectionState(this._signaler.connectionState)\n    }\n  }\n\n  _onSignalingError(error) {\n    log.warning(TAG, this, `restarting connection because of signaling error, ${error}`)\n    this._signaler.reset()\n    this._signaler.start()\n  }\n\n  _onErrorStateChange(error) {\n    if (this._conferencePeer) {\n      this._conferencePeer._setErrorState(error)\n    }\n  }\n\n  _onConnectionStateChange(newState, oldState) {\n    if (newState === 'connected') {\n      this._connectedAt = Date.now()\n    } else {\n      this._connectedAt = null\n    }\n    if (this._conferencePeer) {\n      this._conferencePeer._setConnectionState(newState, oldState)\n    }\n  }\n\n  _onRemoteStreamChange(op, event) {\n    let {stream} = event\n    log.debug(TAG, `${op} remote stream '${stream.id}:'`, stream)\n    let streams = this._peerConnection.getRemoteStreams()\n    this._attachmentManager.setRemoteStreamsForPeer(this._peerId, streams)\n  }\n\n  _handleSignalingMessage(message) {\n    try {\n      this._signaler.handleMessage(message)\n    } catch (error) {\n      log.error(TAG, this, `error when handling signaling message: ${error}`)\n    }\n  }\n\n  setPausedState(isPaused) {\n    this._datamux.setPausedState(isPaused)\n  }\n\n  close() {\n    if (this._signaler.transitionToClosed()) {\n      this.reset()\n      this._datamux.cleanup()\n      this._raftChannel._clearListeners('message') // TODO: proper implementation\n      this._attachmentManager = null\n      log.info(TAG, 'closed connection: ' + this)\n    }\n  }\n\n  reset() {\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('addstream', this._onAddRemoteStream)\n      this._peerConnection.removeEventListener('removestream', this._onRemoveRemoteStream)\n    }\n    this._datamux.reset()\n    this._attachmentManager.cleanupPeer(this._peerId)\n    this._signaler.reset()\n    try {\n      if (this._peerConnection && this._peerConnection.signalingState !== 'closed') {\n        this._peerConnection.close()\n      }\n    } catch (e) {\n      log.error(TAG, 'failed to close peer connection: ', e)\n    }\n    this._peerConnection = null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/conferenceConnection.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {diff} from 'common/utils'\n\nconst TAG = 'connection-pool'\n\n// It's not too expensive to keep connections alive, so use a pretty lengthy ttl.\n// A single peerId we will also only have a single connection, so people spamming\n// refresh etc. is not a problem.\nconst CONNECTION_TTL_MS = 30 * 1000\nconst TICK_INTERVAL_MS = 1500\n// We keep this quite low, triggering disconnects is cheap since we don't tear\n// down connections.\nconst DISCONNECTED_TICK_LIMIT = 4 // 6s with ticks every 1.5s\n\n// This thing should keep track of setting up connections, expiring old connections\n// that aren't needed, doing raft communication, making sure the local mesh links\n// are updated and pingers are active, and set up specific connections that are\n// needed to connect to a cluster.\nexport default class ConferenceConnectionPool {\n  constructor({ownId, connectionFactory, meshTopology, onRaftMessage, onDisconnected, onInvite, onBestConnection}) {\n    argCheck.string(this, 'options.ownId', ownId)\n    this._tick = this._tick.bind(this)\n    this.handleRaftMessage = this.handleRaftMessage.bind(this)\n\n    this._connectionFactory = connectionFactory\n    this._meshTopology = meshTopology\n    this._onRaftMessage = onRaftMessage\n    this._onDisconnected = onDisconnected\n    this._onInvite = onInvite\n    this._onBestConnection = onBestConnection\n\n    this._ownId = ownId\n    this._intervalId = null\n    this._connections = new Map() // peerId: conferenceConnection\n\n    // Connections that aren't expected will expire after some time. The reason we don't close them\n    // straight away is that it is quite common that connections are no longer needed due to signaling\n    // conflicts, but once the conflicts are resolved and we've joined the cluster, the connection\n    // will be needed again.\n    this._expiry = new Map() // peerId: expiryTimeMs\n\n    // Similar to expiry, but keeps track of immaterial connections\n    // that can be realized using .materializeGhostConnections()\n    this._ghostConnections = new Map() // peerId: expiryTimeMs\n\n    // These are the expected connections, they're synchronized with the raft membership configuration\n    this._expected = new Set() // peerId\n\n    // When connecting to a cluster, this will make sure that we are only accepting messages from the\n    // cluster leader\n    this._clusterLeader = null\n\n    this._disconnectedTicks = 0\n\n    // Used to keep track of the best connection, currently selected by uptime\n    this._bestConnection = null\n    this._bestConnectionTime = Infinity\n  }\n\n  toString() {\n    let active = this.active.size\n    let expected = this._expected.size\n    let total = this._connections.size\n    return `connectionPool{ownId=${this._ownId},active=${active},expected=${expected},total=${total}}`\n  }\n\n  get connections() {\n    return this._connections\n  }\n\n  get expected() {\n    return this._expected\n  }\n\n  get active() {\n    let active = new Set()\n    this._expected.forEach(peerId => {\n      if (this._connections.has(peerId)) {\n        active.add(peerId)\n      }\n    })\n    return active\n  }\n\n  start() {\n    if (!this._intervalId) {\n      this._intervalId = setInterval(this._tick, TICK_INTERVAL_MS)\n    } else {\n      throw new Error(`Called connectionPool.start() when already started for ${this}`)\n    }\n  }\n\n  stop() {\n    if (this._intervalId) {\n      clearInterval(this._intervalId)\n      this._intervalId = null\n    }\n    this._disconnectedTicks = 0\n    this._clusterLeader = null\n    this._expected.clear()\n    this._connections.forEach((connection, peerId) => this._removeConnection(peerId))\n    this._connections.clear()\n    this._expiry.clear()\n  }\n\n  // Adds an entry for a possible connection that might be realized at a later stage.\n  // The ghost connection will stick around for ttlMs milliseconds, and then be removed.\n  addGhostConnection(peerId, {ttlMs = CONNECTION_TTL_MS} = {}) {\n    log.debug(TAG, this, `adding ghost connection to ${peerId} with ttl ${ttlMs}ms`)\n    this._ghostConnections.set(peerId, Date.now() + ttlMs)\n  }\n\n  // Materialize all active ghost connections to real connections.\n  materializeGhostConnections() {\n    let now = Date.now()\n    this._ghostConnections.forEach((expiry, peerId) => {\n      if (expiry > now) {\n        log.debug(TAG, this, `materializing ghost connection, ${peerId}`)\n        this._onInvite(peerId)\n      }\n    })\n    this._ghostConnections.clear()\n  }\n\n  // Temporary connections are used when setting up connections to peers that are not yet\n  // members of the raft cluster. There connections will expire, but the TTL should be more than\n  // enough to have time to set up a connection and do raft signaling until the peer or oneself\n  // has become a true member of the cluster.\n  ensureTemporaryConnection(peerId) {\n    if (peerId === this._ownId) {\n      log.error(TAG, this, `tried to ensure connection to self, ${peerId}`)\n      return\n    }\n    this._addConnection(peerId)\n  }\n\n  // This is a special case of the above method, where we will only be accepting raft message from the\n  // cluster leader until we've received the cluster configuration.\n  connectToClusterLeader(peerId) {\n    this._clusterLeader = peerId\n    this.ensureTemporaryConnection(peerId)\n  }\n\n  // This should be called when the raft members are updated. We unset the cluster leader here, since\n  // if we get a membership update we've successfully joined the cluster.\n  // This is safe because the only messages that are sent to non-members are snapshot requests, which\n  // are always ignored once we've joined the cluster. This means that a stray cluster leader won't break\n  // our local raft state for the cluster.\n  setExpectedConnections(peerIds) {\n    this._expected = new Set(peerIds)\n    if (this._expected.has(this._ownId)) {\n      this._clusterLeader = null\n      this._expected.delete(this._ownId)\n    }\n    this._tick()\n  }\n\n  // Sets the observer callback that will be called once synchronously, and then whenever\n  // the 'best' connection changes. Which connection is the best one is currently determined\n  // only by how long it has been connected.\n  setBestConnectionObserver(callback) {\n    this._onBestConnection = callback\n    if (callback) {\n      callback(this._bestConnection)\n    }\n  }\n\n  // This simply forwards WebRTC signaling messages to the correct connection\n  handleConnectionMessage(peerId, message) {\n    if (message.recipient !== this._ownId) {\n      return // ignore messages that aren't meant for us\n    }\n    let {content} = message\n    if (!content) {\n      log.warning(TAG, this, `got signaling message without content from ${peerId}, ${JSON.stringify(message)}`)\n      return\n    }\n\n    let connection = this._connections.get(peerId)\n    if (!connection) {\n      let keys = `[${Object.keys(content).join(', ')}]`\n      log.debug(TAG, this, `got signaling message for missing connection to ${peerId} containing ${keys}, creating`)\n      connection = this._addConnection(peerId)\n    }\n\n    connection._handleSignalingMessage(content)\n  }\n\n  // This handles outbound raft messages that are generated by a Raft instance\n  handleRaftMessage(peerId, message) {\n    let connection = this._connections.get(peerId)\n    if (connection && connection.raftChannel) {\n      if (connection.raftChannel.readyState === 'open') {\n        connection.raftChannel.send(message)\n      } else {\n        log.verbose(TAG, `raft message to '${peerId}' was not sent: ${JSON.stringify(message)}`)\n      }\n    }\n  }\n\n  _tick() {\n    let [added, removed] = diff(this._connections.keys(), this._expected)\n    log.verbose(TAG, this, `ticked, adding [${added.join(', ')}], maybe removing [${removed.join(', ')}]`)\n    added.forEach(peerId => {\n      log.info(TAG, this, `adding expected connection to ${peerId}`)\n      this._addConnection(peerId)\n    })\n\n    let now = Date.now()\n    removed.forEach(peerId => {\n      let expiry = this._expiry.get(peerId)\n      if (!expiry || expiry < now) {\n        log.info(TAG, this, `removing expired connection to ${peerId}`)\n        this._removeConnection(peerId)\n      }\n    })\n\n    let newExpiryMs = now + CONNECTION_TTL_MS\n    this.active.forEach(peerId => {\n      this._expiry.set(peerId, newExpiryMs)\n    })\n\n    this._ghostConnections.forEach((expiry, peerId) => {\n      if (expiry < now) {\n        log.verbose(TAG, this, `expired ghost connection to ${peerId}`)\n        this._ghostConnections.delete(peerId)\n      }\n    })\n\n    // Find the connection that has been connected the longest\n    let stillTheBest = this._bestConnection && this._bestConnection.connectedAt === this._bestConnectionTime\n    if (!stillTheBest) {\n      let hadConnection = !!this._bestConnection\n      this._bestConnection = null\n      this._bestConnectionTime = Infinity\n      this._connections.forEach(connection => {\n        if (connection.connectedAt && connection.connectedAt < this._bestConnectionTime) {\n          this._bestConnection = connection\n          this._bestConnectionTime = connection.connectedAt\n        }\n      })\n      if (this._onBestConnection && (this._bestConnection || hadConnection)) {\n        this._onBestConnection(this._bestConnection)\n      }\n    }\n\n    let haveConnection = false\n    let isConnected = false\n    let disconnectFactor = 1\n\n    // Check if we're currently connected\n    if (this._clusterLeader) {\n      let leaderConnection = this._connections.get(this._clusterLeader)\n      if (leaderConnection) {\n        haveConnection = true\n        isConnected = leaderConnection.up\n      }\n      disconnectFactor = 3\n    } else {\n      if (!this._expected.size) {\n        this._disconnectedTicks = 0\n        return\n      }\n      this._expected.forEach(peerId => {\n        if (isConnected) {\n          return\n        }\n        let connection = this._connections.get(peerId)\n        if (connection) {\n          haveConnection = true\n          isConnected = connection.up\n        }\n      })\n    }\n    if (!haveConnection) {\n      this._disconnectedTicks += disconnectFactor\n      log.debug(TAG, this, `has not connection, incremented disconnection ticks to ${this._disconnectedTicks}`)\n    } else if (!isConnected) {\n      this._disconnectedTicks += disconnectFactor\n      log.debug(TAG, this, `is not connected, incremented disconnection ticks to ${this._disconnectedTicks}`)\n    } else {\n      this._disconnectedTicks = 0\n    }\n    if (this._disconnectedTicks > DISCONNECTED_TICK_LIMIT) {\n      log.info(TAG, this, 'reached disconnection tick limit, signaling disconnect')\n      this._clusterLeader = null\n      this._disconnectedTicks = 0\n      this._expected.clear()\n      this._expiry.clear()\n      this._onDisconnected()\n    }\n  }\n\n  _addConnection(peerId) {\n    this._expiry.set(peerId, Date.now() + CONNECTION_TTL_MS)\n\n    if (this._connections.has(peerId)) {\n      log.debug(TAG, this, `already has a connection to ${peerId}, no need to add`)\n      return\n    }\n\n    log.debug(TAG, this, `is adding a connection to ${peerId}`)\n\n    let peerLinkInfo = this._meshTopology.localTopologyInfo.addPeer(peerId)\n    let connection = this._connectionFactory({peerId, peerLinkInfo})\n    this._connections.set(peerId, connection)\n\n    // Handling of inbound raft messages, we ignore messages that aren't from the leader when we're joining a cluster.\n    connection.raftChannel.on('message', message => {\n      if (this._clusterLeader && peerId !== this._clusterLeader) {\n        log.verbose(TAG, `ignored raft message from ${peerId}, only accepting message from cluster leader, ` +\n          `${this._clusterLeader}, message: ${JSON.stringify(message)}`)\n      }\n      this._onRaftMessage(peerId, message)\n    })\n\n    connection.start()\n    return connection\n  }\n\n  _removeConnection(peerId) {\n    let connection = this._connections.get(peerId)\n    if (!connection) {\n      log.error(TAG, this, `could not find removed connection ${peerId}`)\n      return\n    }\n    if (this._expected.has(peerId)) {\n      log.error(TAG, this, `is removing an expected connection, check you logics ${peerId}`)\n    }\n    log.debug(TAG, this, `will remove connection to ${peerId}`)\n\n    this._connections.delete(peerId)\n    this._expiry.delete(peerId)\n    this._meshTopology.localTopologyInfo.removePeer(peerId)\n\n    connection.close()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/conferenceConnectionPool.js","'use strict'\n\nimport EmitterMixin from 'common/emitter'\nimport {diff, ReadOnlyMap} from 'common/utils'\n\n// Copying these instead of importing for better minification\nconst CONNECTION_STATE_CONNECTED = 'connected'\n\n/**\n * A class representing the state of a single conference peer.\n *\n * @abstract\n * @class ConferencePeer\n * @extends EventEmitter\n */\nexport class ConferencePeer extends EmitterMixin(null) {\n  constructor(id, onUpdate) {\n    super()\n    this._id = id\n    this._errorState = null\n    this._connectionState = null\n    this._onUpdate = onUpdate\n  }\n\n  toString() {\n    return `conferencePeer{id=${this._id},state=${this._connectionState},error=${this._errorState}}`\n  }\n\n  /**\n   * The id of the peer.\n   *\n   * @readonly\n   * @member {UserId} ConferencePeer#id\n   */\n  get id() {\n    return this._id\n  }\n\n  /**\n   * Emitted when the error state of the connection to the peer is changed.\n   *\n   * @event ConferencePeer#errorState\n   * @param {(ConnectionFailedError|ConnectionLostError)?} error - A new error, or null.\n   */\n\n  /**\n   * The error state of the peer. This will be null if there is no current problem with the call.\n   *\n   * @readonly\n   * @member {(ConnectionFailedError|ConnectionLostError)?} ConferencePeer#errorState\n   */\n  get errorState() {\n    return this._errorState\n  }\n\n  /**\n   * Emitted when the state of the connection to the peer is changed.\n   *\n   * @event ConferencePeer#connectionState\n   * @param {PeerConnectionState} connectionState - The new connection state.\n   * @param {PeerConnectionState} oldConnectionState - The old connection state.\n   */\n\n  /**\n   * The connection state of the peer.\n   *\n   * @readonly\n   * @member {PeerConnectionState} ConferencePeer#connectionState\n   */\n  get connectionState() {\n    return this._connectionState\n  }\n\n  _setErrorState(errorState) {\n    if (this._errorState !== errorState) {\n      this._errorState = errorState\n      this._emit('errorState', errorState)\n      this._onUpdate()\n    }\n  }\n\n  _setConnectionState(newState, oldState) {\n    if (this._connectionState !== newState) {\n      this._connectionState = newState\n      this._emit('connectionState', newState, oldState)\n      this._onUpdate()\n    }\n  }\n\n  _clear() {\n    this._setErrorState(null)\n    this._setConnectionState(null, this._connectionState)\n    this._clearListeners()\n  }\n}\n\n/**\n * I collection representing all peers in a confernece.\n *\n * Each value in the map is a {@link ConferencePeer} instance, and the key is the {@link UserId} of that peer.\n *\n * @abstract\n * @class ConferencePeers\n * @extends EventEmitter\n * @extends ReadOnlyMap\n */\nexport default class ConferencePeers extends EmitterMixin(ReadOnlyMap) {\n  constructor({ownId, onUpdate}) {\n    super()\n    this._onPeerUpdate = this._onPeerUpdate.bind(this)\n\n    this._ownId = ownId\n    this._onUpdate = onUpdate\n  }\n\n  /**\n   * Provited a way to iterate though all the peer IDs in this map.\n   *\n   * @function ConferencePeers#keys\n   * @returns {Iterator<UserId>} - An iterator of all peer IDs in this map.\n   */\n\n  /**\n   * Provited a way to iterate though all the peers in this map.\n   *\n   * @function ConferencePeers#values\n   * @returns {Iterator<ConferencePeer>} - An iterator of all peers in this map.\n   */\n\n  /**\n   * Returns the peer for the given userId.\n   *\n   * @function ConferencePeers#get\n   * @param {UserId} peerId - The id of the peer to retreive.\n   * @returns {ConferencePeer} The peer, if it exists, `undefined` otherwise\n   */\n\n  /**\n   * Returns true if the map has an entry for the given peerId.\n   *\n   * @function ConferencePeers#has\n   * @param {UserId} peerId - The peerId to look for.\n   */\n\n  /**\n   * Synchronously calls an interator function once for each entry in the map.\n   *\n   * Errors thrown inside the iterator function will cancel the iteration\n   *\n   * @function ConferencePeers#forEach\n   * @param {ConferencePeersForEachCallback} func - The iterator function.\n   * @param {*} [thisArg] - The value to use as `this` inside the iterator function.\n   */\n\n  /**\n   * The iterator function passed to {@link ConferencePeers#forEach}.\n   *\n   * @callback ConferencePeersForEachCallback\n   * @param {UserId} peerId - The peerId of the current entry.\n   * @param {ConferencePeer} peer - The value of the current entry.\n   * @param {ConferencePeers} peers - The peer map itself.\n   */\n\n  /**\n   * Emitted when peers are added or removed.\n   *\n   * @event ConferencePeers#update\n   * @param {ConferencePeers} peers - The peer collection itself.\n   */\n\n  /**\n   * Emitted when peers are added or removed, or when any of the peers change state.\n   *\n   * @event ConferencePeers#deepUpdate\n   * @param {ConferencePeers} peers - The peer collection itself.\n   */\n\n  /**\n   * Emitted when a peer is added to the conference.\n   *\n   * @event ConferencePeers#added\n   * @param {UserId} peerId - The id of the peer that was added.\n   * @param {ConferencePeer} peer - The peer that was added\n   */\n\n  /**\n   * Emitted when a peer is removed from the conference.\n   *\n   * @event ConferencePeers#removed\n   * @param {UserId} peerId - The id of the peer that was removed.\n   */\n\n  // Connecitons need to be known here so that we can update peers before add events are\n  // emitted, while keeping the add and remove events consistent with the state of the map.\n  _setPeers(peerIds, connections) {\n    peerIds = new Set(peerIds)\n    peerIds.delete(this._ownId)\n    let [added, removed] = diff(this.keys(), peerIds)\n\n    removed.forEach(peerId => {\n      let peer = this.get(peerId)\n      peer._clear()\n      let connection = connections.get(peerId)\n      if (connection) {\n        connection._setConferencePeer(null)\n      }\n      this._delete(peerId)\n      this._emit('removed', peerId)\n    })\n    added.forEach(peerId => {\n      let peer = new ConferencePeer(peerId, this._onPeerUpdate)\n      let connection = connections.get(peerId)\n      if (connection) {\n        connection._setConferencePeer(peer)\n      }\n      this._set(peerId, peer)\n      this._emit('added', peerId, peer)\n    })\n\n    if (added.length || removed.length) {\n      this._emit('update', this)\n      this._onUpdate()\n      this._emit('deepUpdate', this)\n    }\n  }\n\n  _onPeerUpdate() {\n    this._onUpdate()\n    this._emit('deepUpdate', this)\n  }\n\n  _hasConnection() {\n    let connected = false\n    this.forEach(peer => {\n      if (!connected && peer.connectionState === CONNECTION_STATE_CONNECTED) {\n        connected = true\n      }\n    })\n    return connected\n  }\n\n  _clear() {\n    let updated = this.size !== 0\n    this.forEach((peer, peerId) => {\n      peer._clear()\n      this._emit('removed', peerId)\n    })\n    super._clear()\n    if (updated) {\n      this._emit('update', this)\n      this._emit('deepUpdate', this)\n    }\n  }\n\n  _cleanup() {\n    this._clear()\n    this._clearListeners()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/conferencePeers.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EventEmitter from 'common/emitter'\nimport {forEach, fill} from 'common/utils'\n\nimport MediaNode from 'media/mediaNode'\nimport Passthrough from 'media/passthrough'\n\nimport RtcComponent from 'webrtc/rtcComponent'\n\nconst TAG = 'conference-switcher'\n\nconst VOICE_DETECTION_INTERVAL_MS = 100\nconst VOICE_DETECTION_BACKOFF_MS = 2500\n\nclass RelayLinks {\n  static parse(data) {\n    if (!data) {\n      return null\n    }\n    argCheck.array('RelayLinks.parse', 'data', data)\n    if (data.length % 2 !== 0) {\n      throw new TypeError(`relay links array length must be even, was ${data.length}`)\n    }\n    let length = data.length\n    let userIds = data.slice(0, (length - 2) / 2)\n    let parents = data.slice((length - 2) / 2, length - 2)\n    let speakers = data.slice(length - 2, length)\n    return new RelayLinks(userIds, parents, speakers)\n  }\n\n  static createEmpty(memberIds) {\n    let userIds = [...memberIds].sort()\n    let parents = fill(Array(userIds.length), -1)\n    let speakers = [0, 0]\n    return new RelayLinks(userIds, parents, speakers)\n  }\n\n  constructor(userIds, parents, speakers) {\n    // An array of all members, in a determined order\n    this._userIds = userIds\n    // An array with the same length as the number of userIds. Each element in the array represents\n    // a link from the element to the index of that element in the array. Where the element and index\n    // are the indices in the userIds array. An element of -1 means there's no link to that userId.\n    // e.g. userIds = [a, b, c], parents = [1, 2, -1], links = b -> a, c -> b,\n    this._parents = parents\n    // An array with two elements, the index of the primary and the secondary speakers in the userIds array\n    this._speakers = speakers\n  }\n\n  toString() {\n    let links = []\n    this._parents.forEach((sourceIndex, targetIndex) => {\n      let targetId = this._userIds[targetIndex]\n      if (!links[sourceIndex]) {\n        links[sourceIndex] = [targetId]\n      } else {\n        links[sourceIndex].push(targetId)\n      }\n    })\n    let linkStrs = []\n    this._userIds.forEach((sourceId, sourceIndex) => {\n      if (links[sourceIndex]) {\n        linkStrs.push(`${sourceId}->[${links[sourceIndex].join(',')}]`)\n      }\n    })\n    return `relayLinks{${linkStrs.join(',')}}`\n  }\n\n  toJSON() {\n    return this._userIds.concat(this._parents).concat(this._speakers)\n  }\n\n  insert(source, target) {\n    let sourceIndex = this._userIds.indexOf(source)\n    let targetIndex = this._userIds.indexOf(target)\n    this._parents[targetIndex] = sourceIndex\n  }\n\n  setSpeakers(primaryId, secondaryId) {\n    this._speakers[0] = this._userIds.indexOf(primaryId)\n    this._speakers[1] = this._userIds.indexOf(secondaryId)\n  }\n\n  getSpeakers() {\n    let [primaryIndex, secondaryIndex] = this._speakers\n    return [this._userIds[primaryIndex], this._userIds[secondaryIndex]]\n  }\n\n  getParentOf(userId) {\n    let index = this._userIds.indexOf(userId)\n    if (index < 0) {\n      return null\n    }\n    let parentIndex = this._parents[index]\n    return this._userIds[parentIndex]\n  }\n\n  getChildrenOf(userId) {\n    let index = this._userIds.indexOf(userId)\n    if (index < 0) {\n      return []\n    }\n    let childIds = new Set()\n    for (let childIndex = 0; childIndex < this._parents.length; childIndex += 1) {\n      let parentIndex = this._parents[childIndex]\n      if (parentIndex === index) { // we are the parent\n        let childId = this._userIds[childIndex]\n        childIds.add(childId)\n      }\n    }\n    return childIds\n  }\n\n  equals(otherLinks) {\n    if (!otherLinks) {\n      return false\n    }\n    if (this === otherLinks) {\n      return true\n    }\n    let linksA = this._userIds\n    let linksB = otherLinks._userIds\n    if (linksA.length !== linksB.length) {\n      return false\n    }\n\n    for (let i = 0; i < linksA.length; i += 1) {\n      if (linksA[i] !== linksB[i]) {\n        return false\n      }\n    }\n\n    let parentsA = this._parents\n    let parentsB = otherLinks._parents\n    for (let i = 0; i < parentsA.length; i += 1) {\n      if (parentsA[i] !== parentsB[i]) {\n        return false\n      }\n    }\n\n    return true\n  }\n}\n\nclass SwitcherComponent extends RtcComponent {\n  constructor() {\n    super({label: 'cct.conference.switcher'})\n\n    this._input = new Passthrough()\n    this._output = new Passthrough()\n\n    this._parentId = null\n    this._childrenIds = new Set()\n    this._primarySpeaker = null\n  }\n\n  rtcComponentDidReceivePeer() {\n    this._updateRelayState()\n  }\n\n  rtcComponentDidLosePeer(peer) {\n    // TODO: fix TypeError: this._childrenIds.delete is not a function\n    this._childrenIds.delete(peer.id)\n    this._updateRelayState()\n  }\n\n  setRelayState(parentId, childrenIds, primarySpeaker) {\n    this._parentId = parentId\n    this._childrenIds = childrenIds\n    this._primarySpeaker = primarySpeaker\n    this._updateRelayState()\n  }\n\n  _updateRelayState() {\n    let {peers} = this.attachPoint\n\n    // Start by clearing all connections, updates are deferred so identical setups will not cause a renegotiation\n    if (this._input.output.targets.size) {\n      this._input.disconnect()\n    }\n    this.attachPoint.peers.forEach(peer => {\n      if (peer.output.targets.size) {\n        peer.disconnect()\n      }\n    })\n\n    if (this._parentId === this.attachPoint.ownId) {\n      this._input.connect(this._output)\n    } else if (this._parentId) {\n      let parent = peers.get(this._parentId)\n      if (parent) {\n        parent.connect(this._output)\n      }\n    }\n\n    let relaySource = null\n    if (this._primarySpeaker === this.attachPoint.ownId) {\n      // We're the primary speaker, forward our own stream\n      relaySource = this._input\n    } else if (this._parentId) {\n      // We've got a parent, forward the stream we're receiving from it\n      relaySource = peers.get(this._parentId)\n    }\n\n    if (!relaySource) {\n      // We've got no parent or got ourselves as parent\n      return\n    }\n\n    this._childrenIds.forEach(targetId => {\n      let target = peers.get(targetId)\n      if (target) {\n        // If the target is the primary speaker we're the secondary speaker and should send our own stream\n        // Note that we can't just check if we're the secondary direcly because the secondary speaker\n        // might still relay primary streams simultaneously.\n        if (this._primarySpeaker === targetId) {\n          this._input.connect(target)\n        } else {\n          relaySource.connect(target)\n        }\n      }\n    })\n  }\n}\n\n/**\n * @typedef {'off'|'manual'|'manual/follow'|'manual/automatic'|'automatic'} ConferenceSwitcherMode\n *\n * A string representing the connection state of a peer connection.\n *\n * - `'off'` - The switching functionality is turned off and will not consume any resources.\n * - `'manual'` - Speaker switching is done manually with {@link ConferenceSwitcher#requestPrimarySpeaker}\n *  and {@link ConferenceSwitcher#requestSecondarySpeaker}. Both speakers are chosen from\n *  {@link ConferenceSwitcher#selectedPrimarySpeaker} and {@link ConferenceSwitcher#selectedSecondarySpeaker}.\n * - `'manual/follow'` - The primary speaker is selected manually, and the secondary speaker will\n *                         always be the previous primary speaker.\n * - `'manual/automatic'` - The primary speaker is selected manually, and the secondary speaker\n *                           is automatically selected using active speaker detection.\n * - `'automatic'` - The primary speaker is automatically selected using active speaker detection,\n *                    and the secondary speaker will always be the previous primary speaker.\n */\n\nconst MODE_OFF = 'off'\nconst MODE_MANUAL = 'manual'\nconst MODE_MANUAL_FOLLOW = 'manual/follow'\nconst MODE_MANUAL_AUTOMATIC = 'manual/automatic'\nconst MODE_AUTOMATIC = 'automatic'\n\n// Modes 'automatic' and 'manual/automatic' are not yet implemented\nconst MODES = [MODE_OFF, MODE_MANUAL, MODE_MANUAL_FOLLOW, MODE_MANUAL_AUTOMATIC, MODE_AUTOMATIC]\n\nconst STATE_KEY_MODE = 'sw-mode'\nconst STATE_KEY_PRIMARY_SPEAKER = 'sw-speaker-1'\nconst STATE_KEY_SECONDARY_SPEAKER = 'sw-speaker-2'\nconst STATE_KEY_LINKS = 'sw-links'\n\nconst switcherModeBreakdown = {\n  [MODE_OFF]: null,\n  [MODE_MANUAL]: {primaryMode: 'manual', secondaryMode: 'manual'},\n  [MODE_MANUAL_FOLLOW]: {primaryMode: 'manual', secondaryMode: 'follow'},\n  [MODE_MANUAL_AUTOMATIC]: {primaryMode: 'manual', secondaryMode: 'automatic'},\n  [MODE_AUTOMATIC]: {primaryMode: 'automatic', secondaryMode: 'follow'},\n}\n\n/**\n * A media switcher for conferences, with the primary purpose of allowing high-quality\n * video to be sent from one member of the conference to the rest. The video is sent\n * in a way that distributes the bandwidth and processing requirements across all nodes.\n *\n * The switcher can operate in a couple of different modes, with the default one being\n * `'off'`. The modes enable different way of selecting which conference members should\n * be sending video to other members.\n *\n * The distributed nature of the switcher can be a bit confusing, for example, when\n * joining a conference, every participant should set the switcherMode to whetever\n * makes sense in the application. It is up to the application to make sure that\n * the switcherMode configuration is consistent across members, usually by simply\n * setting a default value, but other mechanisms could be used. The way this works\n * under the hood is that whoever joins the conference first gets to choose the\n * switcherMode, while the rest will be ignored.\n *\n * @abstract\n * @class ConferenceSwitcher\n * @extends EventEmitter\n * @extends ConnectMixin\n */\nexport default class ConferenceSwitcher extends EventEmitter(MediaNode.connectMixin(MediaNode)) {\n  /**\n   * Emitted when the primary speaker of the conference changes.\n   *\n   * @event ConferenceSwitcher#mode\n   * @param {UserId} mode - The new primary speaker.\n   */\n\n  /**\n   * Emitted when the selected primary speaker of the conference changes.\n   *\n   * See {@link ConferenceSwitcher#selectedPrimarySpeaker} for more details.\n   *\n   * @event ConferenceSwitcher#selectedPrimarySpeaker\n   * @param {UserId} selectedPrimarySpeaker - The new selected primary speaker.\n   */\n\n  /**\n   * Emitted when the primary speaker of the conference changes.\n   *\n   * See {@link ConferenceSwitcher#selectedSecondarySpeaker} for more details.\n   *\n   * @event ConferenceSwitcher#selectedSecondarySpeaker\n   * @param {UserId} selectedSecondarySpeaker - The new selected secondary speaker.\n   */\n\n  /**\n   * Emitted when the primary speaker of the conference changes.\n   *\n   * See {@link ConferenceSwitcher#primarySpeaker} for more details.\n   *\n   * @event ConferenceSwitcher#primarySpeaker\n   * @param {UserId} primarySpeaker - The new primary speaker.\n   */\n\n  /**\n   * Emitted when the primary speaker of the conference changes.\n   *\n   * See {@link ConferenceSwitcher#secondarySpeaker} for more details.\n   *\n   * @event ConferenceSwitcher#secondarySpeaker\n   * @param {UserId} secondarySpeaker - The new secondary speaker.\n   */\n\n  /**\n   * Emitted when the primary speaker of the conference changes.\n   *\n   * See {@link ConferenceSwitcher#speaker} for more details.\n   *\n   * @event ConferenceSwitcher#speaker\n   * @param {UserId} speaker - The new speaker.\n   */\n\n  static modeUsesVoiceDetection(mode = MODE_OFF) {\n    if (mode === MODE_OFF) {\n      return false\n    }\n    let {primaryMode, secondaryMode} = switcherModeBreakdown[mode]\n    return primaryMode === 'automatic' || secondaryMode === 'automatic'\n  }\n\n  constructor({ownId, raft, mode}) {\n    super()\n    this._onTopologyChange = this._onTopologyChange.bind(this)\n    this._voiceDetectionTick = this._voiceDetectionTick.bind(this)\n\n    this._ownId = ownId\n    this._raft = raft\n    this._mode = null\n    this._defaultMode = mode || MODE_OFF\n    this._meshTopology = raft.log.meshTopology\n\n    this._speaker = null\n    this._primarySpeaker = null\n    this._secondarySpeaker = null\n    this._selectedPrimarySpeaker = null\n    this._selectedSecondarySpeaker = null\n    this._loudestPeer = null\n\n    this._component = new SwitcherComponent()\n    this._isLeader = false\n    // A sorted list of conference members, earlier in the list means the member was a more recent speaker\n    this._memberIds = []\n\n    this._setMode(this._defaultMode)\n    this._meshTopology.addChangeListener(this._onTopologyChange)\n  }\n\n  toString() {\n    return `switcher{ownId=${this._ownId},mode=${this._mode},speaker=${this._speaker}}`\n  }\n\n  _getLocalStreamsForPeer(peerId) {\n\n  }\n\n  _setMode(mode) {\n    if (mode === this._mode) {\n      return\n    }\n    this._mode = mode\n    this._emit('mode', mode)\n\n    let useVoice = ConferenceSwitcher.modeUsesVoiceDetection(this._mode)\n    this._setVoiceDetectionEnabled(this._isLeader ? useVoice : false)\n    this._meshTopology.localTopologyInfo.setVoiceActivityDetectorActive(useVoice)\n  }\n\n  _setVoiceDetectionEnabled(enabled) {\n    if (enabled) {\n      if (!this._voiceDetectionIntervalId) {\n        this._voiceDetectionIntervalId = setInterval(this._voiceDetectionTick, VOICE_DETECTION_INTERVAL_MS)\n      }\n    } else {\n      if (this._voiceDetectionIntervalId) {\n        clearInterval(this._voiceDetectionIntervalId)\n        this._voiceDetectionIntervalId = null\n      }\n      if (this._voiceDetectionTimeoutId) {\n        clearTimeout(this._voiceDetectionTimeoutId)\n        this._voiceDetectionTimeoutId = null\n      }\n    }\n  }\n\n  _voiceDetectionTick() {\n    let currentLoudest = this._loudestPeer\n    // Array of [volume, peerId] pairs\n    let volumes = []\n    this._meshTopology.topologyInfos.forEach((topologyInfo, peerId) => {\n      volumes.push([topologyInfo.volume, peerId])\n    })\n    if (volumes.length === 0) {\n      this._loudestPeer = null\n    }\n    volumes.sort((a, b) => {\n      return b[0] - a[0] // descending order\n    })\n    let loudest = volumes[0][1]\n    if (loudest !== currentLoudest) {\n      this._loudestPeer = loudest\n      this._refreshRelayTree()\n\n      // Turn off voice switching for a bit after selecting a new speaker\n      this._setVoiceDetectionEnabled(false)\n      this._voiceDetectionTimeoutId = setTimeout(() => {\n        this._setVoiceDetectionEnabled(true)\n        this._voiceDetectionTimeoutId = null\n      }, VOICE_DETECTION_BACKOFF_MS)\n    }\n  }\n\n  _setDefaultMode(defaultMode = MODE_OFF) {\n    argCheck.values('ConferenceSwitcher defaultMode', 'mode', defaultMode, MODES)\n    this._defaultMode = defaultMode\n    this._setMode(this._defaultMode)\n  }\n\n  _initializeLeader() {\n    this._raft.set(STATE_KEY_MODE, this._defaultMode)\n    this._raft.set(STATE_KEY_LINKS, null)\n    this._raft.set(STATE_KEY_PRIMARY_SPEAKER, this._ownId)\n    this._raft.set(STATE_KEY_SECONDARY_SPEAKER, this._ownId)\n  }\n\n  /**\n   * Requests a new switching mode to be used in the conference. Whether this call\n   * succeeds depends on the current state of the conference and if other clients\n   * are requesting new modes at the same time.\n   *\n   * It's also not guaranteed that the switcher mode is set to the requested value\n   * when this call succeeds, as another conference member might have set another\n   * value just afterwards.\n   *\n   * To get this to work well with a UI, one should rely on this method to do the\n   * request and to get feedback about whether it was successfull. If the application\n   * displays the current switcher mode somewhere, that should be hooked up to the\n   * {@link event:ConferenceSwitcher.mode} event.\n   *\n   * @param {ConferenceSwitcherMode} mode - The new mode to request a switch to.\n   * @returns {Promise} A promise that is resolved if the request is successful, or\n   *                      rejected if it fails.\n   */\n  requestMode(mode) {\n    argCheck.values('ConferenceSwitcher.requestMode', 'mode', mode, MODES)\n    return this._raft.set(STATE_KEY_MODE, mode)\n  }\n\n  /**\n   * The current switcher mode of the conference.\n   *\n   * This could be changed at any point because some other client or oneself request\n   * a new switcher mode. One should listen to the {@link event:ConferenceSwitcher.mode}\n   * event to get notifications for when it's changed.\n   *\n   * @readonly\n   * @member {ConferenceSwitcherMode} ConferenceSwitcher#mode\n   */\n  get mode() {\n    return this._mode\n  }\n\n  /**\n   * The current speaker. This is the user who's video stream is currently available\n   * via the output of the switcher.\n   *\n   * This will usually be the same as the primary speaker. The exception is for the\n   * primary speaker itself, for whom the speaker will be set to the secondary speaker.\n   *\n   * @readonly\n   * @member {ConferenceSwitcherMode} ConferenceSwitcher#mode\n   */\n  get speaker() {\n    return this._speaker\n  }\n\n  /**\n   * The primary speaker of the conference, all other members of the conference will\n   * see this stream sent by this member.\n   *\n   * @readonly\n   * @member {ConferenceSwitcherMode} ConferenceSwitcher#mode\n   */\n  get primarySpeaker() {\n    return this._primarySpeaker\n  }\n\n  /**\n   * The secondary speaker of the conference, the primary speaker will receive the\n   * stream sent from this member.\n   *\n   * @readonly\n   * @member {ConferenceSwitcherMode} ConferenceSwitcher#mode\n   */\n  get secondarySpeaker() {\n    return this._secondarySpeaker\n  }\n\n  /**\n   * Requests a new primary speaker of the conference.\n   *\n   * This behaves similarly to {@link ConferenceSwitcher#requestMode}.\n   *\n   * @param {UserId} userId - The id of the primary speaker to request.\n   * @returns {Promise} A promise that is resolved if the request is successful, or\n   *                      rejected if it fails.\n   */\n  requestPrimarySpeaker(userId) {\n    argCheck.string('ConferenceSwitcher.requestPrimarySpeaker', userId, userId)\n    return this._raft.set(STATE_KEY_PRIMARY_SPEAKER, userId)\n  }\n\n  /**\n   * The currently selected primary speaker. This is not always the same as the\n   * primary speaker, since e.g. in automatic switching mode, the primary speaker\n   * will be chosen based on audio level instead of this property.\n   *\n   * @readonly\n   * @member {ConferenceSwitcherMode} ConferenceSwitcher#mode\n   */\n  get selectedPrimarySpeaker() {\n    return this._selectedPrimarySpeaker\n  }\n\n  /**\n   * Requests a new secondary speaker of the conference.\n   *\n   * This behaves similarly to {@link ConferenceSwitcher#requestMode}.\n   *\n   * @param {UserId} userId - The id of the secondary speaker to request.\n   * @returns {Promise} A promise that is resolved if the request is successful, or\n   *                      rejected if it fails.\n   */\n  requestSecondarySpeaker(userId) {\n    argCheck.string('ConferenceSwitcher.requestSecondarySpeaker', userId, userId)\n    return this._raft.set(STATE_KEY_SECONDARY_SPEAKER, userId)\n  }\n\n  /**\n   * The currently selected secondary speaker. This is not always the same as the\n   * secondary speaker, since e.g. in automatic and follow modes, the secondary speaker\n   * will be chosen based on who the previous primary speaker was.\n   *\n   * @readonly\n   * @member {ConferenceSwitcherMode} ConferenceSwitcher#mode\n   */\n  get selectedSecondarySpeaker() {\n    return this._selectedSecondarySpeaker\n  }\n\n  /**\n   * Sets the audio broadcaster to use for voice activated video switching.\n   *\n   * @private\n   * @param {MediaBroadcaster} broadcaster - A broadcaster instance that is used to broadcast audio.\n   */\n  setAudioBroadcaster(broadcaster) {\n    // TODO: implement\n  }\n\n  /**\n   * The media input for the switcher.\n   *\n   * @readonly\n   * @member {MediaNodeInput} ConferenceSwitcher#input\n   */\n  get input() {\n    return this._component._input\n  }\n\n  /**\n   * The media output for the switcher. The media stream will belong to whoever\n   * is set as the {@link ConferenceSwitcher#speaker}.\n   *\n   * @readonly\n   * @member {MediaNodeOutput} ConferenceSwitcher#output\n   */\n  get output() {\n    return this._component._output\n  }\n\n  _handleLeadershipChange(isLeader) {\n    this._isLeader = isLeader\n    let useVoice = ConferenceSwitcher.modeUsesVoiceDetection(this._mode)\n    if (isLeader) {\n      log.verbose(TAG, this, 'recalculating relay tree due to becoming leader')\n      this._refreshRelayTree()\n      this._setVoiceDetectionEnabled(useVoice)\n    } else {\n      this._setVoiceDetectionEnabled(false)\n    }\n    this._meshTopology.localTopologyInfo.setVoiceActivityDetectorActive(useVoice)\n  }\n\n  get _relayLinks() {\n    let relayLinksData = this._raft.get(STATE_KEY_LINKS)\n    if (relayLinksData) {\n      let n2 = (relayLinksData.length - 2) / 2\n      return {\n        ids: relayLinksData.slice(0, n2),\n        parents: relayLinksData.slice(n2, 2 * n2),\n      }\n    } else {\n      return {\n        ids: [],\n        parents: [],\n      }\n    }\n  }\n\n  _handleStateChange() {\n    var needUpdate = false\n    let mode = this._raft.get(STATE_KEY_MODE) || this._defaultMode\n    if (mode !== this._mode) {\n      this._setMode(mode)\n      if (this._isLeader) {\n        log.verbose(TAG, this, 'recalculating relay tree because of mode change')\n        needUpdate = true\n      }\n    }\n    let primarySpeaker = this._raft.get(STATE_KEY_PRIMARY_SPEAKER)\n    if (primarySpeaker !== this._selectedPrimarySpeaker) {\n      this._selectedPrimarySpeaker = primarySpeaker\n      this._emit('selectedPrimarySpeaker', primarySpeaker)\n      if (this._isLeader) {\n        log.verbose(TAG, this, 'recalculating relay tree because of primary speaker change')\n        needUpdate = true\n      }\n    }\n    let secondarySpeaker = this._raft.get(STATE_KEY_SECONDARY_SPEAKER)\n    if (secondarySpeaker !== this._selectedSecondarySpeaker) {\n      this._selectedSecondarySpeaker = secondarySpeaker\n      this._emit('selectedSecondarySpeaker', secondarySpeaker)\n      if (this._isLeader) {\n        log.verbose(TAG, this, 'recalculating relay tree because of secondary speaker change')\n        needUpdate = true\n      }\n    }\n\n    if (needUpdate) {\n      this._refreshRelayTree()\n    }\n\n    let relayLinkData = this._raft.get(STATE_KEY_LINKS)\n    let relayLinks = RelayLinks.parse(relayLinkData)\n    if (relayLinks) {\n      let parentId = relayLinks.getParentOf(this._ownId)\n      let childrenIds = relayLinks.getChildrenOf(this._ownId)\n      let [primaryId, secondaryId] = relayLinks.getSpeakers()\n      primarySpeaker = primaryId\n\n      if (primaryId !== this._primarySpeaker) {\n        this._primarySpeaker = primaryId\n        this._emit('primarySpeaker', primaryId)\n      }\n      if (secondaryId !== this._secondarySpeaker) {\n        this._secondarySpeaker = secondaryId\n        this._emit('secondarySpeaker', secondaryId)\n      }\n\n      let speaker = this._primarySpeaker\n      if (this._primarySpeaker === this._ownId) {\n        speaker = this._secondarySpeaker\n      }\n      if (speaker !== this._speaker) {\n        this._speaker = speaker\n        this._emit('speaker', speaker)\n      }\n      this._component.setRelayState(parentId, childrenIds, primaryId)\n    } else {\n      this._component.setRelayState(null, new Set(), null)\n    }\n    this._emit('_relayLinks')\n  }\n\n  _setMembers(memberIds) {\n    let memberIdsCopy = new Set(memberIds)\n    // Filter out ids from priority list that are no longer present, while maintaining pririty order.\n    this._memberIds = this._memberIds.filter(userId => memberIdsCopy.delete(userId))\n    // We also delete the ids that are present from the copy, so that we end up with a set of IDs\n    // that are missing and need to be added to the priority list.\n    this._memberIds.push(...memberIdsCopy)\n    if (this._isLeader) {\n      log.verbose(TAG, this, 'recalculating relay tree because of members change')\n      this._refreshRelayTree()\n    }\n  }\n\n  _onTopologyChange(topology) {\n    if (this._isLeader) {\n      log.verbose(TAG, this, 'recalculating relay tree because of topology change')\n      this._refreshRelayTree()\n    }\n  }\n\n  _refreshRelayTree() {\n    if (this._mode === MODE_OFF) {\n      return\n    }\n\n    let {primaryMode, secondaryMode} = switcherModeBreakdown[this._mode]\n\n    let primaryId\n    if (primaryMode === 'manual') {\n      primaryId = this._selectedPrimarySpeaker\n    } else if (primaryMode === 'automatic') {\n      primaryId = this._loudestPeer\n    }\n\n    if (!primaryId) {\n      log.debug(TAG, this, 'skipped relay tree rebuild, no active speaker')\n      return\n    }\n\n    {\n      let index = this._memberIds.indexOf(primaryId)\n      if (index >= 0) {\n        this._memberIds.splice(index, 1)\n        this._memberIds.unshift(primaryId)\n      } else {\n        log.debug(TAG, this, 'active speaker is not a member of the conference, skipping relay tree build')\n        return\n      }\n    }\n\n    let {topologyInfos} = this._meshTopology\n    if (!topologyInfos.get(primaryId)) {\n      log.warning(TAG, this, \"doesn't have topology info for active speaker, can't build relay tree yet\")\n      return\n    }\n\n    let targetIds = new Set(this._memberIds)\n\n    let powers = {}\n    targetIds.forEach(targetId => {\n      var power = 1\n      let targetInfo = topologyInfos.get(targetId)\n      if (targetInfo) {\n        power = targetInfo.power\n      }\n      powers[targetId] = power\n    })\n\n    let secondaryId = primaryId\n\n    if (secondaryMode === 'manual') {\n      if (targetIds.has(this._selectedSecondarySpeaker)) {\n        secondaryId = this._selectedSecondarySpeaker\n      }\n    } else if (secondaryMode === 'follow') {\n      secondaryId = this._memberIds[1] || primaryId\n    } else if (secondaryMode === 'automatic') {\n      secondaryId = this._loudestPeer || this._memberIds[1] || primaryId\n    }\n\n    let relayLinks = RelayLinks.createEmpty(targetIds)\n    let sourceId = primaryId\n    let sourceQueue = []\n\n    targetIds.delete(primaryId)\n\n    if (secondaryId) {\n      relayLinks.insert(secondaryId, primaryId)\n      if (secondaryId !== primaryId) {\n        powers[secondaryId] -= 1\n      }\n    }\n\n    while (targetIds.size) {\n      let sourcePower = powers[sourceId] || 1\n      for (; sourcePower > 0 && targetIds.size; sourcePower -= 1) {\n        // sourceInfo should always be set, because we verify it for active speaker and only push\n        // sources with info to the queue\n        let sourceInfo = topologyInfos.get(sourceId)\n        // go through all targets and figure out the 'best' ones\n        let ordered = [...targetIds].map(targetId => {\n          let linkInfo = sourceInfo.links[targetId]\n          let rttMs = linkInfo ? linkInfo.rttMs : Infinity\n          if (rttMs < 0) {\n            rttMs = Infinity\n          }\n          let power = powers[targetId]\n          return [power, rttMs, targetId]\n        }).sort(([p1, r1], [p2, r2]) => {\n          if (p1 !== p2) {\n            return p2 - p1 // high target power is better\n          } else {\n            return r1 - r2 // lower rtt is better\n          }\n        })\n\n        let bestTargetId = ordered[0][2]\n        targetIds.delete(bestTargetId)\n        relayLinks.insert(sourceId, bestTargetId)\n\n        if (topologyInfos.get(bestTargetId)) {\n          sourceQueue.push(bestTargetId)\n        }\n      }\n\n      sourceId = sourceQueue.shift()\n      if (!sourceId && targetIds.size) {\n        // TODO: To make this less frequent, the algorithm should probably prefer targets that we have\n        // topology information for, and also targets with more links. It needs to be weighted properly\n        // though, which makes it a bit non-trivial to implement.\n        log.warning(TAG, this, 'ran out of source nodes for relay tree, tree is incomplete')\n        break\n      }\n    }\n\n    relayLinks.setSpeakers(primaryId, secondaryId)\n\n    let currentLinks = RelayLinks.parse(this._raft.get(STATE_KEY_LINKS))\n    if (!relayLinks.equals(currentLinks)) {\n      log.info(TAG, this, `computed new relay links: ${relayLinks}`)\n\n      log.verbose(TAG, this, 'built new relay tree based on the following topology:')\n      topologyInfos.forEach((topologyInfo, userId) => {\n        log.verbose(TAG, `    peer: ${userId}`)\n        log.verbose(TAG, `        power: ${topologyInfo.power}`)\n        log.verbose(TAG, '        links:')\n        forEach(topologyInfo.links, (link, peerId) => {\n          log.verbose(TAG, `            ${peerId} => ${link}`)\n        })\n      })\n      // toJSON, otherwise local representation will be incorrect\n      this._raft.set(STATE_KEY_LINKS, relayLinks.toJSON())\n    }\n  }\n\n  _invalidate() {\n    this._meshTopology.removeChangeListener(this._onTopologyChange)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/switcher.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {isFirefox, isChrome} from 'common/utils'\n\nimport {audioContextUtil} from 'webrtc/utils'\n\nconst TAG = 'voice-detector'\n\nconst MODE_STATS = 'stats'\nconst MODE_MAX = 'max'\nconst MODE_FFT = 'fft'\nconst MODE_RMS = 'rms'\nconst MODES = [MODE_STATS, MODE_MAX, MODE_FFT, MODE_RMS]\n\nconst TICK_INTERVAL_MS = 500\n\nconst VOLUME_FILTER_ALPHA = 0.05\nconst VOLUME_FILTER_INTERVAL_MS = 100\n\nconst RMS_ALPHA = 0.2\n\nexport class RmsVolumeAlgorithm {\n  constructor() {\n    this._filtered = 0\n  }\n\n  process(buffer) {\n    var count = buffer.length\n    var sumOfSquares = 0\n    for (let i = 0; i < count; i += 1) {\n      let val = buffer[i]\n      sumOfSquares += val * val\n    }\n    let meanOfSquares = sumOfSquares / count\n    let value = Math.sqrt(meanOfSquares)\n    this._filtered = this._filtered * (1 - RMS_ALPHA) + value * RMS_ALPHA\n    return this._filtered\n  }\n}\n\nexport class MaxVolumeAlgorithm {\n  constructor() {\n    this._max = 0\n    this._volume = 0\n    this._updateTime = 0\n\n    this._updateFrequencyMs = 100\n  }\n\n  process(buffer) {\n    var count = buffer.length\n    let localMax = 0\n    for (let i = 0; i < count; i += 1) {\n      let val = buffer[i]\n      if (val < -localMax) {\n        localMax = -val\n      } else if (val > localMax) {\n        localMax = val\n      }\n    }\n\n    if (localMax > this._max) {\n      this._max = localMax\n    }\n\n    let now = Date.now()\n    if (now - this._updateTime > this._updateFrequencyMs) {\n      this._updateTime = now\n\n      this._volume = this._max\n      this._max /= 4 // Decay\n    }\n\n    return this._volume\n  }\n}\n\nexport class AudioProcessorMeter {\n  constructor(algorithm) {\n    this._processAudioData = this._processAudioData.bind(this)\n\n    if (algorithm === MODE_RMS) {\n      this._algorithm = new RmsVolumeAlgorithm()\n    } else if (algorithm === MODE_MAX) {\n      this._algorithm = new MaxVolumeAlgorithm()\n    } else {\n      throw new TypeError(`Unknown volume algorithm: '${algorithm}'`)\n    }\n    this._stream = null\n    this._volume = 0\n  }\n\n  toString() {\n    return `audioProcessorMeter{mode=${this._mode},volume=${this.volume}}`\n  }\n\n  get volume() {\n    if (this._volume > 1) {\n      return 1\n    }\n    return this._volume\n  }\n\n  tick(peerConnection, track, stream) {\n    if (stream === this._stream) {\n      return\n    }\n\n    if (this._stream) {\n      if (this._audioSource) {\n        this._audioSource.disconnect()\n        this._audioSource = null\n      }\n      this._stream = null\n\n      if (!stream) {\n        if (this._processorNode) {\n          this._processorNode.disconnect()\n          this._processorNode = null\n        }\n        if (this._audioContext) {\n          audioContextUtil.release()\n          this._audioContext = null\n          this._destination = null\n        }\n      }\n    }\n    this._stream = stream\n    if (stream) {\n      if (!this._audioContext) {\n        this._audioContext = audioContextUtil.get()\n        this._destination = this._audioContext.createMediaStreamDestination()\n      }\n      if (!this._processorNode) {\n        this._processorNode = this._audioContext.createScriptProcessor(2048, 1, 1)\n        this._processorNode.connect(this._destination)\n        this._processorNode.onaudioprocess = this._processAudioData\n      }\n\n      this._audioSource = this._audioContext.createMediaStreamSource(stream)\n      this._audioSource.connect(this._processorNode)\n    }\n  }\n\n  _processAudioData(event) {\n    if (!this._stream) {\n      this._volume = 0\n      return\n    }\n    let buffer = event.inputBuffer.getChannelData(0)\n    this._volume = this._algorithm.process(buffer)\n  }\n}\n\nexport class RtcStatsMeter {\n  constructor() {\n    this._processStatsResult = this._processStatsResult.bind(this)\n    this._volume = 0\n  }\n\n  toString() {\n    return `rtcStatsMeter{volume=${this.volume}}`\n  }\n\n  get volume() {\n    return this._volume\n  }\n\n  tick(peerConnection, track, stream) {\n    if (!peerConnection) {\n      return\n    }\n    if (isChrome) {\n      peerConnection._pc.getStats(this._processStatsResult, track)\n    } else {\n      peerConnection._pc.getStats(track, this._processStatsResult, error => {\n        log.error(TAG, this, `failed to get stats, ${error}`)\n      })\n    }\n  }\n\n  _processStatsResult(result) {\n    let maxVolume = 0\n    // We use the legacy Chrome API if available, since we then avoid the conversion to a Map.\n    if (typeof(result.result) === 'function') {\n      result.result().filter(stat => stat.type === 'ssrc').forEach(stat => {\n        let volume = +stat.stat('audioInputLevel')\n        if (volume > maxVolume) {\n          maxVolume = volume\n        }\n      })\n    } else {\n      for (let key in result) {\n        if (result.hasOwnProperty(key)) {\n          let stat = result[key]\n          if (stat.type === 'ssrc') {\n            let volume = +stat.audioInputLevel\n            if (volume > maxVolume) {\n              maxVolume = volume\n            }\n          }\n        }\n      }\n    }\n    // WebRTC.org uses the absolute value of 16-bit signed intergers when calculating\n    // audio levels, so divide by 0x8000\n    let normalizedVolume = maxVolume / 0x8000\n    this._volume = normalizedVolume\n  }\n}\n\nclass VolumeFilter {\n  constructor({alpha, intervalMs, volumeSource}) {\n    this._tick = this._tick.bind(this)\n\n    this._alpha = alpha\n    this._intervalMs = intervalMs\n    this._volumeSource = volumeSource\n\n    this._volume = 0\n    this._intervalId = null\n  }\n\n  get volume() {\n    return this._volume\n  }\n\n  start() {\n    this.stop()\n    this._intervalId = setInterval(this._tick, this._intervalMs)\n  }\n\n  stop() {\n    this._volume = 0\n    if (this._intervalId) {\n      clearInterval(this._intervalId)\n      this._intervalId = null\n    }\n  }\n\n  _tick() {\n    let measuredVolume = this._volumeSource.volume\n    if (measuredVolume > 1) {\n      measuredVolume = 1\n    }\n    let oldComponent = (1 - this._alpha) * this._volume\n    let newComponent = this._alpha * measuredVolume\n    this._volume = oldComponent + newComponent\n  }\n}\n\nexport default class VoiceActivityDetector {\n  constructor({mode = null, active = false} = {}) {\n    this._tick = this._tick.bind(this)\n\n    argCheck.optValues(this, 'options.mode', mode, MODES)\n    if (!mode) {\n      if (isFirefox) {\n        mode = MODE_MAX\n      } else {\n        mode = MODE_STATS\n      }\n    }\n\n    if (mode === MODE_STATS) {\n      this._meter = new RtcStatsMeter()\n    } else if (mode === MODE_RMS || mode === MODE_MAX) {\n      this._meter = new AudioProcessorMeter(mode)\n    } else {\n      log.error(TAG, `VoiceActivityDetector mode '${mode}' is not implemented`)\n    }\n\n    this._volumeFilter = new VolumeFilter({\n      alpha: VOLUME_FILTER_ALPHA,\n      intervalMs: VOLUME_FILTER_INTERVAL_MS,\n      volumeSource: this._meter,\n    })\n\n    this._active = active\n\n    this._peerConnection = null\n    this._intervalId = null\n  }\n\n  toString() {\n    return `voiceActivityDetector{meter=${this._meter}}`\n  }\n\n  get volume() {\n    return this._volumeFilter.volume\n  }\n\n  setActive(active) {\n    this._active = active\n    this._maybeStartOrStop()\n  }\n\n  setPeerConnection(peerConnection) {\n    this._peerConnection = peerConnection || null\n    this._maybeStartOrStop()\n  }\n\n  _maybeStartOrStop() {\n    if (this._peerConnection && this._active) {\n      if (!this._intervalId) {\n        this._intervalId = setInterval(this._tick, TICK_INTERVAL_MS)\n        this._tick()\n      }\n      this._volumeFilter.start()\n    } else if (!this._peerConnection && !this._active) {\n      this._volumeFilter.stop()\n      if (this._intervalId) {\n        clearInterval(this._intervalId)\n        this._intervalId = null\n        this._meter.tick(null, null, null)\n      }\n    }\n  }\n\n  _findTrack() {\n    var streams\n    try {\n      streams = this._peerConnection.getLocalStreams()\n    } catch (error) {\n      streams = []\n      log.debug(TAG, `Failed to get local streams, ${error}`)\n    }\n    var track = null\n    var stream = null\n    for (let i = streams.length - 1; i >= 0; i -= 1) {\n      let tracks = streams[i].getAudioTracks()\n      track = tracks[tracks.length - 1]\n      if (track) {\n        stream = streams[i]\n        break\n      }\n    }\n    return [track, stream]\n  }\n\n  _tick() {\n    let [track, stream] = this._findTrack()\n    this._meter.tick(this._peerConnection, track, stream)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/conference/voiceActivityDetector.js","'use strict'\n\n// This module provide an activity tracker that helps\n// with identifying temporary or permanent connection\n// failures.\n\nconst ACTIVITY_TIMEOUT_MS = 1500\n// Higher than ice disconnect timeout, which lets us detect if\n// it's just the channel haning or the call disconnecing\nconst DISCONNECT_TIMEOUT_MS = 12000\n\n/**\n * A class which helps keeping track of the state of\n * a connection. The different states are active, inactive,\n * and disconnected. If the state can transition back and\n * forth between active and inactive, but if it reaches the\n * disconnected state it will stay there until a reset.\n *\n * @class ActivityTracker\n * @private\n */\nexport default class ActivityTracker {\n  constructor(options = {}) {\n    let {\n      inactivityTimeoutMs = ACTIVITY_TIMEOUT_MS,\n      disconnectTimeoutMs = DISCONNECT_TIMEOUT_MS,\n    } = options\n\n    if (disconnectTimeoutMs <= inactivityTimeoutMs) {\n      throw new Error('inactivity timeout must be less than disconnect timeout')\n    }\n\n    this._onActivityTimeout = this._onActivityTimeout.bind(this)\n    this._onDisconnectTimeout = this._onDisconnectTimeout.bind(this)\n\n    this._inactivityTimeoutMs = inactivityTimeoutMs\n    this._disconnectTimeoutMs = disconnectTimeoutMs - inactivityTimeoutMs\n\n    this._activityTimeoutId = null\n    this._disconnectTimeoutId = null\n\n    this._running = false\n    this._active = false\n    this._disconnected = false\n  }\n\n  /**\n   * Whether the connection is active or not. Also false\n   * before the tracker has been started.\n   *\n   * @member {boolean}\n   */\n  get active() {\n    return this._active\n  }\n\n  /**\n   * Whether the connection is disconnected.\n   *\n   * @member {boolean}\n   */\n  get disconnected() {\n    return this._disconnected\n  }\n\n  /**\n   * Whether the activity tracker is running.\n   *\n   * @member {boolean}\n   */\n  get running() {\n    return this._running\n  }\n\n  /**\n   * Starts tracking activity.\n   *\n   * @param {Object} options - Options object.\n   * @param {Function} options.onActiveStateChange - Called when\n   *   the active property of the tracker is changed.\n   * @param {Function} options.onDisconnect - Called on disconnect.\n   */\n  start({onActiveStateChange = null, onDisconnect = null}) {\n    if (this._running) {\n      throw new Error('already started')\n    }\n    this._running = true\n    this._disconnected = false\n    this._activeStateChangeCallback = onActiveStateChange\n    this._disconnectCallback = onDisconnect\n\n    this._activityTimeoutId = setTimeout(this._onActivityTimeout, this._inactivityTimeoutMs)\n\n    this._active = true\n    this._activeStateChangeCallback && this._activeStateChangeCallback(this._active)\n  }\n\n  /**\n   * Stop activity tracking and reset to initial state.\n   */\n  stop() {\n    if (!this._running) {\n      throw new Error('tried to stop without starting')\n    }\n    let wasActive = this._active\n    this._active = false\n    this._running = false\n    this._disconnected = false\n\n    if (this._activityTimeoutId) {\n      clearTimeout(this._activityTimeoutId)\n      this._activityTimeoutId = null\n    }\n    if (this._disconnectTimeoutId) {\n      clearTimeout(this._disconnectTimeoutId)\n      this._disconnectTimeoutId = null\n    }\n\n    if (wasActive) {\n      this._activeStateChangeCallback && this._activeStateChangeCallback(this._active)\n    }\n  }\n\n  /**\n   * Mark the connection as active. This will reset\n   * the activity timeout and bring the connection\n   * back to active if it was inactive.\n   *\n   * This will not bring the connection back from disconnected.\n   */\n  registerActivity() {\n    if (this._disconnected || !this._running) {\n      return\n    }\n    if (!this._active) {\n      this._active = true\n      this._activeStateChangeCallback && this._activeStateChangeCallback(this._active)\n    }\n\n    if (this._activityTimeoutId) {\n      clearTimeout(this._activityTimeoutId)\n      this._activityTimeoutId = setTimeout(this._onActivityTimeout, this._inactivityTimeoutMs)\n    }\n    if (this._disconnectTimeoutId) {\n      clearTimeout(this._disconnectTimeoutId)\n      this._disconnectTimeoutId = null\n    }\n  }\n\n  _onActivityTimeout() {\n    this._activityTimeoutId = null\n\n    if (this._disconnectTimeoutId) {\n      clearTimeout(this._disconnectTimeoutId)\n    }\n    this._disconnectTimeoutId = setTimeout(this._onDisconnectTimeout, this._disconnectTimeoutMs)\n    this._active = false\n    this._activeStateChangeCallback && this._activeStateChangeCallback(this._active)\n  }\n\n  _onDisconnectTimeout() {\n    this._disconnectTimeoutId = null\n\n    this._disconnected = true\n    this._disconnectCallback && this._disconnectCallback()\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/activityTracker.js","'use strict'\n\n// This module contains utilities for measuring and estimating\n// the available bandwidth.\n\n// Starting off with 200kBkps for 2s gives us an initial burst\n// of 400kB,\nconst DEFAULT_INITIAL_TARGET_KBPS = 400\nconst DEFAULT_INITIAL_SEND_WINDOW_SIZE_MS = 1000\n\n// How long we should wait before trying to send again if\n// we have been limited by bandwidth. This is divided by the\n// target bandwidth in kbps to yield the time in ms.\n// bytes / kB/s = kB / kB/ms = kB * ms / kB = ms\nconst DEFAULT_RETRY_SIZE_BYTES = 4096\n\n/**\n * Estimates the available bandwidth and how many bytes\n * can be sent without causing excessive congestion.\n */\nexport class BandwidthEstimator {\n  constructor(options = {}) {\n    let {\n      timeSource = Date,\n      initialTargetKbps = DEFAULT_INITIAL_TARGET_KBPS,\n      initialSendWindowSizeMs = DEFAULT_INITIAL_SEND_WINDOW_SIZE_MS,\n    } = options\n\n    this._timeSource = timeSource\n    this._initialTargetKbps = initialTargetKbps\n    this._initialSendWindowSizeMs = initialSendWindowSizeMs\n\n    // kB/s == B/ms, which is conventient since we're measuing time in ms.\n    this._targetKbps = 0\n    this._sendWindowSizeMs = 0\n    // The send marker keeps track of how much time we have\n    // used up by sending data. Sent bytes are converted to\n    // time according to the current target bandwith.\n    // When sending data, the marker is pushed into the future\n    // according to the target bandwidth and current position.\n    // The marker should not extend further into the future than\n    // the send window size, which is how the available send bytes\n    // are calculated.\n    // If the marker is in the past when sending data, it will\n    // first be set to the current time, and then pushed forward.\n    //\n    //               send marker\n    //      current time |   send window size\n    //          v        v          v\n    // time ---->--------*----------<------\n    //          |-------| |---------|\n    //              ^            ^\n    //     send window consumed  |\n    //                   send window available\n    //\n    this._sendMarkerMs = 0\n\n    this.reset()\n  }\n\n  // resets all moving values back to initial values\n  reset() {\n    this._targetKbps = this._initialTargetKbps\n    this._sendWindowSizeMs = this._initialSendWindowSizeMs\n    this._sendMarkerMs = this._timeSource.now()\n  }\n\n  // Returns the distance from the send marker to the\n  // end of the send window.\n  get bytesAvailable() {\n    // This check is eneded, otherwise we'd end up with (Infinity | 0), which, in JS, is 0\n    if (this._targetKbps === Infinity) {\n      return Infinity\n    }\n    let currentTimeMs = this._timeSource.now()\n    if (this._sendMarkerMs < currentTimeMs) {\n      this._sendMarkerMs = currentTimeMs\n    }\n    let availableMs = currentTimeMs + this._sendWindowSizeMs - this._sendMarkerMs\n    if (availableMs < 0) {\n      return 0\n    }\n\n    return (availableMs * this._targetKbps) | 0\n  }\n\n  calculateRetryTimeoutMs(retrySizeBytes = DEFAULT_RETRY_SIZE_BYTES) {\n    let retryTimeoutMs = retrySizeBytes / this._targetKbps\n    // This is unlikely, but would be a waste if we didn't consider\n    if (this._sendWindowSizeMs / 2 < retryTimeoutMs) {\n      return (this._sendWindowSizeMs / 2) | 0\n    } else {\n      return retryTimeoutMs | 0\n    }\n  }\n\n  // Pushes the send marker into the future based on bytes\n  // sent and target bandwith.\n  consumeSendBytes(bytes) {\n    let currentTimeMs = this._timeSource.now()\n    if (this._sendMarkerMs < currentTimeMs) {\n      this._sendMarkerMs = currentTimeMs\n    }\n\n    let timeEquivalentMs = bytes / this._targetKbps\n\n    this._sendMarkerMs += timeEquivalentMs\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/bandwidthEstimation.js","'use strict'\n\n// This modules contains different implementation\n// of push/pull send buffers. Messages are added\n// directly to the buffer, but a separate implmentation\n// is needed to move the data data channels.\n\nimport {ID_BASE, M_SEP, MT_TRANSFER_BINARY_DATA} from 'datamux/constants'\nimport {TransferItem} from 'datamux/transfer'\n\n/**\n * @class SendBuffer\n * @private\n */\nexport class SendBuffer {\n  constructor() {\n    this._listener = null\n  }\n\n  /**\n   * @returns {boolean} Whether the buffer is empty.\n   */\n  get empty() {\n    return true\n  }\n\n  /**\n   * Called to notify the listener that there is new data available.\n   */\n  notify() {\n    if (this._listener) {\n      this._listener()\n    }\n  }\n\n  /**\n   * @param {Function} listener - Callback that will be called when data is available.\n   */\n  setNotificationListener(listener) {\n    this._listener = listener\n  }\n\n  /**\n   * @param {byteLength} byteLength - Maximum number of bytes to read.\n   * @returns {(String|BufferView)?} - A single message to send, or null\n   *   if empty or next message doesn't fit.\n   */\n  read(byteLength) {\n    return null\n  }\n}\n\nexport class TransferBuffer extends SendBuffer {\n  constructor() {\n    super()\n    this._items = []\n    this._currentItem = null\n  }\n\n  toString() {\n    return `transferBuffer{size=${this._items.length + (this._currentItem ? 1 : 0)}}`\n  }\n\n  get empty() {\n    if (this._currentItem) {\n      return false\n    }\n    return this._items.length === 0\n  }\n\n  clear() {\n    this._items.length = 0\n    this._currentItem = null\n  }\n\n  push(transferItem) {\n    this._items.push(transferItem)\n    this.notify()\n  }\n\n  read(byteLength, encoding = 'binary' /* or 'base64' */) {\n    if (!this._currentItem) {\n      if (this._items.length) {\n        this._currentItem = this._items.shift()\n      } else {\n        return null\n      }\n    }\n\n    if (this._currentItem instanceof TransferItem) {\n      let message = null\n\n      if (encoding === 'base64') {\n        message = this._currentItem.readBase64(byteLength)\n        if (message) {\n          let lengthStr = message.length.toString(ID_BASE)\n          message = MT_TRANSFER_BINARY_DATA + lengthStr + M_SEP + message\n        }\n      } else {\n        message = this._currentItem.read(byteLength)\n      }\n\n      if (this._currentItem.empty) {\n        this._currentItem = null\n      }\n\n      return message\n    } else {\n      // Plain messages can be sent as well, but won't be split.\n      // This will so far only be used for sending transfer headers.\n      let message = this._currentItem\n      if (message.length < byteLength) {\n        this._currentItem = null\n        return message\n      } else {\n        return null\n      }\n    }\n  }\n}\n\nexport class MessageBuffer extends SendBuffer {\n  constructor() {\n    super()\n    this._messages = []\n  }\n\n  toString() {\n    return `messageBuffer{size=${this._messages.length}}`\n  }\n\n  get empty() {\n    return this._messages.length === 0\n  }\n\n  clear() {\n    this._messages.length = 0\n  }\n\n  push(message) {\n    this._messages.push(message)\n    this.notify()\n  }\n\n  read(byteLength) {\n    if (!this._messages.length) {\n      return null\n    }\n\n    let first = this._messages[0]\n    if (first.length > byteLength) {\n      return\n    }\n\n    return this._messages.shift()\n  }\n}\n\nexport class PrioritizedBuffer extends SendBuffer {\n  constructor() {\n    super()\n\n    this._messageBuffer = new MessageBuffer()\n    this._transferBuffer = new TransferBuffer()\n  }\n\n  toString() {\n    return `prioBuffer{${this._messageBuffer},${this._transferBuffer}}`\n  }\n\n  get empty() {\n    return this._messageBuffer.empty && this._transferBuffer.empty\n  }\n\n  setNotificationListener(listener) {\n    this._messageBuffer.setNotificationListener(listener)\n    this._transferBuffer.setNotificationListener(listener)\n  }\n\n  clear() {\n    this._messageBuffer.clear()\n    this._transferBuffer.clear()\n  }\n\n  // Queue a high-priority message.\n  pushMessage(message) {\n    this._messageBuffer.push(message)\n  }\n\n  // Queue a low-priority transfer item.\n  pushTransfer(transfer) {\n    this._transferBuffer.push(transfer)\n  }\n\n  read(byteLength, encoding) {\n    let message = this._messageBuffer.read(byteLength, encoding)\n    if (message) {\n      return message\n    }\n    // There are messages, but we don't have send bytes available yet.\n    if (!this._messageBuffer.empty) {\n      return null\n    }\n\n    let data = this._transferBuffer.read(byteLength, encoding)\n    if (data) {\n      return data\n    }\n\n    return null\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/buffers.js","'use strict'\n\n// This module contains the implementation of the public\n// channel API, the end result of the datamux system.\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport EventEmitter from 'common/emitter'\nimport {defer} from 'common/utils'\n\nimport {ChannelClosedError} from 'webrtc/errors'\n\nconst TAG = 'datamux'\n\nconst MUX_CHANNEL_READY_STATE_OPENING = 'opening'\nconst MUX_CHANNEL_READY_STATE_OPEN = 'open'\nconst MUX_CHANNEL_READY_STATE_CLOSED = 'closed'\n\n/**\n * Types that can be sent and received over {@link DataChannel}s.\n *\n * JSON serialization is handled by `JSON.stringify`, which means that\n * circular references are not allowed, and `toJSON` methods will be used.\n *\n * As opposed to {@link JsonTypes} this includes some binary types,\n * e.g. ArrayBuffer and Blob. These binary types may also be embedded within\n * objects and arrays.\n *\n * @typedef DataChannel.DataChannelTypes {string|number|boolean|null|ArrayBuffer|Blob\n * |ArrayBufferView|Array<DataChannelTypes>|Object<DataChannelTypes>}\n */\n\n/**\n * The channel ready state.\n *\n * All channels start off in the `'opening'` state, they then\n * move to `'open'`, and finally `'closed'``. The state transitions\n * always happen in this order, although `'open'` might be skipped\n * if the channel fails to open.\n *\n * @typedef DataChannel.ReadyState {'opening'|'open'|'close'}\n */\n\n/**\n * A data channel class that functions a lot like normal WebRTC data channels,\n * but provides a number of abstractions and improvements, while taking care\n * of browser incompatability issues.\n *\n * Data channels are created with {@link RtcPeer#createChannel}. Each channel\n * is created for it's own specific peer in an attached {@link RtcComponent},\n * and they may not, and can not, interact across these boundaries.\n * i.e. channels are only visible to matching components.\n *\n * As opposed to normal WebRTC data channels, these channels are always reliable\n * and ordered. They also support much more complex and larger messages. Objects\n * and arrays that are sent will be serialized as JSON, but they may contain\n * some binary types that will be transmitted separately in an efficient way.\n *\n * @abstract\n * @class DataChannel\n * @extends EmitterMixin\n */\nexport default class DataChannel extends EventEmitter(null) {\n  /**\n   * Emitted when the channel is opened, i.e. when the\n   * {@link DataChannel#readyState} has reached 'open'.\n   *\n   * This may not always be emitted for a channel, as it might\n   * go directly to closed.\n   *\n   * @event DataChannel#open\n   * @param {DataChannel} channel - The channel that was opened.\n   */\n\n  /**\n   * Emitted when the channel is closed, i.e. when the\n   * {@link DataChannel#readyState} has reached 'closed'.\n   *\n   * This will always be emitted for every channel.\n   *\n   * After the channel is closed, all event listeners will removed.\n   *\n   * @event DataChannel#close\n   * @param {DataChannel} channel - The channel that was closed.\n   */\n\n  /**\n   * Emitted when the {@link DataChannel#readyState} is changed.\n   *\n   * @event DataChannel#readyState\n   * @param {string} readyState - The new readyState of the channel.\n   */\n\n  /**\n   * Emitted when a message is received.\n   *\n   * @event DataChannel#message\n   * @param {DataChannelTypes} message - The received message.\n   */\n\n  constructor(config) {\n    super()\n\n    this.send = this.send.bind(this)\n\n    this._localId = config.localId\n    this._isLocal = config.isLocal\n    this._label = config.label\n    this._protocol = config.protocol || ''\n    this._namespaceId = config.namespaceId || ''\n    this._pairingId = config.pairingId || null\n    this._builtin = config.builtin\n    this._onSendMessage = config.onMessage\n    this._onClose = config.onClose\n\n    this._readyState = MUX_CHANNEL_READY_STATE_OPENING\n    this._startupQueue = []\n    this._receiveQueue = null\n  }\n\n  toString() {\n    return `dataChannel{${this.readyState},${this._localId}->${this._remoteId || '?'}` +\n      `,ns=${this._namespaceId},label=${this.label},protocol=${this.protocol}}`\n  }\n\n  /**\n   * @readonly\n   * @member {string} DataChannel#label\n   */\n  get label() {\n    return this._label\n  }\n\n  /**\n   * @readonly\n   * @member {string} DataChannel#protocol\n   */\n  get protocol() {\n    return this._protocol\n  }\n\n  /**\n   * The current state of the channel.\n   *\n   * @readonly\n   * @member {DataChannel.ReadyState} DataChannel#readyState\n   */\n  get readyState() {\n    return this._readyState\n  }\n\n  /**\n   * Send a message on the channel. Will throw an error if the\n   * channel is closed.\n   *\n   * @function DataChannel#send\n   * @param {DataChannelTypes} message - The message to send.\n   * @returns {Promise} A promise that will be resolved once the message has been\n   * handed off to the WebRTC send buffer.\n   */\n  send(message) {\n    if (this._readyState === MUX_CHANNEL_READY_STATE_CLOSED) {\n      throw new Error('tried to send when channel was closed')\n    }\n    if (!this._onSendMessage) {\n      return\n    }\n    if (this._readyState === MUX_CHANNEL_READY_STATE_OPENING) {\n      let deferred = defer()\n      this._startupQueue.push([deferred, message])\n      return deferred.promise\n    } else {\n      return this._onSendMessage(message)\n    }\n  }\n\n  /**\n   * Closes the channel.\n   *\n   * Only requested (non-paired) channels may be closed.\n   *\n   * @function DataChannel#close\n   */\n  close() {\n    if (this._pairingId) {\n      throw new Error('paired channels can not be closed')\n    }\n    this._onClose(this)\n    Promise.reject().catch(() => {\n      this._close(null)\n    })\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Waits for the channel to open.\n   *\n   * If the channels goes directly to closed, the returned promise will be\n   * rejected.\n   *\n   * ##### Errors:\n   * - {@link ChannelClosedError} - The channel was closed.\n   *\n   * @function DataChannel#waitForOpen\n   * @returns {Promise} A Promise that is resolved once the channel has connected.\n   */\n  waitForOpen() {\n    return new Promise((resolve, reject) => {\n      switch (this._readyState) {\n        case MUX_CHANNEL_READY_STATE_OPEN:\n          return resolve(this)\n        case MUX_CHANNEL_READY_STATE_CLOSED:\n          return reject(new ChannelClosedError('channel was already closed'))\n        case MUX_CHANNEL_READY_STATE_OPENING:\n          this.once('readyState', readyState => {\n            if (readyState === MUX_CHANNEL_READY_STATE_OPEN) {\n              resolve(this)\n            } else {\n              reject(new ChannelClosedError('channel was closed'))\n            }\n          })\n      }\n    })\n  }\n\n  // eslint-disable-next-line jsdoc/require-description-complete-sentence\n  /**\n   * Receive messages using an ES6 generator function. Every time a\n   * message is received the generator will continue to run, with\n   * yield returning the message that was received.\n   *\n   * ##### Errors:\n   * - {@link ChannelClosedError} - The channel was closed.\n   *\n   * @example\n   * channel.receiveWithGenerator(function *() {\n   *   while (true) {\n   *     let message = yield\n   *     console.log('got message:', message)\n   *   }\n   * }).catch(error => {\n   *   console.log('channel closed:', error)\n   * })\n   *\n   * @function DataChannel#receiveWithGenerator\n   * @param {Function} generator - An ES6 generator (`function * () {}`).\n   * @returns {Promise} A promise that is resolved when the generator returns,\n   * or is rejected when the channel is closed.\n   */\n  receiveWithGenerator(generator) {\n    return this.waitForOpen().then(() => {\n      log.debug(TAG, this, 'beginning to receive with iterator')\n      return new Promise((resolve, reject) => {\n        let iterator = generator()\n\n        const onMessage = message => {\n          try {\n            next = iterator.next(message)\n            if (next.done) {\n              resolve(next.value)\n              end()\n            }\n          } catch (error) {\n            reject(error)\n            end()\n          }\n        }\n\n        const onClose = () => {\n          reject(new ChannelClosedError('receive was interrupted by channel closing'))\n          end()\n        }\n\n        const end = () => {\n          if (next && !next.done) {\n            iterator.return()\n          }\n          resolve()\n          this.off('message', onMessage)\n          this.off('close', onClose)\n        }\n\n        this.on('message', onMessage)\n        this.on('close', onClose)\n\n        let next = iterator.next() // run iterator up until first yield\n      })\n    })\n  }\n\n  /**\n   * Send messages using an ES6 generator function. Every yielded value that\n   * is not a promise (has a `.then` method) will be sent as a message to the peer.\n   *\n   * When a promise is yielded, sending will be paused until the promise is resolved.\n   * The generator will then continue, with yield returning the resolved value.\n   * If the promise is rejected, execution will continue by yield throwing the error.\n   * The resolved value of the promise will not be sent over the channel,\n   * but if that is desired it can be yielded directly afterwards.\n   *\n   * The handling of promises allows the generator to easily mix async tasks\n   * with sending messages, which can otherwise be quite tricky to implement.\n   *\n   * @example\n   * channel.sendWithGenerator(function * () {\n   *   while (true) {\n   *     // downloadNextFile() downloads a file and returns a promise\n   *     let file = yield downloadNextFile()\n   *     // send the file to a peer\n   *     yield file\n   *   }\n   * })\n   *\n   * @function DataChannel#sendWithGenerator\n   * @param {Function} generator - An ES6 generator (`function * () {}`).\n   * @returns {Promise} A promise that is resolved when the generator returns,\n   * or is rejected when the channel is closed.\n   */\n  sendWithGenerator(generator) {\n    return this.sendWithIterator(generator())\n  }\n\n  sendWithIterator(iterator) {\n    return this.waitForOpen().then(() => {\n      log.debug(TAG, this, 'beginning to send with iterator')\n      return new Promise((resolve, reject) => {\n        const onDone = error => {\n          if (error) {\n            log.info(TAG, this, `send iterator ended with error, ${error}`)\n            reject(error)\n            if (next && !next.done) {\n              iterator.return()\n            }\n          } else {\n            log.debug(TAG, this, 'send iterator ended successfully')\n          }\n\n          this.off('close', onClosed)\n        }\n\n        const onClosed = () => {\n          onDone(new ChannelClosedError('Send was interrupted by channel closing'))\n        }\n\n        let next = null\n        const doSend = () => {\n          if (!next) {\n            try {\n              next = iterator.next()\n            } catch (error) {\n              onDone(error)\n              return\n            }\n          }\n\n          if (next.done) {\n            onDone()\n            resolve(next.value)\n            return\n          }\n\n          let {value} = next\n          next = null\n\n          if (value && value.then) {\n            value.then(result => {\n              next = iterator.next(result)\n              doSend()\n            }).catch(onDone)\n          } else {\n            try {\n              if (this.closed) {\n                onClosed()\n              } else {\n                this.send(value).then(() => {\n                  next = iterator.next()\n                  doSend()\n                }).catch(onDone)\n              }\n            } catch (error) {\n              onDone(error)\n            }\n          }\n        }\n\n        this.on('close', onClosed)\n\n        Promise.reject().catch(doSend)\n      })\n    })\n  }\n\n  _setRemoteId(remoteId) {\n    argCheck.number('DataChannel._setRemoteId', 'remoteId', remoteId)\n    if (remoteId <= this._remoteId) {\n      throw new Error(`Could not set remote id to ${remoteId}, already have ${this._remoteId}`)\n    } else {\n      log.info(TAG, this, `switching remoteId from ${this._remoteId} to ${remoteId}`)\n    }\n\n    this._remoteId = remoteId\n\n    if (this._readyState === MUX_CHANNEL_READY_STATE_OPEN) {\n      return // channel was already open, just updated ID, so we're done\n    } else {\n      this._readyState = MUX_CHANNEL_READY_STATE_OPEN\n    }\n\n    if (this._startupQueue) {\n      this._startupQueue.forEach(([deferred, message]) => {\n        this._onSendMessage(message).then(deferred.resolve).catch(deferred.reject)\n      })\n      this._startupQueue = null\n    }\n\n    this._receiveQueue = new ReceiveQueue({\n      onMessage: message => this._emit('message', message),\n    })\n\n    this._emit('open', this)\n    this._emit('readyState', this._readyState)\n  }\n\n  _close() {\n    if (this._readyState === MUX_CHANNEL_READY_STATE_CLOSED) {\n      log.debug(TAG, this, 'was already closed')\n      return\n    }\n    if (this._startupQueue) {\n      this._startupQueue.forEach(([deferred]) => {\n        deferred.reject(new ChannelClosedError('Early send was interrupted by channel closing'))\n      })\n      this._startupQueue = null\n    }\n    if (this._receiveQueue) {\n      this._receiveQueue.reset()\n      this._receiveQueue = null\n    }\n    this._readyState = MUX_CHANNEL_READY_STATE_CLOSED\n    this._emit('close', this)\n    this._emit('readyState', this._readyState)\n    if (this._builtin) {\n      this._remoteId = null\n    } else {\n      this._clearListeners()\n    }\n  }\n\n  _handleRecievedMessagePromise(messagePromise) {\n    this._receiveQueue.handleMessagePromise(messagePromise)\n  }\n}\n\n/**\n * A queue that makes sure that message are handled in order.\n *\n * This is close to a generic promise queue, but since it has special\n * handling of rejected promises we keep it here.\n */\nexport class ReceiveQueue {\n  constructor({onMessage}) {\n    this._onMessage = onMessage\n\n    this._queue = []\n    this._currentPromise = null\n    this._epoch = 0 // for cancelling existing promise\n  }\n\n  reset() {\n    this._queue.length = 0\n    this._currentPromise = null\n    this._epoch += 1\n  }\n\n  handleMessagePromise(promise) {\n    this._queue.push(promise)\n    this._process()\n  }\n\n  _process() {\n    if (this._currentPromise) {\n      return\n    }\n    let promise = this._queue.shift()\n    if (!promise) {\n      return\n    }\n    let epoch = this._epoch\n    this._currentPromise = promise\n    promise.then(message => {\n      this._currentPromise = null\n      if (epoch === this._epoch) {\n        this._onMessage(message)\n        this._process()\n      }\n    }).catch(error => {\n      log.error(TAG, `failed to receive message, ${error}`)\n      this._currentPromise = null\n      if (epoch === this._epoch) {\n        this._process()\n      }\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/channel.js","'use strict'\n\n// This modules contains classes used to move data from\n// send buffers to a the concrete data channel.\n\nimport log from 'common/log'\nimport {base64ToUtf8, binaryStringToArrayBuffer} from 'common/utils'\nimport argCheck from 'common/argCheck'\n\nimport {ID_BASE, M_SEP, MT_PING, MT_PONG, MT_TRANSFER_BINARY_DATA} from 'datamux/constants'\n\nconst TAG = 'datamux'\n\nconst MTU = 1024 * 64\n\nconst INITIAL_RTT_MS = 250\nconst DEFAULT_PING_INTERVAL_MS = 500\n\nexport class Base64Reader {\n  constructor() {\n    this.reset()\n  }\n\n  toString() {\n    return `base64Reader{offset=${this._base64.length},size=${this._size}}`\n  }\n\n  get reading() {\n    return this._size !== -1\n  }\n\n  reset() {\n    this._size = -1\n    this._base64 = ''\n  }\n\n  begin(size) {\n    this._size = size\n    this._base64 = ''\n  }\n\n  write(str) {\n    this._base64 += str\n\n    if (this._base64.length < this._size) {\n      return\n    } else if (this._base64.length === this._size) {\n      let binaryString = base64ToUtf8(this._base64)\n      let buffer = binaryStringToArrayBuffer(binaryString)\n      let result = new Uint8Array(buffer)\n\n      this.reset()\n      return result\n    } else {\n      log.error(TAG, this, 'length mismatch when receiving base64 encoded message')\n      this.reset()\n    }\n  }\n}\n\n/**\n * This class manages the sending of data on a data channel. It keeps track of the\n * total amount of buffered data, and makes sure that data is sent at a suitable pace.\n */\nexport default class ChannelController {\n  constructor(options = {}) {\n    let {\n      buffer,\n      channelDriver,\n      activityTracker = null,\n      bandwidthEstimator = null,\n      mtu = MTU,\n      transferEncoding = 'binary',\n      pingIntervalMs = DEFAULT_PING_INTERVAL_MS,\n    } = options\n\n    argCheck.options(this, 'options', options)\n      .object('buffer')\n      .object('channelDriver')\n\n    this._onMessage = this._onMessage.bind(this)\n    this._onSendAttempt = this._onSendAttempt.bind(this)\n    this._sendPing = this._sendPing.bind(this)\n\n    this._buffer = buffer\n    this._channelDriver = channelDriver\n    this._activityTracker = activityTracker\n    this._bandwidthEstimator = bandwidthEstimator\n    this._mtu = mtu\n    this._transferEncoding = transferEncoding\n    this._pingIntervalMs = pingIntervalMs\n    this._base64Reader = new Base64Reader()\n\n    this._rttMs = INITIAL_RTT_MS\n    this._running = false\n    this._receivedPong = false\n    this._messageCallback = null\n    this._rttChangeCallback = null\n    this._pingTimeoutId = null\n    this._bandwidthTimeoutId = null\n  }\n\n  toString() {\n    return `channelController{${this._running ? 'started' : 'stopped'},rtt=${this._rttMs},buffer=${this._buffer}}`\n  }\n\n  get rttMs() {\n    return this._rttMs\n  }\n\n  get running() {\n    return this._running\n  }\n\n  start({channel, onMessage, onRttChange, disablePinging = false}) {\n    if (this._running) {\n      throw new Error('already started')\n    }\n    this._running = true\n    this._buffer.setNotificationListener(this._onSendAttempt)\n    this._base64Reader.reset()\n\n    this._messageCallback = onMessage\n    this._rttChangeCallback = onRttChange\n    if (this._bandwidthEstimator) {\n      this._bandwidthEstimator.reset()\n    }\n    this._channelDriver.start({\n      channel,\n      onMessage: this._onMessage,\n      onSendAttempt: this._onSendAttempt,\n    })\n\n    if (!disablePinging) {\n      this._receivedPong = false\n      this._sendPing()\n    }\n  }\n\n  stop() {\n    if (!this._running) {\n      throw new Error('already stopped')\n    }\n    this._running = false\n    this._buffer.setNotificationListener(null)\n    this._channelDriver.stop()\n    this._messageCallback = null\n    this._base64Reader.reset()\n\n    this._receivedPong = false\n    clearInterval(this._pingTimeoutId)\n    this._pingTimeoutId = null\n    if (this._bandwidthTimeoutId) {\n      clearTimeout(this._bandwidthTimeoutId)\n      this._bandwidthTimeoutId = null\n    }\n  }\n\n  /**\n   * Immediately sends a message.\n   *\n   * @param {string} message - Message to send.\n   */\n  sendImmediateMessage(message) {\n    this._sendData(message)\n  }\n\n  _onMessage(data) {\n    if (this._activityTracker) {\n      this._activityTracker.registerActivity()\n    }\n    if (typeof(data) !== 'string') {\n      this._messageCallback(data)\n      return\n    }\n\n    if (this._base64Reader.reading) {\n      let message = this._base64Reader.write(data)\n      if (message) {\n        this._messageCallback(message)\n      }\n      return\n    }\n\n    let messageType = data[0]\n\n    switch (messageType) {\n      case MT_PING:\n        this._handlePing(data.slice(1))\n        return\n      case MT_PONG:\n        this._handlePong(data.slice(1))\n        return\n      case MT_TRANSFER_BINARY_DATA: {\n        let sepIndex = data.indexOf(M_SEP)\n        let lengthStr = data.slice(1, sepIndex < 0 ? undefined : sepIndex)\n        let length = parseInt(lengthStr, ID_BASE)\n        this._base64Reader.begin(length)\n\n        let chunk = data.slice(sepIndex + M_SEP.length)\n        let message = this._base64Reader.write(chunk)\n        if (message) {\n          this._messageCallback(message)\n        }\n        return\n      }\n    }\n\n    this._messageCallback(data)\n  }\n\n  _handlePing(message) {\n    // some input validation so we don't echo back anything we receive\n    let pingTime = parseInt(message, 36)\n    if (!pingTime) {\n      log.error(TAG, `received invalid ping message: '${message}'`)\n      return\n    }\n    this._sendData(MT_PONG + pingTime.toString(36))\n  }\n\n  _handlePong(message) {\n    this._receivedPong = true\n\n    let pingSendTime = parseInt(message, 36)\n    if (!pingSendTime) {\n      log.error(TAG, `received invalid pong message: '${message}'`)\n      return\n    }\n    let rttMs = Date.now() - pingSendTime\n\n    // we are heavily biased towards minimum ping, with a = 3/4, otherwise a = 1/8\n    if (rttMs <= this._rttMs) {\n      this._rttMs = (this._rttMs / 4) + 3 * (rttMs / 4)\n    } else {\n      this._rttMs = 7 * (this._rttMs / 8) + (rttMs / 8)\n    }\n    this._rttChangeCallback && this._rttChangeCallback(this._rttMs)\n\n    // When the ping timeout expires we only send a new ping if we have\n    // received a pong. This is true if the timeout expired before a pong,\n    // so we can send a new ping straight away.\n    if (!this._pingTimeoutId) {\n      log.debug(TAG, 'received pong after ping timeout had expired')\n      this._sendPing()\n    }\n  }\n\n  _sendPing() {\n    this._sendData(MT_PING + Date.now().toString(36))\n    this._startPingTimeout()\n  }\n\n  _startPingTimeout() {\n    this._pingTimeoutId = setTimeout(() => {\n      if (this._receivedPong) {\n        this._sendPing()\n      } else {\n        this._pingTimeoutId = null\n      }\n    }, this._pingIntervalMs)\n  }\n\n  _onSendAttempt() {\n    if (this._bandwidthTimeoutId) {\n      clearTimeout(this._bandwidthTimeoutId)\n      this._bandwidthTimeoutId = null\n    }\n    let {bytesToSend} = this._channelDriver\n    let bytesAvailable = this._bandwidthEstimator ? this._bandwidthEstimator.bytesAvailable : Infinity\n    if (bytesAvailable < bytesToSend) {\n      bytesToSend = bytesAvailable\n    }\n    while (bytesToSend > 0) {\n      let messageSize = bytesToSend\n      if (messageSize > this._mtu) {\n        messageSize = this._mtu\n      }\n\n      let data = this._buffer.read(messageSize, this._transferEncoding)\n      if (data) {\n        let sentBytes = this._sendData(data)\n        bytesToSend -= sentBytes\n      } else {\n        break\n      }\n    }\n    // If the buffer isn't empty and the channel driver is able to send more\n    // data, it means that we've been limited by the bandwidth estiamtor.\n    // If that's the case, we schedule a timeout for when there should\n    // be more bandwidth available to use.\n    if (!this._buffer.empty && this._channelDriver.bytesToSend > 0) {\n      let retryTimeoutMs = this._bandwidthEstimator.calculateRetryTimeoutMs()\n      this._bandwidthTimeoutId = setTimeout(this._onSendAttempt, retryTimeoutMs)\n    }\n  }\n\n  _sendData(data) {\n    let dataSize = data.byteLength || data.length || 0\n    this._channelDriver.send(data)\n    if (this._bandwidthEstimator) {\n      this._bandwidthEstimator.consumeSendBytes(dataSize)\n    }\n    return dataSize\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/channelController.js","'use strict'\n\n// This module contains the ChannelDriver class, which\n// is used to notify when the underlying data channel\n// implementation wants to send more data.\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\n\nconst TAG = 'datamux'\n\nexport const DEFAULT_LOW_THRESHOLD = 0x10000\nexport const DEFAULT_HIGH_THRESHOLD = 0x20000\nconst DEFAULT_FALLBACK_PROCESS_INTERVAL_MS = 100\n\nexport default class ChannelDriver {\n  constructor(options = {}) {\n    let {\n      lowThreshold = DEFAULT_LOW_THRESHOLD,\n      highThreshold = DEFAULT_HIGH_THRESHOLD,\n      fallbackIntervalMs = DEFAULT_FALLBACK_PROCESS_INTERVAL_MS,\n    } = options\n\n    if (highThreshold < lowThreshold) {\n      argCheck.error(this, 'options.highThreshold', 'be lower than options.lowThreshold')\n    }\n\n    this._lowThreshold = lowThreshold\n    this._highThreshold = highThreshold\n    this._fallbackIntervalMs = fallbackIntervalMs\n\n    // To make sure we don't handle old events, see datamux.js\n    this._eventEpoch = 1\n\n    this._channel = null\n    this._messageCallback = null\n    this._sendAttemptCallback = null\n    this._processIntervalId = null\n  }\n\n  // The number of bytes available until the high-watermark\n  // is reached.\n  get bytesToSend() {\n    let bytes = this._highThreshold - this._channel.bufferedAmount\n    if (bytes < 0) {\n      return 0\n    }\n    return bytes\n  }\n\n  // Call to start sending and receiving data on a channel.\n  // Each time a message is received, the onMessage callback\n  // will be called. Each time it's worthwhile checking the state\n  // of the send buffer, the onSendAttempt callback is called.\n  start({channel, onMessage, onSendAttempt}) {\n    if (this._channel) {\n      throw new Error('Tried to start sender while already started')\n    }\n    this._channel = channel\n    this._messageCallback = onMessage\n    this._sendAttemptCallback = onSendAttempt\n\n    let _onMessage = this._onMessage.bind(this, this._eventEpoch)\n    let _onSendAttempt = this._onSendAttempt.bind(this, this._eventEpoch)\n\n    this._channel.onmessage = _onMessage\n\n    this._hasBufferedAmountLowEvent = typeof(channel.bufferedAmountLowThreshold) === 'number'\n    if (this._hasBufferedAmountLowEvent) {\n      this._channel.bufferedAmountLowThreshold = this._lowThreshold\n      this._channel.onbufferedamountlow = _onSendAttempt\n      Promise.reject().catch(_onSendAttempt)\n    } else {\n      this._processIntervalId = setInterval(_onSendAttempt, this._fallbackIntervalMs)\n    }\n  }\n\n  // Stops the processing of the current channel. As soon as\n  // this message has been called it is possible to call\n  // start with a new or the same channel.\n  stop() {\n    if (!this._channel) {\n      throw new Error('Tried to stop sender while already stopped')\n    }\n\n    this._eventEpoch += 1\n\n    if (this._hasBufferedAmountLowEvent) {\n      this._channel.onbufferedamountlow = null\n    } else {\n      clearInterval(this._processIntervalId)\n      this._processIntervalId = null\n    }\n\n    this._channel.onmessage = null\n    this._channel = null\n    this._sendAttemptCallback = null\n  }\n\n  send(data) {\n    if (!this._channel) {\n      throw new Error('channelDriver.send() called while stopped')\n    }\n    if (this._channel.readyState === 'open') {\n      try {\n        this._channel.send(data)\n        return true\n      } catch (error) {\n        log.info(TAG, this, `failed to send data on channel, ${error}`)\n      }\n    }\n    return false\n  }\n\n  _onMessage(eventEpoch, event) {\n    if (eventEpoch !== this._eventEpoch) {\n      return\n    }\n    let {data} = event\n    if (this._messageCallback) {\n      this._messageCallback(data)\n    }\n  }\n\n  _onSendAttempt(eventEpoch) {\n    if (eventEpoch !== this._eventEpoch) {\n      return\n    }\n    if (this._sendAttemptCallback) {\n      this._sendAttemptCallback()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/channelDriver.js","'use strict'\n\n// This module contains the channel registry, which\n// is used to keep track of local and remote channels\n// of different types, in different namespaces.\n\nimport log from 'common/log'\n\nconst TAG = 'datamux'\n\n/**\n * Keeps track of pairing channels within a namespace and pairs them up.\n * Non-pairing channels also have a namespaceId, but we don't bother\n * tracking them here.\n */\nexport class PairingNamespace {\n  constructor() {\n    this._byPairingId = new Map()\n    this._remoteInfos = new Map()\n  }\n\n  cleanup() {\n    this._byPairingId.clear()\n    this._byPairingId = null\n    this._remoteInfos.clear()\n    this._remoteInfos = null\n  }\n\n  clearRemoteInfos() {\n    this._remoteInfos.clear()\n    this._byPairingId.clear()\n  }\n\n  clearLocalChannels() {\n    this._byPairingId.clear()\n  }\n\n  trimByRemoteId(minimumRemoteId) {\n    this._remoteInfos.forEach((remoteInfo, key) => {\n      if (remoteInfo.remoteId < minimumRemoteId) {\n        this._remoteInfos.delete(key)\n      }\n    })\n  }\n\n  add(channel) {\n    let pairingId = channel._pairingId\n    if (!pairingId) {\n      throw new Error('Tried to add channel without pairingId to pairing namespace')\n    }\n    let remoteInfo = this._remoteInfos.get(pairingId)\n    if (remoteInfo) {\n      channel._setRemoteId(remoteInfo.remoteId)\n      this._remoteInfos.delete(pairingId)\n    }\n    this._byPairingId.set(pairingId, channel)\n  }\n\n  addPairingInfo({remoteId, label, protocol, pairingId}) {\n    let channel = this._byPairingId.get(pairingId)\n    if (channel) {\n      if (channel.label !== label) {\n        log.error(TAG, `label mismatch for pairing channel '${pairingId}', ${channel.label} != '${label}'`)\n        return\n      }\n      if (channel.protocol !== protocol) {\n        let values = `'${pairingId}', ${channel.protocol} != '${protocol}'`\n        log.error(TAG, `protocol mismatch for pairing channel ${values}`)\n        return\n      }\n      return channel\n    } else {\n      this._remoteInfos.set(pairingId, {remoteId, label, protocol})\n    }\n  }\n\n  validateConfig({label, protocol, pairingId}) {\n    if (this._byPairingId.has(pairingId)) {\n      throw new Error(`Pairing channel id ${pairingId} already exists`)\n    }\n    let remoteInfo = this._remoteInfos.get(pairingId)\n    if (remoteInfo) {\n      if (remoteInfo.label !== label) {\n        throw new Error('Pairing channel label does not match remote label, ' +\n          `${remoteInfo.label} != ${label}`)\n      }\n      if (remoteInfo.protocol !== protocol) {\n        throw new Error('Pairing channel protocol does not match remote protocol, ' +\n          `${remoteInfo.protocol} != ${protocol}`)\n      }\n    }\n  }\n}\n\n/**\n * Stores all channels and makes it possible to look them up by different IDs.\n *\n * Also responsible for linking local and remote channels.\n */\nexport default class MuxChannelRegistry {\n  constructor() {\n    this._channelIdCounter = 1\n\n    // Any non-builtin channel which has or receives a remote id below\n    // this number will be instantly closed\n    this._minimumRemoteId = 0\n    // Any channel below this ID may not be linked to a remote id\n    this._minimumLocalId = 0\n\n    // Builtin channels are created inside the library in a deterministic order\n    // that should not change between protocol versions. The are used for internal\n    // communication, and the purpose is to reduce setup time and bandwidth usage.\n    this._builtinChannels = new Map()\n\n    // Keeps track of local channels\n    this._localChannels = new Map()\n\n    // Tracks all channels, but resets on disconnect\n    this._byRemoteId = new Map()\n    this._namespaces = new Map()\n  }\n\n  toString() {\n    return `channelRegistry{local=${this._localChannels.size},remote=${this._byRemoteId.size}}`\n  }\n\n  cleanup() {\n    this.clearConnections()\n    this._builtinChannels.clear()\n    this._builtinChannels = null\n    this._localChannels.clear()\n    this._localChannels = null\n    this._byRemoteId = null\n    this._namespaces.forEach(namespace => namespace.cleanup())\n    this._namespaces.clear()\n    this._namespaces = null\n  }\n\n  clearConnections() {\n    this._builtinChannels.forEach(channel => channel._close())\n    this._localChannels.forEach(channel => channel._close())\n    this._localChannels.clear()\n    this._namespaces.forEach(namespace => namespace.clearRemoteInfos())\n    this._namespaces.clear()\n    this._byRemoteId.clear()\n  }\n\n  // Clears all paired and normal channels, but keeps builtin ones\n  // Returns a channel id to use as the minimum id by the peer.\n  clearAppConnections() {\n    this._localChannels.forEach(channel => channel._close())\n    this._localChannels.clear()\n    this._namespaces.forEach(namespace => namespace.clearLocalChannels())\n\n    this._byRemoteId.forEach(channel => {\n      if (!channel._builtin) {\n        channel._close()\n      }\n    })\n    // We clear everything and then add back the buildin ones\n    this._byRemoteId.clear()\n    this._builtinChannels.forEach(channel => {\n      if (channel._remoteId) {\n        this._byRemoteId.set(channel._remoteId, channel)\n      }\n    })\n\n    this._minimumLocalId = this._channelIdCounter\n\n    return this._channelIdCounter\n  }\n\n  clearNamespace(namespaceId) {\n    let namespace = this._namespaces.get(namespaceId)\n    if (namespace) {\n      namespace.cleanup()\n      this._namespaces.delete(namespaceId)\n    }\n    const removeChannel = channel => {\n      if (channel._namespaceId === namespaceId) {\n        this.remove(channel)\n        if (channel._remoteId) {\n          this._byRemoteId.delete(channel._remoteId)\n        }\n        this._localChannels.delete(channel._localId)\n        channel._close()\n      }\n    }\n    this._localChannels.forEach(removeChannel)\n    this._byRemoteId.forEach(removeChannel)\n  }\n\n  setMinimumRemoteId(minimumRemoteId) {\n    this._minimumRemoteId = minimumRemoteId\n\n    this._byRemoteId.forEach((channel, remoteId) => {\n      if (channel._builtin) {\n        return\n      }\n      if (channel._remoteId && channel._remoteId < minimumRemoteId) {\n        channel._close()\n        this._byRemoteId.delete(remoteId)\n      }\n    })\n\n    this._namespaces.forEach(namespace => namespace.trimByRemoteId(minimumRemoteId))\n  }\n\n  getNextId() {\n    let channelId = this._channelIdCounter\n    this._channelIdCounter += 1\n    return channelId\n  }\n\n  getByRemoteId(id) {\n    return this._byRemoteId.get(id)\n  }\n\n  forEachLocalChannel(func, thisArg) {\n    this._localChannels.forEach(func, thisArg)\n  }\n\n  connectBuiltins() {\n    this._builtinChannels.forEach(channel => {\n      this._byRemoteId.set(channel._localId, channel)\n      channel._setRemoteId(channel._localId)\n    })\n  }\n\n  addBuiltin(channel) {\n    this._builtinChannels.set(channel._localId, channel)\n  }\n\n  addLocal(channel) {\n    this._localChannels.set(channel._localId, channel)\n    if (channel._pairingId) {\n      this._getPairingNamespace(channel._namespaceId).add(channel)\n    }\n    if (channel._remoteId) { // might be set in namespace if pairing\n      this._byRemoteId.set(channel._remoteId, channel)\n    }\n  }\n\n  addRemote({channel, remoteId}) {\n    if (remoteId < this._minimumRemoteId) {\n      log.info(TAG, `won't add channel with remote id ${remoteId}, minimum is ${this._minimumRemoteId}`)\n      return\n    }\n    let oldRemoteId = channel._remoteId\n    channel._setRemoteId(remoteId)\n    if (oldRemoteId) {\n      this._byRemoteId.delete(oldRemoteId)\n    }\n    this._byRemoteId.set(channel._remoteId, channel)\n  }\n\n  remove(channel) {\n    if (channel._remoteId) {\n      if (!this._byRemoteId.delete(channel._remoteId)) {\n        log.error(TAG, `could not find channel to remove with remote id '${channel._remoteId}'`)\n      }\n    }\n    if (channel._isLocal) {\n      this._localChannels.delete(channel._localId)\n    }\n  }\n\n  link({localId, remoteId}) {\n    if (remoteId < this._minimumRemoteId) {\n      log.info(TAG, `won't link channel with remote id ${remoteId}, minimum is ${this._minimumRemoteId}`)\n      return\n    }\n    if (localId < this._minimumLocalId) {\n      log.info(TAG, `won't link channel with local id ${localId}, minimum is ${this._minimumLocalId}`)\n      return\n    }\n    let channel = this._localChannels.get(localId)\n    if (channel) {\n      channel._setRemoteId(remoteId)\n      this._byRemoteId.set(remoteId, channel)\n    } else {\n      log.warning(TAG, `link channel with local id '${localId}' not found for remote id ${remoteId}`)\n    }\n  }\n\n  validateConfig({label, protocol, namespaceId, pairingId}) {\n    if (pairingId) {\n      this._getPairingNamespace(namespaceId).validateConfig({label, protocol, pairingId})\n    }\n  }\n\n  addPairingInfo({remoteId, namespaceId, label, protocol, pairingId}) {\n    if (remoteId < this._minimumRemoteId) {\n      log.info(TAG, `won't add pairing info with remote id ${remoteId}, minimum is ${this._minimumRemoteId}`)\n      return\n    }\n    let channel = this._getPairingNamespace(namespaceId).addPairingInfo({remoteId, label, protocol, pairingId})\n    if (channel) {\n      let oldRemoteId = channel._remoteId\n      channel._setRemoteId(remoteId)\n      if (oldRemoteId) {\n        this._byRemoteId.delete(oldRemoteId)\n      }\n      this._byRemoteId.set(channel._remoteId, channel)\n    }\n  }\n\n  _getPairingNamespace(namespaceId) {\n    let namespace = this._namespaces.get(namespaceId)\n    if (!namespace) {\n      namespace = new PairingNamespace(namespaceId)\n      this._namespaces.set(namespaceId, namespace)\n    }\n    return namespace\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/datamux/registry.js","'use strict'\n\nimport log from 'common/log'\nimport {forEach, priv, createTimedBuffer} from 'common/utils'\n\nvar Call\nvar Conference\nvar StatsFormatter\n\nif (process.env.HAS_WEBRTC) {\n  /* global require:false */\n  Call = require('webrtc/call').default\n  StatsFormatter = require('webrtc/statsFormatter').default\n\n  Conference = require('conference/conference').default\n}\n\nconst TAG = 'call-registry'\n\nconst CONFERENCE_SIGNALING_VERSION = 1\n\nexport function CallStore() {\n  this._rooms = {}\n  this._passiveCalls = {}\n}\n\nCallStore.prototype = {\n  constructor: CallStore,\n  toString: function () {\n    return 'callStore{}'\n  },\n  getCallsInRoom: function (room) {\n    return this._rooms[room.id] || {}\n  },\n  getCallInRoomToPeer: function (room, peer) {\n    var callsInRoom = this._rooms[room.id]\n    return callsInRoom && callsInRoom[peer.id]\n  },\n  getPassiveCallInRoom: function (room) {\n    return this._passiveCalls[room.id]\n  },\n  putPassiveCall: function (call) {\n    this._passiveCalls[call.room.id] = call\n  },\n  putCall: function (call) {\n    var roomId = call.room.id\n    var peerId = call.peerId\n    var callsInRoom = this._rooms[roomId] = this._rooms[roomId] || {}\n    callsInRoom[peerId] = call\n  },\n  removeCall: function (call) {\n    if (call._isPassive) {\n      delete this._passiveCalls[call.room.id]\n    } else {\n      var callsInRoom = this._rooms[call.room.id]\n      delete callsInRoom[call.peerId]\n      if (Object.keys(callsInRoom).length === 0) {\n        delete this._rooms[call.room.id]\n      }\n    }\n  },\n  clear: function () {\n    this._rooms = {}\n    this._passiveCalls = {}\n  },\n}\n\nexport default function CallRegistry(dependencies) {\n  this._userRegistry = dependencies.userRegistry\n  this._delegate = dependencies.delegate\n  this._dependencies = null\n  this._callStore = new CallStore()\n  this._conferences = new Map()\n}\n\nCallRegistry.prototype = {\n  constructor: CallRegistry,\n  toString: function () {\n    return 'callRegistry{}'\n  },\n\n    // peer is falsy if it's a passive call\n  startCall: function (room, peer) {\n    var currentCall = null\n    if (peer) {\n      log.debug(TAG, `starting call to ${peer} in ${room}`)\n      currentCall = this._callStore.getCallInRoomToPeer(room, peer)\n\n      if (currentCall) {\n        if (currentCall.stopped) {\n          currentCall.start()\n        }\n        return currentCall\n      }\n      return this._createCall(room, peer, null)\n    }\n\n    log.debug(TAG, `starting passive call in ${room}`)\n    currentCall = this._callStore.getPassiveCallInRoom(room)\n    if (currentCall) {\n      throw new Error('Tried to start passive call with an ongoing passive call')\n    }\n\n    // If there are incoming calls we hijack the most recent one when starting a passive call\n    var calls = this._callStore.getCallsInRoom(room)\n    var incomingCalls = []\n    for (var index in calls) {\n      currentCall = calls[index]\n      if (currentCall._signaler._receivedOffer) {\n        incomingCalls.push(currentCall)\n      } else {\n        throw new Error('Tried to start passive call in room with active calls.')\n      }\n    }\n    incomingCalls.sort(function (a, b) {\n      return b._signaler._receivedOffer.timestamp - a._signaler._receivedOffer.timestamp\n    })\n    log.debug(TAG, `have ${incomingCalls.length} incoming calls when starting passive call`)\n    // hang up old calls and close the most recent one, then reuse the offer.\n    incomingCalls.slice(1).forEach(function (call) {\n      call.hangup()\n    })\n\n    var call = this._createCall(room, null)\n    if (incomingCalls[0]) {\n      let peerId = incomingCalls[0].peerId\n      log.info(TAG, `hijacking offer from ${peerId} to start passive call`)\n      let hijackedOffer = incomingCalls[0]._signaler._receivedOffer\n      incomingCalls[0].close()\n      call._setPeerId(peerId)\n      call.handleSignalingMessage(hijackedOffer)\n    }\n    return call\n  },\n\n  startConference(room, options) {\n    log.debug(TAG, `starting conference call in ${room}`)\n    let conference = this._conferences.get(room.id)\n    if (!conference) {\n      conference = this._createConference(room, options)\n      this._conferences.set(room.id, conference)\n    }\n    if (conference.stopped) {\n      conference.start(options)\n    }\n    return conference\n  },\n\n  getConferenceInRoom(room) {\n    return this._conferences.get(room.id) || null\n  },\n\n  closeCallsInRoom: function (room) {\n    var calls = this._callStore.getCallsInRoom(room)\n    forEach(calls, function (call) {\n      call.close()\n    })\n  },\n\n  getCallsInRoom: function (room) {\n    return this._callStore.getCallsInRoom(room)\n  },\n\n  getPassiveCallInRoom: function (room) {\n    return this._callStore.getPassiveCallInRoom(room) || null\n  },\n\n  // dependencies.ownUser\n  // dependencies.reporter\n  // dependencies.baseRequest\n  // dependencies.iceServers\n  init: function (dependencies) {\n    this._ownUser = dependencies.ownUser\n    this._reporter = dependencies.reporter\n    this._sendEvent = dependencies.baseRequest.path('rooms', '{roomId}', 'send')\n    this._iceServers = dependencies.iceServers\n    this._iceCandidateFilter = dependencies.iceCandidateFilter\n    return this\n  },\n  clear: function () {\n    this._ownUser = null\n    this._reporter = null\n    this._sendEvent = null\n    this._iceServers = null\n    this._iceCandidateFilter = null\n    this._callStore.clear()\n  },\n\n  // handle event after it's been converted by room\n  _handleEvent: function (event) {\n    if (event.sender === this._ownUser) {\n      return\n    }\n    if (event.isPastEvent) {\n      return\n    }\n    if (event.type === 'cct.call.message') {\n      this._handleCallEvent(event)\n    } else if (event.type === 'cct.conference.messages') {\n      this._handleConferenceEvent(event)\n    }\n  },\n\n  _handleCallEvent(event) {\n    if (event.room.membership !== 'member') {\n      return log.error('call-registry', `received call event, but was not a member of ${event.room}`)\n    }\n\n    let {recipient, message} = event.content\n    if (recipient && recipient !== this._ownUser._matrixId) {\n      return\n    }\n\n    if (message.offer) {\n      this._handleCallOffer(event)\n    } else {\n      let call = this._callStore.getCallInRoomToPeer(event.room, event.sender)\n      if (!call) {\n        call = this._callStore.getPassiveCallInRoom(event.room)\n      }\n      if (!call) {\n        log.warning(TAG, `${this._ownUser} got unknown call event from ${event.sender}: ${JSON.stringify(message)}`)\n        return\n      }\n      call.handleSignalingMessage(message)\n    }\n  },\n\n  _handleCallOffer: function ({room, sender, content}) {\n    log.debug(TAG, `incoming call from peer ${sender}: ${JSON.stringify(content.message)}`)\n\n    var activeCall = this._callStore.getCallInRoomToPeer(room, sender)\n    if (activeCall) {\n      activeCall.handleSignalingMessage(content.message)\n      return\n    }\n    var passiveCall = this._callStore.getPassiveCallInRoom(room)\n    if (passiveCall) {\n      let peerId = sender.id\n      if (peerId && passiveCall._setPeerId(peerId)) {\n        Object.defineProperty(passiveCall, 'peer', {\n          configurable: true,\n          enumerable: true,\n          value: sender,\n        })\n        passiveCall._emit('peer', sender)\n        passiveCall.handleSignalingMessage(content.message)\n      }\n      return\n    }\n\n    var incomingCall = this._createCall(room, sender, content.message)\n    this._delegate._onIncomingCall(incomingCall)\n    room._emit('call', incomingCall)\n    room._emit('calls', this._callStore.getCallsInRoom(room))\n  },\n\n  _handleConferenceEvent({room, sender, content}) {\n    if (content.version !== CONFERENCE_SIGNALING_VERSION) {\n      log.warning(TAG, `got conference signaling with wrong version, ${content.version}, make sure all ` +\n        'conference participants are using the same version of libcct')\n      return\n    }\n    var conference = this._conferences.get(room.id)\n    content.messages.forEach(message => {\n      if (conference) {\n        log.verbose(TAG, 'forwarding conference message:', message)\n        conference.handleSignalingMessage(sender.id, message)\n      } else if (message.type === 'search') {\n        log.verbose(TAG, 'got first conference join:', message)\n        conference = this._createConference(room)\n        this._delegate._onIncomingConference()\n        room._emit('conference', conference)\n        conference.handleSignalingMessage(sender.id, message)\n      } else {\n        log.verbose(TAG, 'dropped conference message:', message)\n      }\n    })\n  },\n\n  // peer is falsy if it's a passive call\n  _createCall: function (room, peer, offer) {\n    let peerId = peer ? peer.id : null\n    var statsFormatter = this._reporter && new StatsFormatter({\n      'userId': this._ownUser.id,\n      'roomId': room.id,\n      'peerId': peerId,\n    }, this._reporter)\n\n    var call = priv(Call, {\n      peerId: peerId,\n      offer: offer,\n      userId: this._ownUser.id,\n      onSignalingMessage: this._onCallMessage.bind(this, room, peer && peer._matrixId),\n      onClosed: this._onCallClosed.bind(this, room),\n      iceServers: this._iceServers,\n      iceCandidateFilter: this._iceCandidateFilter,\n      statsFormatter: statsFormatter,\n    })\n\n    Object.defineProperties(call, {\n      room: {\n        configurable: true,\n        enumerable: true,\n        value: room,\n      },\n      peer: {\n        configurable: true,\n        enumerable: true,\n        value: peer,\n      },\n    })\n\n    if (peerId) {\n      this._callStore.putCall(call)\n    } else {\n      this._callStore.putPassiveCall(call)\n    }\n    if (peerId && !offer) { // outgoing non-passive call\n      call.start()\n    }\n    return call\n  },\n\n  _onCallMessage: function (room, recipient, message) {\n    room.send('cct.call.message', {message, recipient}).catch(error => {\n      log.warning(TAG, `failed to send call signaling message, ${error}`)\n    })\n  },\n\n  _onCallClosed: function (room, call) {\n    this._callStore.removeCall(call)\n    room._emit('calls', this._callStore.getCallsInRoom(room))\n  },\n\n  _createConference: function (room, options = {}) {\n    let statsFormatterFactory = null\n    if (this._reporter) {\n      statsFormatterFactory = peerId => new StatsFormatter({\n        peerId,\n        roomId: room.id,\n        userId: this._ownUser.id,\n      }, this._reporter)\n    }\n\n    let {switcherMode} = options\n\n    let conference = priv(Conference, {\n      userId: this._ownUser.id,\n      statsFormatterFactory,\n      switcherMode,\n      onSignalingMessage: createTimedBuffer(50, this._onConferenceMessages.bind(this, room)),\n      onClosed: this._onConferenceClosed.bind(this, room),\n      iceServers: this._iceServers,\n      iceCandidateFilter: this._iceCandidateFilter,\n    })\n\n    Object.defineProperties(conference, {\n      room: {\n        configurable: true,\n        enumerable: true,\n        value: room,\n      },\n    })\n\n    this._conferences.set(room.id, conference)\n\n    return conference\n  },\n\n  _onConferenceMessages: function (room, messages) {\n    room.send('cct.conference.messages', {\n      messages,\n      version: CONFERENCE_SIGNALING_VERSION,\n    }).catch(error => {\n      log.warning(TAG, `failed to send conference signaling message: ${error}`)\n    })\n  },\n\n  _onConferenceClosed: function (room) {\n    this._conferences.delete(room.id)\n    room._emit('conference', null)\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/callRegistry.js","'use strict'\n\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\nimport {defer, priv} from 'common/utils'\nimport Room from 'matrix/room'\n\n// How long we'll wait for the initial m.room.create\nconst ROOM_CREATE_TIMEOUT = 20000\n// How long we'll wait after the initial m.room.create until all events are received\nconst ROOM_PREPARE_TIMEOUT = 30000\n\nconst TAG = 'room-registry'\n\n// dependencies.delegate._onRoomEvent\n// dependencies.delegate._onRoomCreated\nexport default class RoomRegistry {\n  constructor(dependencies) {\n    this._roomMap = {}\n    this._roomArray = []\n    this._deferredRooms = {}\n    this._roomDependencies = null\n    this._delegate = dependencies.delegate\n  }\n\n  toString() {\n    let serverName = this._roomDependencies ? this._roomDependencies.serverName : ''\n    return `roomRegistry{serverName=${serverName}}`\n  }\n\n  getRooms() {\n    return this._roomArray\n  }\n  getRoom(matrixId) {\n    return this._roomMap[matrixId]\n  }\n  getOrCreateEmptyRoom(matrixId) {\n    let room = this._roomMap[matrixId]\n    if (room) {\n      return room\n    }\n    return this._createRoom(matrixId)\n  }\n  waitForRoom(matrixId, lastState, invitedUserIds) {\n    let lastStateStr = JSON.stringify(lastState)\n    let invitesStr = invitedUserIds.join(',')\n    log.debug(TAG, `${this} waiting for ${matrixId} lastState=${lastStateStr} invites=${invitesStr}`)\n\n    return this._waitForRoomCreation(matrixId).then(room => {\n      log.debug(TAG, `${this} got room ${matrixId}, now waiting for state`)\n      let roomReady = Promise.all([\n        this._waitForRoomState(room, lastState.type, lastState.stateKey),\n        this._waitForRoomInvites(room, invitedUserIds),\n      ])\n      let readyTimeout = new Promise((resolve, reject) => {\n        setTimeout(() => {\n          reject(new Error(`timed out after ${ROOM_CREATE_TIMEOUT}ms while waiting for ${room} to be prepared`))\n        }, ROOM_PREPARE_TIMEOUT)\n      })\n      return Promise.race([roomReady, readyTimeout]).then(() => room)\n    })\n  }\n  _waitForRoomCreation(matrixId) {\n    let room = this._roomMap[matrixId]\n    if (room) {\n      return Promise.resolve(room)\n    }\n    let deferred = this._deferredRooms[matrixId] = this._deferredRooms[matrixId] || []\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        reject(new Error(`timed out after ${ROOM_CREATE_TIMEOUT}ms while waiting for room, ${matrixId}`))\n      }, ROOM_CREATE_TIMEOUT)\n      deferred.push(resolve)\n    })\n  }\n  _waitForRoomState(room, type, stateKey) {\n    let state = room.state(type)\n    log.debug(TAG, this + ' waiting for room state ' + type + '/' + (stateKey || '') + ' in ' + room)\n\n    if (type === 'm.room.aliases') {\n      // Aliases state key is the server name, which can get tricky, so we\n      // just check for any alias state instead.\n      if (state.keys.length) {\n        return Promise.resolve()\n      }\n\n      log.debug(TAG, this + ' room alias was not set, waiting for any update in ' + room)\n      return state.once('update')\n    }\n\n    if (state.has(stateKey)) {\n      return Promise.resolve()\n    }\n    if (stateKey) {\n      log.debug(TAG, this + ' state was not set, waiting for state key update in ' + room)\n      return state.once('update:' + stateKey)\n    } else {\n      log.debug(TAG, this + ' state was not set, waiting for default value update in ' + room)\n      return state.once('value')\n    }\n  }\n  _waitForRoomInvites(room, invitedUserIds) {\n    let deferred = defer()\n    let waitForInvite = (invitedUserIds || []).slice()\n    log.debug(TAG, `${this} waiting for invited users in ${room}: ${waitForInvite.join(',')}`)\n\n    const consumeEvent = event => {\n      if (event.type === 'm.room.member' && event.content.membership === 'invited') {\n        let index = waitForInvite.indexOf(event.stateKey)\n        if (index !== -1) {\n          waitForInvite.splice(index, 1)\n        }\n      }\n      if (!waitForInvite.length) {\n        log.debug(TAG, `${this} has now seen all invites for invited users in ${room}`)\n        room.off('event', consumeEvent)\n        deferred.resolve()\n      } else {\n        log.debug(TAG, `${this} waiting for remaining invites in ${room}: ${waitForInvite.join(',')}`)\n      }\n    }\n\n    room.on('event', consumeEvent)\n    room.events.forEach(consumeEvent)\n\n    return deferred.promise\n  }\n\n  init(roomDependencies) {\n    this._roomDependencies = roomDependencies\n    return this\n  }\n  clear() {\n    for (let i in this._roomArray) {\n      this._roomArray[i]._close()\n    }\n    this._roomArray = []\n    this._roomMap = {}\n    this._roomDependencies = null\n  }\n\n  _handleRoomSync(roomId, membership, roomData, isFirstSync) {\n    let room = this.getOrCreateEmptyRoom(roomId)\n    room._handleRoomSync(roomData, membership, isFirstSync)\n  }\n\n  _createRoom(matrixId) {\n    if (this._roomMap[matrixId]) {\n      argCheck.error('RoomRegistry._createRoom', 'matrixId', 'room already exists')\n    }\n    let room = priv(Room, {matrixId}, this._roomDependencies)\n    this._roomMap[matrixId] = room\n    this._roomArray.push(room)\n\n    let deferred = this._deferredRooms[matrixId]\n    if (deferred) {\n      for (let i in deferred) {\n        deferred[i](room)\n      }\n      delete this._deferredRooms[matrixId]\n    }\n    this._delegate._onRoomCreated(room)\n\n    return room\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/roomRegistry.js","'use strict'\n\nimport log from 'common/log'\nimport {SerializedJsonRetryClient} from 'common/request'\n\n// deps.delegate._handleAccountDataSync\n// deps.delegate._didChangeSyncStreamState\n// deps.userRegistry\n// deps.roomRegistry\nexport default function SyncStream(deps) {\n  this._request = null\n  this._state = null\n  this._syncToken = null\n\n  this._retryCount = 0\n  this._retryTimeout = this.INITIAL_RETRY_TIMEOUT\n\n  this._delegate = deps.delegate\n  this._userRegistry = deps.userRegistry\n  this._roomRegistry = deps.roomRegistry\n\n  this._poll = this._poll.bind(this)\n  this._retry = this._retry.bind(this)\n  this._onPollError = this._onPollError.bind(this)\n  this._onPollResponse = this._onPollResponse.bind(this)\n  this._onFirstSyncResponse = this._onFirstSyncResponse.bind(this)\n}\n\nSyncStream.prototype = {\n  constructor: SyncStream,\n  tag: 'sync-stream',\n\n  SYNC_POLL_TIMEOUT: 10000,\n  SYNC_POLL_TIMEOUT_GRACE_PERIOD: 5000,\n  INITIAL_RETRY_TIMEOUT: 1000,\n  MAX_RETRY_TIMEOUT: 1000 * 60,\n  RETRY_ADD: 1000,\n  RETRY_MULT: 1.2,\n  RETRY_DISCONNECT_LIMIT: 2,\n\n  toString: function () {\n    return 'syncStream{token=' + this._syncToken + ',state=' + this._state + '}'\n  },\n\n  // deps.authedRequest\n  // [deps.startToken]\n  start: function (deps) {\n    this._state = 'connecting'\n    this._delegate._didChangeSyncStreamState(this._state)\n    this._request = deps.authedRequest.path('sync')\n            .config('timeout', this.SYNC_POLL_TIMEOUT + this.SYNC_POLL_TIMEOUT_GRACE_PERIOD)\n    return this._request.query({\n      since: deps.startToken,\n      filter: JSON.stringify({room: {timeline: {limit: 0}}}),\n    }).get().then(this._onFirstSyncResponse)\n  },\n\n  stop: function () {\n    this._state = null\n    this._delegate._didChangeSyncStreamState(this._state)\n    this._baseRequest = null\n  },\n\n  get state() {\n    return this._state\n  },\n\n  _poll: function () {\n    this._request.client(new SerializedJsonRetryClient()).query({\n      since: this._syncToken,\n      timeout: this.SYNC_POLL_TIMEOUT,\n    }).get().then(this._onPollResponse).catch(this._onPollError)\n  },\n\n  _onFirstSyncResponse: function (res) {\n    this._onPollResponse(res, true)\n    this._state = 'connected'\n    this._delegate._didChangeSyncStreamState(this._state)\n  },\n\n  _onPollResponse: function (res, isFirstSync) {\n    this._retryTimeout = this.INITIAL_RETRY_TIMEOUT\n    this._retryCount = 0\n\n    var body = res.body\n    if (!this._state) {\n      return\n    } else if (this._state === 'disconnected') {\n      this._state = 'connected'\n      this._delegate._didChangeSyncStreamState(this._state)\n    }\n\n    this._syncToken = body.next_batch\n    try {\n      this._handleReponseEvents(body, isFirstSync)\n    } catch (error) {\n      log.error(this.tag, `${this}, error handling poll response, ${error}`)\n    } finally {\n      this._poll()\n    }\n  },\n\n  _onPollError: function (error) {\n    if (!this._state) {\n      return\n    }\n    log.error(this.tag, `${this}, poll failed, ${error}`)\n    log.error(this.tag, `${this}, scheduling retry in ${this._retryTimeout}ms with ${this._retryCount} made`)\n\n    if (this._retryCount === this.RETRY_DISCONNECT_LIMIT) {\n      this._state = 'disconnected'\n      this._delegate._didChangeSyncStreamState(this._state)\n    }\n    this._retryCount += 1\n    setTimeout(this._retry, this._retryTimeout)\n  },\n\n  _retry: function () {\n    if (!this._state) {\n      return\n    }\n    this._retryTimeout *= this.RETRY_MULT\n    this._retryTimeout += this.RETRY_ADD\n    this._retryTimeout = Math.round(this._retryTimeout)\n    if (this._retryTimeout > this.MAX_RETRY_TIMEOUT) {\n      this._retryTimeout = this.MAX_RETRY_TIMEOUT\n    }\n    this._poll()\n  },\n\n  _handleReponseEvents: function (body, isFirstSync) {\n    var accountDataEvents = body.account_data.events\n    var presenceEvents = body.presence.events\n\n    this._delegate._handleAccountDataSync(accountDataEvents)\n    this._userRegistry._handlePresenceSync(presenceEvents)\n\n    var rooms = body.rooms\n    for (var membership in rooms) {\n      var membershipRooms = rooms[membership]\n      for (var roomId in membershipRooms) {\n        var roomData = membershipRooms[roomId]\n        this._roomRegistry._handleRoomSync(roomId, membership, roomData, isFirstSync)\n      }\n    }\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/matrix/syncStream.js","'use strict'\nimport log from 'common/log'\nimport argCheck from 'common/argCheck'\n\nimport {doesntSupportPlugin} from 'media/common'\nimport HtmlSink from 'media/htmlSink'\nimport MediaNode from 'media/mediaNode'\nimport CanvasSource from 'media/canvasSource'\nimport StreamSplitter from 'media/streamSplitter'\n\nconst TAG = 'canvas-filter'\n\n/**\n * A sink that can be used to take snapshots of a video stream that are\n * exported as either blobs or a data URIs.\n *\n * @class VideoFrameCapture\n */\nexport default class CanvasFilter extends MediaNode.connectMixin() {\n  constructor(options) {\n    super()\n    doesntSupportPlugin(this)\n    argCheck.optOptions('CanvasFilter constructor', 'options', options)\n      .optInstance('canvas', HTMLCanvasElement)\n      .optNumber('videoFrameRate')\n      .optFunc('renderFunction')\n\n    let {\n      render,\n      canvas,\n      videoFrameRate = 24,\n    } = options || {}\n    if (videoFrameRate <= 0) {\n      argCheck.error('CanvasFilter constructor', 'options.videoFrameRate', 'a positive number')\n    }\n\n    this._videoFrameRate = videoFrameRate\n    this._renderFunction = render\n\n    this._renderInterval = null\n\n    this._video = document.createElement('video')\n\n    this._splitter = new StreamSplitter()\n    this._htmlSink = new HtmlSink({target: this._video})\n    this._canvasSource = new CanvasSource({canvas, videoFrameRate})\n    this._canvas = this._canvasSource.canvas\n\n    this._splitter.videoOutput.connect(this._htmlSink)\n\n    this._render = this._render.bind(this)\n\n    this.startRender = this.startRender.bind(this)\n    this.stopRender = this.stopRender.bind(this)\n    this._video.addEventListener('loadeddata', this.startRender)\n    this._video.addEventListener('emptied', this.stopRender)\n  }\n\n  /**\n   * The input from which the video will be captured.\n   *\n   * @member {MediaNodeInput} CanvasFilter#input\n   */\n  get input() {\n    return this._splitter\n  }\n\n  get output() {\n    return this._canvasSource\n  }\n\n  startRender() {\n    let {videoWidth, videoHeight} = this._video\n    this._canvas.width = videoWidth\n    this._canvas.height = videoHeight\n    this._fpsInterval = 1000 / this._videoFrameRate\n    this._then = Date.now()\n    this._startTime = this._then\n    this._render()\n  }\n\n  stopRender() {\n    clearInterval(this._renderInterval)\n    this._renderInterval = null\n  }\n\n  _render() {\n    let now = Date.now()\n    let elapsed = now - this._then\n    if (elapsed > this._fpsInterval) {\n      this._then = now - (elapsed % this._fpsInterval)\n\n      try {\n        this.render(this._video, this._canvas)\n      } catch (error) {\n        log.error(TAG, `error thrown in render function, ${error}`)\n      }\n    }\n\n    requestAnimationFrame(this._render)\n  }\n\n  render(video, canvas) {\n    if (this._renderFunction) {\n      this._renderFunction(video, canvas)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/canvasFilter.js","'use strict'\n\nimport argCheck from 'common/argCheck'\n\nimport {doesntSupportPlugin} from 'media/common'\nimport MediaSource from 'media/mediaSource'\n\nexport default class CanvasSource extends MediaSource {\n  constructor(options) {\n    super()\n    doesntSupportPlugin(this)\n    argCheck.options('CanvasSource constructor', 'options', options)\n      .optInstance('canvas', HTMLCanvasElement)\n      .optNumber('videoFrameRate')\n    let {canvas, videoFrameRate = 24} = options\n\n    if (canvas) {\n      this._canvas = canvas\n    } else {\n      this._canvas = document.createElement('canvas')\n      this._canvas.style.position = 'absolute'\n      this._canvas.style.right = '0'\n\n      this._canvasContainer = document.createElement('div')\n      this._canvasContainer.style.zIndex = -1e10\n      this._canvasContainer.style.position = 'fixed'\n      this._canvasContainer.style.left = '0'\n      this._canvasContainer.style.width = '0'\n      this._canvasContainer.style.height = '0'\n      this._canvasContainer.style.overflow = 'hidden'\n      this._canvasContainer.appendChild(this._canvas)\n\n      document.body.appendChild(this._canvasContainer)\n    }\n\n    this._canvas.getContext('2d') /* initialize context or the below line will fail in Firefox */\n    this.setStream(this._canvas.captureStream(videoFrameRate))\n  }\n\n  stop() {\n    if (this._canvasContainer) {\n      document.body.removeChild(this._canvasContainer)\n      this._canvasContainer = null\n    }\n    this._canvas = null\n    this.stream.stop()\n  }\n\n  get canvas() {\n    return this._canvas\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/canvasSource.js","'use strict'\nimport log from 'common/log'\nimport EmitterMixin from 'common/emitter'\nimport CanvasFilter from 'media/canvasFilter'\n\nconst TAG = 'scaled-canvas-filter'\n\n/**\n * A sink that can be used to make scaled down streams of existing\n * camera streams\n *\n * @class ScaledCanvasFilter\n */\nexport default class ScaledCanvasFilter extends EmitterMixin(CanvasFilter) {\n  constructor(options) {\n    super(options)\n    let {\n      projectionConfiguration,\n      imageFrameRate,\n    } = options\n\n    this._projectionConfiguration = projectionConfiguration\n    this._context = this._canvas.getContext('2d')\n    this._imageFrameRate = imageFrameRate\n    this._grabStillPicture = this._grabStillPicture.bind(this)\n  }\n\n  _calcProjection() {\n    let {videoWidth, videoHeight} = this._video\n\n    let {\n      width,\n      aspectRatio = 16 / 9,\n      contentMode = 'aspectFill',  /* scaltToFill, aspectFit or aspectFill */\n    } = this._projectionConfiguration\n\n    let height = width / aspectRatio\n    this._canvas.width = width\n    this._canvas.height = height\n\n    let videoAspectRatio = videoWidth / videoHeight\n\n    if (contentMode === 'aspectFill') {\n      if (videoAspectRatio < aspectRatio) {\n        let delta = width / videoAspectRatio - height\n\n        return {\n          width: width,\n          height: height + delta,\n          deltaY: -delta / 2,\n          deltaX: 0,\n        }\n      } else {\n        let delta = height * videoAspectRatio - width\n\n        return {\n          height: height,\n          width: width + delta,\n          deltaY: 0,\n          deltaX: -delta / 2,\n        }\n      }\n    }\n\n    if (contentMode === 'scaleToFill') {\n      return {\n        height: height,\n        width: width,\n        deltaY: 0,\n        deltaX: 0,\n      }\n    }\n  }\n\n  startRender() {\n    let {videoWidth, videoHeight} = this._video\n    log.info(TAG, `video resolution: ${videoWidth}x${videoHeight}`)\n    this._projection = this._calcProjection()\n\n    if (this._imageFrameRate > 0) {\n      log.info(TAG, `starting interval for still pictures: frameRate = ${1000 / this._imageFrameRate}`)\n      this._stillPictureInterval = setInterval(this._grabStillPicture, 1000 / this._imageFrameRate)\n    } else {\n      log.info(TAG, 'not starting picture grab loop')\n    }\n\n    this._fpsInterval = 1000 / this._videoFrameRate\n    this._then = Date.now()\n    this._startTime = this._then\n    this._render()\n  }\n\n  _grabStillPicture() {\n    let dataUrl = this._canvas.toDataURL('image/joeg')\n    this._emit('stillPictureCaptured', dataUrl)\n  }\n\n  render(video, canvas) {\n    let {videoWidth, videoHeight} = this._video\n\n    let ctx = this._context\n    ctx.drawImage(video, 0, 0, videoWidth, videoHeight,\n                  this._projection.deltaX, this._projection.deltaY,\n                  this._projection.width, this._projection.height)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/scaledCanvasFilter.js","'use strict'\n\nimport {assertPriv} from 'common/utils'\n\nexport default class ScreenSourceInfo {\n  constructor(priv, info) {\n    assertPriv('ScreenSourceInfo', priv)\n    this.type = info.type\n    this.label = info.label\n  }\n\n  toString() {\n    return `screenSourceInfo{type=${this.type},label=\"${this.label}\"}`\n  }\n\n  /**\n   * The screen sharing type of this source.\n   *\n   * @member {ScreenSharingType} ScreenSourceInfo#type\n   */\n\n  /**\n   * A human-readable description of the source, e.g. \"Screen 1\", or the title of a window.\n   *\n   * @member {'string'} ScreenSourceInfo#label\n   */\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/screenSourceInfo.js","'use strict'\nimport log from 'common/log'\nimport EmitterMixin from 'common/emitter'\nimport HtmlSink from 'media/htmlSink'\n\nconst TAG = 'temasys-canvas-filter'\n\n/**\n * A sink that can be used to make scaled down streams of existing\n * camera streams\n *\n * @class TemasysCanvasFilter\n */\nexport default class TemasysCanvasFilter extends EmitterMixin(null) {\n  constructor(options) {\n    super()\n    let {\n      projectionConfiguration,\n      imageFrameRate = 0.5,\n    } = options\n\n    this._video = document.createElement('video')\n    this._htmlSink = new HtmlSink({target: this._video})\n\n    this._canvas = document.createElement('canvas')\n    this._canvas.style.position = 'absolute'\n    this._canvas.style.right = '0'\n\n    this._canvasContainer = document.createElement('div')\n    this._canvasContainer.style.zIndex = -1e10\n    this._canvasContainer.style.position = 'fixed'\n    this._canvasContainer.style.left = '0'\n    this._canvasContainer.style.width = '0'\n    this._canvasContainer.style.height = '0'\n    this._canvasContainer.style.overflow = 'hidden'\n    this._canvasContainer.appendChild(this._canvas)\n\n    document.body.appendChild(this._canvasContainer)\n    this._canvasContainer.appendChild(this._video)\n\n    this._projectionConfiguration = projectionConfiguration\n    this._imageFrameRate = imageFrameRate\n    this._render = this._render.bind(this)\n    this.startRender = this.startRender.bind(this)\n    this.stopRender = this.stopRender.bind(this)\n    this.render = this.render.bind(this)\n\n    setTimeout(this.startRender, 1000) // TODO: How to start rendering properly?\n  }\n\n  startRender() {\n    let {videoWidth, videoHeight} = this._htmlSink.target\n    this._canvas.width = videoWidth\n    this._canvas.height = videoHeight\n    this._renderInterval = setInterval(this._render, 1000 / this._imageFrameRate)\n  }\n\n  stopRender() {\n    clearInterval(this._renderInterval)\n    this._renderInterval = null\n  }\n\n  _render() {\n    try {\n      this.render(this._video, this._canvas)\n    } catch (error) {\n      log.error(TAG, `error thrown in render function, ${error}`)\n    }\n  }\n\n  _calcProjection() {\n    let {videoWidth, videoHeight} = this._htmlSink.target\n\n    let {\n      width,\n      aspectRatio = 16 / 9,\n      contentMode = 'aspectFill',  /* scaltToFill, aspectFit or aspectFill */\n    } = this._projectionConfiguration\n\n    let height = width / aspectRatio\n    this._canvas.width = width\n    this._canvas.height = height\n\n    let videoAspectRatio = videoWidth / videoHeight\n\n    if (contentMode === 'aspectFill') {\n      if (videoAspectRatio < aspectRatio) {\n        let delta = width / videoAspectRatio - height\n\n        return {\n          width: width,\n          height: height + delta,\n          deltaY: -delta / 2,\n          deltaX: 0,\n        }\n      } else {\n        let delta = height * videoAspectRatio - width\n\n        return {\n          height: height,\n          width: width + delta,\n          deltaY: 0,\n          deltaX: -delta / 2,\n        }\n      }\n    }\n\n    if (contentMode === 'scaleToFill') {\n      return {\n        height: height,\n        width: width,\n        deltaY: 0,\n        deltaX: 0,\n      }\n    }\n  }\n\n  render(video, canvas) {\n    let {videoWidth, videoHeight} = this._htmlSink.target\n    if (!this._projection) {\n      this._projection = this._calcProjection()\n    }\n\n    let base64img = this._htmlSink.target.getFrame()\n    let image = new Image()\n    image.onload = () => {\n      let ctx = this._canvas.getContext('2d')\n      ctx.drawImage(image, 0, 0, videoWidth, videoHeight,\n                    this._projection.deltaX, this._projection.deltaY,\n                    this._projection.width, this._projection.height)\n\n      let dataUrl = this._canvas.toDataURL('image/jpeg')\n      this._emit('stillPictureCaptured', dataUrl)\n    }\n\n    image.setAttribute('src', 'data:image/png;base64,' + base64img)\n  }\n\n  get input() {\n    return this._htmlSink\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/temasysCanvasFilter.js","'use strict'\n\nimport argCheck from 'common/argCheck'\nimport log from 'common/log'\nimport {priv} from 'common/utils'\n\nimport {AdapterJS} from 'webrtc/utils'\nconst {WebRTCPlugin} = AdapterJS\n\nimport {getUserMedia} from 'media/common'\nimport ConcreteMediaSource from 'media/concreteMediaSource'\nimport ScreenSourceInfo from 'media/screenSourceInfo'\n\nconst TAG = 'temasys-screen-source'\n\nclass TemasysScreenSourceInfo extends ScreenSourceInfo {\n  constructor(priv, info) {\n    super(priv, {\n      type: info.kind,\n      label: info.label,\n    })\n    this._id = info.id\n  }\n\n  toString() {\n    return `temasysScreenSourceInfo{type=${this.type},id=${this._id},label=\"${this.label}\"}`\n  }\n}\n\n/**\n * Internal media node for acquiring a Temasys screen sharing stream.\n *\n * @private\n * @class TemasysScreenSource\n * @extends ConcreteMediaSource\n * @param {Object} [options] - Optional options object.\n * @param {ScreenSharingType|null} [options.type=null] - The screen sharing type to use. Specifying\n *   null will let the user choose either screen or window.\n * @param {boolean} [options.audio=false] - Whether audio should be requested as well.\n * @param {Object} [options.video] - Constraints for the video, defaults to max resolution and no\n *   framerate limit.\n */\nexport default class TemasysScreenSource extends ConcreteMediaSource {\n  static get canEnumerateSources() {\n    return true\n  }\n\n  static enumerateSources() {\n    return new Promise(resolve => {\n      WebRTCPlugin.plugin.getScreensharingSources(list => {\n        resolve(list.map(info => priv(TemasysScreenSourceInfo, info)))\n      })\n    })\n  }\n\n  constructor(options) {\n    super()\n\n    argCheck.optOptions('TemasysScreenSource constructor', 'options', options)\n      .optObject('video')\n\n    const video = options.video || {}\n    const type = options.type || 'screensharing'\n\n    if (!video.mediaSource) {\n      video.mediaSource = type\n    }\n\n    if (options.type && !WebRTCPlugin.plugin.screensharingKeys) {\n      log.warning(TAG, 'this version of the temasys plugin does not support screen sharing type selection')\n    }\n    video.optional = [{\n      sourceId: WebRTCPlugin.plugin.screensharingKey || 'Screensharing',\n    }]\n\n    if (video.source) {\n      var source = video.source\n      if (source.exact) {\n        throw new TypeError('Constaint video.source.exact is not supported')\n      } else if (source.ideal) {\n        source = source.ideal\n      }\n      argCheck.instance(this, 'source', video.source, TemasysScreenSourceInfo)\n      video.optional.push({\n        screenId: video.source._id,\n      })\n      delete video.source\n    }\n\n    getUserMedia({\n      video,\n      audio: false,\n    }).then(stream => {\n      this.setStream(stream)\n      stream.onended = () => {\n        if (stream) stream.stop()\n        this.setStream(null)\n      }\n    }, error => this.setError(error)).catch(error => {\n      log.error(TAG, `unexpected error in TemasysScreenSource: ${error}`)\n    })\n  }\n\n  // track.stop() for screen sharing streams is broken at least up until 0.8.892\n  _stopStream(stream) {\n    try {\n      stream.stop()\n    } catch (error) {\n      log.error(TAG, 'failed to stop media stream:', error)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/media/temasysScreenSource.js","'use strict'\n\nimport log from 'common/log'\nimport {assign} from 'common/utils'\n\nimport createPeerConnectionStatNormalizer from 'webrtc/statsNormalizer'\n\n// function MediaStreamTrackMonitor(pc, mst) {\n//     this.pc = pc;\n//     this.mst = mst;\n//     mst.addEventListener('started', function () {\n//         log.verbose('stats-monitor', 'mst: onstarted');\n//     });\n//     mst.addEventListener('mute', function () {\n//         log.verbose('stats-monitor', 'mst: onmute');\n//     });\n//     mst.addEventListener('unmute', function () {\n//         log.verbose('stats-monitor', 'mst: onunmute');\n//     });\n//     mst.addEventListener('overconstrained', function () {\n//         log.verbose('stats-monitor', 'mst: onoverconstrained: ' + JSON.stringify(mst.getConstraints()));\n//     });\n//     mst.addEventListener('ended', function () {\n//         log.verbose('stats-monitor', 'mst: onended');\n//     });\n// }\n//\n// function MediaStreamMonitor(pc, ms) {\n//     var self = this;\n//     this.pc = pc;\n//     this.ms = ms;\n//     this.mediaStreamTracks = {};\n//     ms.addEventListener('active', function () {\n//         log.verbose('stats-monitor', 'ms: onactive');\n//     });\n//     ms.addEventListener('addtrack', function (e) {\n//         log.verbose('stats-monitor', 'ms: onaddtrack: ' + e.track.id);\n//         self.mediaStreamTracks[e.track.id] = new MediaStreamTrackMonitor(self, e.track);\n//     });\n//     ms.addEventListener('ended', function () {\n//         log.verbose('stats-monitor', 'ms: onended');\n//     });\n//     ms.addEventListener('inactive', function () {\n//         log.verbose('stats-monitor', 'ms: oninactive');\n//     });\n//     ms.addEventListener('removetrack', function (e) {\n//         log.verbose('stats-monitor', 'ms: onremovetrack: ' + e.track.id);\n//         delete self.mediaStreamTracks[e.track.id];\n//     });\n// }\n\nvar WEBRTC_MONITOR_REGEX_MSID_CHROME = /^a=ssrc:(\\d+) msid:([-a-zA-Z0-9]+) ([-a-zA-Z0-9]+)$/\nvar WEBRTC_MONITOR_REGEX_MSID_FIREFOX = /^a=msid:{([-a-zA-Z0-9]+)} {([-a-zA-Z0-9]+)}$/\nvar WEBRTC_MONITOR_REGEX_MSLABEL = /^a=ssrc:(\\d+) mslabel:([-a-zA-Z0-9]+)$/\nvar WEBRTC_MONITOR_REGEX_LABEL = /^a=ssrc:(\\d+) label:(?:{)([-a-zA-Z0-9]+)(?:})$/\nvar WEBRTC_MONITOR_REGEX_CNAME = /^a=ssrc:(\\d+) cname:(?:{)([-a-zA-Z0-9]+)(?:})$/\n\nfunction parseIdentities(sdp, identities) {\n  var ids = {}\n  ids.ssrcs = []\n  var blocks = sdp.split(/(?=^m=)/mig)\n  for (var block in blocks) {\n    var lines = blocks[block].split(/\\r?\\n/)\n    var msidTemp = {}\n    for (var line = 0; line < lines.length; line += 1) {\n      var sdpMsIdC = lines[line].match(WEBRTC_MONITOR_REGEX_MSID_CHROME)\n      if (sdpMsIdC) {\n        if (!(sdpMsIdC[1] in ids.ssrcs)) {\n          ids.ssrcs.push(sdpMsIdC[1])\n        }\n        ids.msid = sdpMsIdC[2]\n        ids.mstid = sdpMsIdC[3]\n      }\n      var sdpMsIdF = lines[line].match(WEBRTC_MONITOR_REGEX_MSID_FIREFOX)\n      if (sdpMsIdF) {\n        if (ids.ssrc) {\n          ids.msid = sdpMsIdF[1]\n          ids.mstid = sdpMsIdF[2]\n        } else {\n          msidTemp.msid = sdpMsIdF[1]\n          msidTemp.mstid = sdpMsIdF[2]\n        }\n      }\n      var sdpMsLabel = lines[line].match(WEBRTC_MONITOR_REGEX_MSLABEL)\n      if (sdpMsLabel) {\n        if (!(sdpMsLabel[1] in ids.ssrcs)) {\n          ids.ssrcs.push(sdpMsLabel[1])\n        }\n        ids.msid = sdpMsLabel[2]\n      }\n      var sdpLabel = lines[line].match(WEBRTC_MONITOR_REGEX_LABEL)\n      if (sdpLabel) {\n        if (!(sdpLabel[1] in ids.ssrcs)) {\n          ids.ssrcs.push(sdpLabel[1])\n        }\n        ids.mstid = sdpLabel[2]\n      }\n      var sdpCname = lines[line].match(WEBRTC_MONITOR_REGEX_CNAME)\n      if (sdpCname) {\n        if (!(sdpCname[1] in ids.ssrcs)) {\n          ids.ssrcs.push(sdpCname[1])\n        }\n        ids.cname = sdpCname[2]\n        if (Object.keys(msidTemp).length) {\n          ids.msid = msidTemp.msid\n          ids.mstid = msidTemp.mstid\n          msidTemp = {}\n        }\n      }\n    }\n    if (Object.keys(ids.ssrcs).length) {\n      for (var ssrc in ids.ssrcs) {\n        identities[ids.ssrcs[ssrc]] = {}\n        for (var id in ids) {\n          if (id === 'ssrcs') {\n            continue\n          }\n          identities[ids.ssrcs[ssrc]][id] = ids[id]\n        }\n      }\n    }\n    ids = {}\n    ids.ssrcs = []\n  }\n  return identities\n}\n\nfunction reportGenericStat(formatter, identities, stat) {\n  var sample = {\n    timestamp: Date.now(),\n    pcId: identities.pcId,\n  }\n\n  sample = assign(sample, stat)\n\n  formatter.handleStats([sample])\n}\n\nvar PEER_CONNECTION_MONITOR_CANDIDATE_RE = new RegExp('' +\n  '^candidate:(\\\\d+) (\\\\d) (UDP|TCP) ([\\\\d\\\\.]*) ([\\\\d\\\\.a-f\\\\:]*) (\\\\d*) ' +\n  'typ ([a-z]*)( raddr ([\\\\d\\\\.a-f\\\\:]*) rport (\\\\d*))?( tcptype (active|passive|so))?.*$', 'mi')\n\nfunction parseCandidateString(candidateString) {\n  var candidate = null\n  var candidateMatches = candidateString.match(PEER_CONNECTION_MONITOR_CANDIDATE_RE)\n  if (candidateMatches) {\n    candidate = {\n      'foundation': candidateMatches[1],\n      'componentId': parseInt(candidateMatches[2]),\n      'transport': candidateMatches[3].toUpperCase(),\n      'priority': parseInt(candidateMatches[4]),\n      'address': candidateMatches[5],\n      'port': parseInt(candidateMatches[6]),\n      'type': candidateMatches[7],\n    }\n    if (candidateMatches[9]) {\n      candidate.relatedAddress = candidateMatches[9]\n    }\n    if (!isNaN(candidateMatches[10])) {\n      candidate.relatedPort = parseInt(candidateMatches[10])\n    }\n    if (candidateMatches[12]) {\n      candidate.tcpType = candidateMatches[12]\n    } else if (candidate.transport === 'TCP') {\n      if (candidate.port === 0 || candidate.port === 9) {\n        candidate.tcpType = 'active'\n        candidate.port = 9\n      } else {\n        return\n      }\n    }\n  }\n  return candidate\n}\n\nfunction reportCandidate(formatter, identities, rtcicecandidate, localOrRemote) {\n  var candidate = parseCandidateString(rtcicecandidate.candidate)\n  if (!candidate) {\n    return\n  }\n  var report = {\n    sourceId: 'candidates',\n    localOrRemote: localOrRemote,\n  }\n  report = assign(report, candidate)\n  reportGenericStat(formatter, identities, report)\n}\n\nvar PEER_CONNECTION_MONITOR_INTERNAL_MS = 1000\nvar PEER_CONNECTION_MONITOR_ICE_CHECKING_TIMEOUT_MS = 15000\n\nexport default function attachPeerConnectionMonitor(pc, formatter, reportIntervalMs) {\n  var tag = 'stats-monitor'\n  var callSucceeded = null\n\n  var reportInterval = 0\n  reportIntervalMs = reportIntervalMs || PEER_CONNECTION_MONITOR_INTERNAL_MS\n\n  var identities = {\n    isRelay: false,\n    pcId: pc.id,\n  }\n\n  pc.addEventListener('signalingstatechange', function () {\n    if (pc.signalingState === 'closed') {\n      log.debug(tag, 'stopped gather stats for ' + pc.id)\n      return clearInterval(reportInterval)\n    }\n\n    if (pc._pc.localDescription) {\n      identities = parseIdentities(pc._pc.localDescription.sdp, identities)\n    }\n    if (pc._pc.remoteDescription) {\n      identities = parseIdentities(pc._pc.remoteDescription.sdp, identities)\n    }\n  })\n\n  var normalizePeerConnectionStats = createPeerConnectionStatNormalizer()\n  var iceCheckingTimeout\n\n  pc.addEventListener('iceconnectionstatechange', function () {\n    var iceConnectionState = pc.iceConnectionState\n    reportGenericStat(formatter, identities, {\n      sourceId: 'iceConnectionState',\n      iceConnectionState: iceConnectionState,\n    })\n    if (iceCheckingTimeout) {\n      clearTimeout(iceCheckingTimeout)\n      iceCheckingTimeout = null\n    }\n    if (callSucceeded === null) {\n      if (iceConnectionState === 'connected' || iceConnectionState === 'completed') {\n        callSucceeded = true\n        reportGenericStat(formatter, identities, {\n          sourceId: 'events',\n          eventType: 'callSetupResult',\n          callSucceeded: true,\n        })\n\n        pc.getStats(null).then(function (stats) {\n          var normalizedStats = normalizePeerConnectionStats(stats, identities)\n          for (var i in normalizedStats) {\n            var stat = normalizedStats[i]\n            if ('localIpAddress' in stat) {\n              reportGenericStat(formatter, identities, stat)\n              if ('localCandidateType' in stat) {\n                identities.isRelay = stat.localCandidateType === 'relayed'\n              }\n            }\n          }\n        }).catch(function (error) {\n          log.warning(tag, 'getStats error:', error)\n        })\n      }\n      if (iceConnectionState === 'failed') {\n        callSucceeded = false\n        reportGenericStat(formatter, identities, {\n          sourceId: 'events',\n          eventType: 'callSetupResult',\n          callSucceeded: false,\n        })\n      }\n      if (iceConnectionState === 'checking' && !iceCheckingTimeout) {\n        iceCheckingTimeout = setTimeout(function () {\n          callSucceeded = false\n          reportGenericStat(formatter, identities, {\n            sourceId: 'events',\n            eventType: 'callSetupResult',\n            callSucceeded: false,\n          })\n        }, PEER_CONNECTION_MONITOR_ICE_CHECKING_TIMEOUT_MS)\n      }\n    }\n  })\n\n  pc.addEventListener('icecandidate', function (event) {\n    if (!event.candidate) {\n      return\n    }\n    reportCandidate(formatter, identities, event.candidate, 'local')\n  })\n\n  var realAddIceCandidate = pc.addIceCandidate\n  function addIceCandidate(candidate) {\n    reportCandidate(formatter, identities, candidate, 'remote')\n    return realAddIceCandidate.call(pc, candidate)\n  }\n  pc.addIceCandidate = addIceCandidate\n\n  reportInterval = setInterval(function () {\n    pc.getStats(null).then(function (stats) {\n      var normalizedStats = normalizePeerConnectionStats(stats, identities)\n      formatter.handleStats(normalizedStats)\n    }).catch(function (error) {\n      log.warning(tag, 'getStats error:', error)\n    })\n  }, reportIntervalMs)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/peerConnectionMonitor.js","'use strict'\n\nimport log from 'common/log'\nimport {isChrome, errorForwarder} from 'common/utils'\n\nconst TAG = 'renegotiator'\n\nexport default class Renegotiator {\n  constructor({label, channel, onError}) {\n    this._label = label\n    this._peerConnection = null\n    this._isInitiator = null\n    this._needRenegotiation = false\n    this._doingRenegotiation = false\n    this._renegotiationTime = 1\n    this._renegotiationOfferQueue = []\n\n    this._onError = onError\n\n    this._channel = channel\n    this._channel.on('message', this._onMessage.bind(this))\n\n    this._onSignalingStateChange = this._onSignalingStateChange.bind(this)\n    this._onNegotiationNeeded = this._onNegotiationNeeded.bind(this)\n  }\n\n  toString() {\n    return `renegotiator{\"${this._label}\",initiator=${this._isInitiator},${this._peerConnection}}`\n  }\n\n  setPeerConnection(peerConnection) {\n    this.reset()\n    this._peerConnection = peerConnection\n    this._peerConnection.addEventListener('negotiationneeded', this._onNegotiationNeeded)\n    this._peerConnection.addEventListener('signalingstatechange', this._onSignalingStateChange)\n  }\n\n  start(isInitiator) {\n    this._isInitiator = isInitiator\n\n    if (this._needRenegotiation) {\n      this._onNegotiationNeeded()\n    }\n  }\n\n  reset() {\n    if (this._peerConnection) {\n      this._peerConnection.removeEventListener('negotiationneeded', this._onNegotiationNeeded)\n      this._peerConnection.removeEventListener('signalingstatechange', this._onSignalingStateChange)\n    }\n    this._peerConnection = null\n    this._isInitiator = null\n    this._needRenegotiation = false\n    this._doingRenegotiation = false\n    this._renegotiationTime = 1\n    this._renegotiationOfferQueue = []\n  }\n\n  _onNegotiationNeeded() {\n    log.debug(TAG, this._peerConnection + ' needs negotiation')\n    if (this._isInitiator === true) {\n      if (this._doingRenegotiation) {\n        this._needRenegotiation = true\n      } else {\n        this._sendRenegotiationOffer()\n      }\n    } else if (this._isInitiator === false) {\n      this._sendRenegotiationRequest()\n    } else {\n      this._needRenegotiation = true\n    }\n  }\n\n  _sendRenegotiationRequest() {\n    this._renegotiationTime += 1\n    let audioCount = 0\n    let videoCount = 0\n    this._peerConnection.getLocalStreams().forEach(stream => {\n      audioCount += stream.getAudioTracks().length\n      videoCount += stream.getVideoTracks().length\n    })\n    let time = this._renegotiationTime\n    this._sendMessage('negotiationRequest', {audioCount, videoCount, time})\n    log.debug(TAG, `sent negotiation request {time=${time},audio=${audioCount},video=${videoCount}}`)\n  }\n\n  _handleRenegotiationRequest(content) {\n    var time = content.time\n    if (time < this._renegotiationTime) {\n      log.error(TAG, 'invalid renegotiation time: ' + time)\n      return\n    }\n    if (isChrome) {\n      this._requestedConstraints = {\n        mandatory: {\n          OfferToReceiveAudio: !!content.audioCount,\n          OfferToReceiveVideo: !!content.videoCount,\n        },\n      }\n    } else {\n      this._requestedConstraints = {\n        offerToReceiveVideo: content.videoCount || 0,\n        offerToReceiveAudio: content.audioCount || 0,\n      }\n    }\n    this._renegotiationTime = content.time\n    if (!this._doingRenegotiation) {\n      this._sendRenegotiationOffer()\n    } else {\n      this._needRenegotiation = true\n    }\n  }\n\n  _sendRenegotiationOffer(offerConstraints) {\n    this._doingRenegotiation = true\n    this._needRenegotiation = false\n    log.verbose(TAG, 'preparing to send renegotiation offer with constraints: ' +\n      JSON.stringify(this._requestedConstraints))\n    return this._peerConnection.performOffer({\n      constraints: this._requestedConstraints,\n    }).then(description => {\n      log.debug(TAG, 'sending offer:', description)\n\n      return this._sendMessage('offer', {\n        type: description.type,\n        sdp: description.sdp,\n        unifiedPlanSdp: description.unifiedPlanSdp,\n      })\n    })\n    .catch(errorForwarder(this._onError, '_sendRenegotiationOffer'))\n  }\n\n  _handleRenegotiationOffer(offer) {\n    if (this._doingRenegotiation) {\n      this._renegotiationOfferQueue.push(offer)\n      return log.info(TAG, 'got early offer, queued:', offer)\n    }\n\n    log.verbose(TAG, 'got offer', offer)\n    this._doingRenegotiation = true\n    return this._peerConnection.performAnswer({offer})\n      .then(description => {\n        log.debug(TAG, 'sending answer:', description)\n        return this._sendMessage('answer', {\n          type: description.type,\n          sdp: description.sdp,\n          unifiedPlanSdp: description.unifiedPlanSdp,\n          time: this._renegotiationTime,\n        })\n      })\n      .catch(errorForwarder(this._onError, '_handleRenegotiationOffer'))\n      .then(() => {\n        this._doingRenegotiation = false\n        if (this._renegotiationOfferQueue.length) {\n          this._handleRenegotiationOffer(this._renegotiationOfferQueue.pop())\n        }\n      })\n  }\n\n  _handleRenegotiationAnswer(answer) {\n    log.debug(TAG, 'got answer:', answer)\n    return this._peerConnection.handleAnswer({answer})\n      .catch(errorForwarder(this._onError, '_handleRenegotiationAnswer'))\n      .then(() => {\n        if (this._renegotiationTime > answer.time) {\n          this._needRenegotiation = true\n        } else {\n          this._renegotiationTime = answer.time\n        }\n        this._doingRenegotiation = this._needRenegotiation\n        if (this._needRenegotiation) {\n          return this._sendRenegotiationOffer()\n        }\n      })\n  }\n\n  _onSignalingStateChange() {\n    let {signalingState} = this._peerConnection\n    log.debug(TAG, `${this} changed signaling state: ${signalingState}`)\n  }\n\n  _onMessage(message) {\n    if (!this._peerConnection) {\n      log.error(TAG, 'got signaling message without peer connection')\n      return false\n    }\n    try {\n      let {type, content} = message\n      switch (type) {\n        case 'negotiationRequest':\n          this._handleRenegotiationRequest(content)\n          break\n        case 'answer':\n          this._handleRenegotiationAnswer(content)\n          break\n        case 'offer':\n          this._handleRenegotiationOffer(content)\n          break\n        default:\n          log.warning(TAG, `got unknown message: '${type}'`)\n          break\n      }\n    } catch (error) {\n      log.error(TAG, 'error processing message (', event.data, '):', error, error.stack)\n    }\n  }\n\n  _sendMessage(type, content) {\n    if (this._channel.readyState === 'open') {\n      this._channel.send({type, content}).catch(error => {\n        log.debug(TAG, this, `failed to send '${type}' message, ${error}`)\n      })\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/renegotiator.js","\nimport log from 'common/log'\n\nconst TAG = 'peer-connection'\n\nconst candidateRegExp = new RegExp('^candidate:(\\\\d+) (\\\\d) (UDP|TCP) ([\\\\d\\\\.]*) ([\\\\d\\\\.a-f\\\\:]*) (\\\\d*)' +\n  ' typ ([a-z]*)( raddr ([\\\\d\\\\.a-f\\\\:]*) rport (\\\\d*))?' +\n  '( tcptype (active|passive|so))?(.*)$', 'i')\nconst bundleAttributeRegExp = new RegExp('^a=group:BUNDLE (.*)$', 'mi')\n\n/**\n * @typedef IceCandidateInfo\n *\n * An object containing information about an ICE candidate.\n *\n * More information can be found in [RFC 5245](https://tools.ietf.org/html/rfc5245) and\n * [RFC 6544](https://tools.ietf.org/html/rfc6544).\n *\n * @property {string} foundation - The candidate foundation.\n * @property {number} componentId - The candidate component id, will almost always be 1 because of RTCP multiplexing.\n * @property {string} transport - The transport used, `'TCP'` or `'UDP'`.\n * @property {number} priority - The candidate priority.\n * @property {string} address - The candidate address.\n * @property {number} port - The candidate port.\n * @property {string} type - The candidate type, `'host'`, `'srflx'`, `'prflx'`, or `'relay'`.\n * @property {string} candidate - The original candidate line, always without attribute prefix (`a=`).\n * @property {string} origin - The origin of the candidate, `'local'` or `'remote'`.\n * @property {string} [relatedAddress] - The candidate related address, not used in host candidates.\n * @property {number} [relatedPort] - The candidate related port, not used in host candidates.\n * @property {string} [tcpType] - The candidate tcp type, `'active'`, `'passive'`, simultaneous-open, `'so'`.\n */\n\nexport function parseCandidateInfo(line, origin) {\n  let match = line.match(candidateRegExp)\n  if (!match) {\n    throw new Error(`Could not parse ${origin} ice candidate: ${line}`)\n  }\n  let info = {\n    foundation: match[1],\n    componentId: parseInt(match[2]),\n    transport: match[3].toUpperCase(),\n    priority: parseInt(match[4]),\n    address: match[5],\n    port: parseInt(match[6]),\n    type: match[7],\n    candidate: line,\n    origin: origin,\n  }\n  if (match[9]) {\n    info.relatedAddress = match[9]\n  }\n  if (!isNaN(match[10])) {\n    info.relatedPort = parseInt(match[10])\n  }\n  if (match[12]) {\n    info.tcpType = match[12]\n  } else if (info.transport === 'TCP') {\n    if (info.port === 0 || info.port === 9) {\n      info.tcpType = 'active'\n      info.port = 9\n    } else {\n      return\n    }\n  }\n  return info\n}\n\nexport function filterSdpCandidates(sdp, filter, origin) {\n  if (!sdp) {\n    return sdp\n  }\n  return sdp.split(/\\r\\n/).filter(line => {\n    if (line.indexOf('a=candidate:') === 0) {\n      try {\n        let candidate = line.slice(2)\n        let info = parseCandidateInfo(candidate, origin)\n        if (!filter(info)) {\n          log.verbose(TAG, `ignored candidate due to being filtered out: ${candidate}`)\n          return false\n        }\n      } catch (error) {\n        log.error(TAG, `ignoring candidate, error was thrown in candidate filter: ${error}`)\n        return false\n      }\n    }\n    return true\n  }).join('\\r\\n')\n}\n\nexport function workaroundSdpBundleBug(sdp) {\n  if (sdp.match(bundleAttributeRegExp)) {\n    // If the SDP already has a group attribute, we don't need to do anything\n    return sdp\n  }\n  return rewriteBundleAttribute(sdp)\n}\n\nexport function extractApplicationBlock(sdp) {\n  let [sessionBlock, ...mediaBlocks] = sdp.split(blockSplitRegExp)\n\n  let applicationMBlockIndex = -1\n  for (let index in mediaBlocks) {\n    if (mediaBlocks[index].indexOf('m=application') === 0) {\n      applicationMBlockIndex = +index\n      break\n    }\n  }\n\n  if (applicationMBlockIndex === -1) {\n    return [sdp, null]\n  }\n\n  let [, applicationMId] = mediaBlocks[applicationMBlockIndex].match(/a=mid:(.*)/mi) || []\n  if (!applicationMId) {\n    throw new Error('sdp application block does not have an mId')\n  }\n\n  let newSessionBlock = sessionBlock.replace(bundleAttributeRegExp, (_, mIdsStr) => {\n    let mIds = mIdsStr.split(' ')\n    let index = mIds.indexOf(applicationMId)\n    if (index === -1) {\n      throw new Error('sdp group:BUNDLE attribute did not contain application block mId')\n    }\n    mIds.splice(index, 1)\n    return 'a=group:BUNDLE ' + mIds.join(' ')\n  })\n\n  let applicationMBlock = mediaBlocks.splice(applicationMBlockIndex, 1)[0]\n  let newSdp = newSessionBlock + mediaBlocks.join('')\n  return [newSdp, {\n    block: applicationMBlock,\n    index: applicationMBlockIndex,\n    applicationMId,\n    needsInteropTranslation: !!mediaBlocks.length,\n  }]\n}\n\nexport function injectApplicationBlock(sdp, extractedBlock) {\n  if (!extractedBlock) {\n    return sdp\n  }\n\n  let [sessionBlock, ...mediaBlocks] = sdp.split(blockSplitRegExp)\n\n  let newSessionBlock = sessionBlock.replace(bundleAttributeRegExp, (_, mIdsStr) => {\n    let mIds = mIdsStr ? mIdsStr.split(' ') : []\n    mIds.splice(extractedBlock.index, 0, extractedBlock.applicationMId)\n    return 'a=group:BUNDLE ' + mIds.join(' ')\n  })\n\n  mediaBlocks.splice(extractedBlock.index, 0, extractedBlock.block)\n  return newSessionBlock + mediaBlocks.join('')\n}\n\nconst modeRegExp = new RegExp('^a=(inactive|recvonly|sendonly|sendrecv)$', 'mi')\nconst blockSplitRegExp = new RegExp('(?=m=(?:audio|video|application))', 'i')\nconst mediaTypeRegExp = new RegExp('^m=(audio|video|application)', 'i')\n\nconst modeValues = {\n  inactive: 0,\n  sendonly: 1,\n  recvonly: 2,\n  sendrecv: 3,\n}\nconst modeNames = {\n  0: 'inactive',\n  1: 'sendonly',\n  2: 'recvonly',\n  3: 'sendrecv',\n}\n\nexport function readMediaModeUnions(sdp) {\n  let [sessionBlock, ...mediaBlocks] = sdp.split(blockSplitRegExp)\n  // the mode above the media blocks is used if a media block doesn't have it's own mode\n  let [, defaultModeName = 'sendrecv'] = sessionBlock.match(modeRegExp) || []\n\n  let audioModeValue = modeValues.inactive\n  let videoModeValue = modeValues.inactive\n  let applicationModeValue = modeValues.inactive\n\n  mediaBlocks.forEach(mediaBlock => {\n    let [, mediaType] = mediaBlock.match(mediaTypeRegExp)\n    let [, modeName = defaultModeName] = mediaBlock.match(modeRegExp) || []\n    let modeValue = modeValues[modeName]\n    if (mediaType === 'audio') {\n      audioModeValue |= modeValue\n    } else if (mediaType === 'video') {\n      videoModeValue |= modeValue\n    } else if (mediaType === 'application') {\n      applicationModeValue |= modeValue\n    }\n  })\n\n  return {\n    audio: modeNames[audioModeValue],\n    video: modeNames[videoModeValue],\n    application: modeNames[applicationModeValue],\n  }\n}\n\nexport function overrideMediaModes(sdp, mediaModes) {\n  let [sessionBlock, ...mediaBlocks] = sdp.split(blockSplitRegExp)\n\n  mediaBlocks = mediaBlocks.map(mediaBlock => {\n    let [, mediaType] = mediaBlock.match(mediaTypeRegExp)\n    let modeName = mediaModes[mediaType] || modeNames[3] // default to sendrecv\n    return mediaBlock.replace(modeRegExp, `a=${modeName}`)\n  })\n\n  return [sessionBlock, ...mediaBlocks].join('')\n}\n\n// This rewrites the bundle attribute according to the actual media blocks in the sdp\nexport function rewriteBundleAttribute(sdp) {\n  let [sessionBlock, ...mediaBlocks] = sdp.split(blockSplitRegExp)\n  let mIds = mediaBlocks.map(mediaBlock => {\n    let [, mId] = mediaBlock.match(/^a=mid:(.+)$/mi) || []\n    if (!mId) {\n      let [, mediaType] = mediaBlock.match(mediaTypeRegExp)\n      throw new Error(`media block of type ${mediaType} did not contain mid attribute`)\n    }\n    return mId\n  })\n\n  mIds.unshift('') // conditional padding weith space after BUNDLE\n  let bundleAttribute = `a=group:BUNDLE${mIds.join(' ')}`\n\n  if (sessionBlock.match(bundleAttributeRegExp)) {\n    sessionBlock = sessionBlock.replace(bundleAttributeRegExp, bundleAttribute)\n  } else {\n    sessionBlock += `${bundleAttribute}\\r\\n`\n  }\n  return [sessionBlock, ...mediaBlocks].join('')\n}\n\nconst bweRegExp = new RegExp('a=extmap:5 ' +\n  'http://www\\\\.ietf\\\\.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01' +\n  '\\r\\n', 'gi')\n\n// Chrome 58 and 59 has a broken bandwidth estimation implementation that\n// doesn't detect when packets are sent using TURN/TCP. This results in\n// the estimated bandwidth to always end up at 10kbps.\n// The fix we use is to always disable the new bandwidth estimation algorithm\n// for all connections.\nexport function disableSendBandwidthEstimation(sdp) {\n  return sdp.replace(bweRegExp, '')\n}\n\nconst ssrcGroupRegExp = new RegExp('a=ssrc-group:.+\\\\s\\\\d+\\\\s(\\\\d+)' + '\\r\\n', 'gi')\nconst rtxPayloadTypeRegExp = new RegExp('a=(?:fmtp:\\\\d+\\\\sapt=\\\\d+|rtpmap:\\\\d+\\\\srtx/\\\\d+)' + '\\r\\n', 'gi')\n\n// Removes retransmission information from a Chrome-style (Plan B) SDPs.\n// This includes rtpmap and fmtp attributes with rtx/apt values, ssrc-group\n// attributes, and the ssrc attributes for the ssrcs used for retransmission.\nexport function removeChromeRetransmission(sdp) {\n  let [sessionBlock, ...mediaBlocks] = sdp.split(blockSplitRegExp)\n\n  let modifiedMediaBlocks = mediaBlocks.map(mediaBlock => {\n    let [, mediaType] = mediaBlock.match(mediaTypeRegExp)\n    if (mediaType !== 'video') {\n      return mediaBlock\n    }\n    let removedSsrcs = []\n\n    let withoutSsrcGroups = mediaBlock.replace(ssrcGroupRegExp, (_, ssrc) => {\n      // We assume the second SSRC is used for retransmission\n      removedSsrcs.push(ssrc)\n      return ''\n    })\n    let ssrcRegExp = new RegExp(`a=ssrc:(?:${removedSsrcs.join('|')})\\\\s.*\\r\\n`, 'gi')\n    let withoutSsrcs = withoutSsrcGroups.replace(ssrcRegExp, '')\n    let withoutRtxPayloadTypes = withoutSsrcs.replace(rtxPayloadTypeRegExp, '')\n    return withoutRtxPayloadTypes\n  })\n\n  return [sessionBlock, ...modifiedMediaBlocks].join('')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/sdpTransform.js","'use strict'\n\nimport {assign, randomString} from 'common/utils'\n\nexport default function StatsFormatter(context, reporter) {\n  this.context = assign({}, context)\n  this.context.contextId = randomString(16)\n  this.context.userAgent = navigator.userAgent\n  this.reporter = reporter\n  this.tag = 'stats-formatter'\n}\n\nStatsFormatter.prototype.setPeerId = function (peerId) {\n  this.context.peerId = peerId\n}\n\nStatsFormatter.prototype.handleStats = function (stats) {\n  for (var i in stats) {\n    stats[i] = assign(stats[i], this.context)\n  }\n  this.reporter.handleStats(stats)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/statsFormatter.js","'use strict'\n\nimport log from 'common/log'\nimport {\n  assign,\n  isChrome,\n  isFirefox,\n  maybeConvertStringToNumber,\n} from 'common/utils'\n\nvar STATS_OBJ_REGEX_FIREFOX = /(in|out)bound_(rtp|rtcp)_(audio|video)_(\\d+)/\nvar STATS_KEY_BLACKLIST_FIREFOX = [\n  'id',\n  'type',\n  'isRemote',\n  'remoteId',\n]\n\nvar STATS_OBJ_REGEX_CHROME = /(ssrc)_(\\d+)_(recv|send)/\nvar STATS_KEY_BLACKLIST_CHROME = [\n  'id',\n  'type',\n  'googTrackId',\n  'transportId',\n]\n\nfunction normalizeStatsMatchFirefox(statKey, stat) {\n  var sample = {}\n  var matchFirefox = statKey.match(STATS_OBJ_REGEX_FIREFOX)\n  if (matchFirefox) {\n    switch (matchFirefox[1]) {\n      case 'in':\n        sample.role = 'receiver'\n        break\n      case 'out':\n        sample.role = 'sender'\n        break\n      default:\n        log.warning('stats-normalizer', 'No role match!')\n        return null\n    }\n    switch (matchFirefox[2]) {\n      case 'rtp':\n        sample.reportType = sample.role === 'receiver' ? 'receiver' : 'sender'\n        break\n      case 'rtcp':\n        sample.reportType = sample.role === 'receiver' ? 'sender' : 'receiver'\n        break\n      default:\n        log.warning('stats-normalizer', 'No reportType match!')\n        return null\n    }\n\n    for (var k in stat) {\n      if (STATS_KEY_BLACKLIST_FIREFOX.indexOf(k) >= 0) {\n        continue\n      }\n      sample[k] = maybeConvertStringToNumber(stat[k].toString())\n    }\n    return sample\n  }\n}\n\nfunction normalizeStatsMatchChrome(statKey, stat) {\n  var sample = {}\n  var matchChrome = statKey.match(STATS_OBJ_REGEX_CHROME)\n  if (matchChrome) {\n    switch (matchChrome[3]) {\n      case 'recv':\n        sample.role = 'receiver'\n        sample.reportType = 'receiver'\n        break\n      case 'send':\n        sample.role = 'sender'\n        sample.reportType = 'sender'\n        break\n      default:\n        log.warning('stats-normalizer', 'No role match!')\n        return null\n    }\n\n    for (var k in stat) {\n      if (STATS_KEY_BLACKLIST_CHROME.indexOf(k) >= 0) {\n        continue\n      }\n      sample[k] = maybeConvertStringToNumber(stat[k].toString())\n            // FIXME - set the mediaType from an ssrc lookup after parsing the sdp\n      if (k === 'audioInputLevel' || k === 'audioOutputLevel') {\n        sample.mediaType = 'audio'\n      } else if (k === 'googFrameHeightReceived' || k === 'googFrameHeightSent') {\n        sample.mediaType = 'video'\n      } else {\n        continue\n      }\n    }\n    return sample\n  }\n}\n\nvar candidatePairKeys = [\n  'portNumber',\n  'ipAddress',\n  'transport',\n  'candidateType',\n  // 'relatedAddress',\n  // 'relatedPort',\n  // 'tcpType',\n]\nfunction assignCandidatePairValues(stat, localOrRemote, sample) {\n  for (var i in candidatePairKeys) {\n    var key = candidatePairKeys[i]\n    if (key in stat) {\n      var destKey = localOrRemote + key.charAt(0).toUpperCase() + key.slice(1)\n      sample[destKey] = maybeConvertStringToNumber(stat[key])\n    }\n  }\n  return sample\n}\n\nfunction getSelectedPairSampleFromStats(stats, stat, browser) {\n  var localCandidateId = stat.localCandidateId\n  var remoteCandidateId = stat.remoteCandidateId\n  var localStat = stats[localCandidateId]\n  var remoteStat = stats[remoteCandidateId]\n\n  var sample = {}\n\n  sample.sourceId = 'selectedPair'\n\n  sample = assignCandidatePairValues(localStat, 'local', sample)\n  sample = assignCandidatePairValues(remoteStat, 'remote', sample)\n  if (browser === 'chrome') {\n    sample.localPriority = +localStat.priority\n    sample.remotePriority = +remoteStat.priority\n  }\n  if (browser === 'firefox') {\n    sample.localPriority = +stat.priority\n    sample.remotePriority = +stat.priority\n  }\n\n  return sample\n}\n\nexport default function createPeerConnectionStatNormalizer() {\n  var selectedPairs = {}\n\n  function normalizeSsrcStats(stats, identities) {\n    var samples = []\n    var sampleTsMs = Date.now()\n\n    for (var i in stats) {\n      var stat = stats[i]\n      var sample = null\n      var ssrc = stat.ssrc\n      if (!ssrc) {\n        continue\n      }\n      var identity = identities[ssrc]\n      if (!identity) {\n        log.warning('stat-normalizer', 'got stat without identity:', stat)\n        continue\n      }\n\n      if (isFirefox) {\n        sample = normalizeStatsMatchFirefox(i, stat)\n      }\n      if (isChrome) {\n        sample = normalizeStatsMatchChrome(i, stat)\n      }\n      if (!sample) {\n        continue\n      }\n\n      if (sample.timestamp) {\n        sample.getStatsTs = sample.timestamp\n        delete sample.timestamp\n      }\n\n      sample.timestamp = sampleTsMs\n      sample.pcId = identities.pcId\n      sample.isRelay = identities.isRelay\n\n      sample = assign(sample, identity)\n      sample.sourceId = 'ssrc-' + ssrc\n\n      samples.push(sample)\n    }\n\n    return samples\n  }\n\n  function normalizeSelectedPairStats(stats, identities) {\n    var samples = []\n    var sampleTsMs = Date.now()\n    var newSelectedPairs = {}\n\n    for (var i in stats) {\n      var stat = stats[i]\n      var sample = null\n\n      if (stat.type === 'candidatepair' && stat.selected === true && stat.state === 'succeeded') {\n        sample = getSelectedPairSampleFromStats(stats, stat, 'firefox')\n      }\n      if (stat.type === 'googCandidatePair' && stat.googActiveConnection === 'true') {\n        sample = getSelectedPairSampleFromStats(stats, stat, 'chrome')\n      }\n\n      if (!sample) {\n        continue\n      }\n\n      sample.timestamp = sampleTsMs\n      sample.pcId = identities.pcId\n      sample.isRelay = identities.isRelay\n\n      var newSelectedPair = stat.localCandidateId + stat.remoteCandidateId\n      if (!(newSelectedPair in newSelectedPairs)) {\n        newSelectedPairs[newSelectedPair] = []\n      }\n      newSelectedPairs[newSelectedPair].push(sample)\n    }\n\n    for (var oldPair in selectedPairs) {\n      if (!(oldPair in newSelectedPairs)) {\n        delete selectedPairs[oldPair]\n      }\n    }\n    for (var newPair in newSelectedPairs) {\n      if (!(newPair in selectedPairs)) {\n        selectedPairs[newPair] = true;\n        [].push.apply(samples, newSelectedPairs[newPair])\n      }\n    }\n\n    return samples\n  }\n\n  return function normalizePeerConnectionStats(stats, identities) {\n    var samples = []\n\n    samples = normalizeSsrcStats(stats, identities);\n    [].push.apply(samples, normalizeSelectedPairStats(stats, identities))\n\n    return samples\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/webrtc/statsNormalizer.js","module.exports = { \"default\": require(\"core-js/library/fn/math/log2\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/math/log2.js\n// module id = 277\n// module chunks = 0","module.exports = { \"default\": require(\"core-js/library/fn/math/sign\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/math/sign.js\n// module id = 278\n// module chunks = 0","module.exports = { \"default\": require(\"core-js/library/fn/object/values\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/core-js/object/values.js\n// module id = 279\n// module chunks = 0","\"use strict\";\n\nexports.__esModule = true;\n\nvar _assign = require(\"../core-js/object/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = _assign2.default || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/helpers/extends.js\n// module id = 280\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 281\n// module chunks = 0","require('../../modules/es6.math.log2');\nmodule.exports = require('../../modules/_core').Math.log2;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/math/log2.js\n// module id = 282\n// module chunks = 0","require('../../modules/es6.math.sign');\nmodule.exports = require('../../modules/_core').Math.sign;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/math/sign.js\n// module id = 283\n// module chunks = 0","require('../../modules/es6.object.define-properties');\nvar $Object = require('../../modules/_core').Object;\nmodule.exports = function defineProperties(T, D){\n  return $Object.defineProperties(T, D);\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/define-properties.js\n// module id = 284\n// module chunks = 0","require('../../modules/es7.object.entries');\nmodule.exports = require('../../modules/_core').Object.entries;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/entries.js\n// module id = 285\n// module chunks = 0","require('../../modules/es7.object.values');\nmodule.exports = require('../../modules/_core').Object.values;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/fn/object/values.js\n// module id = 286\n// module chunks = 0","// 20.2.2.28 Math.sign(x)\nmodule.exports = Math.sign || function sign(x){\n  return (x = +x) == 0 || x != x ? x : x < 0 ? -1 : 1;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/_math-sign.js\n// module id = 287\n// module chunks = 0","// 20.2.2.22 Math.log2(x)\nvar $export = require('./_export');\n\n$export($export.S, 'Math', {\n  log2: function log2(x){\n    return Math.log(x) / Math.LN2;\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.math.log2.js\n// module id = 288\n// module chunks = 0","// 20.2.2.28 Math.sign(x)\nvar $export = require('./_export');\n\n$export($export.S, 'Math', {sign: require('./_math-sign')});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.math.sign.js\n// module id = 289\n// module chunks = 0","var $export = require('./_export');\n// 19.1.2.3 / 15.2.3.7 Object.defineProperties(O, Properties)\n$export($export.S + $export.F * !require('./_descriptors'), 'Object', {defineProperties: require('./_object-dps')});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es6.object.define-properties.js\n// module id = 290\n// module chunks = 0","// https://github.com/tc39/proposal-object-values-entries\nvar $export  = require('./_export')\n  , $entries = require('./_object-to-array')(true);\n\n$export($export.S, 'Object', {\n  entries: function entries(it){\n    return $entries(it);\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es7.object.entries.js\n// module id = 291\n// module chunks = 0","// https://github.com/tc39/proposal-object-values-entries\nvar $export = require('./_export')\n  , $values = require('./_object-to-array')(false);\n\n$export($export.S, 'Object', {\n  values: function values(it){\n    return $values(it);\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/core-js/library/modules/es7.object.values.js\n// module id = 292\n// module chunks = 0","/*! adapterjs - v0.14.3-6d236da - 2017-05-24 */\nvar AdapterJS=AdapterJS||{};AdapterJS.options=AdapterJS.options||{},AdapterJS.VERSION=\"0.14.3-6d236da\",AdapterJS.onwebrtcready=AdapterJS.onwebrtcready||function(isUsingPlugin){},AdapterJS._onwebrtcreadies=[],AdapterJS.webRTCReady=function(baseCallback){if(\"function\"!=typeof baseCallback)throw new Error(\"Callback provided is not a function\");var callback=function(){\"function\"==typeof window.require&&\"function\"==typeof AdapterJS._defineMediaSourcePolyfill&&AdapterJS._defineMediaSourcePolyfill(),baseCallback(null!==AdapterJS.WebRTCPlugin.plugin)};!0===AdapterJS.onwebrtcreadyDone?callback():AdapterJS._onwebrtcreadies.push(callback)},AdapterJS.WebRTCPlugin=AdapterJS.WebRTCPlugin||{},AdapterJS.WebRTCPlugin.pluginInfo=AdapterJS.WebRTCPlugin.pluginInfo||{prefix:\"Tem\",plugName:\"TemWebRTCPlugin\",pluginId:\"plugin0\",type:\"application/x-temwebrtcplugin\",onload:\"__TemWebRTCReady0\",portalLink:\"https://skylink.io/plugin/\",downloadLink:null,companyName:\"Temasys\",downloadLinks:{mac:\"https://bit.ly/webrtcpluginpkg\",win:\"https://bit.ly/webrtcpluginmsi\"}},\"undefined\"!=typeof AdapterJS.WebRTCPlugin.pluginInfo.downloadLinks&&null!==AdapterJS.WebRTCPlugin.pluginInfo.downloadLinks&&(navigator.platform.match(/^Mac/i)?AdapterJS.WebRTCPlugin.pluginInfo.downloadLink=AdapterJS.WebRTCPlugin.pluginInfo.downloadLinks.mac:navigator.platform.match(/^Win/i)&&(AdapterJS.WebRTCPlugin.pluginInfo.downloadLink=AdapterJS.WebRTCPlugin.pluginInfo.downloadLinks.win)),AdapterJS.WebRTCPlugin.TAGS={NONE:\"none\",AUDIO:\"audio\",VIDEO:\"video\"},AdapterJS.WebRTCPlugin.pageId=Math.random().toString(36).slice(2),AdapterJS.WebRTCPlugin.plugin=null,AdapterJS.WebRTCPlugin.setLogLevel=null,AdapterJS.WebRTCPlugin.defineWebRTCInterface=null,AdapterJS.WebRTCPlugin.isPluginInstalled=null,AdapterJS.WebRTCPlugin.pluginInjectionInterval=null,AdapterJS.WebRTCPlugin.injectPlugin=null,AdapterJS.WebRTCPlugin.PLUGIN_STATES={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.NONE,AdapterJS.onwebrtcreadyDone=!1,AdapterJS.WebRTCPlugin.PLUGIN_LOG_LEVELS={NONE:\"NONE\",ERROR:\"ERROR\",WARNING:\"WARNING\",INFO:\"INFO\",VERBOSE:\"VERBOSE\",SENSITIVE:\"SENSITIVE\"},AdapterJS.WebRTCPlugin.WaitForPluginReady=null,AdapterJS.WebRTCPlugin.callWhenPluginReady=null,__TemWebRTCReady0=function(){if(\"complete\"===document.readyState)AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY,AdapterJS.maybeThroughWebRTCReady();else var timer=setInterval(function(){\"complete\"===document.readyState&&(clearInterval(timer),AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY,AdapterJS.maybeThroughWebRTCReady())},100)},AdapterJS.maybeThroughWebRTCReady=function(){AdapterJS.onwebrtcreadyDone||(AdapterJS.onwebrtcreadyDone=!0,AdapterJS._onwebrtcreadies.length?AdapterJS._onwebrtcreadies.forEach(function(callback){\"function\"==typeof callback&&callback(null!==AdapterJS.WebRTCPlugin.plugin)}):\"function\"==typeof AdapterJS.onwebrtcready&&AdapterJS.onwebrtcready(null!==AdapterJS.WebRTCPlugin.plugin))},AdapterJS.TEXT={PLUGIN:{REQUIRE_INSTALLATION:\"This website requires you to install a WebRTC-enabling plugin to work on this browser.\",NOT_SUPPORTED:\"Your browser does not support WebRTC.\",BUTTON:\"Install Now\"},REFRESH:{REQUIRE_REFRESH:\"Please refresh page\",BUTTON:\"Refresh Page\"}},AdapterJS._iceConnectionStates={starting:\"starting\",checking:\"checking\",connected:\"connected\",completed:\"connected\",done:\"completed\",disconnected:\"disconnected\",failed:\"failed\",closed:\"closed\"},AdapterJS._iceConnectionFiredStates=[],AdapterJS.isDefined=null,AdapterJS.parseWebrtcDetectedBrowser=function(){var hasMatch=null;if(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(\" OPR/\")>=0)hasMatch=navigator.userAgent.match(/OPR\\/(\\d+)/i)||[],webrtcDetectedBrowser=\"opera\",webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10),webrtcMinimumVersion=26,webrtcDetectedType=\"webkit\",webrtcDetectedDCSupport=\"SCTP\";else if(navigator.userAgent.match(/Bowser\\/[0-9.]*/g)){hasMatch=navigator.userAgent.match(/Bowser\\/[0-9.]*/g)||[];var chromiumVersion=parseInt((navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./i)||[])[2]||\"0\",10);webrtcDetectedBrowser=\"bowser\",webrtcDetectedVersion=parseFloat((hasMatch[0]||\"0/0\").split(\"/\")[1],10),webrtcMinimumVersion=0,webrtcDetectedType=\"webkit\",webrtcDetectedDCSupport=chromiumVersion>30?\"SCTP\":\"RTP\"}else if(navigator.userAgent.indexOf(\"OPiOS\")>0)hasMatch=navigator.userAgent.match(/OPiOS\\/([0-9]+)\\./),webrtcDetectedBrowser=\"opera\",webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf(\"CriOS\")>0)hasMatch=navigator.userAgent.match(/CriOS\\/([0-9]+)\\./)||[],webrtcDetectedBrowser=\"chrome\",webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf(\"FxiOS\")>0)hasMatch=navigator.userAgent.match(/FxiOS\\/([0-9]+)\\./)||[],webrtcDetectedBrowser=\"firefox\",webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(document.documentMode)hasMatch=/\\brv[ :]+(\\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedBrowser=\"IE\",webrtcDetectedVersion=parseInt(hasMatch[1],10),webrtcMinimumVersion=9,webrtcDetectedType=\"plugin\",webrtcDetectedDCSupport=\"SCTP\",webrtcDetectedVersion||(hasMatch=/\\bMSIE[ :]+(\\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/))hasMatch=navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)||[],webrtcDetectedBrowser=\"edge\",webrtcDetectedVersion=parseFloat((hasMatch[0]||\"0/0\").split(\"/\")[1],10),webrtcMinimumVersion=13.10547,webrtcDetectedType=\"ms\",webrtcDetectedDCSupport=null;else if(\"undefined\"!=typeof InstallTrigger||navigator.userAgent.indexOf(\"irefox\")>0)hasMatch=navigator.userAgent.match(/Firefox\\/([0-9]+)\\./)||[],webrtcDetectedBrowser=\"firefox\",webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10),webrtcMinimumVersion=33,webrtcDetectedType=\"moz\",webrtcDetectedDCSupport=\"SCTP\";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf(\"Chrom\")>0)hasMatch=navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./i)||[],webrtcDetectedBrowser=\"chrome\",webrtcDetectedVersion=parseInt(hasMatch[2]||\"0\",10),webrtcMinimumVersion=38,webrtcDetectedType=\"webkit\",webrtcDetectedDCSupport=webrtcDetectedVersion>30?\"SCTP\":\"RTP\";else if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){hasMatch=navigator.userAgent.match(/version\\/(\\d+)/i)||[];var isMobile=navigator.userAgent.match(/(iPhone|iPad)/gi)||[];webrtcDetectedBrowser=\"safari\",webrtcDetectedVersion=parseInt(hasMatch[1]||\"0\",10),webrtcMinimumVersion=7,webrtcDetectedType=0===isMobile.length?\"plugin\":null,webrtcDetectedDCSupport=0===isMobile.length?\"SCTP\":null}window.webrtcDetectedBrowser=webrtcDetectedBrowser,window.webrtcDetectedVersion=webrtcDetectedVersion,window.webrtcMinimumVersion=webrtcMinimumVersion,window.webrtcDetectedType=webrtcDetectedType,window.webrtcDetectedDCSupport=webrtcDetectedDCSupport},AdapterJS.addEvent=function(elem,evnt,func){elem.addEventListener?elem.addEventListener(evnt,func,!1):elem.attachEvent?elem.attachEvent(\"on\"+evnt,func):elem[evnt]=func},AdapterJS.renderNotificationBar=function(message,buttonText,buttonCallback){if(\"complete\"===document.readyState){var w=window,i=document.createElement(\"iframe\");i.name=\"adapterjs-alert\",i.style.position=\"fixed\",i.style.top=\"-41px\",i.style.left=0,i.style.right=0,i.style.width=\"100%\",i.style.height=\"40px\",i.style.backgroundColor=\"#ffffe1\",i.style.border=\"none\",i.style.borderBottom=\"1px solid #888888\",i.style.zIndex=\"9999999\",\"string\"==typeof i.style.webkitTransition?i.style.webkitTransition=\"all .5s ease-out\":\"string\"==typeof i.style.transition&&(i.style.transition=\"all .5s ease-out\"),document.body.appendChild(i);var c=i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument;c.document.open(),c.document.write('<span style=\"display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;\">'+message+\"</span>\"),buttonText&&\"function\"==typeof buttonCallback?(c.document.write('<button id=\"okay\">'+buttonText+'</button><button id=\"cancel\">Cancel</button>'),c.document.close(),AdapterJS.addEvent(c.document.getElementById(\"okay\"),\"click\",function(e){e.preventDefault();try{e.cancelBubble=!0}catch(error){}buttonCallback(e)}),AdapterJS.addEvent(c.document.getElementById(\"cancel\"),\"click\",function(e){w.document.body.removeChild(i)})):c.document.close(),setTimeout(function(){\"string\"==typeof i.style.webkitTransform?i.style.webkitTransform=\"translateY(40px)\":\"string\"==typeof i.style.transform?i.style.transform=\"translateY(40px)\":i.style.top=\"0px\"},300)}},webrtcDetectedType=null,checkMediaDataChannelSettings=function(peerBrowserAgent,peerBrowserVersion,callback,constraints){if(\"function\"==typeof callback){var beOfferer=!0,isLocalFirefox=\"firefox\"===webrtcDetectedBrowser,isLocalFirefoxInterop=\"moz\"===webrtcDetectedType&&webrtcDetectedVersion>30,isPeerFirefox=\"firefox\"===peerBrowserAgent;if(isLocalFirefox&&isPeerFirefox||isLocalFirefoxInterop)try{delete constraints.mandatory.MozDontOfferDataChannel}catch(error){}else isLocalFirefox&&!isPeerFirefox&&(constraints.mandatory.MozDontOfferDataChannel=!0);if(!isLocalFirefox)for(var prop in constraints.mandatory)constraints.mandatory.hasOwnProperty(prop)&&prop.indexOf(\"Moz\")!==-1&&delete constraints.mandatory[prop];!isLocalFirefox||isPeerFirefox||isLocalFirefoxInterop||(beOfferer=!1),callback(beOfferer,constraints)}},checkIceConnectionState=function(peerId,iceConnectionState,callback){\"function\"==typeof callback&&(peerId=peerId?peerId:\"peer\",AdapterJS._iceConnectionFiredStates[peerId]&&iceConnectionState!==AdapterJS._iceConnectionStates.disconnected&&iceConnectionState!==AdapterJS._iceConnectionStates.failed&&iceConnectionState!==AdapterJS._iceConnectionStates.closed||(AdapterJS._iceConnectionFiredStates[peerId]=[]),iceConnectionState=AdapterJS._iceConnectionStates[iceConnectionState],AdapterJS._iceConnectionFiredStates[peerId].indexOf(iceConnectionState)<0&&(AdapterJS._iceConnectionFiredStates[peerId].push(iceConnectionState),iceConnectionState===AdapterJS._iceConnectionStates.connected&&setTimeout(function(){AdapterJS._iceConnectionFiredStates[peerId].push(AdapterJS._iceConnectionStates.done),callback(AdapterJS._iceConnectionStates.done)},1e3),callback(iceConnectionState)))},createIceServer=null,createIceServers=null,MediaStream=\"function\"==typeof MediaStream?MediaStream:null,RTCPeerConnection=\"function\"==typeof RTCPeerConnection?RTCPeerConnection:null,RTCSessionDescription=\"function\"==typeof RTCSessionDescription?RTCSessionDescription:null,RTCIceCandidate=\"function\"==typeof RTCIceCandidate?RTCIceCandidate:null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,webrtcMinimumVersion=null,!(navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.mediaDevices&&navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/))||0===(navigator.userAgent.match(/android/gi)||[]).length&&0===(navigator.userAgent.match(/chrome/gi)||[]).length&&navigator.userAgent.indexOf(\"Safari/\")>0?(\"object\"==typeof console&&\"function\"==typeof console.log||(console={}||console,console.log=function(arg){},console.info=function(arg){},console.error=function(arg){},console.dir=function(arg){},console.exception=function(arg){},console.trace=function(arg){},console.warn=function(arg){},console.count=function(arg){},console.debug=function(arg){},console.count=function(arg){},console.time=function(arg){},console.timeEnd=function(arg){},console.group=function(arg){},console.groupCollapsed=function(arg){},console.groupEnd=function(arg){}),AdapterJS.parseWebrtcDetectedBrowser(),isIE=\"IE\"===webrtcDetectedBrowser,AdapterJS.WebRTCPlugin.WaitForPluginReady=function(){for(;AdapterJS.WebRTCPlugin.pluginState!==AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY;);},AdapterJS.WebRTCPlugin.callWhenPluginReady=function(callback){if(AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY)callback();else var checkPluginReadyState=setInterval(function(){AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(checkPluginReadyState),callback())},100)},AdapterJS.WebRTCPlugin.setLogLevel=function(logLevel){AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){AdapterJS.WebRTCPlugin.plugin.setLogLevel(logLevel)})},AdapterJS.WebRTCPlugin.injectPlugin=function(){if(\"complete\"===document.readyState&&AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.INITIALIZING){if(AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.INJECTING,\"IE\"===webrtcDetectedBrowser&&webrtcDetectedVersion<=10){var frag=document.createDocumentFragment();for(AdapterJS.WebRTCPlugin.plugin=document.createElement(\"div\"),AdapterJS.WebRTCPlugin.plugin.innerHTML='<object id=\"'+AdapterJS.WebRTCPlugin.pluginInfo.pluginId+'\" type=\"'+AdapterJS.WebRTCPlugin.pluginInfo.type+'\" width=\"1\" height=\"1\"><param name=\"pluginId\" value=\"'+AdapterJS.WebRTCPlugin.pluginInfo.pluginId+'\" /> <param name=\"windowless\" value=\"false\" /> <param name=\"pageId\" value=\"'+AdapterJS.WebRTCPlugin.pageId+'\" /> <param name=\"onload\" value=\"'+AdapterJS.WebRTCPlugin.pluginInfo.onload+'\" /><param name=\"tag\" value=\"'+AdapterJS.WebRTCPlugin.TAGS.NONE+'\" />'+(AdapterJS.options.getAllCams?'<param name=\"forceGetAllCams\" value=\"True\" />':\"\")+\"</object>\";AdapterJS.WebRTCPlugin.plugin.firstChild;)frag.appendChild(AdapterJS.WebRTCPlugin.plugin.firstChild);document.body.appendChild(frag),AdapterJS.WebRTCPlugin.plugin=document.getElementById(AdapterJS.WebRTCPlugin.pluginInfo.pluginId)}else AdapterJS.WebRTCPlugin.plugin=document.createElement(\"object\"),AdapterJS.WebRTCPlugin.plugin.id=AdapterJS.WebRTCPlugin.pluginInfo.pluginId,isIE?(AdapterJS.WebRTCPlugin.plugin.width=\"1px\",AdapterJS.WebRTCPlugin.plugin.height=\"1px\"):(AdapterJS.WebRTCPlugin.plugin.width=\"0px\",AdapterJS.WebRTCPlugin.plugin.height=\"0px\"),AdapterJS.WebRTCPlugin.plugin.type=AdapterJS.WebRTCPlugin.pluginInfo.type,AdapterJS.WebRTCPlugin.plugin.innerHTML='<param name=\"onload\" value=\"'+AdapterJS.WebRTCPlugin.pluginInfo.onload+'\"><param name=\"pluginId\" value=\"'+AdapterJS.WebRTCPlugin.pluginInfo.pluginId+'\"><param name=\"windowless\" value=\"false\" /> '+(AdapterJS.options.getAllCams?'<param name=\"forceGetAllCams\" value=\"True\" />':\"\")+'<param name=\"pageId\" value=\"'+AdapterJS.WebRTCPlugin.pageId+'\"><param name=\"tag\" value=\"'+AdapterJS.WebRTCPlugin.TAGS.NONE+'\" />',document.body.appendChild(AdapterJS.WebRTCPlugin.plugin);AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.INJECTED}},AdapterJS.WebRTCPlugin.isPluginInstalled=function(comName,plugName,plugType,installedCb,notInstalledCb){if(isIE){try{new ActiveXObject(comName+\".\"+plugName)}catch(e){return void notInstalledCb()}installedCb()}else{for(var pluginArray=navigator.mimeTypes,i=0;i<pluginArray.length;i++)if(pluginArray[i].type.indexOf(plugType)>=0)return void installedCb();notInstalledCb()}},AdapterJS.WebRTCPlugin.defineWebRTCInterface=function(){if(AdapterJS.WebRTCPlugin.pluginState!==AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY){AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.INITIALIZING,AdapterJS.isDefined=function(variable){return null!==variable&&void 0!==variable},createIceServer=function(url,username,password){var iceServer=null,urlParts=url.split(\":\");return 0===urlParts[0].indexOf(\"stun\")?iceServer={url:url,hasCredentials:!1}:0===urlParts[0].indexOf(\"turn\")&&(iceServer={url:url,hasCredentials:!0,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){for(var iceServers=[],i=0;i<urls.length;++i)iceServers.push(createIceServer(urls[i],username,password));return iceServers},RTCSessionDescription=function(info){return AdapterJS.WebRTCPlugin.WaitForPluginReady(),AdapterJS.WebRTCPlugin.plugin.ConstructSessionDescription(info.type,info.sdp)},MediaStream=function(mediaStreamOrTracks){return AdapterJS.WebRTCPlugin.WaitForPluginReady(),AdapterJS.WebRTCPlugin.plugin.MediaStream(mediaStreamOrTracks)},RTCPeerConnection=function(servers,constraints){if(void 0!==servers&&null!==servers&&!Array.isArray(servers.iceServers))throw new Error(\"Failed to construct 'RTCPeerConnection': Malformed RTCConfiguration\");if(\"undefined\"!=typeof constraints&&null!==constraints){var invalidConstraits=!1;if(invalidConstraits|=\"object\"!=typeof constraints,invalidConstraits|=constraints.hasOwnProperty(\"mandatory\")&&void 0!==constraints.mandatory&&null!==constraints.mandatory&&constraints.mandatory.constructor!==Object,invalidConstraits|=constraints.hasOwnProperty(\"optional\")&&void 0!==constraints.optional&&null!==constraints.optional&&!Array.isArray(constraints.optional))throw new Error(\"Failed to construct 'RTCPeerConnection': Malformed constraints object\")}AdapterJS.WebRTCPlugin.WaitForPluginReady();var iceServers=null;if(servers&&Array.isArray(servers.iceServers)){iceServers=servers.iceServers;for(var i=0;i<iceServers.length;i++)iceServers[i].urls&&!iceServers[i].url&&(iceServers[i].url=iceServers[i].urls),iceServers[i].hasCredentials=AdapterJS.isDefined(iceServers[i].username)&&AdapterJS.isDefined(iceServers[i].credential)}if(AdapterJS.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION&&AdapterJS.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION>1)return iceServers&&(servers.iceServers=iceServers),AdapterJS.WebRTCPlugin.plugin.PeerConnection(servers);var mandatory=constraints&&constraints.mandatory?constraints.mandatory:null,optional=constraints&&constraints.optional?constraints.optional:null;return AdapterJS.WebRTCPlugin.plugin.PeerConnection(AdapterJS.WebRTCPlugin.pageId,iceServers,mandatory,optional)},MediaStreamTrack=function(){},MediaStreamTrack.getSources=function(callback){AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){AdapterJS.WebRTCPlugin.plugin.GetSources(callback)})};var constraintsToPlugin=function(c){if(\"object\"!=typeof c||c.mandatory||c.optional)return c;var cc={};return Object.keys(c).forEach(function(key){if(\"require\"!==key&&\"advanced\"!==key){if(\"string\"==typeof c[key])return void(cc[key]=c[key]);var r=\"object\"==typeof c[key]?c[key]:{ideal:c[key]};void 0!==r.exact&&\"number\"==typeof r.exact&&(r.min=r.max=r.exact);var oldname=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):\"deviceId\"===name?\"sourceId\":name};if(\"sourceId\"===oldname(\"\",key)&&void 0!==r.exact&&(r.ideal=r.exact,r.exact=void 0),void 0!==r.ideal){cc.optional=cc.optional||[];var oc={};\"number\"==typeof r.ideal?(oc[oldname(\"min\",key)]=r.ideal,cc.optional.push(oc),oc={},oc[oldname(\"max\",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname(\"\",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&\"number\"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname(\"\",key)]=r.exact):[\"min\",\"max\"].forEach(function(mix){void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname(mix,key)]=r[mix])})}}),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc};getUserMedia=function(constraints,successCallback,failureCallback){var cc={};cc.audio=!!constraints.audio&&constraintsToPlugin(constraints.audio),cc.video=!!constraints.video&&constraintsToPlugin(constraints.video),AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){AdapterJS.WebRTCPlugin.plugin.getUserMedia(cc,successCallback,failureCallback)})},window.navigator.getUserMedia=getUserMedia,navigator.mediaDevices||\"undefined\"==typeof Promise||(requestUserMedia=function(constraints){return new Promise(function(resolve,reject){try{getUserMedia(constraints,resolve,reject)}catch(error){reject(error)}})},navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(resolve){var kinds={audio:\"audioinput\",video:\"videoinput\"};return MediaStreamTrack.getSources(function(devices){resolve(devices.map(function(device){return{label:device.label,kind:kinds[device.kind],id:device.id,deviceId:device.id,groupId:\"\"}}))})})}}),attachMediaStream=function(element,stream){if(element&&element.parentNode){var streamId;null===stream?streamId=\"\":(\"undefined\"!=typeof stream.enableSoundTracks&&stream.enableSoundTracks(!0),streamId=stream.id);var elementId=0===element.id.length?Math.random().toString(36).slice(2):element.id,nodeName=element.nodeName.toLowerCase();if(\"object\"!==nodeName){var tag;switch(nodeName){case\"audio\":tag=AdapterJS.WebRTCPlugin.TAGS.AUDIO;break;case\"video\":tag=AdapterJS.WebRTCPlugin.TAGS.VIDEO;break;default:tag=AdapterJS.WebRTCPlugin.TAGS.NONE}var frag=document.createDocumentFragment(),temp=document.createElement(\"div\"),classHTML=\"\";for(element.className?classHTML='class=\"'+element.className+'\" ':element.attributes&&element.attributes.class&&(classHTML='class=\"'+element.attributes.class.value+'\" '),temp.innerHTML='<object id=\"'+elementId+'\" '+classHTML+'type=\"'+AdapterJS.WebRTCPlugin.pluginInfo.type+'\"><param name=\"pluginId\" value=\"'+elementId+'\" /> <param name=\"pageId\" value=\"'+AdapterJS.WebRTCPlugin.pageId+'\" /> <param name=\"windowless\" value=\"true\" /> <param name=\"streamId\" value=\"'+streamId+'\" /> <param name=\"tag\" value=\"'+tag+'\" /> </object>';temp.firstChild;)frag.appendChild(temp.firstChild);var height=\"\",width=\"\";element.clientWidth||element.clientHeight?(width=element.clientWidth,height=element.clientHeight):(element.width||element.height)&&(width=element.width,height=element.height),element.parentNode.insertBefore(frag,element),frag=document.getElementById(elementId),frag.width=width,frag.height=height,element.parentNode.removeChild(element)}else{for(var children=element.children,i=0;i!==children.length;++i)if(\"streamId\"===children[i].name){children[i].value=streamId;break}element.setStreamId(streamId)}var newElement=document.getElementById(elementId);return AdapterJS.forwardEventHandlers(newElement,element,Object.getPrototypeOf(element)),newElement}},reattachMediaStream=function(to,from){for(var stream=null,children=from.children,i=0;i!==children.length;++i)if(\"streamId\"===children[i].name){AdapterJS.WebRTCPlugin.WaitForPluginReady(),stream=AdapterJS.WebRTCPlugin.plugin.getStreamWithId(AdapterJS.WebRTCPlugin.pageId,children[i].value);break}if(null!==stream)return attachMediaStream(to,stream)},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,AdapterJS.attachMediaStream=attachMediaStream,AdapterJS.reattachMediaStream=reattachMediaStream,AdapterJS.getUserMedia=getUserMedia,AdapterJS.forwardEventHandlers=function(destElem,srcElem,prototype){var properties=Object.getOwnPropertyNames(prototype);for(var prop in properties)if(prop){var propName=properties[prop];\"function\"==typeof propName.slice&&\"on\"===propName.slice(0,2)&&\"function\"==typeof srcElem[propName]&&AdapterJS.addEvent(destElem,propName.slice(2),srcElem[propName])}var subPrototype=Object.getPrototypeOf(prototype);subPrototype&&AdapterJS.forwardEventHandlers(destElem,srcElem,subPrototype)},RTCIceCandidate=function(candidate){return candidate.sdpMid||(candidate.sdpMid=\"\"),AdapterJS.WebRTCPlugin.WaitForPluginReady(),AdapterJS.WebRTCPlugin.plugin.ConstructIceCandidate(candidate.sdpMid,candidate.sdpMLineIndex,candidate.candidate)},AdapterJS.addEvent(document,\"readystatechange\",AdapterJS.WebRTCPlugin.injectPlugin),AdapterJS.WebRTCPlugin.injectPlugin()}},AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCb=AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCb||function(){AdapterJS.addEvent(document,\"readystatechange\",AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCbPriv()},AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCbPriv=function(){if(!AdapterJS.options.hidePluginInstallPrompt){var downloadLink=AdapterJS.WebRTCPlugin.pluginInfo.downloadLink;if(downloadLink){var popupString;popupString=AdapterJS.WebRTCPlugin.pluginInfo.portalLink?'This website requires you to install the  <a href=\"'+AdapterJS.WebRTCPlugin.pluginInfo.portalLink+'\" target=\"_blank\">'+AdapterJS.WebRTCPlugin.pluginInfo.companyName+\" WebRTC Plugin</a> to work on this browser.\":AdapterJS.TEXT.PLUGIN.REQUIRE_INSTALLATION,AdapterJS.renderNotificationBar(popupString,AdapterJS.TEXT.PLUGIN.BUTTON,function(){window.open(downloadLink,\"_top\");var pluginInstallInterval=setInterval(function(){isIE||navigator.plugins.refresh(!1),AdapterJS.WebRTCPlugin.isPluginInstalled(AdapterJS.WebRTCPlugin.pluginInfo.prefix,AdapterJS.WebRTCPlugin.pluginInfo.plugName,AdapterJS.WebRTCPlugin.pluginInfo.type,function(){clearInterval(pluginInstallInterval),AdapterJS.WebRTCPlugin.defineWebRTCInterface()},function(){})},500)})}else AdapterJS.renderNotificationBar(AdapterJS.TEXT.PLUGIN.NOT_SUPPORTED)}},AdapterJS.WebRTCPlugin.isPluginInstalled(AdapterJS.WebRTCPlugin.pluginInfo.prefix,AdapterJS.WebRTCPlugin.pluginInfo.plugName,AdapterJS.WebRTCPlugin.pluginInfo.type,AdapterJS.WebRTCPlugin.defineWebRTCInterface,AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCb)):(navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)&&window.RTCPeerConnection&&(window.msRTCPeerConnection=window.RTCPeerConnection),function(f){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=f();else if(\"function\"==typeof define&&define.amd)define([],f);else{var g;g=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,g.adapter=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=\"function\"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i=\"function\"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(requirecopy,module,exports){\"use strict\";var SDPUtils={};SDPUtils.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(blob){return blob.trim().split(\"\\n\").map(function(line){return line.trim()})},SDPUtils.splitSections=function(blob){var parts=blob.split(\"\\nm=\");return parts.map(function(part,index){return(index>0?\"m=\"+part:part).trim()+\"\\r\\n\"})},SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter(function(line){return 0===line.indexOf(prefix)})},SDPUtils.parseCandidate=function(line){var parts;parts=0===line.indexOf(\"a=candidate:\")?line.substring(12).split(\" \"):line.substring(10).split(\" \");for(var candidate={foundation:parts[0],component:parts[1],protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],port:parseInt(parts[5],10),type:parts[7]},i=8;i<parts.length;i+=2)switch(parts[i]){case\"raddr\":candidate.relatedAddress=parts[i+1];break;case\"rport\":candidate.relatedPort=parseInt(parts[i+1],10);break;case\"tcptype\":candidate.tcpType=parts[i+1]}return candidate},SDPUtils.writeCandidate=function(candidate){var sdp=[];sdp.push(candidate.foundation),sdp.push(candidate.component),sdp.push(candidate.protocol.toUpperCase()),sdp.push(candidate.priority),sdp.push(candidate.ip),sdp.push(candidate.port);var type=candidate.type;return sdp.push(\"typ\"),sdp.push(type),\"host\"!==type&&candidate.relatedAddress&&candidate.relatedPort&&(sdp.push(\"raddr\"),sdp.push(candidate.relatedAddress),sdp.push(\"rport\"),sdp.push(candidate.relatedPort)),candidate.tcpType&&\"tcp\"===candidate.protocol.toLowerCase()&&(sdp.push(\"tcptype\"),sdp.push(candidate.tcpType)),\"candidate:\"+sdp.join(\" \")},SDPUtils.parseRtpMap=function(line){var parts=line.substr(9).split(\" \"),parsed={payloadType:parseInt(parts.shift(),10)};return parts=parts[0].split(\"/\"),parsed.name=parts[0],parsed.clockRate=parseInt(parts[1],10),parsed.numChannels=3===parts.length?parseInt(parts[2],10):1,parsed},SDPUtils.writeRtpMap=function(codec){var pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),\"a=rtpmap:\"+pt+\" \"+codec.name+\"/\"+codec.clockRate+(1!==codec.numChannels?\"/\"+codec.numChannels:\"\")+\"\\r\\n\"},SDPUtils.parseExtmap=function(line){var parts=line.substr(9).split(\" \");return{id:parseInt(parts[0],10),uri:parts[1]}},SDPUtils.writeExtmap=function(headerExtension){return\"a=extmap:\"+(headerExtension.id||headerExtension.preferredId)+\" \"+headerExtension.uri+\"\\r\\n\"},SDPUtils.parseFmtp=function(line){for(var kv,parsed={},parts=line.substr(line.indexOf(\" \")+1).split(\";\"),j=0;j<parts.length;j++)kv=parts[j].trim().split(\"=\"),parsed[kv[0].trim()]=kv[1];return parsed},SDPUtils.writeFmtp=function(codec){var line=\"\",pt=codec.payloadType;if(void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.parameters&&Object.keys(codec.parameters).length){var params=[];Object.keys(codec.parameters).forEach(function(param){params.push(param+\"=\"+codec.parameters[param])}),line+=\"a=fmtp:\"+pt+\" \"+params.join(\";\")+\"\\r\\n\"}return line},SDPUtils.parseRtcpFb=function(line){var parts=line.substr(line.indexOf(\" \")+1).split(\" \");return{type:parts.shift(),parameter:parts.join(\" \")}},SDPUtils.writeRtcpFb=function(codec){var lines=\"\",pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.rtcpFeedback&&codec.rtcpFeedback.length&&codec.rtcpFeedback.forEach(function(fb){lines+=\"a=rtcp-fb:\"+pt+\" \"+fb.type+(fb.parameter&&fb.parameter.length?\" \"+fb.parameter:\"\")+\"\\r\\n\"}),lines},SDPUtils.parseSsrcMedia=function(line){var sp=line.indexOf(\" \"),parts={ssrc:parseInt(line.substr(7,sp-7),10)},colon=line.indexOf(\":\",sp);return colon>-1?(parts.attribute=line.substr(sp+1,colon-sp-1),parts.value=line.substr(colon+1)):parts.attribute=line.substr(sp+1),parts},SDPUtils.getMid=function(mediaSection){var mid=SDPUtils.matchPrefix(mediaSection,\"a=mid:\")[0];if(mid)return mid.substr(6)},SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);lines=lines.concat(SDPUtils.splitLines(sessionpart));var fpLine=lines.filter(function(line){return 0===line.indexOf(\"a=fingerprint:\")})[0].substr(14),dtlsParameters={role:\"auto\",fingerprints:[{algorithm:fpLine.split(\" \")[0].toLowerCase(),value:fpLine.split(\" \")[1]}]};return dtlsParameters},SDPUtils.writeDtlsParameters=function(params,setupType){var sdp=\"a=setup:\"+setupType+\"\\r\\n\";return params.fingerprints.forEach(function(fp){sdp+=\"a=fingerprint:\"+fp.algorithm+\" \"+fp.value+\"\\r\\n\"}),sdp},SDPUtils.getIceParameters=function(mediaSection,sessionpart){var lines=SDPUtils.splitLines(mediaSection);lines=lines.concat(SDPUtils.splitLines(sessionpart));var iceParameters={usernameFragment:lines.filter(function(line){return 0===line.indexOf(\"a=ice-ufrag:\")})[0].substr(12),password:lines.filter(function(line){return 0===line.indexOf(\"a=ice-pwd:\")})[0].substr(10)};return iceParameters},SDPUtils.writeIceParameters=function(params){return\"a=ice-ufrag:\"+params.usernameFragment+\"\\r\\na=ice-pwd:\"+params.password+\"\\r\\n\"},SDPUtils.parseRtpParameters=function(mediaSection){for(var description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},lines=SDPUtils.splitLines(mediaSection),mline=lines[0].split(\" \"),i=3;i<mline.length;i++){var pt=mline[i],rtpmapline=SDPUtils.matchPrefix(mediaSection,\"a=rtpmap:\"+pt+\" \")[0];if(rtpmapline){var codec=SDPUtils.parseRtpMap(rtpmapline),fmtps=SDPUtils.matchPrefix(mediaSection,\"a=fmtp:\"+pt+\" \");switch(codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{},codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,\"a=rtcp-fb:\"+pt+\" \").map(SDPUtils.parseRtcpFb),description.codecs.push(codec),codec.name.toUpperCase()){case\"RED\":case\"ULPFEC\":description.fecMechanisms.push(codec.name.toUpperCase())}}}return SDPUtils.matchPrefix(mediaSection,\"a=extmap:\").forEach(function(line){\ndescription.headerExtensions.push(SDPUtils.parseExtmap(line))}),description},SDPUtils.writeRtpDescription=function(kind,caps){var sdp=\"\";sdp+=\"m=\"+kind+\" \",sdp+=caps.codecs.length>0?\"9\":\"0\",sdp+=\" UDP/TLS/RTP/SAVPF \",sdp+=caps.codecs.map(function(codec){return void 0!==codec.preferredPayloadType?codec.preferredPayloadType:codec.payloadType}).join(\" \")+\"\\r\\n\",sdp+=\"c=IN IP4 0.0.0.0\\r\\n\",sdp+=\"a=rtcp:9 IN IP4 0.0.0.0\\r\\n\",caps.codecs.forEach(function(codec){sdp+=SDPUtils.writeRtpMap(codec),sdp+=SDPUtils.writeFmtp(codec),sdp+=SDPUtils.writeRtcpFb(codec)});var maxptime=0;return caps.codecs.forEach(function(codec){codec.maxptime>maxptime&&(maxptime=codec.maxptime)}),maxptime>0&&(sdp+=\"a=maxptime:\"+maxptime+\"\\r\\n\"),sdp+=\"a=rtcp-mux\\r\\n\",caps.headerExtensions.forEach(function(extension){sdp+=SDPUtils.writeExtmap(extension)}),sdp},SDPUtils.parseRtpEncodingParameters=function(mediaSection){var secondarySsrc,encodingParameters=[],description=SDPUtils.parseRtpParameters(mediaSection),hasRed=description.fecMechanisms.indexOf(\"RED\")!==-1,hasUlpfec=description.fecMechanisms.indexOf(\"ULPFEC\")!==-1,ssrcs=SDPUtils.matchPrefix(mediaSection,\"a=ssrc:\").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(parts){return\"cname\"===parts.attribute}),primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc,flows=SDPUtils.matchPrefix(mediaSection,\"a=ssrc-group:FID\").map(function(line){var parts=line.split(\" \");return parts.shift(),parts.map(function(part){return parseInt(part,10)})});flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc&&(secondarySsrc=flows[0][1]),description.codecs.forEach(function(codec){if(\"RTX\"===codec.name.toUpperCase()&&codec.parameters.apt){var encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10),rtx:{ssrc:secondarySsrc}};encodingParameters.push(encParam),hasRed&&(encParam=JSON.parse(JSON.stringify(encParam)),encParam.fec={ssrc:secondarySsrc,mechanism:hasUlpfec?\"red+ulpfec\":\"red\"},encodingParameters.push(encParam))}}),0===encodingParameters.length&&primarySsrc&&encodingParameters.push({ssrc:primarySsrc});var bandwidth=SDPUtils.matchPrefix(mediaSection,\"b=\");return bandwidth.length&&(0===bandwidth[0].indexOf(\"b=TIAS:\")?bandwidth=parseInt(bandwidth[0].substr(7),10):0===bandwidth[0].indexOf(\"b=AS:\")&&(bandwidth=parseInt(bandwidth[0].substr(5),10)),encodingParameters.forEach(function(params){params.maxBitrate=bandwidth})),encodingParameters},SDPUtils.parseRtcpParameters=function(mediaSection){var rtcpParameters={},remoteSsrc=SDPUtils.matchPrefix(mediaSection,\"a=ssrc:\").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(obj){return\"cname\"===obj.attribute})[0];remoteSsrc&&(rtcpParameters.cname=remoteSsrc.value,rtcpParameters.ssrc=remoteSsrc.ssrc);var rsize=SDPUtils.matchPrefix(mediaSection,\"a=rtcp-rsize\");rtcpParameters.reducedSize=rsize.length>0,rtcpParameters.compound=0===rsize.length;var mux=SDPUtils.matchPrefix(mediaSection,\"a=rtcp-mux\");return rtcpParameters.mux=mux.length>0,rtcpParameters},SDPUtils.parseMsid=function(mediaSection){var parts,spec=SDPUtils.matchPrefix(mediaSection,\"a=msid:\");if(1===spec.length)return parts=spec[0].substr(7).split(\" \"),{stream:parts[0],track:parts[1]};var planB=SDPUtils.matchPrefix(mediaSection,\"a=ssrc:\").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(parts){return\"msid\"===parts.attribute});return planB.length>0?(parts=planB[0].value.split(\" \"),{stream:parts[0],track:parts[1]}):void 0},SDPUtils.writeSessionBoilerplate=function(){return\"v=0\\r\\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\\r\\ns=-\\r\\nt=0 0\\r\\n\"},SDPUtils.writeMediaSection=function(transceiver,caps,type,stream){var sdp=SDPUtils.writeRtpDescription(transceiver.kind,caps);if(sdp+=SDPUtils.writeIceParameters(transceiver.iceGatherer.getLocalParameters()),sdp+=SDPUtils.writeDtlsParameters(transceiver.dtlsTransport.getLocalParameters(),\"offer\"===type?\"actpass\":\"active\"),sdp+=\"a=mid:\"+transceiver.mid+\"\\r\\n\",sdp+=transceiver.rtpSender&&transceiver.rtpReceiver?\"a=sendrecv\\r\\n\":transceiver.rtpSender?\"a=sendonly\\r\\n\":transceiver.rtpReceiver?\"a=recvonly\\r\\n\":\"a=inactive\\r\\n\",transceiver.rtpSender){var msid=\"msid:\"+stream.id+\" \"+transceiver.rtpSender.track.id+\"\\r\\n\";sdp+=\"a=\"+msid,sdp+=\"a=ssrc:\"+transceiver.sendEncodingParameters[0].ssrc+\" \"+msid,transceiver.sendEncodingParameters[0].rtx&&(sdp+=\"a=ssrc:\"+transceiver.sendEncodingParameters[0].rtx.ssrc+\" \"+msid,sdp+=\"a=ssrc-group:FID \"+transceiver.sendEncodingParameters[0].ssrc+\" \"+transceiver.sendEncodingParameters[0].rtx.ssrc+\"\\r\\n\")}return sdp+=\"a=ssrc:\"+transceiver.sendEncodingParameters[0].ssrc+\" cname:\"+SDPUtils.localCName+\"\\r\\n\",transceiver.rtpSender&&transceiver.sendEncodingParameters[0].rtx&&(sdp+=\"a=ssrc:\"+transceiver.sendEncodingParameters[0].rtx.ssrc+\" cname:\"+SDPUtils.localCName+\"\\r\\n\"),sdp},SDPUtils.getDirection=function(mediaSection,sessionpart){for(var lines=SDPUtils.splitLines(mediaSection),i=0;i<lines.length;i++)switch(lines[i]){case\"a=sendrecv\":case\"a=sendonly\":case\"a=recvonly\":case\"a=inactive\":return lines[i].substr(2)}return sessionpart?SDPUtils.getDirection(sessionpart):\"sendrecv\"},SDPUtils.getKind=function(mediaSection){var lines=SDPUtils.splitLines(mediaSection),mline=lines[0].split(\" \");return mline[0].substr(2)},SDPUtils.isRejected=function(mediaSection){return\"0\"===mediaSection.split(\" \",2)[1]},module.exports=SDPUtils},{}],2:[function(requirecopy,module,exports){\"use strict\";!function(){var logging=requirecopy(\"./utils\").log,browserDetails=requirecopy(\"./utils\").browserDetails;module.exports.browserDetails=browserDetails,module.exports.extractVersion=requirecopy(\"./utils\").extractVersion,module.exports.disableLog=requirecopy(\"./utils\").disableLog;var chromeShim=requirecopy(\"./chrome/chrome_shim\")||null,edgeShim=requirecopy(\"./edge/edge_shim\")||null,firefoxShim=requirecopy(\"./firefox/firefox_shim\")||null,safariShim=requirecopy(\"./safari/safari_shim\")||null;switch(browserDetails.browser){case\"opera\":case\"chrome\":if(!chromeShim||!chromeShim.shimPeerConnection)return void logging(\"Chrome shim is not included in this adapter release.\");logging(\"adapter.js shimming chrome.\"),module.exports.browserShim=chromeShim,chromeShim.shimGetUserMedia(),chromeShim.shimMediaStream(),chromeShim.shimSourceObject(),chromeShim.shimPeerConnection(),chromeShim.shimOnTrack();break;case\"firefox\":if(!firefoxShim||!firefoxShim.shimPeerConnection)return void logging(\"Firefox shim is not included in this adapter release.\");logging(\"adapter.js shimming firefox.\"),module.exports.browserShim=firefoxShim,firefoxShim.shimGetUserMedia(),firefoxShim.shimSourceObject(),firefoxShim.shimPeerConnection(),firefoxShim.shimOnTrack();break;case\"edge\":if(!edgeShim||!edgeShim.shimPeerConnection)return void logging(\"MS edge shim is not included in this adapter release.\");logging(\"adapter.js shimming edge.\"),module.exports.browserShim=edgeShim,edgeShim.shimGetUserMedia(),edgeShim.shimPeerConnection();break;case\"safari\":if(!safariShim)return void logging(\"Safari shim is not included in this adapter release.\");logging(\"adapter.js shimming safari.\"),module.exports.browserShim=safariShim,safariShim.shimGetUserMedia();break;default:logging(\"Unsupported browser!\")}}()},{\"./chrome/chrome_shim\":3,\"./edge/edge_shim\":5,\"./firefox/firefox_shim\":7,\"./safari/safari_shim\":9,\"./utils\":10}],3:[function(requirecopy,module,exports){\"use strict\";var logging=requirecopy(\"../utils.js\").log,browserDetails=requirecopy(\"../utils.js\").browserDetails,chromeShim={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){\"object\"!=typeof window||!window.RTCPeerConnection||\"ontrack\"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,\"ontrack\",{get:function(){return this._ontrack},set:function(f){var self=this;this._ontrack&&(this.removeEventListener(\"track\",this._ontrack),this.removeEventListener(\"addstream\",this._ontrackpoly)),this.addEventListener(\"track\",this._ontrack=f),this.addEventListener(\"addstream\",this._ontrackpoly=function(e){e.stream.addEventListener(\"addtrack\",function(te){var event=new Event(\"track\");event.track=te.track,event.receiver={track:te.track},event.streams=[e.stream],self.dispatchEvent(event)}),e.stream.getTracks().forEach(function(track){var event=new Event(\"track\");event.track=track,event.receiver={track:track},event.streams=[e.stream],this.dispatchEvent(event)}.bind(this))}.bind(this))}})},shimSourceObject:function(){\"object\"==typeof window&&(!window.HTMLMediaElement||\"srcObject\"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,\"srcObject\",{get:function(){return this._srcObject},set:function(stream){var self=this;return this._srcObject=stream,this.src&&URL.revokeObjectURL(this.src),stream?(this.src=URL.createObjectURL(stream),stream.addEventListener(\"addtrack\",function(){self.src&&URL.revokeObjectURL(self.src),self.src=URL.createObjectURL(stream)}),void stream.addEventListener(\"removetrack\",function(){self.src&&URL.revokeObjectURL(self.src),self.src=URL.createObjectURL(stream)})):void(this.src=\"\")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(pcConfig,pcConstraints){logging(\"PeerConnection\"),pcConfig&&pcConfig.iceTransportPolicy&&(pcConfig.iceTransports=pcConfig.iceTransportPolicy);var pc=new webkitRTCPeerConnection(pcConfig,pcConstraints),origGetStats=pc.getStats.bind(pc);return pc.getStats=function(selector,successCallback,errorCallback){var self=this,args=arguments;if(arguments.length>0&&\"function\"==typeof selector)return origGetStats(selector,successCallback);var fixChromeStats_=function(response){var standardReport={},reports=response.result();return reports.forEach(function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:report.type};report.names().forEach(function(name){standardStats[name]=report.stat(name)}),standardReport[standardStats.id]=standardStats}),standardReport},makeMapStats=function(stats,legacyStats){var map=new Map(Object.keys(stats).map(function(key){return[key,stats[key]]}));return legacyStats=legacyStats||stats,Object.keys(legacyStats).forEach(function(key){map[key]=legacyStats[key]}),map};if(arguments.length>=2){var successCallbackWrapper_=function(response){args[1](makeMapStats(fixChromeStats_(response)))};return origGetStats.apply(this,[successCallbackWrapper_,arguments[0]])}return new Promise(function(resolve,reject){1===args.length&&\"object\"==typeof selector?origGetStats.apply(self,[function(response){resolve(makeMapStats(fixChromeStats_(response)))},reject]):origGetStats.apply(self,[function(response){resolve(makeMapStats(fixChromeStats_(response),response.result()))},reject])}).then(successCallback,errorCallback)},pc},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,\"generateCertificate\",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),[\"createOffer\",\"createAnswer\"].forEach(function(method){var nativeMethod=webkitRTCPeerConnection.prototype[method];webkitRTCPeerConnection.prototype[method]=function(){var self=this;if(arguments.length<1||1===arguments.length&&\"object\"==typeof arguments[0]){var opts=1===arguments.length?arguments[0]:void 0;return new Promise(function(resolve,reject){nativeMethod.apply(self,[resolve,reject,opts])})}return nativeMethod.apply(this,arguments)}}),browserDetails.version<51&&[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach(function(method){var nativeMethod=webkitRTCPeerConnection.prototype[method];webkitRTCPeerConnection.prototype[method]=function(){var args=arguments,self=this,promise=new Promise(function(resolve,reject){nativeMethod.apply(self,[args[0],resolve,reject])});return args.length<2?promise:promise.then(function(){args[1].apply(null,[])},function(err){args.length>=3&&args[2].apply(null,[err])})}}),[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach(function(method){var nativeMethod=webkitRTCPeerConnection.prototype[method];webkitRTCPeerConnection.prototype[method]=function(){return arguments[0]=new(\"addIceCandidate\"===method?RTCIceCandidate:RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}});var nativeAddIceCandidate=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():nativeAddIceCandidate.apply(this,arguments)}}};module.exports={shimMediaStream:chromeShim.shimMediaStream,shimOnTrack:chromeShim.shimOnTrack,shimSourceObject:chromeShim.shimSourceObject,shimPeerConnection:chromeShim.shimPeerConnection,shimGetUserMedia:requirecopy(\"./getusermedia\")}},{\"../utils.js\":10,\"./getusermedia\":4}],4:[function(requirecopy,module,exports){\"use strict\";var logging=requirecopy(\"../utils.js\").log;module.exports=function(){var constraintsToChrome_=function(c){if(\"object\"!=typeof c||c.mandatory||c.optional)return c;var cc={};return Object.keys(c).forEach(function(key){if(\"require\"!==key&&\"advanced\"!==key&&\"mediaSource\"!==key){var r=\"object\"==typeof c[key]?c[key]:{ideal:c[key]};void 0!==r.exact&&\"number\"==typeof r.exact&&(r.min=r.max=r.exact);var oldname_=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):\"deviceId\"===name?\"sourceId\":name};if(void 0!==r.ideal){cc.optional=cc.optional||[];var oc={};\"number\"==typeof r.ideal?(oc[oldname_(\"min\",key)]=r.ideal,cc.optional.push(oc),oc={},oc[oldname_(\"max\",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname_(\"\",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&\"number\"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(\"\",key)]=r.exact):[\"min\",\"max\"].forEach(function(mix){void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(mix,key)]=r[mix])})}}),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc},shimConstraints_=function(constraints,func){if(constraints=JSON.parse(JSON.stringify(constraints)),constraints&&constraints.audio&&(constraints.audio=constraintsToChrome_(constraints.audio)),constraints&&\"object\"==typeof constraints.video){var face=constraints.video.facingMode;if(face=face&&(\"object\"==typeof face?face:{ideal:face}),face&&(\"user\"===face.exact||\"environment\"===face.exact||\"user\"===face.ideal||\"environment\"===face.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete constraints.video.facingMode,\"environment\"===face.exact||\"environment\"===face.ideal))return navigator.mediaDevices.enumerateDevices().then(function(devices){devices=devices.filter(function(d){return\"videoinput\"===d.kind});var back=devices.find(function(d){return d.label.toLowerCase().indexOf(\"back\")!==-1})||devices.length&&devices[devices.length-1];return back&&(constraints.video.deviceId=face.exact?{exact:back.deviceId}:{ideal:back.deviceId}),constraints.video=constraintsToChrome_(constraints.video),logging(\"chrome: \"+JSON.stringify(constraints)),func(constraints)});constraints.video=constraintsToChrome_(constraints.video)}return logging(\"chrome: \"+JSON.stringify(constraints)),func(constraints)},shimError_=function(e){return{name:{PermissionDeniedError:\"NotAllowedError\",ConstraintNotSatisfiedError:\"OverconstrainedError\"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&\": \")+this.message}}},getUserMedia_=function(constraints,onSuccess,onError){shimConstraints_(constraints,function(c){navigator.webkitGetUserMedia(c,onSuccess,function(e){onError(shimError_(e))})})};navigator.getUserMedia=getUserMedia_;var getUserMediaPromise_=function(constraints){return new Promise(function(resolve,reject){navigator.getUserMedia(constraints,resolve,reject)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:getUserMediaPromise_,enumerateDevices:function(){return new Promise(function(resolve){var kinds={audio:\"audioinput\",video:\"videoinput\"};return MediaStreamTrack.getSources(function(devices){resolve(devices.map(function(device){return{label:device.label,kind:kinds[device.kind],deviceId:device.id,groupId:\"\"}}))})})}}),navigator.mediaDevices.getUserMedia){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,function(c){return origGetUserMedia(c).catch(function(e){return Promise.reject(shimError_(e))})})}}else navigator.mediaDevices.getUserMedia=function(constraints){return getUserMediaPromise_(constraints)};\"undefined\"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){logging(\"Dummy mediaDevices.addEventListener called.\")}),\"undefined\"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){logging(\"Dummy mediaDevices.removeEventListener called.\")})}},{\"../utils.js\":10}],5:[function(requirecopy,module,exports){\"use strict\";var SDPUtils=requirecopy(\"sdp\"),browserDetails=requirecopy(\"../utils\").browserDetails,edgeShim={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(args){return args}),window.RTCSessionDescription||(window.RTCSessionDescription=function(args){return args})),window.RTCPeerConnection=function(config){var self=this,_eventTarget=document.createDocumentFragment();if([\"addEventListener\",\"removeEventListener\",\"dispatchEvent\"].forEach(function(method){self[method]=_eventTarget[method].bind(_eventTarget)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return self.localStreams},this.getRemoteStreams=function(){return self.remoteStreams},this.localDescription=new RTCSessionDescription({type:\"\",sdp:\"\"}),this.remoteDescription=new RTCSessionDescription({type:\"\",sdp:\"\"}),this.signalingState=\"stable\",this.iceConnectionState=\"new\",this.iceGatheringState=\"new\",this.iceOptions={gatherPolicy:\"all\",iceServers:[]},config&&config.iceTransportPolicy)switch(config.iceTransportPolicy){case\"all\":case\"relay\":this.iceOptions.gatherPolicy=config.iceTransportPolicy;break;case\"none\":throw new TypeError('iceTransportPolicy \"none\" not supported')}if(this.usingBundle=config&&\"max-bundle\"===config.bundlePolicy,config&&config.iceServers){var iceServers=JSON.parse(JSON.stringify(config.iceServers));this.iceOptions.iceServers=iceServers.filter(function(server){if(server&&server.urls){var urls=server.urls;return\"string\"==typeof urls&&(urls=[urls]),urls=urls.filter(function(url){return 0===url.indexOf(\"turn:\")&&url.indexOf(\"transport=udp\")!==-1&&url.indexOf(\"turn:[\")===-1||0===url.indexOf(\"stun:\")&&browserDetails.version>=14393})[0],!!urls}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var self=this,sections=SDPUtils.splitSections(self.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(event){var end=!event.candidate||0===Object.keys(event.candidate).length;if(end)for(var j=1;j<sections.length;j++)sections[j].indexOf(\"\\r\\na=end-of-candidates\\r\\n\")===-1&&(sections[j]+=\"a=end-of-candidates\\r\\n\");else event.candidate.candidate.indexOf(\"typ endOfCandidates\")===-1&&(sections[event.candidate.sdpMLineIndex+1]+=\"a=\"+event.candidate.candidate+\"\\r\\n\");if(self.localDescription.sdp=sections.join(\"\"),self.dispatchEvent(event),null!==self.onicecandidate&&self.onicecandidate(event),!event.candidate&&\"complete\"!==self.iceGatheringState){var complete=self.transceivers.every(function(transceiver){return transceiver.iceGatherer&&\"completed\"===transceiver.iceGatherer.state});complete&&(self.iceGatheringState=\"complete\")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(stream){this.localStreams.push(stream.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(stream){var idx=this.localStreams.indexOf(stream);idx>-1&&(this.localStreams.splice(idx,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(transceiver){return!!transceiver.rtpSender}).map(function(transceiver){return transceiver.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(transceiver){return!!transceiver.rtpReceiver}).map(function(transceiver){return transceiver.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(localCapabilities,remoteCapabilities){var commonCapabilities={codecs:[],headerExtensions:[],fecMechanisms:[]};return localCapabilities.codecs.forEach(function(lCodec){for(var i=0;i<remoteCapabilities.codecs.length;i++){var rCodec=remoteCapabilities.codecs[i];if(lCodec.name.toLowerCase()===rCodec.name.toLowerCase()&&lCodec.clockRate===rCodec.clockRate&&lCodec.numChannels===rCodec.numChannels){commonCapabilities.codecs.push(rCodec),rCodec.rtcpFeedback=rCodec.rtcpFeedback.filter(function(fb){for(var j=0;j<lCodec.rtcpFeedback.length;j++)if(lCodec.rtcpFeedback[j].type===fb.type&&lCodec.rtcpFeedback[j].parameter===fb.parameter)return!0;return!1});break}}}),localCapabilities.headerExtensions.forEach(function(lHeaderExtension){for(var i=0;i<remoteCapabilities.headerExtensions.length;i++){var rHeaderExtension=remoteCapabilities.headerExtensions[i];if(lHeaderExtension.uri===rHeaderExtension.uri){commonCapabilities.headerExtensions.push(rHeaderExtension);break}}}),commonCapabilities},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(mid,sdpMLineIndex){var self=this,iceGatherer=new RTCIceGatherer(self.iceOptions),iceTransport=new RTCIceTransport(iceGatherer);iceGatherer.onlocalcandidate=function(evt){var event=new Event(\"icecandidate\");event.candidate={sdpMid:mid,sdpMLineIndex:sdpMLineIndex};var cand=evt.candidate,end=!cand||0===Object.keys(cand).length;end?(void 0===iceGatherer.state&&(iceGatherer.state=\"completed\"),event.candidate.candidate=\"candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates\"):(cand.component=\"RTCP\"===iceTransport.component?2:1,event.candidate.candidate=SDPUtils.writeCandidate(cand));var sections=SDPUtils.splitSections(self.localDescription.sdp);event.candidate.candidate.indexOf(\"typ endOfCandidates\")===-1?sections[event.candidate.sdpMLineIndex+1]+=\"a=\"+event.candidate.candidate+\"\\r\\n\":sections[event.candidate.sdpMLineIndex+1]+=\"a=end-of-candidates\\r\\n\",self.localDescription.sdp=sections.join(\"\");var complete=self.transceivers.every(function(transceiver){return transceiver.iceGatherer&&\"completed\"===transceiver.iceGatherer.state});switch(self.iceGatheringState){case\"new\":self._localIceCandidatesBuffer.push(event),end&&complete&&self._localIceCandidatesBuffer.push(new Event(\"icecandidate\"));break;case\"gathering\":self._emitBufferedCandidates(),self.dispatchEvent(event),null!==self.onicecandidate&&self.onicecandidate(event),complete&&(self.dispatchEvent(new Event(\"icecandidate\")),null!==self.onicecandidate&&self.onicecandidate(new Event(\"icecandidate\")),self.iceGatheringState=\"complete\");break;case\"complete\":}},iceTransport.onicestatechange=function(){self._updateConnectionState()};var dtlsTransport=new RTCDtlsTransport(iceTransport);return dtlsTransport.ondtlsstatechange=function(){self._updateConnectionState()},dtlsTransport.onerror=function(){dtlsTransport.state=\"failed\",self._updateConnectionState()},{iceGatherer:iceGatherer,iceTransport:iceTransport,dtlsTransport:dtlsTransport}},window.RTCPeerConnection.prototype._transceive=function(transceiver,send,recv){var params=this._getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);send&&transceiver.rtpSender&&(params.encodings=transceiver.sendEncodingParameters,params.rtcp={cname:SDPUtils.localCName},transceiver.recvEncodingParameters.length&&(params.rtcp.ssrc=transceiver.recvEncodingParameters[0].ssrc),transceiver.rtpSender.send(params)),recv&&transceiver.rtpReceiver&&(params.encodings=transceiver.recvEncodingParameters,params.rtcp={cname:transceiver.cname},transceiver.sendEncodingParameters.length&&(params.rtcp.ssrc=transceiver.sendEncodingParameters[0].ssrc),transceiver.rtpReceiver.receive(params))},window.RTCPeerConnection.prototype.setLocalDescription=function(description){var sections,sessionpart,self=this;if(\"offer\"===description.type)this._pendingOffer&&(sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),sections.forEach(function(mediaSection,sdpMLineIndex){var caps=SDPUtils.parseRtpParameters(mediaSection);self._pendingOffer[sdpMLineIndex].localCapabilities=caps}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if(\"answer\"===description.type){sections=SDPUtils.splitSections(self.remoteDescription.sdp),sessionpart=sections.shift();var isIceLite=SDPUtils.matchPrefix(sessionpart,\"a=ice-lite\").length>0;sections.forEach(function(mediaSection,sdpMLineIndex){var transceiver=self.transceivers[sdpMLineIndex],iceGatherer=transceiver.iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,localCapabilities=transceiver.localCapabilities,remoteCapabilities=transceiver.remoteCapabilities,rejected=\"0\"===mediaSection.split(\"\\n\",1)[0].split(\" \",2)[1];if(!rejected&&!transceiver.isDatachannel){var remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart);if(isIceLite){var cands=SDPUtils.matchPrefix(mediaSection,\"a=candidate:\").map(function(cand){return SDPUtils.parseCandidate(cand)}).filter(function(cand){return\"1\"===cand.component});cands.length&&iceTransport.setRemoteCandidates(cands)}var remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart);isIceLite&&(remoteDtlsParameters.role=\"server\"),self.usingBundle&&0!==sdpMLineIndex||(iceTransport.start(iceGatherer,remoteIceParameters,isIceLite?\"controlling\":\"controlled\"),dtlsTransport.start(remoteDtlsParameters));var params=self._getCommonCapabilities(localCapabilities,remoteCapabilities);self._transceive(transceiver,params.codecs.length>0,!1)}})}switch(this.localDescription={type:description.type,sdp:description.sdp},description.type){case\"offer\":this._updateSignalingState(\"have-local-offer\");break;case\"answer\":this._updateSignalingState(\"stable\");break;default:throw new TypeError('unsupported type \"'+description.type+'\"')}var hasCallback=arguments.length>1&&\"function\"==typeof arguments[1];if(hasCallback){var cb=arguments[1];window.setTimeout(function(){cb(),\"new\"===self.iceGatheringState&&(self.iceGatheringState=\"gathering\"),self._emitBufferedCandidates()},0)}var p=Promise.resolve();return p.then(function(){hasCallback||(\"new\"===self.iceGatheringState&&(self.iceGatheringState=\"gathering\"),window.setTimeout(self._emitBufferedCandidates.bind(self),500))}),p},window.RTCPeerConnection.prototype.setRemoteDescription=function(description){var self=this,stream=new MediaStream,receiverList=[],sections=SDPUtils.splitSections(description.sdp),sessionpart=sections.shift(),isIceLite=SDPUtils.matchPrefix(sessionpart,\"a=ice-lite\").length>0;switch(this.usingBundle=SDPUtils.matchPrefix(sessionpart,\"a=group:BUNDLE \").length>0,sections.forEach(function(mediaSection,sdpMLineIndex){var lines=SDPUtils.splitLines(mediaSection),mline=lines[0].substr(2).split(\" \"),kind=mline[0],rejected=\"0\"===mline[1],direction=SDPUtils.getDirection(mediaSection,sessionpart),mid=SDPUtils.matchPrefix(mediaSection,\"a=mid:\");if(mid=mid.length?mid[0].substr(6):SDPUtils.generateIdentifier(),\"application\"===kind&&\"DTLS/SCTP\"===mline[2])return void(self.transceivers[sdpMLineIndex]={mid:mid,isDatachannel:!0});var transceiver,iceGatherer,iceTransport,dtlsTransport,rtpSender,rtpReceiver,sendEncodingParameters,recvEncodingParameters,localCapabilities,track,remoteIceParameters,remoteDtlsParameters,remoteCapabilities=SDPUtils.parseRtpParameters(mediaSection);rejected||(remoteIceParameters=SDPUtils.getIceParameters(mediaSection,sessionpart),remoteDtlsParameters=SDPUtils.getDtlsParameters(mediaSection,sessionpart),remoteDtlsParameters.role=\"client\"),recvEncodingParameters=SDPUtils.parseRtpEncodingParameters(mediaSection);var cname,remoteSsrc=SDPUtils.matchPrefix(mediaSection,\"a=ssrc:\").map(function(line){return SDPUtils.parseSsrcMedia(line)}).filter(function(obj){return\"cname\"===obj.attribute})[0];remoteSsrc&&(cname=remoteSsrc.value);var isComplete=SDPUtils.matchPrefix(mediaSection,\"a=end-of-candidates\",sessionpart).length>0,cands=SDPUtils.matchPrefix(mediaSection,\"a=candidate:\").map(function(cand){return SDPUtils.parseCandidate(cand)}).filter(function(cand){return\"1\"===cand.component});if(\"offer\"!==description.type||rejected)\"answer\"!==description.type||rejected||(transceiver=self.transceivers[sdpMLineIndex],iceGatherer=transceiver.iceGatherer,iceTransport=transceiver.iceTransport,dtlsTransport=transceiver.dtlsTransport,rtpSender=transceiver.rtpSender,rtpReceiver=transceiver.rtpReceiver,sendEncodingParameters=transceiver.sendEncodingParameters,localCapabilities=transceiver.localCapabilities,self.transceivers[sdpMLineIndex].recvEncodingParameters=recvEncodingParameters,self.transceivers[sdpMLineIndex].remoteCapabilities=remoteCapabilities,self.transceivers[sdpMLineIndex].cname=cname,(isIceLite||isComplete)&&cands.length&&iceTransport.setRemoteCandidates(cands),self.usingBundle&&0!==sdpMLineIndex||(iceTransport.start(iceGatherer,remoteIceParameters,\"controlling\"),dtlsTransport.start(remoteDtlsParameters)),self._transceive(transceiver,\"sendrecv\"===direction||\"recvonly\"===direction,\"sendrecv\"===direction||\"sendonly\"===direction),!rtpReceiver||\"sendrecv\"!==direction&&\"sendonly\"!==direction?delete transceiver.rtpReceiver:(track=rtpReceiver.track,receiverList.push([track,rtpReceiver]),stream.addTrack(track)));else{var transports=self.usingBundle&&sdpMLineIndex>0?{iceGatherer:self.transceivers[0].iceGatherer,iceTransport:self.transceivers[0].iceTransport,dtlsTransport:self.transceivers[0].dtlsTransport}:self._createIceAndDtlsTransports(mid,sdpMLineIndex);if(isComplete&&transports.iceTransport.setRemoteCandidates(cands),localCapabilities=RTCRtpReceiver.getCapabilities(kind),sendEncodingParameters=[{ssrc:1001*(2*sdpMLineIndex+2)}],rtpReceiver=new RTCRtpReceiver(transports.dtlsTransport,kind),track=rtpReceiver.track,receiverList.push([track,rtpReceiver]),stream.addTrack(track),self.localStreams.length>0&&self.localStreams[0].getTracks().length>=sdpMLineIndex){var localTrack;\"audio\"===kind?localTrack=self.localStreams[0].getAudioTracks()[0]:\"video\"===kind&&(localTrack=self.localStreams[0].getVideoTracks()[0]),localTrack&&(rtpSender=new RTCRtpSender(localTrack,transports.dtlsTransport))}self.transceivers[sdpMLineIndex]={iceGatherer:transports.iceGatherer,iceTransport:transports.iceTransport,dtlsTransport:transports.dtlsTransport,localCapabilities:localCapabilities,remoteCapabilities:remoteCapabilities,rtpSender:rtpSender,rtpReceiver:rtpReceiver,kind:kind,mid:mid,cname:cname,sendEncodingParameters:sendEncodingParameters,recvEncodingParameters:recvEncodingParameters},self._transceive(self.transceivers[sdpMLineIndex],!1,\"sendrecv\"===direction||\"sendonly\"===direction)}}),this.remoteDescription={type:description.type,sdp:description.sdp},description.type){case\"offer\":this._updateSignalingState(\"have-remote-offer\");break;case\"answer\":this._updateSignalingState(\"stable\");break;default:throw new TypeError('unsupported type \"'+description.type+'\"')}return stream.getTracks().length&&(self.remoteStreams.push(stream),window.setTimeout(function(){var event=new Event(\"addstream\");event.stream=stream,self.dispatchEvent(event),null!==self.onaddstream&&window.setTimeout(function(){self.onaddstream(event)},0),receiverList.forEach(function(item){var track=item[0],receiver=item[1],trackEvent=new Event(\"track\");trackEvent.track=track,trackEvent.receiver=receiver,\ntrackEvent.streams=[stream],self.dispatchEvent(event),null!==self.ontrack&&window.setTimeout(function(){self.ontrack(trackEvent)},0)})},0)),arguments.length>1&&\"function\"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(transceiver){transceiver.iceTransport&&transceiver.iceTransport.stop(),transceiver.dtlsTransport&&transceiver.dtlsTransport.stop(),transceiver.rtpSender&&transceiver.rtpSender.stop(),transceiver.rtpReceiver&&transceiver.rtpReceiver.stop()}),this._updateSignalingState(\"closed\")},window.RTCPeerConnection.prototype._updateSignalingState=function(newState){this.signalingState=newState;var event=new Event(\"signalingstatechange\");this.dispatchEvent(event),null!==this.onsignalingstatechange&&this.onsignalingstatechange(event)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var event=new Event(\"negotiationneeded\");this.dispatchEvent(event),null!==this.onnegotiationneeded&&this.onnegotiationneeded(event)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var newState,self=this,states={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(transceiver){states[transceiver.iceTransport.state]++,states[transceiver.dtlsTransport.state]++}),states.connected+=states.completed,newState=\"new\",states.failed>0?newState=\"failed\":states.connecting>0||states.checking>0?newState=\"connecting\":states.disconnected>0?newState=\"disconnected\":states.new>0?newState=\"new\":(states.connected>0||states.completed>0)&&(newState=\"connected\"),newState!==self.iceConnectionState){self.iceConnectionState=newState;var event=new Event(\"iceconnectionstatechange\");this.dispatchEvent(event),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(event)}},window.RTCPeerConnection.prototype.createOffer=function(){var self=this;if(this._pendingOffer)throw new Error(\"createOffer called while there is a pending offer.\");var offerOptions;1===arguments.length&&\"function\"!=typeof arguments[0]?offerOptions=arguments[0]:3===arguments.length&&(offerOptions=arguments[2]);var tracks=[],numAudioTracks=0,numVideoTracks=0;if(this.localStreams.length&&(numAudioTracks=this.localStreams[0].getAudioTracks().length,numVideoTracks=this.localStreams[0].getVideoTracks().length),offerOptions){if(offerOptions.mandatory||offerOptions.optional)throw new TypeError(\"Legacy mandatory/optional constraints not supported.\");void 0!==offerOptions.offerToReceiveAudio&&(numAudioTracks=offerOptions.offerToReceiveAudio),void 0!==offerOptions.offerToReceiveVideo&&(numVideoTracks=offerOptions.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(track){tracks.push({kind:track.kind,track:track,wantReceive:\"audio\"===track.kind?numAudioTracks>0:numVideoTracks>0}),\"audio\"===track.kind?numAudioTracks--:\"video\"===track.kind&&numVideoTracks--});numAudioTracks>0||numVideoTracks>0;)numAudioTracks>0&&(tracks.push({kind:\"audio\",wantReceive:!0}),numAudioTracks--),numVideoTracks>0&&(tracks.push({kind:\"video\",wantReceive:!0}),numVideoTracks--);var sdp=SDPUtils.writeSessionBoilerplate(),transceivers=[];tracks.forEach(function(mline,sdpMLineIndex){var rtpSender,rtpReceiver,track=mline.track,kind=mline.kind,mid=SDPUtils.generateIdentifier(),transports=self.usingBundle&&sdpMLineIndex>0?{iceGatherer:transceivers[0].iceGatherer,iceTransport:transceivers[0].iceTransport,dtlsTransport:transceivers[0].dtlsTransport}:self._createIceAndDtlsTransports(mid,sdpMLineIndex),localCapabilities=RTCRtpSender.getCapabilities(kind),sendEncodingParameters=[{ssrc:1001*(2*sdpMLineIndex+1)}];track&&(rtpSender=new RTCRtpSender(track,transports.dtlsTransport)),mline.wantReceive&&(rtpReceiver=new RTCRtpReceiver(transports.dtlsTransport,kind)),transceivers[sdpMLineIndex]={iceGatherer:transports.iceGatherer,iceTransport:transports.iceTransport,dtlsTransport:transports.dtlsTransport,localCapabilities:localCapabilities,remoteCapabilities:null,rtpSender:rtpSender,rtpReceiver:rtpReceiver,kind:kind,mid:mid,sendEncodingParameters:sendEncodingParameters,recvEncodingParameters:null}}),this.usingBundle&&(sdp+=\"a=group:BUNDLE \"+transceivers.map(function(t){return t.mid}).join(\" \")+\"\\r\\n\"),tracks.forEach(function(mline,sdpMLineIndex){var transceiver=transceivers[sdpMLineIndex];sdp+=SDPUtils.writeMediaSection(transceiver,transceiver.localCapabilities,\"offer\",self.localStreams[0])}),this._pendingOffer=transceivers;var desc=new RTCSessionDescription({type:\"offer\",sdp:sdp});return arguments.length&&\"function\"==typeof arguments[0]&&window.setTimeout(arguments[0],0,desc),Promise.resolve(desc)},window.RTCPeerConnection.prototype.createAnswer=function(){var self=this,sdp=SDPUtils.writeSessionBoilerplate();this.usingBundle&&(sdp+=\"a=group:BUNDLE \"+this.transceivers.map(function(t){return t.mid}).join(\" \")+\"\\r\\n\"),this.transceivers.forEach(function(transceiver){if(transceiver.isDatachannel)return void(sdp+=\"m=application 0 DTLS/SCTP 5000\\r\\nc=IN IP4 0.0.0.0\\r\\na=mid:\"+transceiver.mid+\"\\r\\n\");var commonCapabilities=self._getCommonCapabilities(transceiver.localCapabilities,transceiver.remoteCapabilities);sdp+=SDPUtils.writeMediaSection(transceiver,commonCapabilities,\"answer\",self.localStreams[0])});var desc=new RTCSessionDescription({type:\"answer\",sdp:sdp});return arguments.length&&\"function\"==typeof arguments[0]&&window.setTimeout(arguments[0],0,desc),Promise.resolve(desc)},window.RTCPeerConnection.prototype.addIceCandidate=function(candidate){if(null===candidate)this.transceivers.forEach(function(transceiver){transceiver.iceTransport.addRemoteCandidate({})});else{var mLineIndex=candidate.sdpMLineIndex;if(candidate.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===candidate.sdpMid){mLineIndex=i;break}var transceiver=this.transceivers[mLineIndex];if(transceiver){var cand=Object.keys(candidate.candidate).length>0?SDPUtils.parseCandidate(candidate.candidate):{};if(\"tcp\"===cand.protocol&&(0===cand.port||9===cand.port))return;if(\"1\"!==cand.component)return;\"endOfCandidates\"===cand.type&&(cand={}),transceiver.iceTransport.addRemoteCandidate(cand);var sections=SDPUtils.splitSections(this.remoteDescription.sdp);sections[mLineIndex+1]+=(cand.type?candidate.candidate.trim():\"a=end-of-candidates\")+\"\\r\\n\",this.remoteDescription.sdp=sections.join(\"\")}}return arguments.length>1&&\"function\"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var promises=[];this.transceivers.forEach(function(transceiver){[\"rtpSender\",\"rtpReceiver\",\"iceGatherer\",\"iceTransport\",\"dtlsTransport\"].forEach(function(method){transceiver[method]&&promises.push(transceiver[method].getStats())})});var cb=arguments.length>1&&\"function\"==typeof arguments[1]&&arguments[1];return new Promise(function(resolve){var results=new Map;Promise.all(promises).then(function(res){res.forEach(function(result){Object.keys(result).forEach(function(id){results.set(id,result[id]),results[id]=result[id]})}),cb&&window.setTimeout(cb,0,results),resolve(results)})})}}};module.exports={shimPeerConnection:edgeShim.shimPeerConnection,shimGetUserMedia:requirecopy(\"./getusermedia\")}},{\"../utils\":10,\"./getusermedia\":6,sdp:1}],6:[function(requirecopy,module,exports){\"use strict\";module.exports=function(){var shimError_=function(e){return{name:{PermissionDeniedError:\"NotAllowedError\"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).catch(function(e){return Promise.reject(shimError_(e))})}}},{}],7:[function(requirecopy,module,exports){\"use strict\";var browserDetails=requirecopy(\"../utils\").browserDetails,firefoxShim={shimOnTrack:function(){\"object\"!=typeof window||!window.RTCPeerConnection||\"ontrack\"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,\"ontrack\",{get:function(){return this._ontrack},set:function(f){this._ontrack&&(this.removeEventListener(\"track\",this._ontrack),this.removeEventListener(\"addstream\",this._ontrackpoly)),this.addEventListener(\"track\",this._ontrack=f),this.addEventListener(\"addstream\",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(track){var event=new Event(\"track\");event.track=track,event.receiver={track:track},event.streams=[e.stream],this.dispatchEvent(event)}.bind(this))}.bind(this))}})},shimSourceObject:function(){\"object\"==typeof window&&(!window.HTMLMediaElement||\"srcObject\"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,\"srcObject\",{get:function(){return this.mozSrcObject},set:function(stream){this.mozSrcObject=stream}}))},shimPeerConnection:function(){if(\"object\"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(pcConfig,pcConstraints){if(browserDetails.version<38&&pcConfig&&pcConfig.iceServers){for(var newIceServers=[],i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];if(server.hasOwnProperty(\"urls\"))for(var j=0;j<server.urls.length;j++){var newServer={url:server.urls[j]};0===server.urls[j].indexOf(\"turn\")&&(newServer.username=server.username,newServer.credential=server.credential),newIceServers.push(newServer)}else newIceServers.push(pcConfig.iceServers[i])}pcConfig.iceServers=newIceServers}return new mozRTCPeerConnection(pcConfig,pcConstraints)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,\"generateCertificate\",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),[\"setLocalDescription\",\"setRemoteDescription\",\"addIceCandidate\"].forEach(function(method){var nativeMethod=RTCPeerConnection.prototype[method];RTCPeerConnection.prototype[method]=function(){return arguments[0]=new(\"addIceCandidate\"===method?RTCIceCandidate:RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}});var nativeAddIceCandidate=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():nativeAddIceCandidate.apply(this,arguments)};var makeMapStats=function(stats){var map=new Map;return Object.keys(stats).forEach(function(key){map.set(key,stats[key]),map[key]=stats[key]}),map},nativeGetStats=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(selector,onSucc,onErr){return nativeGetStats.apply(this,[selector||null]).then(function(stats){return makeMapStats(stats)}).then(onSucc,onErr)}}}};module.exports={shimOnTrack:firefoxShim.shimOnTrack,shimSourceObject:firefoxShim.shimSourceObject,shimPeerConnection:firefoxShim.shimPeerConnection,shimGetUserMedia:requirecopy(\"./getusermedia\")}},{\"../utils\":10,\"./getusermedia\":8}],8:[function(requirecopy,module,exports){\"use strict\";var logging=requirecopy(\"../utils\").log,browserDetails=requirecopy(\"../utils\").browserDetails;module.exports=function(){var shimError_=function(e){return{name:{SecurityError:\"NotAllowedError\",PermissionDeniedError:\"NotAllowedError\"}[e.name]||e.name,message:{\"The operation is insecure.\":\"The request is not allowed by the user agent or the platform in the current context.\"}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&\": \")+this.message}}},getUserMedia_=function(constraints,onSuccess,onError){var constraintsToFF37_=function(c){if(\"object\"!=typeof c||c.require)return c;var require=[];return Object.keys(c).forEach(function(key){if(\"require\"!==key&&\"advanced\"!==key&&\"mediaSource\"!==key){var r=c[key]=\"object\"==typeof c[key]?c[key]:{ideal:c[key]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||require.push(key),void 0!==r.exact&&(\"number\"==typeof r.exact?r.min=r.max=r.exact:c[key]=r.exact,delete r.exact),void 0!==r.ideal){c.advanced=c.advanced||[];var oc={};\"number\"==typeof r.ideal?oc[key]={min:r.ideal,max:r.ideal}:oc[key]=r.ideal,c.advanced.push(oc),delete r.ideal,Object.keys(r).length||delete c[key]}}}),require.length&&(c.require=require),c};return constraints=JSON.parse(JSON.stringify(constraints)),browserDetails.version<38&&(logging(\"spec: \"+JSON.stringify(constraints)),constraints.audio&&(constraints.audio=constraintsToFF37_(constraints.audio)),constraints.video&&(constraints.video=constraintsToFF37_(constraints.video)),logging(\"ff37: \"+JSON.stringify(constraints))),navigator.mozGetUserMedia(constraints,onSuccess,function(e){onError(shimError_(e))})},getUserMediaPromise_=function(constraints){return new Promise(function(resolve,reject){getUserMedia_(constraints,resolve,reject)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:getUserMediaPromise_,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(resolve){var infos=[{kind:\"audioinput\",deviceId:\"default\",label:\"\",groupId:\"\"},{kind:\"videoinput\",deviceId:\"default\",label:\"\",groupId:\"\"}];resolve(infos)})},browserDetails.version<41){var orgEnumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return orgEnumerateDevices().then(void 0,function(e){if(\"NotFoundError\"===e.name)return[];throw e})}}if(browserDetails.version<49){var origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return origGetUserMedia(c).catch(function(e){return Promise.reject(shimError_(e))})}}navigator.getUserMedia=function(constraints,onSuccess,onError){return browserDetails.version<44?getUserMedia_(constraints,onSuccess,onError):void navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)}}},{\"../utils\":10}],9:[function(requirecopy,module,exports){\"use strict\";var safariShim={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};module.exports={shimGetUserMedia:safariShim.shimGetUserMedia}},{}],10:[function(requirecopy,module,exports){\"use strict\";var logDisabled_=!0,utils={disableLog:function(bool){return\"boolean\"!=typeof bool?new Error(\"Argument type: \"+typeof bool+\". Please use a boolean.\"):(logDisabled_=bool,bool?\"adapter.js logging disabled\":\"adapter.js logging enabled\")},log:function(){if(\"object\"==typeof window){if(logDisabled_)return;\"undefined\"!=typeof console&&\"function\"==typeof console.log}},extractVersion:function(uastring,expr,pos){var match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)},detectBrowser:function(){var result={};if(result.browser=null,result.version=null,\"undefined\"==typeof window||!window.navigator)return result.browser=\"Not a browser.\",result;if(navigator.mozGetUserMedia)result.browser=\"firefox\",result.version=this.extractVersion(navigator.userAgent,/Firefox\\/([0-9]+)\\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)result.browser=\"chrome\",result.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\\/([0-9]+)\\./,2);else{if(!navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/))return result.browser=\"Unsupported webkit-based browser with GUM support but no WebRTC support.\",result;result.browser=\"safari\",result.version=this.extractVersion(navigator.userAgent,/AppleWebKit\\/([0-9]+)\\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/))return result.browser=\"Not a supported browser.\",result;result.browser=\"edge\",result.version=this.extractVersion(navigator.userAgent,/Edge\\/(\\d+).(\\d+)$/,2)}return result}};module.exports={log:utils.log,disableLog:utils.disableLog,browserDetails:utils.detectBrowser(),extractVersion:utils.extractVersion}},{}]},{},[2])(2)}),AdapterJS.parseWebrtcDetectedBrowser(),navigator.mozGetUserMedia?(MediaStreamTrack.getSources=function(successCb){setTimeout(function(){var infos=[{kind:\"audio\",id:\"default\",label:\"\",facing:\"\"},{kind:\"video\",id:\"default\",label:\"\",facing:\"\"}];successCb(infos)},0)},attachMediaStream=function(element,stream){return element.srcObject=stream,element},reattachMediaStream=function(to,from){return to.srcObject=from.srcObject,to},createIceServer=function(url,username,password){var iceServer=null,urlParts=url.split(\":\");if(0===urlParts[0].indexOf(\"stun\"))iceServer={urls:[url]};else if(0===urlParts[0].indexOf(\"turn\"))if(webrtcDetectedVersion<27){var turnUrlParts=url.split(\"?\");1!==turnUrlParts.length&&0!==turnUrlParts[1].indexOf(\"transport=udp\")||(iceServer={urls:[turnUrlParts[0]],credential:password,username:username})}else iceServer={urls:[url],credential:password,username:username};return iceServer},createIceServers=function(urls,username,password){var iceServers=[];for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers}):navigator.webkitGetUserMedia?(attachMediaStream=function(element,stream){return webrtcDetectedVersion>=43?element.srcObject=stream:\"undefined\"!=typeof element.src&&(element.src=URL.createObjectURL(stream)),element},reattachMediaStream=function(to,from){return webrtcDetectedVersion>=43?to.srcObject=from.srcObject:to.src=from.src,to},createIceServer=function(url,username,password){var iceServer=null,urlParts=url.split(\":\");return 0===urlParts[0].indexOf(\"stun\")?iceServer={url:url}:0===urlParts[0].indexOf(\"turn\")&&(iceServer={url:url,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){var iceServers=[];if(webrtcDetectedVersion>=34)iceServers={urls:urls,credential:password,username:username};else for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers}):navigator.mediaDevices&&navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)&&(attachMediaStream=function(element,stream){return element.srcObject=stream,element},reattachMediaStream=function(to,from){return to.srcObject=from.srcObject,to}),attachMediaStream_base=attachMediaStream,\"opera\"===webrtcDetectedBrowser&&(attachMediaStream_base=function(element,stream){webrtcDetectedVersion>38?element.srcObject=stream:\"undefined\"!=typeof element.src&&(element.src=URL.createObjectURL(stream))}),attachMediaStream=function(element,stream){return\"chrome\"!==webrtcDetectedBrowser&&\"opera\"!==webrtcDetectedBrowser||stream?attachMediaStream_base(element,stream):element.src=\"\",element},reattachMediaStream_base=reattachMediaStream,reattachMediaStream=function(to,from){return reattachMediaStream_base(to,from),to},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=function(constraints,onSuccess,onFailure){navigator.getUserMedia(constraints,onSuccess,onFailure)},AdapterJS.attachMediaStream=attachMediaStream,AdapterJS.reattachMediaStream=reattachMediaStream,AdapterJS.getUserMedia=getUserMedia,\"undefined\"==typeof Promise&&(requestUserMedia=null),AdapterJS.maybeThroughWebRTCReady()),\"undefined\"!=typeof exports&&(module.exports=AdapterJS);\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = AdapterJS;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/exports-loader?AdapterJS!./~/adapterjs/publish/adapter.min.js\n// module id = 294\n// module chunks = 0","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 295\n// module chunks = 0","// This method of obtaining a reference to the global object needs to be\n// kept identical to the way it is obtained in runtime.js\nvar g =\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this;\n\n// Use `getOwnPropertyNames` because not all browsers support calling\n// `hasOwnProperty` on the global `self` object in a worker. See #183.\nvar hadRuntime = g.regeneratorRuntime &&\n  Object.getOwnPropertyNames(g).indexOf(\"regeneratorRuntime\") >= 0;\n\n// Save the old regeneratorRuntime in case it needs to be restored later.\nvar oldRuntime = hadRuntime && g.regeneratorRuntime;\n\n// Force reevalutation of runtime.js.\ng.regeneratorRuntime = undefined;\n\nmodule.exports = require(\"./runtime\");\n\nif (hadRuntime) {\n  // Restore the original runtime.\n  g.regeneratorRuntime = oldRuntime;\n} else {\n  // Remove the global property added by runtime.js.\n  try {\n    delete g.regeneratorRuntime;\n  } catch(e) {\n    g.regeneratorRuntime = undefined;\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/regenerator-runtime/runtime-module.js\n// module id = 296\n// module chunks = 0","/**\n * Copyright (c) 2014, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * https://raw.github.com/facebook/regenerator/master/LICENSE file. An\n * additional grant of patent rights can be found in the PATENTS file in\n * the same directory.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    if (typeof process === \"object\" && process.domain) {\n      invoke = process.domain.bind(invoke);\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          if (method === \"return\" ||\n              (method === \"throw\" && delegate.iterator[method] === undefined)) {\n            // A return or throw (when the delegate iterator has no throw\n            // method) always terminates the yield* loop.\n            context.delegate = null;\n\n            // If the delegate iterator has a return method, give it a\n            // chance to clean up.\n            var returnMethod = delegate.iterator[\"return\"];\n            if (returnMethod) {\n              var record = tryCatch(returnMethod, delegate.iterator, arg);\n              if (record.type === \"throw\") {\n                // If the return method threw an exception, let that\n                // exception prevail over the original return or throw.\n                method = \"throw\";\n                arg = record.arg;\n                continue;\n              }\n            }\n\n            if (method === \"return\") {\n              // Continue with the outer return, now that the delegate\n              // iterator has been terminated.\n              continue;\n            }\n          }\n\n          var record = tryCatch(\n            delegate.iterator[method],\n            delegate.iterator,\n            arg\n          );\n\n          if (record.type === \"throw\") {\n            context.delegate = null;\n\n            // Like returning generator.throw(uncaught), but without the\n            // overhead of an extra function call.\n            method = \"throw\";\n            arg = record.arg;\n            continue;\n          }\n\n          // Delegate generator ran and handled its own exceptions so\n          // regardless of what the method was, we continue as if it is\n          // \"next\" with an undefined arg.\n          method = \"next\";\n          arg = undefined;\n\n          var info = record.arg;\n          if (info.done) {\n            context[delegate.resultName] = info.value;\n            context.next = delegate.nextLoc;\n          } else {\n            state = GenStateSuspendedYield;\n            return info;\n          }\n\n          context.delegate = null;\n        }\n\n        if (method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = arg;\n\n        } else if (method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw arg;\n          }\n\n          if (context.dispatchException(arg)) {\n            // If the dispatched exception was caught by a catch block,\n            // then let that catch block handle the exception normally.\n            method = \"next\";\n            arg = undefined;\n          }\n\n        } else if (method === \"return\") {\n          context.abrupt(\"return\", arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          var info = {\n            value: record.arg,\n            done: context.done\n          };\n\n          if (record.arg === ContinueSentinel) {\n            if (context.delegate && method === \"next\") {\n              // Deliberately forget the last sent value so that we don't\n              // accidentally pass it on to the delegate.\n              arg = undefined;\n            }\n          } else {\n            return info;\n          }\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(arg) call above.\n          method = \"throw\";\n          arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n        return !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.next = finallyEntry.finallyLoc;\n      } else {\n        this.complete(record);\n      }\n\n      return ContinueSentinel;\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = record.arg;\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // Among the various tricks for obtaining a reference to the global\n  // object, this seems to be the most reliable technique that does not\n  // use indirect eval (which violates Content Security Policy).\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this\n);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/regenerator-runtime/runtime.js\n// module id = 297\n// module chunks = 0","/* Copyright @ 2015 Atlassian Pty Ltd\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nmodule.exports = function arrayEquals(array) {\n    // if the other array is a falsy value, return\n    if (!array)\n        return false;\n\n    // compare lengths - can save a lot of time\n    if (this.length != array.length)\n        return false;\n\n    for (var i = 0, l = this.length; i < l; i++) {\n        // Check if we have nested arrays\n        if (this[i] instanceof Array && array[i] instanceof Array) {\n            // recurse into the nested arrays\n            if (!arrayEquals.apply(this[i], [array[i]]))\n                return false;\n        } else if (this[i] != array[i]) {\n            // Warning - two different object instances will never be equal:\n            // {x:20} != {x:20}\n            return false;\n        }\n    }\n    return true;\n};\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-interop/lib/array-equals.js\n// module id = 298\n// module chunks = 0","/* Copyright @ 2015 Atlassian Pty Ltd\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexports.Interop = require('./interop');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-interop/lib/index.js\n// module id = 299\n// module chunks = 0","/* Copyright @ 2015 Atlassian Pty Ltd\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* global RTCSessionDescription */\n/* jshint -W097 */\n\"use strict\";\n\nvar transform = require('./transform');\nvar arrayEquals = require('./array-equals');\n\nfunction Interop() {\n\n    /**\n     * This map holds the most recent Unified Plan offer/answer SDP that was\n     * converted to Plan B, with the SDP type ('offer' or 'answer') as keys and\n     * the SDP string as values.\n     *\n     * @type {{}}\n     */\n    this.cache = {};\n}\n\nmodule.exports = Interop;\n\n/**\n * Returns the index of the first m-line with the given media type and with a\n * direction which allows sending, in the last Unified Plan description with\n * type \"answer\" converted to Plan B. Returns {null} if there is no saved\n * answer, or if none of its m-lines with the given type allow sending.\n * @param type the media type (\"audio\" or \"video\").\n * @returns {*}\n */\nInterop.prototype.getFirstSendingIndexFromAnswer = function(type) {\n    if (!this.cache.answer) {\n        return null;\n    }\n\n    var session = transform.parse(this.cache.answer);\n    if (session && session.media && Array.isArray(session.media)){\n        for (var i = 0; i < session.media.length; i++) {\n            if (session.media[i].type == type &&\n                (!session.media[i].direction /* default to sendrecv */ ||\n                    session.media[i].direction === 'sendrecv' ||\n                    session.media[i].direction === 'sendonly')){\n                return i;\n            }\n        }\n    }\n\n    return null;\n};\n\n/**\n * This method transforms a Unified Plan SDP to an equivalent Plan B SDP. A\n * PeerConnection wrapper transforms the SDP to Plan B before passing it to the\n * application.\n *\n * @param desc\n * @returns {*}\n */\nInterop.prototype.toPlanB = function(desc) {\n    var self = this;\n    //#region Preliminary input validation.\n\n    if (typeof desc !== 'object' || desc === null ||\n        typeof desc.sdp !== 'string') {\n        console.warn('An empty description was passed as an argument.');\n        return desc;\n    }\n\n    // Objectify the SDP for easier manipulation.\n    var session = transform.parse(desc.sdp);\n\n    // If the SDP contains no media, there's nothing to transform.\n    if (typeof session.media === 'undefined' ||\n        !Array.isArray(session.media) || session.media.length === 0) {\n        console.warn('The description has no media.');\n        return desc;\n    }\n\n    // Try some heuristics to \"make sure\" this is a Unified Plan SDP. Plan B\n    // SDP has a video, an audio and a data \"channel\" at most.\n    if (session.media.length <= 3 && session.media.every(function(m) {\n            return ['video', 'audio', 'data'].indexOf(m.mid) !== -1;\n        })) {\n        console.warn('This description does not look like Unified Plan.');\n        return desc;\n    }\n\n    //#endregion\n\n    // HACK https://bugzilla.mozilla.org/show_bug.cgi?id=1113443\n    var sdp = desc.sdp;\n    var rewrite = false;\n    for (var i = 0; i < session.media.length; i++) {\n        var uLine = session.media[i];\n        uLine.rtp.forEach(function(rtp) {\n            if (rtp.codec === 'NULL')\n            {\n                rewrite = true;\n                var offer = transform.parse(self.cache['offer']);\n                rtp.codec = offer.media[i].rtp[0].codec;\n            }\n        });\n    };\n    if (rewrite) {\n        sdp = transform.write(session);\n    }\n\n    // Unified Plan SDP is our \"precious\". Cache it for later use in the Plan B\n    // -> Unified Plan transformation.\n    this.cache[desc.type] = sdp;\n\n    //#region Convert from Unified Plan to Plan B.\n\n    // We rebuild the session.media array.\n    var media = session.media;\n    session.media = [];\n\n    // Associative array that maps channel types to channel objects for fast\n    // access to channel objects by their type, e.g. type2bl['audio']->channel\n    // obj.\n    var type2bl = {};\n\n    // Used to build the group:BUNDLE value after the channels construction\n    // loop.\n    var types = [];\n\n    // Implode the Unified Plan m-lines/tracks into Plan B channels.\n    media.forEach(function(uLine) {\n\n        // rtcp-mux is required in the Plan B SDP.\n        if ((typeof uLine.rtcpMux !== 'string' ||\n            uLine.rtcpMux !== 'rtcp-mux') &&\n            uLine.direction !== 'inactive') {\n            throw new Error('Cannot convert to Plan B because m-lines ' +\n                'without the rtcp-mux attribute were found.');\n        }\n\n        if (uLine.type === 'application') {\n            session.media.push(uLine);\n            types.push(uLine.mid);\n            return;\n        }\n\n        // If we don't have a channel for this uLine.type, then use this\n        // uLine as the channel basis.\n        if (typeof type2bl[uLine.type] === 'undefined') {\n            type2bl[uLine.type] = uLine;\n        }\n\n        // Add sources to the channel and handle a=msid.\n        if (typeof uLine.sources === 'object') {\n            Object.keys(uLine.sources).forEach(function(ssrc) {\n                if (typeof type2bl[uLine.type].sources !== 'object')\n                    type2bl[uLine.type].sources = {};\n\n                // Assign the sources to the channel.\n                type2bl[uLine.type].sources[ssrc] =\n                    uLine.sources[ssrc];\n\n                if (typeof uLine.msid !== 'undefined') {\n                    // In Plan B the msid is an SSRC attribute. Also, we don't\n                    // care about the obsolete label and mslabel attributes.\n                    //\n                    // Note that it is not guaranteed that the uLine will\n                    // have an msid. recvonly channels in particular don't have\n                    // one.\n                    type2bl[uLine.type].sources[ssrc].msid =\n                        uLine.msid;\n                }\n                // NOTE ssrcs in ssrc groups will share msids, as\n                // draft-uberti-rtcweb-plan-00 mandates.\n            });\n        }\n\n        // Add ssrc groups to the channel.\n        if (typeof uLine.ssrcGroups !== 'undefined' &&\n                Array.isArray(uLine.ssrcGroups)) {\n\n            // Create the ssrcGroups array, if it's not defined.\n            if (typeof type2bl[uLine.type].ssrcGroups === 'undefined' ||\n                    !Array.isArray(type2bl[uLine.type].ssrcGroups)) {\n                type2bl[uLine.type].ssrcGroups = [];\n            }\n\n            type2bl[uLine.type].ssrcGroups =\n                type2bl[uLine.type].ssrcGroups.concat(\n                    uLine.ssrcGroups);\n        }\n\n        if (type2bl[uLine.type] === uLine) {\n            // Copy ICE related stuff from the principal media line.\n            uLine.candidates = media[0].candidates;\n            uLine.iceUfrag = media[0].iceUfrag;\n            uLine.icePwd = media[0].icePwd;\n            uLine.fingerprint = media[0].fingerprint;\n\n            // Plan B mids are in ['audio', 'video', 'data']\n            uLine.mid = uLine.type;\n\n            // Plan B doesn't support/need the bundle-only attribute.\n            delete uLine.bundleOnly;\n\n            // In Plan B the msid is an SSRC attribute.\n            delete uLine.msid;\n\n            // Used to build the group:BUNDLE value after this loop.\n            types.push(uLine.type);\n\n            // Add the channel to the new media array.\n            session.media.push(uLine);\n        }\n    });\n\n    // We regenerate the BUNDLE group with the new mids.\n    session.groups.some(function(group) {\n        if (group.type === 'BUNDLE') {\n            group.mids = types.join(' ');\n            return true;\n        }\n    });\n\n    // msid semantic\n    session.msidSemantic = {\n        semantic: 'WMS',\n        token: '*'\n    };\n\n    var resStr = transform.write(session);\n\n    return new RTCSessionDescription({\n        type: desc.type,\n        sdp: resStr\n    });\n\n    //#endregion\n};\n\n/**\n * This method transforms a Plan B SDP to an equivalent Unified Plan SDP. A\n * PeerConnection wrapper transforms the SDP to Unified Plan before passing it\n * to FF.\n *\n * @param desc\n * @returns {*}\n */\nInterop.prototype.toUnifiedPlan = function(desc) {\n    var self = this;\n    //#region Preliminary input validation.\n\n    if (typeof desc !== 'object' || desc === null ||\n        typeof desc.sdp !== 'string') {\n        console.warn('An empty description was passed as an argument.');\n        return desc;\n    }\n\n    var session = transform.parse(desc.sdp);\n\n    // If the SDP contains no media, there's nothing to transform.\n    if (typeof session.media === 'undefined' ||\n        !Array.isArray(session.media) || session.media.length === 0) {\n        console.warn('The description has no media.');\n        return desc;\n    }\n\n    // Try some heuristics to \"make sure\" this is a Plan B SDP. Plan B SDP has\n    // a video, an audio and a data \"channel\" at most.\n    if (session.media.length > 3 || !session.media.every(function(m) {\n            return ['video', 'audio', 'data'].indexOf(m.mid) !== -1;\n        })) {\n        console.warn('This description does not look like Plan B.');\n        return desc;\n    }\n\n    // Make sure this Plan B SDP can be converted to a Unified Plan SDP.\n    var mids = [];\n    session.media.forEach(function(m) {\n        mids.push(m.mid);\n    });\n\n    var hasBundle = false;\n    if (typeof session.groups !== 'undefined' &&\n        Array.isArray(session.groups)) {\n        hasBundle = session.groups.every(function(g) {\n            return g.type !== 'BUNDLE' ||\n                arrayEquals.apply(g.mids.sort(), [mids.sort()]);\n        });\n    }\n\n    if (!hasBundle) {\n        throw new Error(\"Cannot convert to Unified Plan because m-lines that\" +\n            \" are not bundled were found.\");\n    }\n\n    //#endregion\n\n\n    //#region Convert from Plan B to Unified Plan.\n\n    // Unfortunately, a Plan B offer/answer doesn't have enough information to\n    // rebuild an equivalent Unified Plan offer/answer.\n    //\n    // For example, if this is a local answer (in Unified Plan style) that we\n    // convert to Plan B prior to handing it over to the application (the\n    // PeerConnection wrapper called us, for instance, after a successful\n    // createAnswer), we want to remember the m-line at which we've seen the\n    // (local) SSRC. That's because when the application wants to do call the\n    // SLD method, forcing us to do the inverse transformation (from Plan B to\n    // Unified Plan), we need to know to which m-line to assign the (local)\n    // SSRC. We also need to know all the other m-lines that the original\n    // answer had and include them in the transformed answer as well.\n    //\n    // Another example is if this is a remote offer that we convert to Plan B\n    // prior to giving it to the application, we want to remember the mid at\n    // which we've seen the (remote) SSRC.\n    //\n    // In the iteration that follows, we use the cached Unified Plan (if it\n    // exists) to assign mids to ssrcs.\n\n    var cached;\n    if (typeof this.cache[desc.type] !== 'undefined') {\n        cached = transform.parse(this.cache[desc.type]);\n    }\n\n    var recvonlySsrcs = {\n        audio: {},\n        video: {}\n    };\n\n    // A helper map that sends mids to m-line objects. We use it later to\n    // rebuild the Unified Plan style session.media array.\n    var mid2ul = {};\n    session.media.forEach(function(bLine) {\n        if ((typeof bLine.rtcpMux !== 'string' ||\n            bLine.rtcpMux !== 'rtcp-mux') &&\n            bLine.direction !== 'inactive') {\n            throw new Error(\"Cannot convert to Unified Plan because m-lines \" +\n                \"without the rtcp-mux attribute were found.\");\n        }\n\n        if (bLine.type === 'application') {\n            mid2ul[bLine.mid] = bLine;\n            return;\n        }\n\n        // With rtcp-mux and bundle all the channels should have the same ICE\n        // stuff.\n        var sources = bLine.sources;\n        var ssrcGroups = bLine.ssrcGroups;\n        var candidates = bLine.candidates;\n        var iceUfrag = bLine.iceUfrag;\n        var icePwd = bLine.icePwd;\n        var fingerprint = bLine.fingerprint;\n        var port = bLine.port;\n\n        // We'll use the \"bLine\" object as a prototype for each new \"mLine\"\n        // that we create, but first we need to clean it up a bit.\n        delete bLine.sources;\n        delete bLine.ssrcGroups;\n        delete bLine.candidates;\n        delete bLine.iceUfrag;\n        delete bLine.icePwd;\n        delete bLine.fingerprint;\n        delete bLine.port;\n        delete bLine.mid;\n\n        // inverted ssrc group map\n        var ssrc2group = {};\n        if (typeof ssrcGroups !== 'undefined' && Array.isArray(ssrcGroups)) {\n            ssrcGroups.forEach(function (ssrcGroup) {\n\n                // TODO(gp) find out how to receive simulcast with FF. For the\n                // time being, hide it.\n                if (ssrcGroup.semantics === 'SIM') {\n                    return;\n                }\n\n                // XXX This might brake if an SSRC is in more than one group\n                // for some reason.\n                if (typeof ssrcGroup.ssrcs !== 'undefined' &&\n                    Array.isArray(ssrcGroup.ssrcs)) {\n                    ssrcGroup.ssrcs.forEach(function (ssrc) {\n                        if (typeof ssrc2group[ssrc] === 'undefined') {\n                            ssrc2group[ssrc] = [];\n                        }\n\n                        ssrc2group[ssrc].push(ssrcGroup);\n                    });\n                }\n            });\n        }\n\n        // ssrc to m-line index.\n        var ssrc2ml = {};\n\n        if (typeof sources === 'object') {\n\n            // Explode the Plan B channel sources with one m-line per source.\n            Object.keys(sources).forEach(function(ssrc) {\n\n                // The (unified) m-line for this SSRC. We either create it from\n                // scratch or, if it's a grouped SSRC, we re-use a related\n                // mline. In other words, if the source is grouped with another\n                // source, put the two together in the same m-line.\n                var uLine;\n\n                // We assume here that we are the answerer in the O/A, so any\n                // offers which we translate come from the remote side, while\n                // answers are local. So the check below is to make that we\n                // handle receive-only SSRCs in a special way only if they come\n                // from the remote side.\n                if (desc.type==='offer') {\n                    // We want to detect SSRCs which are used by a remote peer\n                    // in an m-line with direction=recvonly (i.e. they are\n                    // being used for RTCP only).\n                    // This information would have gotten lost if the remote\n                    // peer used Unified Plan and their local description was\n                    // translated to Plan B. So we use the lack of an MSID\n                    // attribute to deduce a \"receive only\" SSRC.\n                    if (!sources[ssrc].msid) {\n                        recvonlySsrcs[bLine.type][ssrc] = sources[ssrc];\n                        // Receive-only SSRCs must not create new m-lines. We\n                        // will assign them to an existing m-line later.\n                        return;\n                    }\n                }\n\n                if (typeof ssrc2group[ssrc] !== 'undefined' &&\n                    Array.isArray(ssrc2group[ssrc])) {\n                    ssrc2group[ssrc].some(function (ssrcGroup) {\n                        // ssrcGroup.ssrcs *is* an Array, no need to check\n                        // again here.\n                        return ssrcGroup.ssrcs.some(function (related) {\n                            if (typeof ssrc2ml[related] === 'object') {\n                                uLine = ssrc2ml[related];\n                                return true;\n                            }\n                        });\n                    });\n                }\n\n                if (typeof uLine === 'object') {\n                    // the m-line already exists. Just add the source.\n                    uLine.sources[ssrc] = sources[ssrc];\n                    delete sources[ssrc].msid;\n                } else {\n                    // Use the \"bLine\" as a prototype for the \"uLine\".\n                    uLine = Object.create(bLine);\n                    ssrc2ml[ssrc] = uLine;\n\n                    if (typeof sources[ssrc].msid !== 'undefined') {\n                        // Assign the msid of the source to the m-line. Note\n                        // that it is not guaranteed that the source will have\n                        // msid. In particular \"recvonly\" sources don't have an\n                        // msid. Note that \"recvonly\" is a term only defined\n                        // for m-lines.\n                        uLine.msid = sources[ssrc].msid;\n                        uLine.direction = 'sendrecv';\n                        delete sources[ssrc].msid;\n                    }\n\n                    // We assign one SSRC per media line.\n                    uLine.sources = {};\n                    uLine.sources[ssrc] = sources[ssrc];\n                    uLine.ssrcGroups = ssrc2group[ssrc];\n\n                    // Use the cached Unified Plan SDP (if it exists) to assign\n                    // SSRCs to mids.\n                    if (typeof cached !== 'undefined' &&\n                        typeof cached.media !== 'undefined' &&\n                        Array.isArray(cached.media)) {\n\n                        cached.media.forEach(function (m) {\n                            if (typeof m.sources === 'object') {\n                                Object.keys(m.sources).forEach(function (s) {\n                                    if (s === ssrc) {\n                                        uLine.mid = m.mid;\n                                    }\n                                });\n                            }\n                        });\n                    }\n\n                    if (typeof uLine.mid === 'undefined') {\n\n                        // If this is an SSRC that we see for the first time\n                        // assign it a new mid. This is typically the case when\n                        // this method is called to transform a remote\n                        // description for the first time or when there is a\n                        // new SSRC in the remote description because a new\n                        // peer has joined the conference. Local SSRCs should\n                        // have already been added to the map in the toPlanB\n                        // method.\n                        //\n                        // Because FF generates answers in Unified Plan style,\n                        // we MUST already have a cached answer with all the\n                        // local SSRCs mapped to some m-line/mid.\n\n                        if (desc.type === 'answer') {\n                            throw new Error(\"An unmapped SSRC was found.\");\n                        }\n\n                        uLine.mid = [bLine.type, '-', ssrc].join('');\n                    }\n\n                    // Include the candidates in the 1st media line.\n                    uLine.candidates = candidates;\n                    uLine.iceUfrag = iceUfrag;\n                    uLine.icePwd = icePwd;\n                    uLine.fingerprint = fingerprint;\n                    uLine.port = port;\n\n                    mid2ul[uLine.mid] = uLine;\n                }\n            });\n        }\n    });\n\n    // Rebuild the media array in the right order and add the missing mLines\n    // (missing from the Plan B SDP).\n    session.media = [];\n    mids = []; // reuse\n\n    if (desc.type === 'answer') {\n\n        // The media lines in the answer must match the media lines in the\n        // offer. The order is important too. Here we assume that Firefox is\n        // the answerer, so we merely have to use the reconstructed (unified)\n        // answer to update the cached (unified) answer accordingly.\n        //\n        // In the general case, one would have to use the cached (unified)\n        // offer to find the m-lines that are missing from the reconstructed\n        // answer, potentially grabbing them from the cached (unified) answer.\n        // One has to be careful with this approach because inactive m-lines do\n        // not always have an mid, making it tricky (impossible?) to find where\n        // exactly and which m-lines are missing from the reconstructed answer.\n\n        for (var i = 0; i < cached.media.length; i++) {\n            var uLine = cached.media[i];\n\n            if (typeof mid2ul[uLine.mid] === 'undefined') {\n\n                // The mid isn't in the reconstructed (unified) answer.\n                // This is either a (unified) m-line containing a remote\n                // track only, or a (unified) m-line containing a remote\n                // track and a local track that has been removed.\n                // In either case, it MUST exist in the cached\n                // (unified) answer.\n                //\n                // In case this is a removed local track, clean-up\n                // the (unified) m-line and make sure it's 'recvonly' or\n                // 'inactive'.\n\n                delete uLine.msid;\n                delete uLine.sources;\n                delete uLine.ssrcGroups;\n                if (!uLine.direction\n                    || uLine.direction === 'sendrecv')\n                    uLine.direction = 'recvonly';\n                else if (uLine.direction === 'sendonly')\n                    uLine.direction = 'inactive';\n            } else {\n                // This is an (unified) m-line/channel that contains a local\n                // track (sendrecv or sendonly channel) or it's a unified\n                // recvonly m-line/channel. In either case, since we're\n                // going from PlanB -> Unified Plan this m-line MUST\n                // exist in the cached answer.\n            }\n\n            session.media.push(uLine);\n\n            if (typeof uLine.mid === 'string') {\n                // inactive lines don't/may not have an mid.\n                mids.push(uLine.mid);\n            }\n        }\n    } else {\n\n        // SDP offer/answer (and the JSEP spec) forbids removing an m-section\n        // under any circumstances. If we are no longer interested in sending a\n        // track, we just remove the msid and ssrc attributes and set it to\n        // either a=recvonly (as the reofferer, we must use recvonly if the\n        // other side was previously sending on the m-section, but we can also\n        // leave the possibility open if it wasn't previously in use), or\n        // a=inactive.\n\n        if (typeof cached !== 'undefined' &&\n            typeof cached.media !== 'undefined' &&\n            Array.isArray(cached.media)) {\n            cached.media.forEach(function(uLine) {\n                mids.push(uLine.mid);\n                if (typeof mid2ul[uLine.mid] !== 'undefined') {\n                    session.media.push(mid2ul[uLine.mid]);\n                } else {\n                    delete uLine.msid;\n                    delete uLine.sources;\n                    delete uLine.ssrcGroups;\n                    if (!uLine.direction\n                        || uLine.direction === 'sendrecv')\n                        uLine.direction = 'recvonly';\n                    if (!uLine.direction\n                        || uLine.direction === 'sendonly')\n                        uLine.direction = 'inactive';\n                    session.media.push(uLine);\n                }\n            });\n        }\n\n        // Add all the remaining (new) m-lines of the transformed SDP.\n        Object.keys(mid2ul).forEach(function(mid) {\n            if (mids.indexOf(mid) === -1) {\n                mids.push(mid);\n                if (mid2ul[mid].direction === 'recvonly') {\n                    // This is a remote recvonly channel. Add its SSRC to the\n                    // appropriate sendrecv or sendonly channel.\n                    // TODO(gp) what if we don't have sendrecv/sendonly\n                    // channel?\n\n                    session.media.some(function (uLine) {\n                        if ((uLine.direction === 'sendrecv' ||\n                            uLine.direction === 'sendonly') &&\n                            uLine.type === mid2ul[mid].type) {\n\n                            // mid2ul[mid] shouldn't have any ssrc-groups\n                            Object.keys(mid2ul[mid].sources).forEach(\n                                function (ssrc) {\n                                uLine.sources[ssrc] =\n                                    mid2ul[mid].sources[ssrc];\n                            });\n\n                            return true;\n                        }\n                    });\n                } else {\n                    session.media.push(mid2ul[mid]);\n                }\n            }\n        });\n    }\n\n    // After we have constructed the Plan Unified m-lines we can figure out\n    // where (in which m-line) to place the 'recvonly SSRCs'.\n    // Note: we assume here that we are the answerer in the O/A, so any offers\n    // which we translate come from the remote side, while answers are local\n    // (and so our last local description is cached as an 'answer').\n    [\"audio\", \"video\"].forEach(function (type) {\n        if (!session || !session.media || !Array.isArray(session.media))\n            return;\n\n        var idx = null;\n        if (Object.keys(recvonlySsrcs[type]).length > 0) {\n            idx = self.getFirstSendingIndexFromAnswer(type);\n            if (idx === null){\n                // If this is the first offer we receive, we don't have a\n                // cached answer. Assume that we will be sending media using\n                // the first m-line for each media type.\n\n                for (var i = 0; i < session.media.length; i++) {\n                    if (session.media[i].type === type) {\n                        idx = i;\n                        break;\n                    }\n                }\n            }\n        }\n\n        if (idx && session.media.length > idx) {\n            var mLine = session.media[idx];\n            Object.keys(recvonlySsrcs[type]).forEach(function(ssrc) {\n                if (mLine.sources && mLine.sources[ssrc]) {\n                    console.warn(\"Replacing an existing SSRC.\");\n                }\n                if (!mLine.sources) {\n                    mLine.sources = {};\n                }\n\n                mLine.sources[ssrc] = recvonlySsrcs[type][ssrc];\n            });\n        }\n    });\n\n    // We regenerate the BUNDLE group (since we regenerated the mids)\n    session.groups.some(function(group) {\n        if (group.type === 'BUNDLE') {\n            group.mids = mids.join(' ');\n            return true;\n        }\n    });\n\n    // msid semantic\n    session.msidSemantic = {\n        semantic: 'WMS',\n        token: '*'\n    };\n\n    var resStr = transform.write(session);\n\n    // Cache the transformed SDP (Unified Plan) for later re-use in this\n    // function.\n    this.cache[desc.type] = resStr;\n\n    return new RTCSessionDescription({\n        type: desc.type,\n        sdp: resStr\n    });\n\n    //#endregion\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-interop/lib/interop.js\n// module id = 300\n// module chunks = 0","/* Copyright @ 2015 Atlassian Pty Ltd\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar transform = require('sdp-transform');\n\nexports.write = function(session, opts) {\n\n  if (typeof session !== 'undefined' &&\n      typeof session.media !== 'undefined' &&\n      Array.isArray(session.media)) {\n\n    session.media.forEach(function (mLine) {\n      // expand sources to ssrcs\n      if (typeof mLine.sources !== 'undefined' &&\n        Object.keys(mLine.sources).length !== 0) {\n          mLine.ssrcs = [];\n          Object.keys(mLine.sources).forEach(function (ssrc) {\n            var source = mLine.sources[ssrc];\n            Object.keys(source).forEach(function (attribute) {\n              mLine.ssrcs.push({\n                id: ssrc,\n                attribute: attribute,\n                value: source[attribute]\n              });\n            });\n          });\n          delete mLine.sources;\n        }\n\n      // join ssrcs in ssrc groups\n      if (typeof mLine.ssrcGroups !== 'undefined' &&\n        Array.isArray(mLine.ssrcGroups)) {\n          mLine.ssrcGroups.forEach(function (ssrcGroup) {\n            if (typeof ssrcGroup.ssrcs !== 'undefined' &&\n                Array.isArray(ssrcGroup.ssrcs)) {\n              ssrcGroup.ssrcs = ssrcGroup.ssrcs.join(' ');\n            }\n          });\n        }\n    });\n  }\n\n  // join group mids\n  if (typeof session !== 'undefined' &&\n      typeof session.groups !== 'undefined' && Array.isArray(session.groups)) {\n\n    session.groups.forEach(function (g) {\n      if (typeof g.mids !== 'undefined' && Array.isArray(g.mids)) {\n        g.mids = g.mids.join(' ');\n      }\n    });\n  }\n\n  return transform.write(session, opts);\n};\n\nexports.parse = function(sdp) {\n  var session = transform.parse(sdp);\n\n  if (typeof session !== 'undefined' && typeof session.media !== 'undefined' &&\n      Array.isArray(session.media)) {\n\n    session.media.forEach(function (mLine) {\n      // group sources attributes by ssrc\n      if (typeof mLine.ssrcs !== 'undefined' && Array.isArray(mLine.ssrcs)) {\n        mLine.sources = {};\n        mLine.ssrcs.forEach(function (ssrc) {\n          if (!mLine.sources[ssrc.id])\n          mLine.sources[ssrc.id] = {};\n        mLine.sources[ssrc.id][ssrc.attribute] = ssrc.value;\n        });\n\n        delete mLine.ssrcs;\n      }\n\n      // split ssrcs in ssrc groups\n      if (typeof mLine.ssrcGroups !== 'undefined' &&\n        Array.isArray(mLine.ssrcGroups)) {\n          mLine.ssrcGroups.forEach(function (ssrcGroup) {\n            if (typeof ssrcGroup.ssrcs === 'string') {\n              ssrcGroup.ssrcs = ssrcGroup.ssrcs.split(' ');\n            }\n          });\n        }\n    });\n  }\n  // split group mids\n  if (typeof session !== 'undefined' &&\n      typeof session.groups !== 'undefined' && Array.isArray(session.groups)) {\n\n    session.groups.forEach(function (g) {\n      if (typeof g.mids === 'string') {\n        g.mids = g.mids.split(' ');\n      }\n    });\n  }\n\n  return session;\n};\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-interop/lib/transform.js\n// module id = 301\n// module chunks = 0","var parser = require('./parser');\nvar writer = require('./writer');\n\nexports.write = writer;\nexports.parse = parser.parse;\nexports.parseFmtpConfig = parser.parseFmtpConfig;\nexports.parsePayloads = parser.parsePayloads;\nexports.parseRemoteCandidates = parser.parseRemoteCandidates;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-transform/lib/index.js\n// module id = 302\n// module chunks = 0","var toIntIfInt = function (v) {\n  return String(Number(v)) === v ? Number(v) : v;\n};\n\nvar attachProperties = function (match, location, names, rawName) {\n  if (rawName && !names) {\n    location[rawName] = toIntIfInt(match[1]);\n  }\n  else {\n    for (var i = 0; i < names.length; i += 1) {\n      if (match[i+1] != null) {\n        location[names[i]] = toIntIfInt(match[i+1]);\n      }\n    }\n  }\n};\n\nvar parseReg = function (obj, location, content) {\n  var needsBlank = obj.name && obj.names;\n  if (obj.push && !location[obj.push]) {\n    location[obj.push] = [];\n  }\n  else if (needsBlank && !location[obj.name]) {\n    location[obj.name] = {};\n  }\n  var keyLocation = obj.push ?\n    {} :  // blank object that will be pushed\n    needsBlank ? location[obj.name] : location; // otherwise, named location or root\n\n  attachProperties(content.match(obj.reg), keyLocation, obj.names, obj.name);\n\n  if (obj.push) {\n    location[obj.push].push(keyLocation);\n  }\n};\n\nvar grammar = require('./grammar');\nvar validLine = RegExp.prototype.test.bind(/^([a-z])=(.*)/);\n\nexports.parse = function (sdp) {\n  var session = {}\n    , media = []\n    , location = session; // points at where properties go under (one of the above)\n\n  // parse lines we understand\n  sdp.split(/(\\r\\n|\\r|\\n)/).filter(validLine).forEach(function (l) {\n    var type = l[0];\n    var content = l.slice(2);\n    if (type === 'm') {\n      media.push({rtp: [], fmtp: []});\n      location = media[media.length-1]; // point at latest media line\n    }\n\n    for (var j = 0; j < (grammar[type] || []).length; j += 1) {\n      var obj = grammar[type][j];\n      if (obj.reg.test(content)) {\n        return parseReg(obj, location, content);\n      }\n    }\n  });\n\n  session.media = media; // link it up\n  return session;\n};\n\nvar fmtpReducer = function (acc, expr) {\n  var s = expr.split('=');\n  if (s.length === 2) {\n    acc[s[0]] = toIntIfInt(s[1]);\n  }\n  return acc;\n};\n\nexports.parseFmtpConfig = function (str) {\n  return str.split(/\\;\\s?/).reduce(fmtpReducer, {});\n};\n\nexports.parsePayloads = function (str) {\n  return str.split(' ').map(Number);\n};\n\nexports.parseRemoteCandidates = function (str) {\n  var candidates = [];\n  var parts = str.split(' ').map(toIntIfInt);\n  for (var i = 0; i < parts.length; i += 3) {\n    candidates.push({\n      component: parts[i],\n      ip: parts[i + 1],\n      port: parts[i + 2]\n    });\n  }\n  return candidates;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-transform/lib/parser.js\n// module id = 303\n// module chunks = 0","var grammar = require('./grammar');\n\n// customized util.format - discards excess arguments and can void middle ones\nvar formatRegExp = /%[sdv%]/g;\nvar format = function (formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n    var arg = args[i];\n    i += 1;\n    switch (x) {\n      case '%%':\n        return '%';\n      case '%s':\n        return String(arg);\n      case '%d':\n        return Number(arg);\n      case '%v':\n        return '';\n    }\n  });\n  // NB: we discard excess arguments - they are typically undefined from makeLine\n};\n\nvar makeLine = function (type, obj, location) {\n  var str = obj.format instanceof Function ?\n    (obj.format(obj.push ? location : location[obj.name])) :\n    obj.format;\n\n  var args = [type + '=' + str];\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      }\n      else { // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  }\n  else {\n    args.push(location[obj.name]);\n  }\n  return format.apply(null, args);\n};\n\n// RFC specified order\n// TODO: extend this with all the rest\nvar defaultOuterOrder = [\n  'v', 'o', 's', 'i',\n  'u', 'e', 'p', 'c',\n  'b', 't', 'r', 'z', 'a'\n];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\n\n\nmodule.exports = function (session, opts) {\n  opts = opts || {};\n  // ensure certain properties exist\n  if (session.version == null) {\n    session.version = 0; // \"v=0\" must be there (only defined version atm)\n  }\n  if (session.name == null) {\n    session.name = \" \"; // \"s= \" must be there if no meaningful name set\n  }\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = \"\";\n    }\n  });\n\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = [];\n\n  // loop through outerOrder for matching properties on session\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      }\n      else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  });\n\n  // then for each media line, follow the innerOrder\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        }\n        else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n\n  return sdp.join('\\r\\n') + '\\r\\n';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/sdp-transform/lib/writer.js\n// module id = 304\n// module chunks = 0"],"sourceRoot":""}